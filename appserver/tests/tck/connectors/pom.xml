<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright (c) 2021, 2025 Contributors to the Eclipse Foundation. All rights reserved.

    This program and the accompanying materials are made available under the
    terms of the Eclipse Public License v. 2.0, which is available at
    http://www.eclipse.org/legal/epl-2.0.

    This Source Code may also be made available under the following Secondary
    Licenses when the conditions for such availability set forth in the
    Eclipse Public License v. 2.0 are satisfied: GNU General Public License,
    version 2 with the GNU Classpath Exception, which is available at
    https://www.gnu.org/software/classpath/license.html.

    SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0

-->

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.glassfish.main.tests.tck</groupId>
        <artifactId>tck</artifactId>
        <version>8.0.0-M14</version>
    </parent>

    <artifactId>tck-connectors</artifactId>
    <name>TCK: Connectors</name>

    <properties>
        <glassfish.major>8</glassfish.major>
        <glassfish.home>${project.build.directory}/glassfish${glassfish.major}</glassfish.home>
        <glassfish.domain.dir>${glassfish.home}/glassfish/domains/domain1</glassfish.domain.dir>
        <glassfish.lib.dir>${glassfish.home}/glassfish/lib</glassfish.lib.dir>
        <whitebox.directory>${project.build.directory}/whiteboxes</whitebox.directory>

        <tck.version>11.0.1</tck.version>
        <tck.arquillian.version>11.1.0</tck.arquillian.version>
        <tck.test.user1>j2ee</tck.test.user1>
        <tck.test.user2>javajoe</tck.test.user2>
        <tck.reportDirectory>${project.build.directory}/report</tck.reportDirectory>
        <tck.workDirectory>${project.build.directory}/work</tck.workDirectory>
        <tck.tssql>${project.build.testOutputDirectory}/ts.sql</tck.tssql>
        <tck.tsjte>${project.build.testOutputDirectory}/ts.jte</tck.tsjte>
        <tck.clientDirectory>${project.build.directory}</tck.clientDirectory>
    </properties>

    <dependencies>
        <dependency>
            <groupId>org.glassfish.main.distributions</groupId>
            <artifactId>glassfish</artifactId>
            <type>zip</type>
        </dependency>
        <dependency>
            <groupId>org.glassfish.main.tests.tck</groupId>
            <artifactId>glassfish-runner</artifactId>
            <version>${project.version}</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>jakarta.tck</groupId>
            <artifactId>connector</artifactId>
            <version>${tck.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>jakarta.tck</groupId>
            <artifactId>common</artifactId>
            <version>${tck.arquillian.version}</version>
            <scope>runtime</scope>
            <exclusions>
                <exclusion>
                    <groupId>commons-logging</groupId>
                    <artifactId>commons-logging</artifactId>
                </exclusion>
            </exclusions>
        </dependency>

        <dependency>
            <groupId>jakarta.tck.arquillian</groupId>
            <artifactId>arquillian-protocol-lib</artifactId>
            <version>${tck.arquillian.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>jakarta.tck.arquillian</groupId>
            <artifactId>arquillian-protocol-common</artifactId>
            <version>${tck.arquillian.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>jakarta.tck.arquillian</groupId>
            <artifactId>arquillian-protocol-javatest</artifactId>
            <version>${tck.arquillian.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>jakarta.tck.arquillian</groupId>
            <artifactId>arquillian-protocol-appclient</artifactId>
            <version>${tck.arquillian.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>jakarta.tck.arquillian</groupId>
            <artifactId>tck-porting-lib</artifactId>
            <version>${tck.arquillian.version}</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-engine</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>${junit.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.junit.vintage</groupId>
            <artifactId>junit-vintage-engine</artifactId>
            <version>${junit.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.jboss.arquillian.container</groupId>
            <artifactId>arquillian-container-test-spi</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.jboss.arquillian.junit5</groupId>
            <artifactId>arquillian-junit5-container</artifactId>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>ee.omnifish.arquillian</groupId>
            <artifactId>arquillian-glassfish-server-managed</artifactId>
        </dependency>
        <dependency>
            <groupId>ee.omnifish.arquillian</groupId>
            <artifactId>glassfish-client-ee11</artifactId>
        </dependency>

        <dependency>
            <groupId>org.glassfish.main</groupId>
            <artifactId>glassfish-jul-extension</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-jdk14</artifactId>
            <version>2.0.17</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>jcl-over-slf4j</artifactId>
            <version>2.0.17</version>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <testResources>
            <testResource>
                <directory>src/test/resources</directory>
                <filtering>true</filtering>
                <includes>
                    <include>**/*</include>
                </includes>
            </testResource>
        </testResources>

        <plugins>
            <plugin>
                <artifactId>maven-dependency-plugin</artifactId>
                <configuration>
                    <skip>${skipITs}</skip>
                </configuration>
                <executions>
                    <execution>
                        <id>unpack-glassfish</id>
                        <phase>pre-integration-test</phase>
                        <goals>
                            <goal>unpack-dependencies</goal>
                        </goals>
                        <configuration>
                            <includeArtifactIds>glassfish</includeArtifactIds>
                            <outputDirectory>${project.build.directory}</outputDirectory>
                        </configuration>
                    </execution>
                    <execution>
                        <id>install-arquillian-libs</id>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <phase>initialize</phase>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>jakarta.tck.arquillian</groupId>
                                    <artifactId>tck-porting-lib</artifactId>
                                    <version>${tck.arquillian.version}</version>
                                    <outputDirectory>${project.build.directory}/lib</outputDirectory>
                                    <destFileName>tck-porting-lib.jar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck.arquillian</groupId>
                                    <artifactId>arquillian-protocol-lib</artifactId>
                                    <version>${tck.arquillian.version}</version>
                                    <outputDirectory>${glassfish.lib.dir}</outputDirectory>
                                    <destFileName>arquillian-protocol-lib.jar</destFileName>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                    <execution>
                        <id>install-whiteboxes</id>
                        <phase>pre-integration-test</phase>
                        <goals>
                            <goal>copy</goal>
                        </goals>
                        <configuration>
                            <artifactItems>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>whitebox</artifactId>
                                    <version>${tck.version}</version>
                                    <outputDirectory>${glassfish.lib.dir}</outputDirectory>
                                    <destFileName>whitebox.jar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>annotated</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-anno_no_md.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>ibanno</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-ibanno_no_md.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>mdcomplete</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-mdcomplete.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>mixedmode</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-mixedmode.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>multianno</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-multianno.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>whitebox-notx</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-notx.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>whitebox-notx-param</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-notx-param.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>whitebox-tx</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-tx.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>whitebox-tx-param</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-tx-param.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>whitebox-xa</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-xa.rar</destFileName>
                                </artifactItem>
                                <artifactItem>
                                    <groupId>jakarta.tck</groupId>
                                    <artifactId>whitebox-xa-param</artifactId>
                                    <version>${tck.version}</version>
                                    <type>rar</type>
                                    <outputDirectory>${whitebox.directory}</outputDirectory>
                                    <destFileName>whitebox-xa-param.rar</destFileName>
                                </artifactItem>
                            </artifactItems>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <plugin>
                <artifactId>maven-failsafe-plugin</artifactId>
                <configuration>
                    <dependenciesToScan>jakarta.tck:connector</dependenciesToScan>
                    <systemPropertyVariables>
                        <glassfish.home>${glassfish.home}</glassfish.home>
                        <glassfish.enableDerby>true</glassfish.enableDerby>
                        <glassfish.systemProperties>
                            j2eelogin.name=${tck.test.user1}
                            j2eelogin.password=${tck.test.user1}
                            eislogin.name=cts1
                            eislogin.password=cts1
                        </glassfish.systemProperties>
                        <glassfish.postBootCommands>
                            --passwordfile ${project.build.testOutputDirectory}/${tck.test.user1}.pass create-file-user --groups staff:mgr ${tck.test.user1}
                            --passwordfile ${project.build.testOutputDirectory}/${tck.test.user2}.pass create-file-user --groups guest ${tck.test.user2}
                            create-jdbc-connection-pool --restype javax.sql.DataSource --datasourceclassname org.apache.derby.jdbc.ClientDataSource --property databaseName=derbyDB:serverName=localhost:portNumber=1527:user=cts1:password=cts1:createDatabase=create cts-derby-pool
                            create-jdbc-resource --connectionpoolid cts-derby-pool jdbc/DB1
                            create-jdbc-connection-pool --restype javax.sql.XADataSource --datasourceclassname org.apache.derby.jdbc.ClientXADataSource --property serverName=localhost:portNumber=1527:user=cts1:password=cts1:DatabaseName=derbyDB:connectionAttributes=";create\=true;" --steadypoolsize 32 --maxpoolsize 64 cts-derby-XA-pool
                            create-jdbc-resource --connectionpoolid cts-derby-XA-pool eis/JDBCwhitebox-xa
                            create-jdbc-resource --connectionpoolid cts-derby-XA-pool eis/JDBCwhitebox-notx
                            list-jdbc-connection-pools
                            ping-connection-pool cts-derby-XA-pool
                            deploy ${whitebox.directory}/whitebox-tx.rar
                            create-connector-connection-pool --raname whitebox-tx --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-tx-pool.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-tx-pool.rar eis/whitebox-tx
                            deploy ${whitebox.directory}/whitebox-xa.rar
                            create-connector-connection-pool --raname whitebox-xa --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-xa-pool.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-xa-pool.rar eis/whitebox-xa
                            deploy ${whitebox.directory}/whitebox-notx.rar
                            create-connector-connection-pool --raname whitebox-notx --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-notx-pool.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-notx-pool.rar eis/whitebox-notx
                            deploy ${whitebox.directory}/whitebox-mdcomplete.rar
                            create-connector-connection-pool --raname whitebox-mdcomplete --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-mdcomplete-pool.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-mdcomplete-pool.rar eis/whitebox-mdcomplete
                            deploy ${whitebox.directory}/whitebox-anno_no_md.rar
                            create-connector-connection-pool --raname whitebox-anno_no_md --property eisPrincipalName=cts1:userName=${tck.test.user1}:password=cts1:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-anno_no_md-pool.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-anno_no_md-pool.rar eis/whitebox-anno_no_md
                            deploy ${whitebox.directory}/whitebox-mixedmode.rar
                            create-connector-connection-pool --raname whitebox-mixedmode --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-mixedmode-pool.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-mixedmode-pool.rar eis/whitebox-mixedmode
                            deploy ${whitebox.directory}/whitebox-multianno.rar
                            create-connector-connection-pool --raname whitebox-multianno --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-multianno.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-multianno.rar eis/whitebox-multianno
                            deploy ${whitebox.directory}/whitebox-tx-param.rar
                            create-connector-connection-pool --raname whitebox-tx-param --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-tx-param.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-tx-param.rar eis/whitebox-tx-param
                            deploy ${whitebox.directory}/whitebox-notx-param.rar
                            create-connector-connection-pool --raname whitebox-notx-param --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-notx-param.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-notx-param.rar eis/whitebox-notx-param
                            deploy ${whitebox.directory}/whitebox-xa-param.rar
                            create-connector-connection-pool --raname whitebox-xa-param --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-xa-param.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-xa-param.rar eis/whitebox-xa-param
                            deploy ${whitebox.directory}/whitebox-ibanno_no_md.rar
                            create-connector-connection-pool --raname whitebox-ibanno_no_md --property eisPrincipalName=${tck.test.user1}:userName=${tck.test.user1}:password=${tck.test.user1}:TSRValue=comp/TransactionSynchronizationRegistry --connectiondefinition com.sun.ts.tests.common.connector.whitebox.TSConnectionFactory cts-connector-pool-whitebox-ibanno_no_md.rar
                            create-connector-resource --poolname cts-connector-pool-whitebox-ibanno_no_md.rar eis/whitebox-ibanno_no_md
                            list-connector-resources
                            list-jndi-entries
                            create-jms-resource --restype jakarta.jms.QueueConnectionFactory jms/QueueConnectionFactory
                            create-jms-resource --restype jakarta.jms.Queue --property imqDestinationName=MDB_QUEUE_REPLY MDB_QUEUE
                            create-jms-resource --restype jakarta.jms.Queue --property imqDestinationName=MDB_QUEUE_REPLY MDB_QUEUE_REPLY
                        </glassfish.postBootCommands>
                    </systemPropertyVariables>
                </configuration>

                <executions>
                    <execution>
                        <id>tck-appclient</id>
                        <goals>
                            <goal>integration-test</goal>
                        </goals>
                        <configuration>
                            <groups>tck-appclient</groups>
                            <includes>
                                <include>**/ClientTest.*</include>
                                <include>**/*EjbTest.*</include>
                            </includes>
                            <systemPropertyVariables>
                                <arquillian.xml>arquillian-client.xml</arquillian.xml>
                            </systemPropertyVariables>
                        </configuration>
                    </execution>
                    <execution>
                        <id>tck-javatest</id>
                        <goals>
                            <goal>integration-test</goal>
                        </goals>
                        <configuration>
                            <groups>tck-javatest</groups>
                            <includes>
                                <include>**/ClientTest.class</include>
                                <include>**/*Servlet*.class</include>
                                <include>**/*Jsp**.class</include>
                            </includes>
                            <systemPropertyVariables>
                                <arquillian.xml>arquillian.xml</arquillian.xml>
                            </systemPropertyVariables>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>
