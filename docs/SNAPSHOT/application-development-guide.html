<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Eclipse GlassFish Application Development Guide, Release 7</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Eclipse GlassFish Application Development Guide, Release 7</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#eclipse-glassfish-server">1. Eclipse GlassFish</a></li>
<li><a href="#preface">2. Preface</a>
<ul class="sectlevel2">
<li><a href="#glassfish-server-documentation-set">Eclipse GlassFish Documentation Set</a></li>
<li><a href="#related-documentation">Related Documentation</a></li>
<li><a href="#typographic-conventions">Typographic Conventions</a></li>
<li><a href="#symbol-conventions">Symbol Conventions</a></li>
<li><a href="#default-paths-and-file-names">Default Paths and File Names</a></li>
</ul>
</li>
<li><a href="#part-i">Part I</a></li>
<li><a href="#development-tasks-and-tools">3. Development Tasks and Tools</a></li>
<li><a href="#setting-up-a-development-environment">4. Setting Up a Development Environment</a>
<ul class="sectlevel2">
<li><a href="#installing-and-preparing-the-server-for-development">Installing and Preparing the Server for Development</a></li>
<li><a href="#high-availability-features">High Availability Features</a></li>
<li><a href="#development-tools">Development Tools</a>
<ul class="sectlevel3">
<li><a href="#the-asadmin-command">The <code>asadmin</code> Command</a></li>
<li><a href="#the-administration-console">The Administration Console</a></li>
<li><a href="#the-migration-tool">The Migration Tool</a></li>
<li><a href="#the-netbeans-ide">Code Editors</a></li>
<li><a href="#debugging-tools">Debugging Tools</a></li>
<li><a href="#profiling-tools">Profiling Tools</a></li>
</ul>
</li>
<li><a href="#sample-applications">Sample Applications</a></li>
</ul>
</li>
<li><a href="#class-loaders">5. Class Loaders</a>
<ul class="sectlevel2">
<li><a href="#the-class-loader-hierarchy">The Class Loader Hierarchy</a></li>
<li><a href="#delegation">Delegation</a></li>
<li><a href="#using-the-java-optional-package-mechanism">Using the Java Optional Package Mechanism</a></li>
<li><a href="#using-the-endorsed-standards-override-mechanism">Using the Endorsed Standards Override Mechanism</a></li>
<li><a href="#class-loader-universes">Class Loader Universes</a></li>
<li><a href="#application-specific-class-loading">Application-Specific Class Loading</a></li>
<li><a href="#circumventing-class-loader-isolation">Circumventing Class Loader Isolation</a>
<ul class="sectlevel3">
<li><a href="#using-the-common-class-loader">Using the Common Class Loader</a></li>
<li><a href="#sharing-libraries-across-a-cluster">Sharing Libraries Across a Cluster</a></li>
<li><a href="#packaging-the-client-jar-for-one-application-in-another-application">Packaging the Client JAR for One Application in Another Application</a></li>
<li><a href="#to-package-the-client-jar-for-one-application-in-another-application">To Package the Client JAR for One Application in Another Application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#debugging-applications">6. Debugging Applications</a>
<ul class="sectlevel2">
<li><a href="#enabling-debugging">Enabling Debugging</a>
<ul class="sectlevel3">
<li><a href="#to-set-the-server-to-automatically-start-up-in-debug-mode">To Set the Server to Automatically Start Up in Debug Mode</a></li>
</ul>
</li>
<li><a href="#jpda-options">JPDA Options</a></li>
<li><a href="#generating-a-stack-trace-for-debugging">Generating a Stack Trace for Debugging</a></li>
<li><a href="#application-client-debugging">Application Client Debugging</a></li>
<li><a href="#open-message-queue-debugging">Open Message Queue Debugging</a></li>
<li><a href="#enabling-verbose-mode">Enabling Verbose Mode</a></li>
<li><a href="#class-loader-debugging">Class Loader Debugging</a></li>
<li><a href="#glassfish-server-logging">Eclipse GlassFish Logging</a></li>
<li><a href="#debug-profiling-tools">Profiling Tools</a>
<ul class="sectlevel3">
<li><a href="#the-netbeans-profiler">The NetBeans Profiler</a></li>
<li><a href="#the-hprof-profiler">The HPROF Profiler</a></li>
<li><a href="#the-jprobe-profiler">The JProbe Profiler</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-ii">Part II</a></li>
<li><a href="#developing-applications-and-application-components">7. Developing Applications and Application Components</a></li>
<li><a href="#api-for-dev">8. API for development</a>
<ul class="sectlevel2">
<li><a href="#glassfish-api">GlassFish API</a></li>
<li><a href="#glassfish-ee-api">GlassFish EE API</a></li>
<li><a href="#simple-glassfish-api">Simple GlassFish API</a></li>
</ul>
</li>
<li><a href="#securing-applications">9. Securing Applications</a>
<ul class="sectlevel2">
<li><a href="#security-goals">Security Goals</a></li>
<li><a href="#glassfish-server-specific-security-features">Eclipse GlassFish Specific Security Features</a></li>
<li><a href="#container-security">Container Security</a>
<ul class="sectlevel3">
<li><a href="#declarative-security">Declarative Security</a></li>
<li><a href="#programmatic-security">Programmatic Security</a></li>
</ul>
</li>
<li><a href="#roles-principals-and-principal-to-role-mapping">Roles, Principals, and Principal to Role Mapping</a></li>
<li><a href="#realm-configuration">Realm Configuration</a>
<ul class="sectlevel3">
<li><a href="#supported-realms">Supported Realms</a></li>
<li><a href="#how-to-configure-a-realm">How to Configure a Realm</a></li>
<li><a href="#how-to-set-a-realm-for-an-application-or-module">How to Set a Realm for an Application or Module</a></li>
<li><a href="#creating-a-custom-realm">Creating a Custom Realm</a></li>
</ul>
</li>
<li><a href="#java-ee-security-api-support">Jakarta EE Security API Support</a></li>
<li><a href="#jacc-support">JACC Support</a></li>
<li><a href="#pluggable-audit-module-support">Pluggable Audit Module Support</a>
<ul class="sectlevel3">
<li><a href="#configuring-an-audit-module">Configuring an Audit Module</a></li>
<li><a href="#the-auditmodule-class">The <code>AuditModule</code> Class</a></li>
</ul>
</li>
<li><a href="#the-server-policy-file">The <code>server.policy</code> File</a>
<ul class="sectlevel3">
<li><a href="#default-permissions">Default Permissions</a></li>
<li><a href="#system-properties">System Properties</a></li>
<li><a href="#changing-permissions-for-an-application">Changing Permissions for an Application</a></li>
<li><a href="#enabling-and-disabling-the-security-manager">Enabling and Disabling the Security Manager</a></li>
</ul>
</li>
<li><a href="#configuring-message-security-for-web-services">Configuring Message Security for Web Services</a>
<ul class="sectlevel3">
<li><a href="#message-security-providers">Message Security Providers</a></li>
<li><a href="#message-security-responsibilities">Message Security Responsibilities</a></li>
<li><a href="#application-specific-message-protection">Application-Specific Message Protection</a></li>
<li><a href="#understanding-and-running-the-sample-application">Understanding and Running the Sample Application</a></li>
</ul>
</li>
<li><a href="#programmatic-login-using-the-programmaticlogin-class">Programmatic Login Using the ProgrammaticLogin Class</a>
<ul class="sectlevel3">
<li><a href="#programmatic-login-precautions">Programmatic Login Precautions</a></li>
<li><a href="#granting-programmatic-login-permission">Granting Programmatic Login Permission</a></li>
<li><a href="#the-programmaticlogin-class">The <code>ProgrammaticLogin</code> Class</a></li>
</ul>
</li>
<li><a href="#user-authentication-for-single-sign-on">User Authentication for Single Sign-on</a></li>
<li><a href="#adding-authentication-mechanisms-to-the-servlet-container">Adding Authentication Mechanisms to the Servlet Container</a>
<ul class="sectlevel3">
<li><a href="#the-glassfish-server-and-jsr-375">The Eclipse GlassFish and JSR-375</a></li>
<li><a href="#the-glassfish-server-and-jsr-196">The Eclipse GlassFish and JSR 196</a></li>
<li><a href="#writing-a-server-authentication-module">Writing a Server Authentication Module</a></li>
<li><a href="#sample-server-authentication-module">Sample Server Authentication Module</a></li>
<li><a href="#compiling-and-installing-a-server-authentication-module">Compiling and Installing a Server Authentication Module</a></li>
<li><a href="#configuring-a-server-authentication-module">Configuring a Server Authentication Module</a></li>
<li><a href="#binding-a-server-authentication-module-to-your-application">Binding a Server Authentication Module to Your Application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#developing-web-services">10. Developing Web Services</a>
<ul class="sectlevel2">
<li><a href="#creating-portable-web-service-artifacts">Creating Portable Web Service Artifacts</a></li>
<li><a href="#deploying-a-web-service">Deploying a Web Service</a></li>
<li><a href="#the-web-service-uri-wsdl-file-and-test-page">The Web Service URI, WSDL File, and Test Page</a></li>
<li><a href="#the-databinding-provider">The Databinding Provider</a></li>
</ul>
</li>
<li><a href="#configuring-the-java-persistence-provider">11. Configuring the Java Persistence Provider</a>
<ul class="sectlevel2">
<li><a href="#overview-of-oracle-toplink">Overview of Oracle TopLink</a></li>
<li><a href="#using-oracle-toplink-in-glassfish-server">Using Oracle TopLink in Eclipse GlassFish</a></li>
<li><a href="#specifying-the-database-for-an-application">Specifying the Database for an Application</a></li>
<li><a href="#specifying-the-persistence-provider-for-an-application">Specifying the Persistence Provider for an Application</a></li>
<li><a href="#primary-key-generation-defaults">Primary Key Generation Defaults</a></li>
<li><a href="#automatic-schema-generation">Automatic Schema Generation</a>
<ul class="sectlevel3">
<li><a href="#annotations">Annotations</a></li>
<li><a href="#generation-options">Generation Options</a></li>
</ul>
</li>
<li><a href="#restrictions-and-optimizations">Restrictions and Optimizations</a>
<ul class="sectlevel3">
<li><a href="#oracle-database-enhancements">Oracle Database Enhancements</a></li>
<li><a href="#extended-persistence-context">Extended Persistence Context</a></li>
<li><a href="#using-orderby-with-a-shared-session-cache">Using @OrderBy with a Shared Session Cache</a></li>
<li><a href="#using-blob-or-clob-types-with-the-inet-oraxo-jdbc-driver">Using BLOB or CLOB Types with the Inet Oraxo JDBC Driver</a></li>
<li><a href="#database-case-sensitivity">Database Case Sensitivity</a></li>
<li><a href="#sybase-finder-limitation">Sybase Finder Limitation</a></li>
<li><a href="#mysql-database-restrictions">MySQL Database Restrictions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#developing-web-applications">12. Developing Web Applications</a>
<ul class="sectlevel2">
<li><a href="#using-servlets">Using Servlets</a>
<ul class="sectlevel3">
<li><a href="#caching-servlet-results">Caching Servlet Results</a></li>
<li><a href="#about-the-servlet-engine">About the Servlet Engine</a></li>
</ul>
</li>
<li><a href="#using-javaserver-pages">Using JavaServer Pages</a>
<ul class="sectlevel3">
<li><a href="#jsp-tag-libraries-and-standard-portable-tags">JSP Tag Libraries and Standard Portable Tags</a></li>
<li><a href="#jsp-caching">JSP Caching</a></li>
<li><a href="#options-for-compiling-jsp-files">Options for Compiling JSP Files</a></li>
</ul>
</li>
<li><a href="#creating-and-managing-sessions">Creating and Managing Sessions</a>
<ul class="sectlevel3">
<li><a href="#configuring-sessions">Configuring Sessions</a></li>
<li><a href="#session-managers">Session Managers</a></li>
</ul>
</li>
<li><a href="#using-comet">Using Comet</a>
<ul class="sectlevel3">
<li><a href="#introduction-to-comet">Introduction to Comet</a></li>
<li><a href="#grizzly-comet">Grizzly Comet</a></li>
<li><a href="#bayeux-protocol">Bayeux Protocol</a></li>
</ul>
</li>
<li><a href="#advanced-web-application-features">Advanced Web Application Features</a>
<ul class="sectlevel3">
<li><a href="#internationalization-issues">Internationalization Issues</a></li>
<li><a href="#virtual-server-properties">Virtual Server Properties</a></li>
<li><a href="#class-loader-delegation">Class Loader Delegation</a></li>
<li><a href="#using-the-default-web-xml-file">Using the <code>default-web.xml</code> File</a></li>
<li><a href="#configuring-logging-and-monitoring-in-the-web-container">Configuring Logging and Monitoring in the Web Container</a></li>
<li><a href="#configuring-idempotent-url-requests">Configuring Idempotent URL Requests</a></li>
<li><a href="#header-management">Header Management</a></li>
<li><a href="#configuring-valves-and-catalina-listeners">Configuring Valves and Catalina Listeners</a></li>
<li><a href="#alternate-document-roots">Alternate Document Roots</a></li>
<li><a href="#using-a-context-xml-file">Using a context.xml File</a></li>
<li><a href="#enabling-webdav">Enabling WebDav</a></li>
<li><a href="#using-ssi">Using SSI</a></li>
<li><a href="#using-cgi">Using CGI</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#using-enterprise-javabeans-technology">13. Using Enterprise JavaBeans Technology</a>
<ul class="sectlevel2">
<li><a href="#value-added-features">Value Added Features</a>
<ul class="sectlevel3">
<li><a href="#read-only-beans">Read-Only Beans</a></li>
<li><a href="#the-pass-by-reference-element">The <code>pass-by-reference</code> Element</a></li>
<li><a href="#pooling-and-caching">Pooling and Caching</a></li>
<li><a href="#priority-based-scheduling-of-remote-bean-invocations">Priority Based Scheduling of Remote Bean Invocations</a></li>
<li><a href="#immediate-flushing">Immediate Flushing</a></li>
</ul>
</li>
<li><a href="#ejb-timer-service">EJB Timer Service</a>
<ul class="sectlevel3">
<li><a href="#to-deploy-an-ejb-timer-to-a-cluster">To Deploy an EJB Timer to a Cluster</a></li>
</ul>
</li>
<li><a href="#using-session-beans">Using Session Beans</a>
<ul class="sectlevel3">
<li><a href="#about-the-session-bean-containers">About the Session Bean Containers</a></li>
<li><a href="#stateful-session-bean-failover">Stateful Session Bean Failover</a></li>
<li><a href="#session-bean-restrictions-and-optimizations">Session Bean Restrictions and Optimizations</a></li>
</ul>
</li>
<li><a href="#using-read-only-beans">Using Read-Only Beans</a>
<ul class="sectlevel3">
<li><a href="#read-only-bean-characteristics-and-life-cycle">Read-Only Bean Characteristics and Life Cycle</a></li>
<li><a href="#read-only-bean-good-practices">Read-Only Bean Good Practices</a></li>
<li><a href="#refreshing-read-only-beans">Refreshing Read-Only Beans</a></li>
<li><a href="#deploying-read-only-beans">Deploying Read-Only Beans</a></li>
</ul>
</li>
<li><a href="#using-message-driven-beans">Using Message-Driven Beans</a>
<ul class="sectlevel3">
<li><a href="#message-driven-bean-configuration">Message-Driven Bean Configuration</a></li>
<li><a href="#message-driven-bean-restrictions-and-optimizations">Message-Driven Bean Restrictions and Optimizations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#using-container-managed-persistence">14. Using Container-Managed Persistence</a>
<ul class="sectlevel2">
<li><a href="#glassfish-server-support-for-cmp">Eclipse GlassFish Support for CMP</a></li>
<li><a href="#cmp-mapping">CMP Mapping</a>
<ul class="sectlevel3">
<li><a href="#mapping-capabilities">Mapping Capabilities</a></li>
<li><a href="#the-mapping-deployment-descriptor-file">The Mapping Deployment Descriptor File</a></li>
<li><a href="#mapping-considerations">Mapping Considerations</a></li>
</ul>
</li>
<li><a href="#automatic-schema-generation-for-cmp">Automatic Schema Generation for CMP</a>
<ul class="sectlevel3">
<li><a href="#supported-data-types-for-cmp">Supported Data Types for CMP</a></li>
<li><a href="#generation-options-for-cmp">Generation Options for CMP</a></li>
</ul>
</li>
<li><a href="#schema-capture">Schema Capture</a>
<ul class="sectlevel3">
<li><a href="#automatic-database-schema-capture">Automatic Database Schema Capture</a></li>
<li><a href="#using-the-capture-schema-utility">Using the <code>capture-schema</code> Utility</a></li>
</ul>
</li>
<li><a href="#configuring-the-cmp-resource">Configuring the CMP Resource</a></li>
<li><a href="#performance-related-features">Performance-Related Features</a>
<ul class="sectlevel3">
<li><a href="#version-column-consistency-checking">Version Column Consistency Checking</a></li>
<li><a href="#relationship-prefetching">Relationship Prefetching</a></li>
<li><a href="#read-only-beans-2">Read-Only Beans</a></li>
</ul>
</li>
<li><a href="#default-fetch-group-flags">Default Fetch Group Flags</a></li>
<li><a href="#configuring-queries-for-1-1-finders">Configuring Queries for 1.1 Finders</a>
<ul class="sectlevel3">
<li><a href="#about-jdoql-queries">About JDOQL Queries</a></li>
<li><a href="#query-filter-expression">Query Filter Expression</a></li>
<li><a href="#query-parameters">Query Parameters</a></li>
<li><a href="#query-variables">Query Variables</a></li>
<li><a href="#jdoql-examples">JDOQL Examples</a></li>
</ul>
</li>
<li><a href="#cmp-restrictions-and-optimizations">CMP Restrictions and Optimizations</a>
<ul class="sectlevel3">
<li><a href="#disabling-order-by-validation">Disabling ORDER BY Validation</a></li>
<li><a href="#setting-the-heap-size-on-db2">Setting the Heap Size on DB2</a></li>
<li><a href="#eager-loading-of-field-state">Eager Loading of Field State</a></li>
<li><a href="#restrictions-on-remote-interfaces">Restrictions on Remote Interfaces</a></li>
<li><a href="#postgresql-case-insensitivity">PostgreSQL Case Insensitivity</a></li>
<li><a href="#no-support-for-lock-when-loaded-on-sybase">No Support for <code>lock-when-loaded</code> on Sybase</a></li>
<li><a href="#sybase-finder-limitation-2">Sybase Finder Limitation</a></li>
<li><a href="#date-and-time-fields">Date and Time Fields</a></li>
<li><a href="#set-recursive_triggers-to-false-on-mssql">Set <code>RECURSIVE_TRIGGERS</code> to <code>false</code> on MSSQL</a></li>
<li><a href="#mysql-database-restrictions-2">MySQL Database Restrictions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#developing-java-clients">15. Developing Java Clients</a>
<ul class="sectlevel2">
<li><a href="#introducing-the-application-client-container">Introducing the Application Client Container</a>
<ul class="sectlevel3">
<li><a href="#acc-security">ACC Security</a></li>
<li><a href="#acc-naming">ACC Naming</a></li>
<li><a href="#application-client-annotation">Application Client Annotation</a></li>
<li><a href="#java-web-start">Java Web Start</a></li>
<li><a href="#application-client-jar-file">Application Client JAR File</a></li>
</ul>
</li>
<li><a href="#developing-clients-using-the-acc">Developing Clients Using the ACC</a>
<ul class="sectlevel3">
<li><a href="#to-access-an-ejb-component-from-an-application-client">To Access an EJB Component From an Application Client</a></li>
<li><a href="#to-access-a-jms-resource-from-an-application-client">To Access a JMS Resource From an Application Client</a></li>
<li><a href="#using-java-web-start">Using Java Web Start</a></li>
<li><a href="#using-the-embeddable-acc">Using the Embeddable ACC</a></li>
<li><a href="#running-an-application-client-using-the-appclient-script">Running an Application Client Using the <code>appclient</code> Script</a></li>
<li><a href="#using-the-package-appclient-script">Using the <code>package-appclient</code> Script</a></li>
<li><a href="#the-client-policy-file">The <code>client.policy</code> File</a></li>
<li><a href="#using-rmiiiop-over-ssl">Using RMI/IIOP Over SSL</a></li>
<li><a href="#connecting-to-a-remote-ejb-module-through-a-firewall">Connecting to a Remote EJB Module Through a Firewall</a></li>
<li><a href="#specifying-a-splash-screen">Specifying a Splash Screen</a></li>
<li><a href="#setting-login-retries">Setting Login Retries</a></li>
<li><a href="#using-libraries-with-application-clients">Using Libraries with Application Clients</a></li>
</ul>
</li>
<li><a href="#developing-clients-without-the-acc">Developing Clients Without the ACC</a>
<ul class="sectlevel3">
<li><a href="#to-access-an-ejb-component-from-a-stand-alone-client">To access an EJB component from a stand-alone client</a></li>
<li><a href="#to-access-an-ejb-component-from-a-server-side-module">To access an EJB component from a server-side module</a></li>
<li><a href="#to-access-a-jms-resource-from-a-stand-alone-client">To access a JMS resource from a stand-alone client</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#developing-connectors">16. Developing Connectors</a>
<ul class="sectlevel2">
<li><a href="#connector-support-in-the-glassfish-server">Connector Support in the Eclipse GlassFish</a>
<ul class="sectlevel3">
<li><a href="#connector-architecture-for-jms-and-jdbc">Connector Architecture for JMS and JDBC</a></li>
<li><a href="#connector-configuration">Connector Configuration</a></li>
</ul>
</li>
<li><a href="#advanced-connector-configuration-options">Advanced Connector Configuration Options</a>
<ul class="sectlevel3">
<li><a href="#thread-associations">Thread Associations</a></li>
<li><a href="#security-maps">Security Maps</a></li>
<li><a href="#work-security-maps">Work Security Maps</a></li>
<li><a href="#overriding-configuration-properties">Overriding Configuration Properties</a></li>
<li><a href="#testing-a-connector-connection-pool">Testing a Connector Connection Pool</a></li>
<li><a href="#flushing-a-connector-connection-pool">Flushing a Connector Connection Pool</a></li>
<li><a href="#handling-invalid-connections">Handling Invalid Connections</a></li>
<li><a href="#setting-the-shutdown-timeout">Setting the Shutdown Timeout</a></li>
<li><a href="#specifying-the-class-loading-policy">Specifying the Class Loading Policy</a></li>
<li><a href="#using-last-agent-optimization-of-transactions">Using Last Agent Optimization of Transactions</a></li>
<li><a href="#disabling-pooling-for-a-connection">Disabling Pooling for a Connection</a></li>
<li><a href="#using-application-scoped-connectors">Using Application-Scoped Connectors</a></li>
</ul>
</li>
<li><a href="#inbound-communication-support">Inbound Communication Support</a></li>
<li><a href="#outbound-communication-support">Outbound Communication Support</a></li>
<li><a href="#configuring-a-message-driven-bean-to-use-a-resource-adapter">Configuring a Message Driven Bean to Use a Resource Adapter</a></li>
</ul>
</li>
<li><a href="#developing-lifecycle-listeners">17. Developing Lifecycle Listeners</a>
<ul class="sectlevel2">
<li><a href="#server-life-cycle-events">Server Life Cycle Events</a></li>
<li><a href="#the-lifecyclelistener-interface">The LifecycleListener Interface</a></li>
<li><a href="#the-lifecycleevent-class">The <code>LifecycleEvent</code> Class</a></li>
<li><a href="#the-server-lifecycle-event-context">The Server Lifecycle Event Context</a></li>
<li><a href="#deploying-a-lifecycle-module">Deploying a Lifecycle Module</a></li>
<li><a href="#considerations-for-lifecycle-modules">Considerations for Lifecycle Modules</a></li>
</ul>
</li>
<li><a href="#developing-osgi-enabled-java-ee-applications">18. Developing OSGi-enabled Jakarta EE Applications</a>
<ul class="sectlevel2">
<li><a href="#overview-of-osgi-application-and-glassfish-server">Overview of OSGi Application and Eclipse GlassFish</a>
<ul class="sectlevel3">
<li><a href="#benefits-of-using-osgi-in-enterprise-java-applications">Benefits of Using OSGi in Enterprise Java Applications</a></li>
</ul>
</li>
<li><a href="#developing-osgi-application-bundles-for-glassfish-server">Developing OSGi Application Bundles for Eclipse GlassFish</a>
<ul class="sectlevel3">
<li><a href="#developing-plain-osgi-bundles">Developing Plain OSGi Bundles</a></li>
<li><a href="#developing-web-application-bundles">Developing Web Application Bundles</a></li>
<li><a href="#developing-ejb-application-bundles">Developing EJB Application Bundles</a></li>
</ul>
</li>
<li><a href="#deploying-osgi-bundles-in-glassfish-server">Deploying OSGi Bundles in Eclipse GlassFish</a></li>
</ul>
</li>
<li><a href="#part-iii">Part III</a></li>
<li><a href="#using-services-and-apis">19. Using Services and APIs</a></li>
<li><a href="#using-the-jdbc-api-for-database-access">20. Using the JDBC API for Database Access</a>
<ul class="sectlevel2">
<li><a href="#statements">Statements</a>
<ul class="sectlevel3">
<li><a href="#using-an-initialization-statement">Using an Initialization Statement</a></li>
<li><a href="#setting-a-statement-timeout">Setting a Statement Timeout</a></li>
<li><a href="#statement-leak-detection-and-leaked-statement-reclamation">Statement Leak Detection and Leaked Statement Reclamation</a></li>
<li><a href="#statement-caching">Statement Caching</a></li>
<li><a href="#statement-tracing">Statement Tracing</a></li>
</ul>
</li>
<li><a href="#connections">Connections</a>
<ul class="sectlevel3">
<li><a href="#transparent-pool-reconfiguration">Transparent Pool Reconfiguration</a></li>
<li><a href="#disabling-pooling">Disabling Pooling</a></li>
<li><a href="#associating-connections-with-threads">Associating Connections with Threads</a></li>
<li><a href="#custom-connection-validation">Custom Connection Validation</a></li>
<li><a href="#sharing-connections">Sharing Connections</a></li>
<li><a href="#marking-bad-connections">Marking Bad Connections</a></li>
<li><a href="#handling-invalid-connections-2">Handling Invalid Connections</a></li>
</ul>
</li>
<li><a href="#connection-wrapping">Connection Wrapping</a>
<ul class="sectlevel3">
<li><a href="#wrapping-connections">Wrapping Connections</a></li>
<li><a href="#obtaining-a-physical-connection-from-a-wrapped-connection">Obtaining a Physical Connection From a Wrapped Connection</a></li>
<li><a href="#using-the-connection-unwrap-method">Using the <code>Connection.unwrap()</code> Method</a></li>
</ul>
</li>
<li><a href="#allowing-non-component-callers">Allowing Non-Component Callers</a></li>
<li><a href="#using-application-scoped-jdbc-resources">Using Application-Scoped JDBC Resources</a></li>
<li><a href="#restrictions-and-optimizations-2">Restrictions and Optimizations</a>
<ul class="sectlevel3">
<li><a href="#disabling-stored-procedure-creation-on-sybase">Disabling Stored Procedure Creation on Sybase</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#using-the-transaction-service">21. Using the Transaction Service</a>
<ul class="sectlevel2">
<li><a href="#handling-transactions-with-databases">Handling Transactions with Databases</a>
<ul class="sectlevel3">
<li><a href="#using-jdbc-transaction-isolation-levels">Using JDBC Transaction Isolation Levels</a></li>
<li><a href="#using-non-transactional-connections">Using Non-Transactional Connections</a></li>
</ul>
</li>
<li><a href="#handling-transactions-with-enterprise-beans">Handling Transactions with Enterprise Beans</a>
<ul class="sectlevel3">
<li><a href="#flat-transactions">Flat Transactions</a></li>
<li><a href="#global-and-local-transactions">Global and Local Transactions</a></li>
<li><a href="#commit-options">Commit Options</a></li>
<li><a href="#bean-level-container-managed-transaction-timeouts">Bean-Level Container-Managed Transaction Timeouts</a></li>
</ul>
</li>
<li><a href="#handling-transactions-with-the-java-message-service">Handling Transactions with the Java Message Service</a>
<ul class="sectlevel3">
<li><a href="#transactions-and-non-persistent-messages">Transactions and Non-Persistent Messages</a></li>
<li><a href="#using-the-configurabletransactionsupport-interface">Using the ConfigurableTransactionSupport Interface</a></li>
</ul>
</li>
<li><a href="#the-transaction-manager-the-transaction-synchronization-registry-and-usertransaction">The Transaction Manager, the Transaction Synchronization Registry, and <code>UserTransaction</code></a></li>
</ul>
</li>
<li><a href="#using-the-java-naming-and-directory-interface">22. Using the Java Naming and Directory Interface</a>
<ul class="sectlevel2">
<li><a href="#accessing-the-naming-context">Accessing the Naming Context</a>
<ul class="sectlevel3">
<li><a href="#portable-global-jndi-names">Portable Global JNDI Names</a></li>
<li><a href="#glassfish-server-v2-vendor-specific-global-jndi-names">Eclipse GlassFish V2 Vendor-Specific Global JNDI Names</a></li>
<li><a href="#disabling-glassfish-server-v2-jndi-names">Disabling Eclipse GlassFish V2 JNDI Names</a></li>
<li><a href="#accessing-ejb-components-using-the-cosnaming-naming-context">Accessing EJB Components Using the <code>CosNaming</code> Naming Context</a></li>
<li><a href="#accessing-ejb-components-in-a-remote-glassfish-server">Accessing EJB Components in a Remote Eclipse GlassFish</a></li>
<li><a href="#naming-environment-for-lifecycle-modules">Naming Environment for Lifecycle Modules</a></li>
</ul>
</li>
<li><a href="#configuring-resources">Configuring Resources</a>
<ul class="sectlevel3">
<li><a href="#external-jndi-resources">External JNDI Resources</a></li>
<li><a href="#custom-resources">Custom Resources</a></li>
<li><a href="#built-in-factories-for-custom-resources">Built-in Factories for Custom Resources</a></li>
<li><a href="#using-application-scoped-resources">Using Application-Scoped Resources</a></li>
</ul>
</li>
<li><a href="#using-a-custom-jndi-properties-file">Using a Custom <code>jndi.properties</code> File</a></li>
<li><a href="#mapping-references">Mapping References</a></li>
</ul>
</li>
<li><a href="#using-the-java-message-service">23. Using the Java Message Service</a>
<ul class="sectlevel2">
<li><a href="#using-application-scoped-jms-resources">Using Application-Scoped JMS Resources</a></li>
<li><a href="#load-balanced-message-inflow">Load-Balanced Message Inflow</a></li>
<li><a href="#authentication-with-connectionfactory">Authentication With <code>ConnectionFactory</code></a></li>
<li><a href="#delivering-soap-messages-using-the-jms-api">Delivering SOAP Messages Using the JMS API</a>
<ul class="sectlevel3">
<li><a href="#to-send-soap-messages-using-the-jms-api">To Send SOAP Messages Using the JMS API</a></li>
<li><a href="#to-receive-soap-messages-using-the-jms-api">To Receive SOAP Messages Using the JMS API</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#using-the-jakarta-mail-api">24. Using the Jakarta Mail API</a>
<ul class="sectlevel2">
<li><a href="#introducing-jakarta-mail">Introducing Jakarta Mail</a></li>
<li><a href="#creating-a-jakarta-mail-session">Creating a Jakarta Mail Session</a></li>
<li><a href="#jakarta-mail-session-properties">Jakarta Mail Session Properties</a></li>
<li><a href="#looking-up-a-jakarta-mail-session">Looking Up a Jakarta Mail Session</a></li>
<li><a href="#sending-and-reading-messages-using-jakarta-mail">Sending and Reading Messages Using Jakarta Mail</a>
<ul class="sectlevel3">
<li><a href="#to-send-a-message-using-jakarta-mail">To Send a Message Using Jakarta Mail</a></li>
<li><a href="#to-read-a-message-using-jakarta-mail">To Read a Message Using Jakarta Mail</a></li>
</ul>
</li>
<li><a href="#using-application-scoped-jakarta-mail-resources">Using Application-Scoped Jakarta Mail Resources</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="eclipse-glassfish-server"><a class="anchor" href="#eclipse-glassfish-server"></a>1. Eclipse GlassFish</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Application Development Guide</p>
</div>
<div class="paragraph">
<p>Release 7</p>
</div>
<div class="paragraph">
<p>Contributed 2018 - 2024</p>
</div>
<div class="paragraph">
<p>This Application Development Guide describes how to create and run Java
Platform, Enterprise Edition (Jakarta EE platform) applications that follow
the open Java standards model for Jakarta EE components and APIs in the
Eclipse GlassFish environment. Topics include
developer tools, security, and debugging. This book is intended for use
by software developers who create, assemble, and deploy Jakarta EE
applications using Oracle servers and software.</p>
</div>
<hr>
<div class="paragraph">
<p>Eclipse GlassFish Application Development Guide,
Release 7</p>
</div>
<div class="paragraph">
<p>Copyright © 2013, 2019 Oracle and/or its affiliates. All rights reserved.</p>
</div>
<div class="paragraph">
<p>This program and the accompanying materials are made available under the
terms of the Eclipse Public License v. 2.0, which is available at
<a href="http://www.eclipse.org/legal/epl-2.0" class="bare">http://www.eclipse.org/legal/epl-2.0</a>.</p>
</div>
<div class="paragraph">
<p>SPDX-License-Identifier: EPL-2.0</p>
</div>
<div class="paragraph">
<p>Oracle and Java are registered trademarks of Oracle and/or its
affiliates. Other names may be trademarks of their respective owners.</p>
</div>
<div class="paragraph">
<p>Intel and Intel Xeon are trademarks or registered trademarks of Intel
Corporation. All SPARC trademarks are used under license and are
trademarks or registered trademarks of SPARC International, Inc. AMD,
Opteron, the AMD logo, and the AMD Opteron logo are trademarks or
registered trademarks of Advanced Micro Devices. UNIX is a registered
trademark of The Open Group.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHoAAAAoCAYAAAAxH+4YAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4gsHAhURI94LCQAADalJREFUeNrtnHmw19QVxz+/t0EeyKJVXBAxWAUVcUcbE6xaRTvWsVXrUlsdbZUaday4MCLWjVbEVm2sjLbVukxVFFrtQlUUEuO4gguCGxERkMciD/QReNuvf+RErnnJ75ffAwo678xkXn5Zbu69Z7nnfM+5r0AKhY6OZgfq725AD2Bf4DBgIFAPtACLgFnAS0ATsE6zg3a6aKuiQqmboaP3BYYDPwVOAWqBdmHuZ8AXwmxNXnGBacC7wFKgqApMF205qklqMoBmB4SOfiQwGvi+3F4IPAH4wDvAx5odhIn3dwO+Dewmmr2qa4q3Mo0WJhc0OyiGjn4ZMA7oI7fHAI8AizQ7aC1l5uVaAajR7KCla4q3Moq1OXT08aGjF+V4N3T0vUNHr1Kfi58t1U7yvIu2EgbL+SUKk/3Q0XfpYtg3g1RNPQK4Xn6+BZyl2cHiNNPcRV/TNTp09N7Ag8CJwDrgMM0O3uxi8jdPo4cLkwEu3lRMtkyj0/fT7uW91pk2N7adjZmDjR1XLo0WMORe4GzgbeBAzQ5aVUbLR7tV2Har6/ltWQNwPT/+3UtAmP5iYRYAvuv56+Ln42fld7USFhZdz2+uUPhqFQH/Sh8t0ygIVpCFLxTlnXZ1PGr/0q5bpnGIhKl7Ad2BVcCbwFOu5wdZ7VimUQNUVzjv64VXRSCOkNpriBCuk+XCBKAtjqUT8fa6Cj94O3BZ2uAt09As0zgauBowMhgyWfozG2hTJuJKYLwyqO4V9mseMEjOrwVuUu4NFcBnpzLCshJ4HLhDwKGiMra4n1WWaRwD/AHYM2uOLNOYClzlev4HKcyeoljavLSDzFt3YC5wJHBxlUhZT6ABeFGzg2KGJNMJyUpjcj9gEvBUFpOFTgVeAK6zTKOHMgFqu2s60a/Ps/ooQv55jja2Ay4A3gDOUy2UjLEAnC5jVJn8BRGiqM7nycDTlmnsm2IZmioc2xdire4CngXqgGeAQTWyPkOEVX+Wo7GiPFcKz65XJ0xhci3wKDAi8fzzwEfS5u7A0XK9G3Ac8PtODHpT0FIgTJjyetEaZCJvt0xjmev5TyoauSMwVu4DzAd+CwRiTnsDFvALoBdR7mA0cE4ZJoZl/K1G4c9Hcj4NWA7sWCMfAXg/p4a0AqY0VMqbT9OMSQkmTxXzvQxolk7WAdsDtwD7AD8DVmWthZuR2gEbmK4wLCYTuAfYlijZc6FlGk+7nr9OfJCdgCGKYoxwPX9xwsJNA/4D3AjcD/y9TH/uAO4uo2DtwArxIVYq1xfWsCEhsbSCrFOD6/l5tF/V5v2AHym3HgQucD0/TDguoev5qy3TOAWodz2/aQswOaZG1/MbUxzJJyzT2AX4nThLg4Wxs+XR3kob7yWZLNTiev5zwHMVLDlL0xzcPFQjmkRsFnKGVbnTkAqDzhBfADEt45NMTqx1RWBLMrnUWAD+Jk5PNdBXrFBMy5XzwZZpnAx4wJo4SkhEEnnG2B47yp1l9CdJlCwHyLK/ZRqlzHw18LYaIgEHyvUi8JLr+e+mTF65yd3ilMGUYuxgifX6lChlayneswu8YZnGIlmqPgHedT1/Sc4x9gcOtkyjvQRfVgCfqOGfyuhZct4zJazKYuL9ZbS6N3CoOCGxy99H8Wz9CiR5S1KxhOCdo8TzK8Rxi59ZaZnGNUQZv11iGVEY3yZr6KeWabwC3OB6/qIy8/GTMqFWnViZcWlOW42yrgwIHb02R2qxQJRvLke1ynk35XdRJmZrZzJpptIyjXrgQnEiYzBjruv5byeE9wXgEOByCcV6JpRlBzn2A061TMNwPX9uCWZvK0cp2j4L7KkR7k8DhonWLc8xAWvLxNY9EhrfrKA0hbjDW7lGVwEzckCRK4Hb0sbjev6nEjaNtkxjiCCAg4EDgMPFEa6WeX8O2LHEfDQTVfNkUbcUXKAD4nU/8FegXw5GNwN7CIyXFzBZoYRj1RK73/010Ohy9DFwrev5XiJy6CDArufPE1Qufqa7IHwXCx/6WaZxkuv5/8j41g2CNraVsUCpwlAjFSUzJI4+IXT0OWXW6gIQxo5WTuelzTKNdwQIqQKOsExjoOv5CzIw3s54pZuDAsEWVHPYIijibOBR1/PnCBJWVNdxudZPni2mjGedZRo3Agcpa/dQIIvRLcBaiUY65XWj2UFD6Oi3iITdodnB+k0RXiXM3sOyVmmCNV9nmcb5IgRf4sSJiTrQ9fzXtxCT2wULn5EATNqAphhHkD4XVW2WCGMcMAA4yvX8RlVYlfFUJeaylLa2d5bJADVx3KzZwcOho48EbgZGl4mnh1umsbqMZ77I9fxPFCl/zTKNp4DTFK+1v2UaF7qeP1+dAMs0DhAUaF/LNM5MwIslveIKQqJcEKjr+UsqDP8KgnLtKr99yzROjLNUCTozgRS+WuJTAy3TOLyEMBTED3rL9fyWNNONwuyzQ0efETq6odmBHwMoxz3awZt+OsckTQSuSFw7C9ifDUD/McCHlmkEwBy5djCws/LOZMs0DnI9f07KN3awTKMcs+90Pf/STipCoZMh2RjgIfm9NzDfMo2ZwExZCnYCRgrEG9M81/OfLdHuRXKU8592B5akeZZxeS9yfqSs1YNyxtW5QhPRqlbgOyIoajWpDvxAjp0TDt0/E45fVYX9aE2xNlltFZT7VZ1htGj448CtCcdohJjziRJyfYXJcYycWO4qzUW3lFyjVWYLY68FDggdvV6zg7UKbJk3LdgdWJycAGH2SoEEfyyDO4yO+d8lEodOBaa6nr9eMb8NRAUSefyEWgX5i2kuG5InSxP3QrEsTSKoFadBpZ/rLdMYK2DUGUTp2O1SHp8F/Bu41/X8hSlLTCD9bclpfdZket3qD4XZ7aGjz1Ikvk0ksr0Ck7cmaz1zPX8tcJ9lGlOAbwHbyAEReP85sNz1/DUpa+xUorRmMWc/klm0S9hQRZL0MxaKw1irAjuVarT0txl4xDKN/8oY+8jfWgk1V4qlaogTFSnr/QTAqWCs7eRLNYtYb6La7CywIatGqlztVGfrqErVhZWrGdvYb6aNMXkv61oXddH/n5Ian3cXRynrkdVm2vVS36+0L5X2s5J5ydt2pc/mtbiFnMwsSPzbnAgj3tHs4AP1o7GXHjr6gYLn1gGzNTuYUaL9k4D5mh3MUa4NF6/zJbUgInT0GuB7wAeaHXwo1+olVAvUNuTejoLItUqfVwEvaHYQho5eSKuRi8cROvpZwAfAKyn7y3oDx6Z47kXgec0OlivPVovj+Z5mB/MyvtUdOEni72XAk5odNGbsbRtIVOs3Pa7YlTBuN7nWXNIZK0FVRCm3ZmFcXEp6jYQRqjNXkOtXiPe9FugVOvqDwM+BlpSQ7S8CkIxVrl0sKNqZCdy8TuLUgaGjD9HsoIko8X8b8IASj6PEsQ+Jo1IlXumC0NFHaXYwPW0iZRwj5T1f+rAw0W5/orRgtfSvyIaK1BF8NWdQB9wpx7wUJg8R6HMQUW1YPbA8dPSTNTt4OaWPhwCPAT8U57RAVE58OvBymkNWaUx6swTkg4k2xf8p5ZljieqgHBl4X+B8otqvURlxeS861o3Xy5FmhbqL5KvATU861nbFwtxMVFXaV6xBHXBX6Oi7qxhCgsZLuDUMKaBMPDdX+tdblOB5ojRhNwkNk9Shf/LtGmCytLO3Zge9ier4GoFpoaN3T5mzWEEnh44+UKxSHVHWsJClqZVQI9Em+MVyrE6YlG5ifl4FfqPZQVEQt/sERLh6E7kGNaIZw0JHvxWlwqMEbv2ZZgeNmh3MBL4rpu8oFRRSfAGLKJU4TjTmIlkeVE0siolcL+FnO7Bes4NmCU/zjuUEonqz0zQ7eE+Wk8VEhQZ9gHMzhL1ZNHdm6Oh9yuDkFTP6PGHYI2Im90rcryNKYc6KA3dlwHPILoz/MvujPF8s4UfUElVnXimw4Nk5/I0qpf2lEiPvlNQwobFEe8Eniok0gX3i+wkNK6SdV4Ao7ip9mxkLkLwfV/7skTGW1cKPnrKE9CyFc1TK6OXAh3LMp+PujTaRsgFAdWJt2VXWnyzorkeKqWsrIan1mh38kaiadBxRLXU5DDruTw8BL1alePbDxVQvCx39UqKdDk3ITtPNsIU4Bpb2VJeR0NFjIWzIGEs34DVZl0cK0LN+UzF6qmYHo4GrROoXJDRiLVG1yvHA8YpJPJzof6Dcn9HuS8CI0NF3kMH2l7V0fonSpljjryfaMVGOya3SlwFExXoNwIvJaEF8iV5EJT4TxCncBjg+dPS9NsPu0uniZT+QsAST5O8jpaBmzQ6eAUaJ4BbLYt2VgOZp7rtCU8QDfDx09PfF6x4mzsu4jHcuFemcFzr6fKJ87gKifUtJRhRFy2MNXRI6+hjxWrO2E2mAq2hjE/ArzQ5mJ0LCwaIdEzU7uELR9n5Ee6x+Ldh12jfKwcPtyf7Jt5eEjn458OfQ0dcKjr8HUbnVKM0OFmakjNXvPSDLy9CN1egi0c6J2eVAAs0O1kjC4lzgdTHxVxHtuV6VFvBrdvAWUTbnIXH2JgBHaHbwYcogW8Tb/5fyvgv8kigNmKSPJAS8SY5LgaGaHdwjoWByPqaoIaO03yD+wHsp7bdKXx4rYTpbJfzzU7zugmYHDxGlZ+8V/2EycKhmB5PkfrK9OURZsEbFko4h2lCQum3nf8vVJ/NUdLY+AAAAAElFTkSuQmCC" alt="Eclipse Logo"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a>2. Preface</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This documentation is part of the Java Enterprise Edition contribution
to the Eclipse Foundation and is not intended for use in relation to
Java Enterprise Edition or Orace GlassFish. The documentation is in the
process of being revised to reflect the new Jakarta EE branding.
Additional changes will be made as requirements and procedures evolve
for Jakarta EE. Where applicable, references to Jakarta EE or Java
Enterprise Edition should be considered references to Jakarta EE.</p>
</div>
<div class="paragraph">
<p>Please see the Title page for additional license information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This Application Development Guide describes how to create and run Java
Platform, Enterprise Edition (Jakarta EE platform) applications that follow
the open Java standards model for Jakarta EE components and APIs in the
Eclipse GlassFish environment.
Topics include developer tools, security, and debugging.
This book is intended for use by software developers who create, assemble,
and deploy Jakarta EE applications using Eclipse GlassFishs.</p>
</div>
<div class="paragraph">
<p>This preface contains information about and conventions for the entire
Eclipse GlassFish (Eclipse GlassFish) documentation set.</p>
</div>
<div class="paragraph">
<p>Eclipse GlassFish 7 is developed through the GlassFish project
open-source community at <a href="https://github.com/eclipse-ee4j/glassfish" class="bare">https://github.com/eclipse-ee4j/glassfish</a>.
The GlassFish project provides a structured process for developing the
Eclipse GlassFish platform that makes the new features of the Jakarta EE
platform available faster, while maintaining the most important feature
of Jakarta EE: compatibility. It enables Java developers to access the
Eclipse GlassFish source code and to contribute to the development of the
Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#glassfish-server-documentation-set">Eclipse GlassFish Documentation Set</a></p>
</li>
<li>
<p><a href="#related-documentation">Related Documentation</a></p>
</li>
<li>
<p><a href="#typographic-conventions">Typographic Conventions</a></p>
</li>
<li>
<p><a href="#symbol-conventions">Symbol Conventions</a></p>
</li>
<li>
<p><a href="#default-paths-and-file-names">Default Paths and File Names</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="glassfish-server-documentation-set"><a class="anchor" href="#glassfish-server-documentation-set"></a>Eclipse GlassFish Documentation Set</h3>
<div class="paragraph">
<p>The Eclipse GlassFish documentation set describes deployment planning and
system installation. For an introduction to Eclipse GlassFish, refer to
the books in the order in which they are listed in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Book Title</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="release-notes.html#GSRLN">Release Notes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides late-breaking information about
the software and the documentation and includes a comprehensive,
table-based summary of the supported hardware, operating system, Java
Development Kit (JDK), and database drivers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="quick-start-guide.html#GSQSG">Quick Start Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to get started with the Eclipse GlassFish product.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="installation-guide.html#GSING">Installation Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to install the software and its components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="upgrade-guide.html#GSUPG">Upgrade Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to upgrade to the latest version of Eclipse GlassFish.
This guide also describes differences between adjacent product releases and configuration
options that can result in incompatibility with the product specifications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="deployment-planning-guide.html#GSPLG">Deployment Planning Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to build a production deployment of Eclipse GlassFish that meets the requirements of
your system and enterprise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="administration-guide.html#GSADG">Administration Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to configure, monitor, and manage Eclipse GlassFish subsystems and components
from the command line by using the <a href="reference-manual.html#asadmin"><code>asadmin</code>(1M)</a> utility.
Instructions for performing these tasks from the Administration Console are provided
in the Administration Console online help.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="security-guide.html#GSSCG">Security Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides instructions for configuring and administering Eclipse GlassFish security.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="application-deployment-guide.html#GSDPG">Application Deployment Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to assemble and deploy applications to the Eclipse GlassFish and provides information
about deployment descriptors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="application-development-guide.html#GSDVG">Application Development Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to create and implement Java Platform, Enterprise Edition (Jakarta EE platform)
applications that are intended to run on the Eclipse GlassFish.
These applications follow the open Java standards model for Jakarta EE components
and application programmer interfaces (APIs).
This guide provides information about developer tools, security, and debugging.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="add-on-component-development-guide.html#GSACG">Add-On Component Development Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to use published interfaces of Eclipse GlassFish to develop add-on components
for Eclipse GlassFish.
This document explains how to perform only those tasks that ensure that the add-on component
is suitable for Eclipse GlassFish.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="embedded-server-guide.html#GSESG">Embedded Server Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to run applications in embedded Eclipse GlassFish and to develop applications
in which Eclipse GlassFish is embedded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="ha-administration-guide.html#GSHAG">High Availability Administration Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to configure Eclipse GlassFish to provide higher availability and
scalability through failover and load balancing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="performance-tuning-guide.html#GSPTG">Performance Tuning Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to optimize the performance of Eclipse GlassFish.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="troubleshooting-guide.html#GSTSG">Troubleshooting Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describes common problems that you might encounter when using Eclipse GlassFish and explains how to solve them.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="error-messages-reference.html#GSEMR">Error Message Reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describes error messages that you might encounter when using Eclipse GlassFish.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="reference-manual.html#GSRFM">Reference Manual</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides reference information in man page format for Eclipse GlassFish administration commands, utility
commands, and related concepts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://eclipse-ee4j.github.io/openmq/guides//mq-release-notes/toc.html">Message Queue Release Notes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describes new features, compatibility issues, and existing bugs for Open Message Queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://eclipse-ee4j.github.io/openmq/guides//mq-tech-over/toc.html">Message Queue Technical Overview</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides an introduction to the technology, concepts, architecture, capabilities, and features of
the Message Queue messaging service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://eclipse-ee4j.github.io/openmq/guides//mq-admin-guide/toc.html">Message Queue Administration Guide</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explains how to set up and manage a Message Queue messaging system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://eclipse-ee4j.github.io/openmq/guides//mq-dev-guide-jmx/toc.html">Message Queue Developer&#8217;s Guide for JMX Clients</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describes the application programming interface in Message Queue for
programmatically configuring and monitoring Message Queue resources in
conformance with the Java Management Extensions (JMX).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://eclipse-ee4j.github.io/openmq/guides//mq-dev-guide-java/toc.html">Message Queue Developer&#8217;s Guide for Java Clients</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides information about concepts and procedures for developing Java messaging
applications (Java clients) that work with Eclipse GlassFish.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://eclipse-ee4j.github.io/openmq/guides//mq-dev-guide-c/toc.html">Message Queue Developer&#8217;s Guide for C Clients</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides programming and reference information for developers working with
Message Queue who want to use the C language binding to the Message
Queue messaging service to send, receive, and process Message Queue messages.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="related-documentation"><a class="anchor" href="#related-documentation"></a>Related Documentation</h3>
<div class="paragraph">
<p>The following tutorials explain how to develop Jakarta EE applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/eclipse-ee4j/jakartaee-firstcup-examples">
Your First Cup: An Introduction to the Jakarta EE Platform</a>.
For beginning Jakarta EE programmers, this short tutorial explains the entire
process for developing a simple enterprise application.
The sample application is a web application that consists of a component that is
based on the Enterprise JavaBeans specification, a JAX-RS web service,
and a JavaServer Faces component for the web front end.</p>
</li>
<li>
<p><a href="https://eclipse-ee4j.github.io/jakartaee-tutorial">The Jakarta EE Tutorial</a>.
This comprehensive tutorial explains how to use Jakarta EE platform technologies
and APIs to develop Jakarta EE applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Javadoc tool reference documentation for packages that are provided with
Eclipse GlassFish is available as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Jakarta EE specifications and API specification is
located at <a href="https://jakarta.ee/specifications/" class="bare">https://jakarta.ee/specifications/</a>.</p>
</li>
<li>
<p>The API specification for Eclipse GlassFish 7, including Jakarta EE
platform packages and nonplatform packages that are specific to the
Eclipse GlassFish product, is located at
<a href="https://glassfish.org/docs/" class="bare">https://glassfish.org/docs/</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about creating enterprise applications in the NetBeans
Integrated Development Environment (IDE), see the
<a href="https://netbeans.apache.org/kb/docs/java-ee.html">
NetBeans Documentation, Training &amp; Support page</a>.</p>
</div>
<div class="paragraph">
<p>For information about the Derby database for use with
the Eclipse GlassFish, see the <a href="https://db.apache.org/derby/index.html">Derby page</a>.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE Samples project is a collection of sample applications that
demonstrate a broad range of Jakarta EE technologies. The Jakarta EE Samples
are bundled with the Jakarta EE Software Development Kit (SDK) and are also
available from the repository
(<code><a href="https://github.com/eclipse-ee4j/glassfish-samples" class="bare">https://github.com/eclipse-ee4j/glassfish-samples</a></code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="typographic-conventions"><a class="anchor" href="#typographic-conventions"></a>Typographic Conventions</h3>
<div class="paragraph">
<p>The following table describes the typographic changes that are used in
this book.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14%;">
<col style="width: 37%;">
<col style="width: 49%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Typeface</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AaBbCc123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The names of commands, files, and directories, and onscreen computer output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit your <code>.login</code> file.</p>
<p class="tableblock">Use <code>ls</code> <code>a</code> to list all files.</p>
<p class="tableblock"><code>machine_name% you have mail.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AaBbCc123</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What you type, contrasted with onscreen computer output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>machine_name%</code> <code>su</code></p>
<p class="tableblock"><code>Password:</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AaBbCc123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A placeholder to be replaced with a real name or value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The command to remove a file is <code>rm</code> filename.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AaBbCc123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Book titles, new terms, and terms to be emphasized (note that some emphasized items appear bold online)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read Chapter 6 in the User&#8217;s Guide.</p>
<p class="tableblock">A cache is a copy that is stored locally.</p>
<p class="tableblock">Do not save the file.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="symbol-conventions"><a class="anchor" href="#symbol-conventions"></a>Symbol Conventions</h3>
<div class="paragraph">
<p>The following table explains symbols that might be used in this book.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 26%;">
<col style="width: 28%;">
<col style="width: 36%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbol</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[ ]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains optional arguments and command options.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ls [-l]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>-l</code> option is not required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{ | }</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains a set of choices for a required command option.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d {y|n}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>-d</code> option requires that you use either the <code>y</code> argument or the <code>n</code> argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${ }</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a variable reference.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${com.sun.javaRoot}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">References the value of the <code>com.sun.javaRoot</code> variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joins simultaneous multiple keystrokes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control-A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Press the Control key while you press the A key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joins consecutive multiple keystrokes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ctrl+A+N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Press the Control key, release it, and then press the subsequent keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates menu item selection in a graphical user interface.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File &gt; New &gt; Templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">From the File menu, choose New. From the New submenu, choose Templates.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="default-paths-and-file-names"><a class="anchor" href="#default-paths-and-file-names"></a>Default Paths and File Names</h3>
<div class="paragraph">
<p>The following table describes the default paths and file names that are
used in this book.</p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Placeholder</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">as-install</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents the base installation directory for Eclipse GlassFish.
In configuration files, as-install is represented as follows:
<code>${com.sun.aas.installRoot}</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Installations on the Oracle Solaris operating system, Linux operating
system, and Mac OS operating system:</p>
<div class="paragraph">
<p>user&#8217;s-home-directory<code>/glassfish7/glassfish</code></p>
</div>
</li>
<li>
<p>Installations on the Windows operating system:</p>
<div class="paragraph">
<p>SystemDrive<code>:\glassfish7\glassfish</code></p>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">as-install-parent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the parent of the base installation directory for Eclipse GlassFish.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Installations on the Oracle Solaris operating system, Linux operating
system, and Mac operating system:</p>
<div class="paragraph">
<p>user&#8217;s-home-directory<code>/glassfish7</code></p>
</div>
</li>
<li>
<p>Installations on the Windows operating system:</p>
<div class="paragraph">
<p>SystemDrive<code>:\glassfish7</code></p>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain-root-dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the directory in which a domain is created by default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">as-install<code>/domains/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain-dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the directory in which a domain&#8217;s configuration is stored.
In configuration files, domain-dir is represented as follows:
<code>${com.sun.aas.instanceRoot}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain-root-dir/domain-name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">instance-dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the directory for a server instance.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain-dir/instance-name</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part-i"><a class="anchor" href="#part-i"></a>Part I</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="development-tasks-and-tools"><a class="anchor" href="#development-tasks-and-tools"></a>3. Development Tasks and Tools</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="setting-up-a-development-environment"><a class="anchor" href="#setting-up-a-development-environment"></a>4. Setting Up a Development Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter gives guidelines for setting up an application development
environment in the Eclipse GlassFish. Setting up an environment
for creating, assembling, deploying, and debugging your code involves
installing the mainstream version of the Eclipse GlassFish and making use
of development tools. In addition, sample applications are available.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#installing-and-preparing-the-server-for-development">Installing and Preparing the Server for Development</a></p>
</li>
<li>
<p><a href="#high-availability-features">High Availability Features</a></p>
</li>
<li>
<p><a href="#development-tools">Development Tools</a></p>
</li>
<li>
<p><a href="#sample-applications">Sample Applications</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="installing-and-preparing-the-server-for-development"><a class="anchor" href="#installing-and-preparing-the-server-for-development"></a>Installing and Preparing the Server for Development</h3>
<div class="paragraph">
<p>For more information about Eclipse GlassFish installation, see the
<a href="installation-guide.html#GSING">
Eclipse GlassFish Installation Guide</a>.</p>
</div>
<div class="paragraph">
<p>The following components are included in the full installation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDK</p>
</li>
<li>
<p>Eclipse GlassFish core</p>
<div class="ulist">
<ul>
<li>
<p>Java Platform, Standard Edition (Java SE) 11 or newer</p>
</li>
<li>
<p>Jakarta EE 10 compliant application server</p>
</li>
<li>
<p>Administration Console</p>
</li>
<li>
<p><code>asadmin</code> utility</p>
</li>
<li>
<p>Other development and deployment tools</p>
</li>
<li>
<p>Open Message Queue software</p>
</li>
<li>
<p>Apache <a href="http://db.apache.org/derby/manuals">Derby database</a></p>
</li>
<li>
<p>Load balancer plug-ins for web servers</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The NetBeans Integrated Development Environment (IDE) bundles the
GlassFish edition of the Eclipse GlassFish, so information about this IDE
is provided as well.</p>
</div>
<div class="paragraph">
<p>After you have installed Eclipse GlassFish, you can further optimize the
server for development in these ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Locate utility classes and libraries so they can be accessed by the
proper class loaders. For more information, see
<a href="#using-the-common-class-loader">Using the Common Class Loader</a>.</p>
</li>
<li>
<p>Set up debugging. For more information, see
<a href="#debugging-applications">Debugging Applications</a>.</p>
</li>
<li>
<p>Configure the Virtual Machine for the Java platform (JVM software).
For more information, see "<a href="administration-guide.html#administering-the-virtual-machine-for-the-java-platform">
Administering the Virtual Machine for the Java Platform</a>"
in Eclipse GlassFish Administration Guide.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="high-availability-features"><a class="anchor" href="#high-availability-features"></a>High Availability Features</h3>
<div class="paragraph">
<p>High availability features such as load balancing and session failover
are discussed in detail in the <a href="ha-administration-guide.html#GSHAG">Eclipse GlassFish
High Availability Administration Guide</a>. This book describes the
following features in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For information about HTTP session persistence, see
<a href="#distributed-sessions-and-persistence">Distributed Sessions and Persistence</a>.</p>
</li>
<li>
<p>For information about checkpointing of the stateful session bean
state, see <a href="#stateful-session-bean-failover">Stateful Session Bean Failover</a>.</p>
</li>
<li>
<p>For information about failover and load balancing for Java clients,
see <a href="#developing-java-clients">Developing Java Clients</a>.</p>
</li>
<li>
<p>For information about load balancing for message-driven beans, see
<a href="#load-balanced-message-inflow">Load-Balanced Message Inflow</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="development-tools"><a class="anchor" href="#development-tools"></a>Development Tools</h3>
<div class="paragraph">
<p>The following general tools are provided with the Eclipse GlassFish:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-asadmin-command">The <code>asadmin</code> Command</a></p>
</li>
<li>
<p><a href="#the-administration-console">The Administration Console</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following development tools are provided with the Eclipse GlassFish
or downloadable from Oracle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-migration-tool">The Migration Tool</a></p>
</li>
<li>
<p><a href="#the-netbeans-ide">The NetBeans IDE</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following third-party tools might also be useful:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#debugging-tools">Debugging Tools</a></p>
</li>
<li>
<p><a href="#profiling-tools">Profiling Tools</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="the-asadmin-command"><a class="anchor" href="#the-asadmin-command"></a>The <code>asadmin</code> Command</h4>
<div class="paragraph">
<p>The <code>asadmin</code> command allows you to configure a local or remote server
and perform both administrative and development tasks at the command
line. For general information about <code>asadmin</code>, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>The <code>asadmin</code> command is located in the as-install<code>/bin</code> directory. Type
<code>asadmin help</code> for a list of subcommands.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-administration-console"><a class="anchor" href="#the-administration-console"></a>The Administration Console</h4>
<div class="paragraph">
<p>The Administration Console lets you configure the server and perform
both administrative and development tasks using a web browser. For
general information about the Administration Console, click the Help
button in the Administration Console. This displays the Eclipse GlassFish
online help.</p>
</div>
<div class="paragraph">
<p>To access the Administration Console, type <code><a href="http://`host" class="bare">http://`host</a></code>:4848` in your
browser. The host is the name of the machine on which the Eclipse GlassFish is running. By default, the host is <code>localhost</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:4848</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-migration-tool"><a class="anchor" href="#the-migration-tool"></a>The Migration Tool</h4>
<div class="paragraph">
<p>The Migration Tool converts and reassembles Jakarta EE applications and
modules developed on other application servers. This tool also generates
a report listing how many files are successfully and unsuccessfully
migrated, with reasons for migration failure. For more information and
to download the Migration Tool, see
<code><a href="http://java.sun.com/j2ee/tools/migration/index.html" class="bare">http://java.sun.com/j2ee/tools/migration/index.html</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-netbeans-ide"><a class="anchor" href="#the-netbeans-ide"></a>Code Editors</h4>
<div class="paragraph">
<p>There is several advanced editors with an integration with GlassFish or
generic Jakarta EE servers. Sometimes you have to install additional
extensions, sometimes all you need is just some configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a></code></p>
</li>
<li>
<p><code><a href="https://www.eclipse.org/downloads/packages/">Eclipse IDE</a></code></p>
</li>
<li>
<p><code><a href="https://netbeans.apache.org">Apache NetBeans</a></code></p>
</li>
<li>
<p><code><a href="https://code.visualstudio.com">Microsoft Visual Studio Code</a></code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="debugging-tools"><a class="anchor" href="#debugging-tools"></a>Debugging Tools</h4>
<div class="paragraph">
<p>You can use several debugging tools with the Eclipse GlassFish. For more
information, see <a href="#debugging-applications">Debugging Applications</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="profiling-tools"><a class="anchor" href="#profiling-tools"></a>Profiling Tools</h4>
<div class="paragraph">
<p>You can use several profilers with the Eclipse GlassFish. For more
information, see <a href="#debug-profiling-tools">Profiling Tools</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sample-applications"><a class="anchor" href="#sample-applications"></a>Sample Applications</h3>
<div class="paragraph">
<p>The samples are available from <code><a href="https://github.com/eclipse-ee4j/glassfish-samples" class="bare">https://github.com/eclipse-ee4j/glassfish-samples</a></code>.</p>
</div>
<div class="paragraph">
<p>Most Eclipse GlassFish samples have the following directory structure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>docs</code> directory contains instructions for how to use the sample.</p>
</li>
<li>
<p>The <code>pom.xml</code> file defines Maven targets for the sample.</p>
</li>
<li>
<p>The <code>src/</code> directory contains source code for the sample.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="class-loaders"><a class="anchor" href="#class-loaders"></a>5. Class Loaders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Understanding Eclipse GlassFish class loaders can help you
determine where to place supporting JAR and resource files for your
modules and applications.</p>
</div>
<div class="paragraph">
<p>In a JVM implementation, the class loaders dynamically load a specific
Java class file needed for resolving a dependency. For example, when an
instance of <code>java.util.Enumeration</code> needs to be created, one of the
class loaders loads the relevant class into the environment.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-class-loader-hierarchy">The Class Loader Hierarchy</a></p>
</li>
<li>
<p><a href="#delegation">Delegation</a></p>
</li>
<li>
<p><a href="#using-the-java-optional-package-mechanism">Using the Java Optional Package Mechanism</a></p>
</li>
<li>
<p><a href="#class-loader-universes">Class Loader Universes</a></p>
</li>
<li>
<p><a href="#application-specific-class-loading">Application-Specific Class Loading</a></p>
</li>
<li>
<p><a href="#circumventing-class-loader-isolation">Circumventing Class Loader Isolation</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Web Profile of the Eclipse GlassFish supports the EJB 3.1 Lite
specification, which allows enterprise beans within web applications,
among other features. The full Eclipse GlassFish supports the entire EJB
3.1 specification. For details, see
<a href="http://jcp.org/en/jsr/detail?id=318">JSR 318</a>
(<code><a href="http://jcp.org/en/jsr/detail?id=318" class="bare">http://jcp.org/en/jsr/detail?id=318</a></code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For information about class loader debugging, see
<a href="#class-loader-debugging">Class Loader Debugging</a>.</p>
</div>
<div class="sect2">
<h3 id="the-class-loader-hierarchy"><a class="anchor" href="#the-class-loader-hierarchy"></a>The Class Loader Hierarchy</h3>
<div class="paragraph">
<p>Class loaders in the Eclipse GlassFish runtime follow a delegation
hierarchy that is illustrated in the following figure and fully
described in <a href="#fvxzq">Table 2-1</a>.</p>
</div>
<div class="paragraph">
<p>The following table describes the class loaders in the Eclipse GlassFish.</p>
</div>
<div id="fvxzq" class="paragraph">
<p>Table 2-1 Eclipse GlassFish Class Loaders</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class Loader</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootstrap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Bootstrap class loader loads the basic runtime classes
provided by the JVM software.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extension</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Extension class loader loads classes from JAR files
present in the system extensions directory, domain-dir<code>/lib/ext</code>. It is
parent to the Public API class loader. See <a href="#using-the-java-optional-package-mechanism">Using the Java
Optional Package Mechanism</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Public API class loader makes available all classes
specifically exported by the Eclipse GlassFish runtime for use by
deployed applications. This includes, but is not limited to, Jakarta EE
APIs and other Oracle APIs. It is parent to the Common class loader.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Common class loader loads JAR files in the as-install<code>/lib</code>
directory, followed by JAR files in the domain-dir<code>/lib</code> directory.
Using domain-dir<code>/lib</code> is recommended whenever possible, and required
for custom login modules and realms. It is parent to the Connector class
loader. See <a href="#using-the-common-class-loader">Using the Common Class Loader</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Connector class loader is a single class loader instance
that loads individually deployed connector modules, which are shared
across all applications. It is parent to the Applib class loader and the
LifeCycleModule class loader.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LifeCycleModule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The LifeCycleModule class loader is created once per
lifecycle module. Each lifecycle module&#8217;s classpath is used to construct
its own class loader. For more information on lifecycle modules, see
<a href="#developing-lifecycle-listeners">Developing Lifecycle Listeners</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applib</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Applib class loader loads the library classes, specified during
deployment, for a specific enabled module or Jakarta EE application; see
<a href="#application-specific-class-loading">Application-Specific Class Loading</a>. One instance of this
class loader is present in each class loader universe; see
<a href="#class-loader-universes">Class Loader Universes</a>. It is parent to the Archive class loader.</p>
</div>
<div class="paragraph">
<p>When multiple deployed applications use the same library, they share the
same instance of the library. One library cannot reference classes from
another library.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Archive class loader loads classes from the WAR, EAR, and
JAR files or directories (for directory deployment) of applications or
modules deployed to the Eclipse GlassFish. This class loader also loads
any application-specific classes generated by the Eclipse GlassFish
runtime, such as stub classes or servlets generated by JSP pages.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In previous Eclipse GlassFish versions, the JVM options provided
<code>classpath-prefix</code> and <code>classpath-suffix</code> attributes that made it
possible to add JAR files or directories either in front of, or after
the application server&#8217;s system <code>classpath</code>. These options are not
present in Eclipse GlassFish 6.0.</p>
</div>
<div class="paragraph">
<p>The <code>classpath-prefix</code> was typically used to substitute another package
for one of the Eclipse GlassFish packages, for example if a newer one was
available. This same result can be achieved on a per-application basis with the
<code>--libraries</code> option for the <code>deploy</code> subcommand. For more information,
see the <a href="reference-manual.html#deploy"><code>deploy</code>(1)</a> help page.
The Java Optional Package Mechanism does what <code>classpath-suffix</code> used to do. For more
information, see <a href="#using-the-java-optional-package-mechanism">Using the Java Optional Package Mechanism</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="delegation"><a class="anchor" href="#delegation"></a>Delegation</h3>
<div class="paragraph">
<p>Note that the class loader hierarchy is not a Java inheritance
hierarchy, but a delegation hierarchy. In the delegation design, a class
loader delegates class loading to its parent before attempting to load a
class itself. If the parent class loader cannot load a class, the class
loader attempts to load the class itself. In effect, a class loader is
responsible for loading only the classes not available to the parent.
Classes loaded by a class loader higher in the hierarchy cannot refer to
classes available lower in the hierarchy.</p>
</div>
<div class="paragraph">
<p>The Java Servlet specification recommends that a web module&#8217;s class
loader look in the local class loader before delegating to its parent.
You can make this class loader follow the delegation inversion model in
the Servlet specification by setting <code>delegate="false"</code> in the
<code>class-loader</code> element of the <code>glassfish-web.xml</code> file. It is safe to do
this only for a web module that does not interact with any other
modules. For details, see "<a href="application-deployment-guide.html#class-loader">class-loader</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>The default value is <code>delegate="true"</code>, which causes a web module&#8217;s
class loader to delegate in the same manner as the other class loaders.
You must use <code>delegate="true"</code> for a web application that accesses EJB
components or that acts as a web service client or endpoint. For details
about <code>glassfish-web.xml</code>, see the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment Guide</a>.</p>
</div>
<div class="paragraph">
<p>For a number of packages, including <code>java.<strong></code> and <code>javax.</strong></code>, symbol
resolution is always delegated to the parent class loader regardless of
the <code>delegate</code> setting. This prevents applications from overriding core
Java runtime classes or changing the API versions of specifications that
are part of the Jakarta EE platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-java-optional-package-mechanism"><a class="anchor" href="#using-the-java-optional-package-mechanism"></a>Using the Java Optional Package Mechanism</h3>
<div class="paragraph">
<p>Optional packages are packages of Java classes and associated native
code that application developers can use to extend the functionality of
the core platform.</p>
</div>
<div class="paragraph">
<p>To use the Java optional package mechanism, copy the JAR files into the
domain-dir<code>/lib/ext</code> directory, or use the <code>asadmin add-library</code> command
with the <code>--type ext</code> option, then restart the server. For more
information about the <code>asadmin add-library</code> command, see the Eclipse GlassFish Reference Manual.</p>
</div>
<div class="paragraph">
<p>For more information, see
<a href="http://docs.oracle.com/javase/8/docs/technotes/guides/extensions/extensions.html">Optional
Packages - An Overview</a>
(<code><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/extensions/extensions.html" class="bare">http://docs.oracle.com/javase/8/docs/technotes/guides/extensions/extensions.html</a></code>)
and
<a href="http://download.oracle.com/javase/tutorial/ext/basics/load.html">Understanding
Extension Class Loading</a>
(<code><a href="http://docs.oracle.com/javase/tutorial/ext/basics/load.html" class="bare">http://docs.oracle.com/javase/tutorial/ext/basics/load.html</a></code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-endorsed-standards-override-mechanism"><a class="anchor" href="#using-the-endorsed-standards-override-mechanism"></a>Using the Endorsed Standards Override Mechanism</h3>
<div class="paragraph">
<p>Endorsed standards handle changes to classes and APIs that are bundled
in the JDK but are subject to change by external bodies.</p>
</div>
<div class="paragraph">
<p>To use the endorsed standards override mechanism, copy the JAR files
into the domain-dir`/lib/endorsed` directory, then restart the server.</p>
</div>
<div class="paragraph">
<p>For more information and the list of packages that can be overridden,
see
<a href="http://docs.oracle.com/javase/8/docs/technotes/guides/standards/">Endorsed
Standards Override Mechanism</a>
(<code><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/standards/" class="bare">http://docs.oracle.com/javase/8/docs/technotes/guides/standards/</a></code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="class-loader-universes"><a class="anchor" href="#class-loader-universes"></a>Class Loader Universes</h3>
<div class="paragraph">
<p>Access to components within applications and modules installed on the
server occurs within the context of isolated class loader universes,
each of which has its own Applib and Archive class loaders.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application Universe - Each Jakarta EE application has its own class
loader universe, which loads the classes in all the modules in the
application.</p>
</li>
<li>
<p>Individually Deployed Module Universe - Each individually deployed EJB
JAR or web WAR has its own class loader universe, which loads the
classes in the module.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A resource such as a file that is accessed by a servlet, JSP, or EJB
component must be in one of the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A directory pointed to by the Libraries field or <code>--libraries</code> option
used during deployment</p>
</li>
<li>
<p>A directory pointed to by the <code>library-directory</code> element in the
<code>application.xml</code> deployment descriptor</p>
</li>
<li>
<p>A directory pointed to by the application or module&#8217;s classpath; for
example, a web module&#8217;s classpath includes these directories:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>module-name/WEB-INF/classes
module-name/WEB-INF/lib</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="application-specific-class-loading"><a class="anchor" href="#application-specific-class-loading"></a>Application-Specific Class Loading</h3>
<div class="paragraph">
<p>You can specify module- or application-specific library classes in one
of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the Administration Console. Open the Applications component, then
go to the page for the type of application or module. Select the Deploy
button. Type the comma-separated paths in the Libraries field. For
details, click the Help button in the Administration Console.</p>
</li>
<li>
<p>Use the <code>asadmin deploy</code> command with the <code>--libraries</code> option and
specify comma-separated paths. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Use the <code>asadmin add-library</code> command with the <code>--type app</code> option,
then restart the server. For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>None of these alternatives apply to application clients. For more
information, see <a href="#using-libraries-with-application-clients">Using Libraries with
Application Clients</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can update a library JAR file using dynamic reloading or by
restarting (disabling and re-enabling) a module or application. To add
or remove library JAR files, you can redeploy the module or application.</p>
</div>
<div class="paragraph">
<p>Application libraries are included in the Applib class loader. Paths to
libraries can be relative or absolute. A relative path is relative to
domain-dir`/lib/applibs`. If the path is absolute, the path must be
accessible to the domain administration server (DAS). The Eclipse GlassFish automatically synchronizes these libraries to all remote cluster
instances when the cluster is restarted. However, libraries specified by
absolute paths are not guaranteed to be synchronized.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use application-specific class loading to specify a different
XML parser than the default Eclipse GlassFish XML parser.</p>
</div>
<div class="paragraph">
<p>You can also use application-specific class loading to access different
versions of a library from different applications.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If multiple applications or modules refer to the same libraries, classes
in those libraries are automatically shared. This can reduce the memory
footprint and allow sharing of static information. However, applications
or modules using application-specific libraries are not portable. Other
ways to make libraries available are described in
<a href="#circumventing-class-loader-isolation">Circumventing Class Loader Isolation</a>.</p>
</div>
<div class="paragraph">
<p>One library cannot reference classes from another library.</p>
</div>
<div class="paragraph">
<p>For general information about deployment, including dynamic reloading,
see the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application
Deployment Guide</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you see an access control error message when you try to use a
library, you may need to grant permission to the library in the
<code>server.policy</code> file. For more information, see
<a href="#changing-permissions-for-an-application">Changing Permissions for an Application</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="circumventing-class-loader-isolation"><a class="anchor" href="#circumventing-class-loader-isolation"></a>Circumventing Class Loader Isolation</h3>
<div class="paragraph">
<p>Since each application or individually deployed module class loader
universe is isolated, an application or module cannot load classes from
another application or module. This prevents two similarly named classes
in different applications or modules from interfering with each other.</p>
</div>
<div class="paragraph">
<p>To circumvent this limitation for libraries, utility classes, or
individually deployed modules accessed by more than one application, you
can include the relevant path to the required classes in one of these
ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-the-common-class-loader">Using the Common Class Loader</a></p>
</li>
<li>
<p><a href="#sharing-libraries-across-a-cluster">Sharing Libraries Across a Cluster</a></p>
</li>
<li>
<p><a href="#packaging-the-client-jar-for-one-application-in-another-application">Packaging the Client JAR for One Application in Another
Application</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="using-the-common-class-loader"><a class="anchor" href="#using-the-common-class-loader"></a>Using the Common Class Loader</h4>
<div class="paragraph">
<p>To use the Common class loader, copy the JAR files into the
domain-dir<code>/lib</code> or as-install<code>/lib</code> directory, or use the
<code>asadmin add-library</code> command with the <code>--type common</code> option, then
restart the server. For more information about the <code>asadmin add-library</code>
command, see the Eclipse GlassFish Reference Manual.</p>
</div>
<div class="paragraph">
<p>Using the Common class loader makes an application or module accessible
to all applications or modules deployed on servers that share the same
configuration. However, this accessibility does not extend to
application clients. For more information, see
<a href="#using-libraries-with-application-clients">Using Libraries with Application Clients</a>.</p>
</div>
<div class="paragraph">
<p>For example, using the Common class loader is the recommended way of
adding JDBC drivers to the Eclipse GlassFish. For a list of the JDBC
drivers currently supported by the Eclipse GlassFish, see the
<a href="release-notes.html#GSRLN">Eclipse GlassFish Release Notes</a>. For
configurations of supported and other drivers, see
"<a href="administration-guide.html#configuration-specifics-for-jdbc-drivers">Configuration Specifics for JDBC Drivers</a>" in
Eclipse GlassFish Administration Guide.</p>
</div>
<div class="paragraph">
<p>To activate custom login modules and realms, place the JAR files in the
domain-dir<code>/lib</code> directory, then restart the server.</p>
</div>
</div>
<div class="sect3">
<h4 id="sharing-libraries-across-a-cluster"><a class="anchor" href="#sharing-libraries-across-a-cluster"></a>Sharing Libraries Across a Cluster</h4>
<div class="paragraph">
<p>To share libraries across a specific cluster, copy the JAR files to the
domain-dir<code>/config/</code>cluster-config-name<code>/lib</code> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="packaging-the-client-jar-for-one-application-in-another-application"><a class="anchor" href="#packaging-the-client-jar-for-one-application-in-another-application"></a>Packaging the Client JAR for One Application in Another Application</h4>
<div class="paragraph">
<p>By packaging the client JAR for one application in a second application,
you allow an EJB or web component in the second application to call an
EJB component in the first (dependent) application, without making
either of them accessible to any other application or module.</p>
</div>
<div class="paragraph">
<p>As an alternative for a production environment, you can have the Common
class loader load the client JAR of the dependent application as
described in <a href="#using-the-common-class-loader">Using the Common Class Loader</a>. Restart the
server to make the dependent application accessible to all applications
or modules deployed on servers that share the same configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="to-package-the-client-jar-for-one-application-in-another-application"><a class="anchor" href="#to-package-the-client-jar-for-one-application-in-another-application"></a>To Package the Client JAR for One Application in Another Application</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the dependent application.</p>
</li>
<li>
<p>Add the dependent application&#8217;s client JAR file to the calling
application.</p>
<div class="ulist">
<ul>
<li>
<p>For a calling EJB component, add the client JAR file at the same level
as the EJB component. Then add a <code>Class-Path</code> entry to the <code>MANIFEST.MF</code>
file of the calling EJB component. The <code>Class-Path</code> entry has this
syntax:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Class-Path: filepath1.jar filepath2.jar ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each filepath is relative to the directory or JAR file containing the
<code>MANIFEST.MF</code> file. For details, see the Jakarta EE specification.</p>
</div>
</li>
<li>
<p>For a calling web component, add the client JAR file under the
<code>WEB-INF/lib</code> directory.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you need to package the client JAR with both the EJB and web
components, set <code>delegate="true"</code> in the <code>class-loader</code> element of the
<code>glassfish-web.xml</code> file.</p>
<div class="paragraph">
<p>This changes the Web class loader so that it follows the standard class
loader delegation model and delegates to its parent before attempting to
load a class itself.</p>
</div>
<div class="paragraph">
<p>For most applications, packaging the client JAR file with the calling
EJB component is sufficient. You do not need to package the client JAR
file with both the EJB and web components unless the web component is
directly calling the EJB component in the dependent application.</p>
</div>
</li>
<li>
<p>Deploy the calling application.</p>
<div class="paragraph">
<p>The calling EJB or web component must specify in its
<code>glassfish-ejb-jar.xml</code> or <code>glassfish-web.xml</code> file the JNDI name of the
EJB component in the dependent application. Using an <code>ejb-link</code> mapping
does not work when the EJB component being called resides in another
application.</p>
</div>
<div class="paragraph">
<p>You do not need to restart the server.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debugging-applications"><a class="anchor" href="#debugging-applications"></a>6. Debugging Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter gives guidelines for debugging applications in the Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#enabling-debugging">Enabling Debugging</a></p>
</li>
<li>
<p><a href="#jpda-options">JPDA Options</a></p>
</li>
<li>
<p><a href="#generating-a-stack-trace-for-debugging">Generating a Stack Trace for Debugging</a></p>
</li>
<li>
<p><a href="#application-client-debugging">Application Client Debugging</a></p>
</li>
<li>
<p><a href="#open-message-queue-debugging">Open Message Queue Debugging</a></p>
</li>
<li>
<p><a href="#enabling-verbose-mode">Enabling Verbose Mode</a></p>
</li>
<li>
<p><a href="#class-loader-debugging">Class Loader Debugging</a></p>
</li>
<li>
<p><a href="#glassfish-server-logging">Eclipse GlassFish Logging</a></p>
</li>
<li>
<p><a href="#debug-profiling-tools">Profiling Tools</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="enabling-debugging"><a class="anchor" href="#enabling-debugging"></a>Enabling Debugging</h3>
<div class="paragraph">
<p>When you enable debugging, you enable both local and remote debugging.
To start the server in debug mode, use the <code>--debug</code> option as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin start-domain --debug [domain-name]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then attach to the server from the Java Debugger (<code>jdb</code>) at its
default Java Platform Debugger Architecture (JPDA) port, which is 9009.
For example, for UNIX systems:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>jdb -attach 9009</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>jdb</code> debugger, see the following links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java Platform Debugger Architecture - The Java Debugger:
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/specs/jpda/architecture.html" class="bare">https://docs.oracle.com/en/java/javase/17/docs/specs/jpda/architecture.html</a></code>
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/specs/jpda/jpda.html" class="bare">https://docs.oracle.com/en/java/javase/17/docs/specs/jpda/jpda.html</a></code></p>
</li>
<li>
<p>Java Platform Debugger Architecture - Connecting with JDB:
<code><a href="https://docs.oracle.com/en/java/javase/17/docs/specs/man/jdb.html" class="bare">https://docs.oracle.com/en/java/javase/17/docs/specs/man/jdb.html</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Eclipse GlassFish debugging is based on the JPDA. For more information,
see <a href="#jpda-options">JPDA Options</a>.</p>
</div>
<div class="paragraph">
<p>You can attach to the Eclipse GlassFish using any JPDA compliant debugger.</p>
</div>
<div class="paragraph">
<p>You can enable debugging even when the Eclipse GlassFish is started
without the <code>--debug</code> option.
This is useful if you start the Eclipse GlassFish from the Windows Start Menu,
or if you want to make sure that debugging is always turned on.</p>
</div>
<div class="sect3">
<h4 id="to-set-the-server-to-automatically-start-up-in-debug-mode"><a class="anchor" href="#to-set-the-server-to-automatically-start-up-in-debug-mode"></a>To Set the Server to Automatically Start Up in Debug Mode</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the Administration Console. Select the JVM Settings component
under the relevant configuration.</p>
</li>
<li>
<p>Check the Debug Enabled box.</p>
</li>
<li>
<p>To specify a different port (from 9009, the default) to use when
attaching the JVM software to a debugger, specify <code>address=</code>port-number
in the Debug Options field.</p>
</li>
<li>
<p>To add JPDA options, add any desired JPDA debugging options in Debug
Options. See <a href="#jpda-options">JPDA Options</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See Also</p>
</div>
<div class="paragraph">
<p>For details, click the Help button in the Administration Console from
the JVM Settings page.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jpda-options"><a class="anchor" href="#jpda-options"></a>JPDA Options</h3>
<div class="paragraph">
<p>The default JPDA options in Eclipse GlassFish are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>-Xdebug -agentlib:transport=dt_socket,server=y,suspend=n,address=9009</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Windows, you can change <code>dt_socket</code> to <code>dt_shmem</code>.</p>
</div>
<div class="paragraph">
<p>If you substitute <code>suspend=y</code>, the JVM software starts in suspended mode
and stays suspended until a debugger attaches to it. This is helpful if
you want to start debugging as soon as the JVM software starts.</p>
</div>
<div class="paragraph">
<p>To specify a different port (from 9009, the default) to use when
attaching the JVM software to a debugger, specify `address=`port-number.</p>
</div>
<div class="paragraph">
<p>You can include additional options. A list of JPDA debugging options is
available at
<code><a href="http://java.sun.com/javase/technologies/core/toolsapis/jpda/" class="bare">http://java.sun.com/javase/technologies/core/toolsapis/jpda/</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="generating-a-stack-trace-for-debugging"><a class="anchor" href="#generating-a-stack-trace-for-debugging"></a>Generating a Stack Trace for Debugging</h3>
<div class="paragraph">
<p>To generate a Java stack trace for debugging, use the
<code>asadmin generate-jvm-report --type=thread</code> command. The stack trace
goes to the domain-dir`/logs/server.log` file and also appears on the
command prompt screen. For more information about the
<code>asadmin generate-jvm-report</code> command, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="application-client-debugging"><a class="anchor" href="#application-client-debugging"></a>Application Client Debugging</h3>
<div class="paragraph">
<p>When the <code>appclient</code> script executes the <code>java</code> command to run the
Application Client Container (ACC), which in turn runs the client, it
includes on the command line the value of the <code>VMARGS</code> environment
variable. You can set this variable to any suitable value. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>VMARGS=-agentlib:transport=dt_socket,server=y,suspend=y,address=8118</code></pre>
</div>
</div>
<div class="paragraph">
<p>For debugging an application client, you should set suspend to <code>y</code> so
you can connect the debugger to the client before any code has actually
executed. Otherwise, the client may start running and execute past the
point you want to examine.</p>
</div>
<div class="paragraph">
<p>You should use different ports for the server and client if you are
debugging both concurrently. For details about setting the port, see
<a href="#jpda-options">JPDA Options</a>.</p>
</div>
<div class="paragraph">
<p>You can also include JVM options in the <code>appclient</code> script directly. For
information about the <code>appclient</code> script, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Application Client Container is supported only in the full Eclipse GlassFish, not in the Web Profile. See
<a href="#developing-java-clients">Developing Java Clients</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="open-message-queue-debugging"><a class="anchor" href="#open-message-queue-debugging"></a>Open Message Queue Debugging</h3>
<div class="paragraph">
<p>Open Message Queue has a broker logger, which can be useful for
debugging Java Message Service (JMS) applications, including
message-driven bean applications. You can adjust the logger&#8217;s verbosity,
and you can send the logger output to the broker&#8217;s console using the
broker&#8217;s <code>-tty</code> option. For more information, see the <a href="https://eclipse-ee4j.github.io/openmq/guides//mq-admin-guide/toc.html">Open
Message Queue Administration Guide</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JMS resources are supported only in the full Eclipse GlassFish, not in
the Web Profile. See <a href="#using-the-java-message-service">Using the Java Message Service</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="enabling-verbose-mode"><a class="anchor" href="#enabling-verbose-mode"></a>Enabling Verbose Mode</h3>
<div class="paragraph">
<p>To have the server logs and messages printed to <code>System.out</code> on your
command prompt screen, you can start the server in verbose mode. This
makes it easy to do simple debugging using print statements, without
having to view the <code>server.log</code> file every time.</p>
</div>
<div class="paragraph">
<p>To start the server in verbose mode, use the <code>--verbose</code> option as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin start-domain --verbose [domain-name]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the server is in verbose mode, messages are logged to the console
or terminal window in addition to the log file. In addition, pressing
Ctrl-C stops the server and pressing Ctrl-\ (on UNIX platforms) or
Ctrl-Break (on Windows platforms) prints a thread dump. On UNIX
platforms, you can also print a thread dump using the <code>jstack</code> command
(see
<code><a href="http://docs.oracle.com/javase/8/docs/technotes/tools/share/jstack.html" class="bare">http://docs.oracle.com/javase/8/docs/technotes/tools/share/jstack.html</a></code>)
or the command <code>kill -QUIT</code> process_id.</p>
</div>
</div>
<div class="sect2">
<h3 id="class-loader-debugging"><a class="anchor" href="#class-loader-debugging"></a>Class Loader Debugging</h3>
<div class="paragraph">
<p>To generate class loading messages, use the following
<code>asadmin create-jvm-options</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -verbose\:class</code></pre>
</div>
</div>
<div class="paragraph">
<p>To send the JVM messages to a special JVM log file instead of <code>stdout</code>,
use the following <code>asadmin create-jvm-options</code> commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -XX\:+LogVMOutput
asadmin create-jvm-options -XX\:LogFile=${com.sun.aas.instanceRoot}/logs/jvm.log</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These <code>-XX</code> options are specific to the OpenJDK (or Hotspot) JVM and do
not work with the JRockit JVM.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To send the Eclipse GlassFish messages to the Administration Console
instead of <code>stderr</code>, start the domain in verbose mode as described in
<a href="#enabling-verbose-mode">Enabling Verbose Mode</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="glassfish-server-logging"><a class="anchor" href="#glassfish-server-logging"></a>Eclipse GlassFish Logging</h3>
<div class="paragraph">
<p>You can use the Eclipse GlassFish&#8217;s log files to help debug your
applications. Use the Administration Console. Select the Stand-Alone
Instances component, select the instance from the table, then click the
View Log Files button in the General Information page. Or select the
Cluster component, select the cluster from the table, select the
Instances tab, select the instance from the table, then click the View
Log Files button in the General Information page.</p>
</div>
<div class="paragraph">
<p>To change logging settings, select Logger Settings under the relevant configuration.</p>
</div>
<div class="paragraph">
<p>For details about logging, click the Help button in the Administration Console.</p>
</div>
</div>
<div class="sect2">
<h3 id="debug-profiling-tools"><a class="anchor" href="#debug-profiling-tools"></a>Profiling Tools</h3>
<div class="paragraph">
<p>You can use a profiler to perform remote profiling on the Eclipse GlassFish to discover bottlenecks in server-side performance. This section
describes how to configure profilers for use with Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-netbeans-profiler">The NetBeans Profiler</a></p>
</li>
<li>
<p><a href="#the-hprof-profiler">The HPROF Profiler</a></p>
</li>
<li>
<p><a href="#the-jprobe-profiler">The JProbe Profiler</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Information about comprehensive monitoring and management support in the
Java 2 Platform, Standard Edition ( J2SE platform) is available at
<code><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/management/index.html" class="bare">http://docs.oracle.com/javase/8/docs/technotes/guides/management/index.html</a></code>.</p>
</div>
<div class="sect3">
<h4 id="the-netbeans-profiler"><a class="anchor" href="#the-netbeans-profiler"></a>The NetBeans Profiler</h4>
<div class="paragraph">
<p>For information on how to use the NetBeans profiler, see
<code><a href="http://profiler.netbeans.org/index.html" class="bare">http://profiler.netbeans.org/index.html</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-hprof-profiler"><a class="anchor" href="#the-hprof-profiler"></a>The HPROF Profiler</h4>
<div class="paragraph">
<p>The Heap and CPU Profiling Agent (HPROF) is a simple profiler agent
shipped with the Java 2 SDK. It is a dynamically linked library that
interacts with the Java Virtual Machine Profiler Interface (JVMPI) and
writes out profiling information either to a file or to a socket in
ASCII or binary format.</p>
</div>
<div class="paragraph">
<p>HPROF can monitor CPU usage, heap allocation statistics, and contention
profiles. In addition, it can also report complete heap dumps and states
of all the monitors and threads in the Java virtual machine. For more
details on the HPROF profiler, see the technical article at
<code><a href="http://java.sun.com/developer/technicalArticles/Programming/HPROF.html" class="bare">http://java.sun.com/developer/technicalArticles/Programming/HPROF.html</a></code>.</p>
</div>
<div class="paragraph">
<p>After HPROF is enabled using the following instructions, its libraries
are loaded into the server process.</p>
</div>
<div class="sect4">
<h5 id="to-use-hprof-profiling-on-unix"><a class="anchor" href="#to-use-hprof-profiling-on-unix"></a>To Use HPROF Profiling on UNIX</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the Administration Console. Select the JVM Settings component
under the relevant configuration. Then select the Profiler tab.</p>
</li>
<li>
<p>Edit the following fields:</p>
<div class="ulist">
<ul>
<li>
<p>Profiler Name - <code>hprof</code></p>
</li>
<li>
<p>Profiler Enabled - <code>true</code></p>
</li>
<li>
<p>Classpath - (leave blank)</p>
</li>
<li>
<p>Native Library Path - (leave blank)</p>
</li>
<li>
<p>JVM Option - Select Add, type the HPROF JVM option in the Value field,
then check its box. The syntax of the HPROF JVM option is as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>-Xrunhprof[:help]|[:param=value,param2=value2, ...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of params you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>-Xrunhprof:file=log.txt,thread=y,depth=3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file parameter determines where the stack dump is written.</p>
</div>
<div class="paragraph">
<p>Using help lists parameters that can be passed to HPROF. The output is
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Hprof usage: -Xrunhprof[:help]|[:&lt;option&gt;=&lt;value&gt;, ...]

== Option Name and Value   Description             Default   -----------             -------
heap=dump|sites|all     heap profiling          all
cpu=samples|old         CPU usage               off
format=a|b              ascii or binary output  a
file=&lt;file&gt;             write data to file      java.hprof
                               (.txt for ascii)
net=&lt;host&gt;:&lt;port&gt;       send data over a socket write to file
depth=&lt;size&gt;            stack trace depth       4
cutoff=&lt;value&gt;          output cutoff point     0.0001
lineno=y|n              line number in traces?  y
thread=y|n              thread in traces?       n
doe=y|n                 dump on exit?           y</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use help in the JVM Option field. This parameter prints text to
the standard output and then exits.</p>
</div>
<div class="paragraph">
<p>The help output refers to the parameters as options, but they are not
the same thing as JVM options.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a id="hprofstp2"></a>
Restart the Eclipse GlassFish.</p>
<div class="paragraph">
<p>This writes an HPROF stack dump to the file you specified using the file
HPROF parameter.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-jprobe-profiler"><a class="anchor" href="#the-jprobe-profiler"></a>The JProbe Profiler</h4>
<div class="paragraph">
<p>Information about JProbe from Sitraka is available at
<code><a href="http://www.quest.com/jprobe/" class="bare">http://www.quest.com/jprobe/</a></code>.</p>
</div>
<div class="paragraph">
<p>After JProbe is installed using the following instructions, its
libraries are loaded into the server process.</p>
</div>
<div class="sect4">
<h5 id="to-enable-remote-profiling-with-jprobe"><a class="anchor" href="#to-enable-remote-profiling-with-jprobe"></a>To Enable Remote Profiling With JProbe</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install JProbe 3.0.1.1. For details, see the JProbe documentation.</p>
</li>
<li>
<p>Configure Eclipse GlassFish using the Administration Console:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the JVM Settings component under the relevant configuration.</p>
</li>
<li>
<p>Then select the Profiler tab.</p>
</li>
<li>
<p>Edit the following fields before selecting Save and restarting the server:<br>
Profiler Name - <code>jprobe</code><br>
Profiler Enabled - <code>true</code><br>
Classpath - (leave blank)<br>
Native Library Path - JProbe-dir<code>/profiler</code><br>
JVM Option - For each of these options, select Add, type the option in
the Value field, then check its box:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    -Xbootclasspath/p:JProbe-dir/profiler/jpagent.jar
    -Xrunjprobeagent
    -Xnoclassgc</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If any of the configuration options are missing or incorrect, the
profiler might experience problems that affect the performance of the
Eclipse GlassFish.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the server starts up with this configuration, you can attach the
profiler.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Set the following environment variable:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>JPROBE_ARGS_0=-jp_input=JPL-file-path</code></pre>
</div>
</div>
<div class="paragraph">
<p>See Step <a href="#jprbstp6">6</a> for instructions on how to create the JPL
file.</p>
</div>
</li>
<li>
<p>Start the server instance.</p>
</li>
<li>
<p>Launch the <code>jpprofiler</code> and attach to Remote Session.
The default port is <code>4444</code>.</p>
</li>
<li>
<p><a id="jprbstp6"></a>
Create the JPL file using the <strong>JProbe Launch Pad</strong>. Here are the required settings:<br></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select Server Side for the type of application.</p>
</li>
<li>
<p>On the Program tab, provide the following details:<br>
Target Server - other-server<br>
Server home Directory - as-install<br>
Server class File - <code>com.sun.enterprise.server.J2EERunner</code><br>
Working Directory - as-install<br>
Classpath - as-install<code>/lib/appserv-rt.jar</code><br>
Source File Path - source-code-dir (in case you want to get the line level details)<br>
Server class arguments - (optional)<br>
Main Package - <code>com.sun.enterprise.server</code><br>
You must also set VM, Attach, and Coverage tabs appropriately.<br>
For further details, see the JProbe documentation.<br>
After you have created the JPL file, use this an input to <code>JPROBE_ARGS_0</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part-ii"><a class="anchor" href="#part-ii"></a>Part II</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="developing-applications-and-application-components"><a class="anchor" href="#developing-applications-and-application-components"></a>7. Developing Applications and Application Components</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="api-for-dev"><a class="anchor" href="#api-for-dev"></a>8. API for development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eclipse GlassFish provides several APIs to build applications and components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://jakarta.ee">Jakarta EE API</a> - Platform or Web profile, depends on the Eclipse GlassFish distribution</p>
</li>
<li>
<p><a href="https://microprofile.io">MicroProfile API</a> - selected specifications, only avaiable in Eclipse GlassFish Full</p>
</li>
<li>
<p>GlassFish API - to access other functionality provided by Eclipse GlassFish</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>GlassFish API is composed of a few sets of APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GlassFish API</p>
</li>
<li>
<p>GlassFish EE API</p>
</li>
<li>
<p>Simple GlassFish API</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="glassfish-api"><a class="anchor" href="#glassfish-api"></a>GlassFish API</h3>
<div class="paragraph">
<p>Most of the functionality specific to Eclipse GlassFish is available in the GlassFish API. To compile applications or components, add the <code>glassfish-api.jar</code> to the compile classpath. You may also need <code>scattered-archive-api.jar</code>.</p>
</div>
<div class="paragraph">
<p>The <code>glassfish-api.jar</code> is located in the Eclipse GlassFish installation in as-install<code>/modules/glassfish-api.jar</code>.</p>
</div>
<div class="paragraph">
<p>In Maven project, you can add it as the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish.main.common&lt;/groupId&gt;
    &lt;artifactId&gt;glassfish-api&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will already add <code>scattered-archive-api.jar</code> as a transitive dependency.</p>
</div>
</div>
<div class="sect2">
<h3 id="glassfish-ee-api"><a class="anchor" href="#glassfish-ee-api"></a>GlassFish EE API</h3>
<div class="paragraph">
<p>GlassFish EE API provides functionality related to Jakarta EE. To compile applications or components, add the <code>glassfish-ee-api.jar</code> to the compile classpath.</p>
</div>
<div class="paragraph">
<p>The <code>glassfish-ee-api.jar</code> is located in the Eclipse GlassFish installation in as-install<code>/modules/glassfish-ee-api.jar</code>.</p>
</div>
<div class="paragraph">
<p>In Maven project, you can add it as the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish.main.common&lt;/groupId&gt;
    &lt;artifactId&gt;glassfish-ee-api&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="simple-glassfish-api"><a class="anchor" href="#simple-glassfish-api"></a>Simple GlassFish API</h3>
<div class="paragraph">
<p>Simple GlassFish API provides basic functionality to deploy applications and run admin commands. Mostly to use embedded Eclipse GlassFish programmatically. To compile applications or components, add the <code>simple-glassfish-api.jar</code> to the compile classpath.</p>
</div>
<div class="paragraph">
<p>The <code>simple-glassfish-api.jar</code> is located in the Eclipse GlassFish installation in as-install<code>/modules/simple-glassfish-api.jar</code>.</p>
</div>
<div class="paragraph">
<p>In Maven project, you can add it as the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish.main.common&lt;/groupId&gt;
    &lt;artifactId&gt;simple-glassfish-api&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="securing-applications"><a class="anchor" href="#securing-applications"></a>9. Securing Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to write secure Jakarta EE applications, which
contain components that perform user authentication and access
authorization for the business logic of Jakarta EE components.</p>
</div>
<div class="paragraph">
<p>For information about administrative security for the Eclipse GlassFish, see the <a href="security-guide.html#GSSCG">Eclipse GlassFish
Security Guide</a>.</p>
</div>
<div class="paragraph">
<p>For general information about Jakarta EE security, see
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#security-2">Security</a>
in The Jakarta EE Tutorial.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#security-goals">Security Goals</a></p>
</li>
<li>
<p><a href="#glassfish-server-specific-security-features">Eclipse GlassFish Specific Security Features</a></p>
</li>
<li>
<p><a href="#container-security">Container Security</a></p>
</li>
<li>
<p><a href="#roles-principals-and-principal-to-role-mapping">Roles, Principals, and Principal to Role Mapping</a></p>
</li>
<li>
<p><a href="#realm-configuration">Realm Configuration</a></p>
</li>
<li>
<p><a href="#java-ee-security-api-support">Jakarta EE Security API Support</a></p>
</li>
<li>
<p><a href="#jacc-support">JACC Support</a></p>
</li>
<li>
<p><a href="#pluggable-audit-module-support">Pluggable Audit Module Support</a></p>
</li>
<li>
<p><a href="#GSDVG00121">The <code>server.policy</code> File</a></p>
</li>
<li>
<p><a href="#configuring-message-security-for-web-services">Configuring Message Security for Web Services</a></p>
</li>
<li>
<p><a href="#programmatic-login-using-the-programmaticlogin-class">Programmatic Login Using the ProgrammaticLogin Class</a></p>
</li>
<li>
<p><a href="#user-authentication-for-single-sign-on">User Authentication for Single Sign-on</a></p>
</li>
<li>
<p><a href="#adding-authentication-mechanisms-to-the-servlet-container">Adding Authentication Mechanisms to the Servlet Container</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Web Profile of the Eclipse GlassFish supports the EJB 3.1 Lite
specification, which allows enterprise beans within web applications,
among other features. The full Eclipse GlassFish supports the entire EJB
3.1 specification. For details, see
<a href="http://jcp.org/en/jsr/detail?id=318">JSR 318</a>
(<code><a href="http://jcp.org/en/jsr/detail?id=318" class="bare">http://jcp.org/en/jsr/detail?id=318</a></code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="security-goals"><a class="anchor" href="#security-goals"></a>Security Goals</h3>
<div class="paragraph">
<p>In an enterprise computing environment, there are many security risks.
The goal of the Eclipse GlassFish is to provide highly secure,
interoperable, and distributed component computing based on the Jakarta EE
security model. Security goals include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Full compliance with the Jakarta EE security model. This includes EJB and
servlet role-based authorization.</p>
</li>
<li>
<p>Support for single sign-on across all Eclipse GlassFish applications
within a single security domain.</p>
</li>
<li>
<p>Support for web services message security.</p>
</li>
<li>
<p>Security support for application clients.</p>
</li>
<li>
<p>Support for several underlying authentication realms, such as simple
file and Lightweight Directory Access Protocol (LDAP). Certificate
authentication is also supported for Secure Socket Layer (SSL) client
authentication. For Solaris, OS platform authentication is supported in
addition to these.</p>
</li>
<li>
<p>Support for declarative security through Eclipse GlassFish specific
XML-based role mapping.</p>
</li>
<li>
<p>Support for Java Authorization Contract for Containers (JACC)
pluggable authorization as included in the Jakarta EE specification and
defined by <a href="http://www.jcp.org/en/jsr/detail?id=115">Java Specification
Request (JSR) 115</a> (<code><a href="http://www.jcp.org/en/jsr/detail?id=115" class="bare">http://www.jcp.org/en/jsr/detail?id=115</a></code>).</p>
</li>
<li>
<p>Support for Java Authentication Service Provider Interface for
Containers as included in the Jakarta EE specification and defined by
<a href="http://www.jcp.org/en/jsr/detail?id=196">JSR 196</a>
(<code><a href="http://www.jcp.org/en/jsr/detail?id=196" class="bare">http://www.jcp.org/en/jsr/detail?id=196</a></code>).</p>
</li>
<li>
<p>Support for Web Services Interoperability Technologies (WSIT) as described in
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#web-services-interoperability-and-jakarta-xml-web-services">
Jakarta EE Tutorial</a>.</p>
</li>
<li>
<p>Support for the Jakarta EE Security API as included in the Jakarta EE
specification and defined by <a href="https://jcp.org/en/jsr/detail?id=375">JSR
375</a> (<code><a href="https://jcp.org/en/jsr/detail?id=375" class="bare">https://jcp.org/en/jsr/detail?id=375</a></code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="glassfish-server-specific-security-features"><a class="anchor" href="#glassfish-server-specific-security-features"></a>Eclipse GlassFish Specific Security Features</h3>
<div class="paragraph">
<p>The Eclipse GlassFish supports the Jakarta EE security model, as well as the
following features which are specific to the Eclipse GlassFish:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Message security; see <a href="#configuring-message-security-for-web-services">Configuring Message Security for Web
Services</a></p>
</li>
<li>
<p>Single sign-on across all Eclipse GlassFish applications within a
single security domain; see <a href="#user-authentication-for-single-sign-on">User Authentication for Single
Sign-on</a></p>
</li>
<li>
<p>Programmatic login; see <a href="#programmatic-login-using-the-programmaticlogin-class">Programmatic Login Using the
ProgrammaticLogin Class</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="container-security"><a class="anchor" href="#container-security"></a>Container Security</h3>
<div class="paragraph">
<p>The component containers are responsible for providing Jakarta EE
application security. The container provides two security forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#declarative-security">Declarative Security</a></p>
</li>
<li>
<p><a href="#programmatic-security">Programmatic Security</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Annotations (also called metadata) enable a declarative style of
programming, and so encompass both the declarative and programmatic
security concepts. Users can specify information about security within a
class file using annotations. When the application is deployed, this
information can either be used by or overridden by the application or
module deployment descriptor.</p>
</div>
<div class="sect3">
<h4 id="declarative-security"><a class="anchor" href="#declarative-security"></a>Declarative Security</h4>
<div class="paragraph">
<p>Declarative security means that the security mechanism for an
application is declared and handled externally to the application.
Deployment descriptors describe the Jakarta EE application&#8217;s security
structure, including security roles, access control, and authentication
requirements.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish supports the deployment descriptors specified by
Jakarta EE and has additional security elements included in its own
deployment descriptors. Declarative security is the application
deployer&#8217;s responsibility. For more information about Eclipse GlassFish
deployment descriptors, see the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment Guide</a>.</p>
</div>
<div class="paragraph">
<p>There are two levels of declarative security, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#application-level-security">Application Level Security</a></p>
</li>
<li>
<p><a href="#component-level-security">Component Level Security</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="application-level-security"><a class="anchor" href="#application-level-security"></a>Application Level Security</h5>
<div class="paragraph">
<p>For an application, roles used by any application must be defined in
<code>@DeclareRoles</code> annotations in the code or <code>role-name</code> elements in the
application deployment descriptor (<code>application.xml</code>). Those role names
are scoped to the EJB XML deployment descriptors (<code>ejb-jar.xml</code> and
<code>glassfish-ejb-jar.xml</code> files) and to the servlet XML deployment
descriptors (<code>web.xml</code> and <code>glassfish-web.xml</code> files). For an
individually deployed web or EJB module, you define roles using
<code>@DeclareRoles</code> annotations or <code>role-name</code> elements in the Jakarta EE
deployment descriptor files <code>web.xml</code> or <code>ejb-jar.xml</code>.</p>
</div>
<div class="paragraph">
<p>To map roles to principals and groups, define matching
<code>security-role-mapping</code> elements in the <code>glassfish-application.xml</code>,
<code>glassfish-ejb-jar.xml</code>, or <code>glassfish-web.xml</code> file for each
<code>role-name</code> used by the application. By default, group principal names
are mapped to roles of the same name. Accordingly, the Default Principal
To Role Mapping setting is enabled by default on the Security page of
the Eclipse GlassFish Administration Console. This default role mapping
definition is in effect if you do not define your own mapping in the
deployment descriptor for your application as described in this section.
For more information, see <a href="#roles-principals-and-principal-to-role-mapping">Roles, Principals, and Principal
to Role Mapping</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="component-level-security"><a class="anchor" href="#component-level-security"></a>Component Level Security</h5>
<div class="paragraph">
<p>Component level security encompasses web components and EJB components.</p>
</div>
<div class="paragraph">
<p>A secure web container authenticates users and authorizes access to a
servlet or JSP by using the security policy laid out in the servlet XML
deployment descriptors (<code>web.xml</code> and <code>glassfish-web.xml</code> files).</p>
</div>
<div class="paragraph">
<p>The EJB container is responsible for authorizing access to a bean method
by using the security policy laid out in the EJB XML deployment
descriptors (<code>ejb-jar.xml</code> and <code>glassfish-ejb-jar.xml</code> files).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="programmatic-security"><a class="anchor" href="#programmatic-security"></a>Programmatic Security</h4>
<div class="paragraph">
<p>Programmatic security involves an EJB component or servlet using method
calls to the security API, as specified by the Jakarta EE security model,
to make business logic decisions based on the caller or remote user&#8217;s
security role. Programmatic security should only be used when
declarative security alone is insufficient to meet the application&#8217;s
security model.</p>
</div>
<div class="paragraph">
<p>The API for programmatic security consists of methods of the Jakarta EE
Security API <code>SecurityContext</code> interface, and methods of the EJB
<code>EJBContext</code> interface and the servlet <code>HttpServletRequest</code> interface.
The Eclipse GlassFish supports these interfaces as specified in the Java
EE specification.</p>
</div>
<div class="paragraph">
<p>There is also a proprietary Glassfish API for programmatic login. See
<a href="#programmatic-login-using-the-programmaticlogin-class">Programmatic Login Using the ProgrammaticLogin Class</a>.</p>
</div>
<div class="paragraph">
<p>For more information about programmatic security, see
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#using-programmatic-security-with-web-applications">
Using Programmatic Security</a> in the The Jakarta EE Tutorial.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="roles-principals-and-principal-to-role-mapping"><a class="anchor" href="#roles-principals-and-principal-to-role-mapping"></a>Roles, Principals, and Principal to Role Mapping</h3>
<div class="paragraph">
<p>By default, any groups that an authenticated user belongs to will be
mapped to roles with the same names. Therefore, the Default Principal To
Role Mapping setting is enabled by default on the Security page of the
GlassFish Administration Console. To change the default mapping you can
clear this setting. For applications, you define roles in
<code>@DeclareRoles</code> annotations or the Jakarta EE deployment descriptor file
<code>application.xml</code>. You define the corresponding role mappings in the
Eclipse GlassFish deployment descriptor file <code>glassfish-application.xml</code>.
For individually deployed web or EJB modules, you define roles in
<code>@DeclareRoles</code> annotations or the Jakarta EE deployment descriptor files
<code>web.xml</code> or <code>ejb-jar.xml</code>. You define the corresponding role mappings
in the Eclipse GlassFish deployment descriptor files <code>glassfish-web.xml</code>
or <code>glassfish-ejb-jar.xml</code>.</p>
</div>
<div class="paragraph">
<p>For more information regarding Jakarta EE deployment descriptors, see the
Jakarta EE Specification. For more information regarding Eclipse GlassFish
deployment descriptors, see "<a href="application-deployment-guide.html#c-elements-of-the-glassfish-server-deployment-descriptors">Elements of the Eclipse GlassFish Deployment Descriptors</a>" in Eclipse GlassFish
Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>Each <code>security-role-mapping</code> element in the <code>glassfish-application.xml</code>,
<code>glassfish-web.xml</code>, or <code>glassfish-ejb-jar.xml</code> file maps a role name
permitted by the application or module to principals and groups. For
example, a <code>glassfish-web.xml</code> file for an individually deployed web
module might contain the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-web-app&gt;</span>
    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>manager<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;principal-name&gt;</span>jgarcia<span class="tag">&lt;/principal-name&gt;</span>
        <span class="tag">&lt;principal-name&gt;</span>mwebster<span class="tag">&lt;/principal-name&gt;</span>
        <span class="tag">&lt;group-name&gt;</span>team-leads<span class="tag">&lt;/group-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>
    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>administrator<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;principal-name&gt;</span>dsmith<span class="tag">&lt;/principal-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>
<span class="tag">&lt;/glassfish-web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A role can be mapped to either specific principals or to groups (or
both). The principal or group names used must be valid principals or
groups in the realm for the application or module. Note that the
<code>role-name</code> in this example must match the <code>@DeclareRoles</code> annotations
or the <code>role-name</code> in the <code>security-role</code> element of the corresponding
<code>web.xml</code> file.</p>
</div>
<div class="paragraph">
<p>You can also specify a custom principal implementation class. This
provides more flexibility in how principals can be assigned to roles. A
user&#8217;s JAAS login module now can authenticate its custom principal, and
the authenticated custom principal can further participate in the
Eclipse GlassFish authorization process. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-role-mapping&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>administrator<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;principal-name</span> <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CustomPrincipalImplClass</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        dsmith
    <span class="tag">&lt;/principal-name&gt;</span>
<span class="tag">&lt;/security-role-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify a default principal and a default principal to role
mapping, each of which applies to the entire Eclipse GlassFish instance.
The default principal to role mapping maps group principals to the same
named roles. Web modules that omit the <code>run-as</code> element in <code>web.xml</code> use
the default principal. Applications and modules that omit the
<code>security-role-mapping</code> element use the default principal to role
mapping. These defaults are part of the Security Service, which you can
access in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, select the Security component under the
relevant configuration. For details, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>Use the <code>asadmin set</code> command. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>. For
example, you can set the default principal as follows.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server-config.security-service.default-principal=dsmith
asadmin set server-config.security-service.default-principal-password=secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set the default principal to role mapping as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server-config.security-service.activate-default-principal-to-role-mapping=true
asadmin set server-config.security-service.mapped-principal-class=CustomPrincipalImplClass</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default principal to role mapping is enabled by default. To disable it,
set the default principal to role mapping property to false.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="realm-configuration"><a class="anchor" href="#realm-configuration"></a>Realm Configuration</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#supported-realms">Supported Realms</a></p>
</li>
<li>
<p><a href="#how-to-configure-a-realm">How to Configure a Realm</a></p>
</li>
<li>
<p><a href="#how-to-set-a-realm-for-an-application-or-module">How to Set a Realm for an Application or Module</a></p>
</li>
<li>
<p><a href="#creating-a-custom-realm">Creating a Custom Realm</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="supported-realms"><a class="anchor" href="#supported-realms"></a>Supported Realms</h4>
<div class="paragraph">
<p>The following realms are supported in the current release of the
Eclipse GlassFish:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>file</code> - Stores user information in a file. This is the default realm
when you first install the Eclipse GlassFish.</p>
</li>
<li>
<p><code>ldap</code> - Stores user information in an LDAP directory.</p>
</li>
<li>
<p><code>jdbc</code> - Stores user information in a database.</p>
<div class="paragraph">
<p>In the JDBC realm, the server gets user credentials from a database. The
Eclipse GlassFish uses the database information and the enabled JDBC
realm option in the configuration file. For digest authentication, a
JDBC realm should be created with <code>digestRealm</code> as the JAAS context.</p>
</div>
</li>
<li>
<p><code>certificate</code> - Sets up the user identity in the Eclipse GlassFish
security context, and populates it with user data obtained from
cryptographically verified client certificates.</p>
</li>
<li>
<p><code>solaris</code> - Allows authentication using Solaris <code>username+password</code>
data. This realm is only supported on the Solaris operating system,
version 9 and above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about configuring realms, see <a href="#how-to-configure-a-realm">How to
Configure a Realm</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-configure-a-realm"><a class="anchor" href="#how-to-configure-a-realm"></a>How to Configure a Realm</h4>
<div class="paragraph">
<p>You can configure a realm in one of these ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, open the Security component under the
relevant configuration and go to the Realms page. For details, click the
Help button in the Administration Console.</p>
</li>
<li>
<p>Use the <code>asadmin create-auth-realm</code> command to configure realms on
local servers. For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="how-to-set-a-realm-for-an-application-or-module"><a class="anchor" href="#how-to-set-a-realm-for-an-application-or-module"></a>How to Set a Realm for an Application or Module</h4>
<div class="paragraph">
<p>The following deployment descriptor elements have optional <code>realm</code> or
<code>realm-name</code> data subelements or attributes that override the domain&#8217;s
default realm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>glassfish-application</code> element in <code>glassfish-application.xml</code></p>
</li>
<li>
<p><code>web-app</code> element in <code>web.xml</code></p>
</li>
<li>
<p><code>as-context</code> element in <code>glassfish-ejb-jar.xml</code></p>
</li>
<li>
<p><code>client-container</code> element in <code>sun-acc.xml</code></p>
</li>
<li>
<p><code>client-credential</code> element in <code>sun-acc.xml</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If modules within an application specify realms, these are ignored. If
present, the realm defined in <code>glassfish-application.xml</code> is used,
otherwise the domain&#8217;s default realm is used.</p>
</div>
<div class="paragraph">
<p>For example, a realm is specified in <code>glassfish-application.xml</code> as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-application&gt;</span>
    ...
    <span class="tag">&lt;realm&gt;</span>ldap<span class="tag">&lt;/realm&gt;</span>
<span class="tag">&lt;/glassfish-application&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the deployment descriptor files and elements,
see "<a href="application-deployment-guide.html#c-elements-of-the-glassfish-server-deployment-descriptors">Elements of the Eclipse GlassFish Deployment
Descriptors</a>" in Eclipse GlassFish Application
Deployment Guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-custom-realm"><a class="anchor" href="#creating-a-custom-realm"></a>Creating a Custom Realm</h4>
<div class="paragraph">
<p>You can create a custom realm by providing a custom Java Authentication
and Authorization Service (JAAS) login module class and a custom realm
class. Note that client-side JAAS login modules are not suitable for use
with the Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>To activate the custom login modules and realms, place the JAR files in
the domain-dir<code>/lib</code> directory or the class files in the
domain-dir`/lib/classes` directory. For more information about class
loading in the Eclipse GlassFish, see <a href="#class-loaders">Class
Loaders</a>.</p>
</div>
<div class="paragraph">
<p>JAAS is a set of APIs that enable services to authenticate and enforce
access controls upon users. JAAS provides a pluggable and extensible
framework for programmatic user authentication and authorization. JAAS
is a core API and an underlying technology for Jakarta EE security
mechanisms. For more information about JAAS, refer to the specification,
available at <code><a href="https://jakarta.ee/specifications/authentication/" class="bare">https://jakarta.ee/specifications/authentication/</a></code> and
<code><a href="https://jakarta.ee/specifications/authorization/" class="bare">https://jakarta.ee/specifications/authorization/</a></code>.</p>
</div>
<div class="paragraph">
<p>For general information about realms and login modules, see the section
about working with realms, users, groups, and roles in
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#security-2">
Introduction to Security in the Jakarta EE Platform</a>
in The Jakarta EE Tutorial.</p>
</div>
<div class="paragraph">
<p>For Javadoc tool pages relevant to custom realms, see the
<code>com.sun.appserv.security</code> package.</p>
</div>
<div class="paragraph">
<p>Custom login modules must extend the
<code>com.sun.appserv.security.AppservPasswordLoginModule</code> class. This class
implements javax.security.auth.spi.LoginModule. Custom login modules
must not implement LoginModule directly.</p>
</div>
<div class="paragraph">
<p>Custom login modules must provide an implementation for one abstract
method defined in <code>AppservPasswordLoginModule</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">abstract</span> <span class="directive">protected</span> <span class="type">void</span> authenticateUser() <span class="directive">throws</span> <span class="exception">LoginException</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This method performs the actual authentication. The custom login module
must not implement any of the other methods, such as <code>login</code>, <code>logout</code>,
<code>abort</code>, <code>commit</code>, or <code>initialize</code>. Default implementations are provided
in <code>AppservPasswordLoginModule</code> which hook into the Eclipse GlassFish
infrastructure.</p>
</div>
<div class="paragraph">
<p>The custom login module can access the following protected object
fields, which it inherits from <code>AppservPasswordLoginModule</code>. These
contain the user name and password of the user to be authenticated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> <span class="predefined-type">String</span> _username;
<span class="directive">protected</span> <span class="predefined-type">String</span> _password;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>authenticateUser</code> method must end with the following sequence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span><span class="type">[]</span> grpList;
<span class="comment">// populate grpList with the set of groups to which</span>
<span class="comment">// _username belongs in this realm, if any</span>
commitUserAuthentication(grpList);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Custom realms must extend the <code>com.sun.appserv.security.AppservRealm</code>
class and implement the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Properties</span> props) <span class="directive">throws</span> BadRealmException, NoSuchRealmException</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is invoked during server startup when the realm is initially
loaded. The <code>props</code> argument contains the properties defined for this
realm. The realm can do any initialization it needs in this method. If
the method returns without throwing an exception, the Eclipse GlassFish
assumes that the realm is ready to service authentication requests. If
an exception is thrown, the realm is disabled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> getAuthType()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method returns a descriptive string representing the type of
authentication done by this realm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">Enumeration</span> getGroupNames(<span class="predefined-type">String</span> username) <span class="directive">throws</span>
    InvalidOperationException, NoSuchUserException</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method returns an <code>Enumeration</code> (of <code>String</code> objects) enumerating
the groups (if any) to which the given <code>username</code> belongs in this realm.</p>
</div>
<div class="paragraph">
<p>Custom realms that manage users must implement the following additional
methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">boolean</span> supportsUserManagement();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method returns <code>true</code> if the realm supports user management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">Enumeration</span> getGroupNames() <span class="directive">throws</span> BadRealmException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method returns an <code>Enumeration</code> of all group names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="predefined-type">Enumeration</span> getUserNames() <span class="directive">throws</span> BadRealmException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method returns an <code>Enumeration</code> of all user names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">void</span> refresh() <span class="directive">throws</span> BadRealmException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method refreshes the realm data so that new users and groups are
visible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">void</span> persist() <span class="directive">throws</span> BadRealmException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method persists the realm data to permanent storage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> User getUser(<span class="predefined-type">String</span> name) <span class="directive">throws</span> NoSuchUserException,
BadRealmException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method returns the information recorded about a particular named
user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">void</span> addUser(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> password, <span class="predefined-type">String</span><span class="type">[]</span> groupList) <span class="directive">throws</span>
BadRealmException, IASSecurityException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method adds a new user, who cannot already exist.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">void</span> removeUser(<span class="predefined-type">String</span> name) <span class="directive">throws</span> NoSuchUserException,
BadRealmException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method removes a user, who must exist.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">void</span> updateUser(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> newName, <span class="predefined-type">String</span> password,
<span class="predefined-type">String</span><span class="type">[]</span> groups) <span class="directive">throws</span> NoSuchUserException, BadRealmException, IASSecurityException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method updates data for a user, who must exist.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The array passed to the <code>commitUseAuthentication</code> method should be newly
created and otherwise unreferenced. This is because the group name array
elements are set to null after authentication as part of cleanup. So the
second time your custom realm executes it returns an array with null
elements.</p>
</div>
<div class="paragraph">
<p>Ideally, your custom realm should not return member variables from the
<code>authenticate</code> method. It should return local variables as the default
<code>JDBCRealm</code> does. Your custom realm can create a local <code>String</code> array in
its <code>authenticate</code> method, copy the values from the member variables,
and return the <code>String</code> array. Or it can use <code>clone</code> on the member
variables.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-ee-security-api-support"><a class="anchor" href="#java-ee-security-api-support"></a>Jakarta EE Security API Support</h3>
<div class="paragraph">
<p>JSR-375 defines several authentication-related plugin SPIs, such as,
<code>HttpAuthenticationMechanism</code> interface, the <code>IdentityStore</code> and
<code>IdentityStoreHandler</code> interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HttpAuthenticationMechanism</code>: An interface for modules that
authenticate callers to a web application. An application can supply its
own <code>HttpAuthenticationMechanism</code>, or use one of the default
implementations provided by the container.</p>
</li>
<li>
<p><code>IdentityStore</code>: This interface defines methods for validating a
caller&#8217;s credentials (such as user name and password) and returning
group membership information. An application can provide its own
IdentityStore, or use the built in LDAP or Database store.</p>
</li>
<li>
<p><code>RememberMeIdentityStore</code>: This interface is a variation on the
<code>IdentityStore</code> interface, intended to address cases where an
authenticated user&#8217;s identity should be remembered for an extended
period of time, so that the caller can return to the application
periodically without needing to present primary authentication
credentials each time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to these authentication plugin SPIs, the Jakarta EE Security
API specification defines the <code>SecurityContext</code> API for use by
application code to query and interact with the current security
context. The <code>SecurityContext</code> interface defines methods that allow an
application to access security information about a caller, authenticate
a caller, and authorize a caller. These methods include
<code>getCallerPrincipal()</code>, <code>getPrincipalsByType()</code>, <code>isCallerInRole()</code>,
<code>authenticate()</code>, and <code>hasAccessToWebResource()</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="jacc-support"><a class="anchor" href="#jacc-support"></a>JACC Support</h3>
<div class="paragraph">
<p>JACC (Java Authorization Contract for Containers) is part of the Jakarta EE
specification and defined by <a href="http://www.jcp.org/en/jsr/detail?id=115">JSR
115</a> (<code><a href="http://www.jcp.org/en/jsr/detail?id=115" class="bare">http://www.jcp.org/en/jsr/detail?id=115</a></code>). JACC defines an
interface for pluggable authorization providers. Specifically, JACC is
used to plug in the Java policy provider used by the container to
perform Jakarta EE caller access decisions. The Java policy provider
performs Java policy decisions during application execution. This
provides third parties with a mechanism to develop and plug in modules
that are responsible for answering authorization decisions during Java
EE application execution. The interfaces and rules used for developing
JACC providers are defined in the JACC 1.0 specification.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish provides a simple file-based JACC-compliant
authorization engine as a default JACC provider, named <code>default</code>. An
alternate provider named <code>simple</code> is also provided. To configure an
alternate provider using the Administration Console, open the Security
component under the relevant configuration, and select the JACC
Providers component. For details, click the Help button in the
Administration Console.</p>
</div>
</div>
<div class="sect2">
<h3 id="pluggable-audit-module-support"><a class="anchor" href="#pluggable-audit-module-support"></a>Pluggable Audit Module Support</h3>
<div class="paragraph">
<p>Audit modules collect and store information on incoming requests
(servlets, EJB components) and outgoing responses. You can create a
custom audit module.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-an-audit-module">Configuring an Audit Module</a></p>
</li>
<li>
<p><a href="#the-auditmodule-class">The <code>AuditModule</code> Class</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-an-audit-module"><a class="anchor" href="#configuring-an-audit-module"></a>Configuring an Audit Module</h4>
<div class="paragraph">
<p>To configure an audit module, you can perform one of the following
tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify an audit module using the Administration Console, open the
Security component under the relevant configuration, and select the
Audit Modules component. For details, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>You can use the <code>asadmin create-audit-module</code> command to configure an
audit module. For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-auditmodule-class"><a class="anchor" href="#the-auditmodule-class"></a>The <code>AuditModule</code> Class</h4>
<div class="paragraph">
<p>You can create a custom audit module by implementing a class that
extends <code>com.sun.enterprise.security.audit.AuditModule</code>.</p>
</div>
<div class="paragraph">
<p>For Javadoc tool pages relevant to audit modules, see the
<code>com.sun.enterprise.security.audit</code> package.</p>
</div>
<div class="paragraph">
<p>The <code>AuditModule</code> class provides default "no-op" implementations for
each of the following methods, which your custom class can override.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Properties</span> props)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding method is invoked during server startup when the audit
module is initially loaded. The <code>props</code> argument contains the properties
defined for this module. The module can do any initialization it needs
in this method. If the method returns without throwing an exception, the
Eclipse GlassFish assumes the module realm is ready to service audit
requests. If an exception is thrown, the module is disabled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> authentication(<span class="predefined-type">String</span> user, <span class="predefined-type">String</span> realm, <span class="type">boolean</span> success)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is invoked when an authentication request has been processed
by a realm for the given user. The <code>success</code> flag indicates whether the
authorization was granted or denied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> webInvocation(<span class="predefined-type">String</span> user, HttpServletRequest req, <span class="predefined-type">String</span> type, <span class="type">boolean</span> success)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is invoked when a web container call has been processed by
authorization. The <code>success</code> flag indicates whether the authorization
was granted or denied. The <code>req</code> object is the standard
<code>HttpServletRequest</code> object for this request. The <code>type</code> string is one
of <code>hasUserDataPermission</code> or <code>hasResourcePermission</code> (see
<a href="http://www.jcp.org/en/jsr/detail?id=115">JSR 115</a>
(<code><a href="http://www.jcp.org/en/jsr/detail?id=115" class="bare">http://www.jcp.org/en/jsr/detail?id=115</a></code>)).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> ejbInvocation(<span class="predefined-type">String</span> user, <span class="predefined-type">String</span> ejb, <span class="predefined-type">String</span> method, <span class="type">boolean</span> success)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is invoked when an EJB container call has been processed by
authorization. The <code>success</code> flag indicates whether the authorization
was granted or denied. The <code>ejb</code> and <code>method</code> strings describe the EJB
component and its method that is being invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> webServiceInvocation(<span class="predefined-type">String</span> uri, <span class="predefined-type">String</span> endpoint, <span class="type">boolean</span> success)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is invoked during validation of a web service request in
which the endpoint is a servlet. The <code>uri</code> is the URL representation of
the web service endpoint. The <code>endpoint</code> is the name of the endpoint
representation. The <code>success</code> flag indicates whether the authorization
was granted or denied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> ejbAsWebServiceInvocation(<span class="predefined-type">String</span> endpoint, <span class="type">boolean</span> success)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is invoked during validation of a web service request in
which the endpoint is a stateless session bean. The <code>endpoint</code> is the
name of the endpoint representation. The <code>success</code> flag indicates
whether the authorization was granted or denied.</p>
</div>
<div class="paragraph">
<p><a id="GSDVG00121"></a><a id="the-server.policy-file"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-server-policy-file"><a class="anchor" href="#the-server-policy-file"></a>The <code>server.policy</code> File</h3>
<div class="paragraph">
<p>Each Eclipse GlassFish domain has its own global J2SE policy file,
located in domain-dir<code>/config</code>. The file is named <code>server.policy</code>.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish is a Jakarta EE compliant application server. As such,
it follows the requirements of the Jakarta EE specification, including the
presence of the security manager (the Java component that enforces the
policy) and a limited permission set for Jakarta EE application code.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#default-permissions">Default Permissions</a></p>
</li>
<li>
<p><a href="#system-properties">System Properties</a></p>
</li>
<li>
<p><a href="#changing-permissions-for-an-application">Changing Permissions for an Application</a></p>
</li>
<li>
<p><a href="#enabling-and-disabling-the-security-manager">Enabling and Disabling the Security Manager</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="default-permissions"><a class="anchor" href="#default-permissions"></a>Default Permissions</h4>
<div class="paragraph">
<p>Internal server code is granted all permissions. These are covered by
the <code>AllPermission</code> grant blocks to various parts of the server
infrastructure code. Do not modify these entries.</p>
</div>
<div class="paragraph">
<p>Application permissions are granted in the default grant block. These
permissions apply to all code not part of the internal server code
listed previously. The Eclipse GlassFish does not distinguish between EJB
and web module permissions. All code is granted the minimal set of web
component permissions (which is a superset of the EJB minimal set). Do
not modify these entries.</p>
</div>
<div class="paragraph">
<p>A few permissions above the minimal set are also granted in the default
<code>server.policy</code> file. These are necessary due to various internal
dependencies of the server implementation. Jakarta EE application
developers must not rely on these additional permissions. In some cases,
deleting these permissions might be appropriate. For example, one
additional permission is granted specifically for using connectors. If
connectors are not used in a particular domain, you should remove this
permission, because it is not otherwise necessary.</p>
</div>
</div>
<div class="sect3">
<h4 id="system-properties"><a class="anchor" href="#system-properties"></a>System Properties</h4>
<div class="paragraph">
<p>The following predefined system properties, also called variables, are
available for use in the <code>server.policy</code> file. The system property most
frequently used in <code>server.policy</code> is <code>${com.sun.aas.instanceRoot}</code>. For
more information about system properties, see the
<code>asadmin create-system-properties</code> command in the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div id="GSDVG533" class="paragraph">
<p>Table 4-1 Predefined System Properties</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 29%;">
<col style="width: 17%;">
<col style="width: 54%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.aas.installRoot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depends on operating system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the
directory where the Eclipse GlassFish is installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.aas.instanceRoot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depends on operating system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the
top level directory for a server instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.aas.hostName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the name of the host (machine).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.aas.javaRoot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depends on operating system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the
installation directory for the Java runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.aas.imqLib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">depends on operating system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the
library directory for the Open Message Queue software.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.aas.configName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>server-config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the name of the
configuration used by a server instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.aas.instanceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>server1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the name of the server
instance. This property is not used in the default configuration, but
can be used to customize configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.aas.clusterName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the name of the
cluster. This property is only set on clustered server instances. This
property is not used in the default configuration, but can be used to
customize configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.sun.aas.domainName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>domain1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the name of the domain.
This property is not used in the default configuration, but can be used
to customize configuration.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="changing-permissions-for-an-application"><a class="anchor" href="#changing-permissions-for-an-application"></a>Changing Permissions for an Application</h4>
<div class="paragraph">
<p>The default policy for each domain limits the permissions of Jakarta EE
deployed applications to the minimal set of permissions required for
these applications to operate correctly. Do not add extra permissions to
the default set (the grant block with no codebase, which applies to all
code). Instead, add a new grant block with a codebase specific to the
applications requiring the extra permissions, and only add the minimally
necessary permissions in that block.</p>
</div>
<div class="paragraph">
<p>If you develop multiple applications that require more than this default
set of permissions, you can add the custom permissions that your
applications need. The <code>com.sun.aas.instanceRoot</code> variable refers to the
domain-dir. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>grant codeBase &quot;file:${com.sun.aas.instanceRoot}/applications/-&quot; {
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add permissions to stub code with the following grant block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>grant codeBase &quot;file:${com.sun.aas.instanceRoot}/generated/-&quot; {
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In general, you should add extra permissions only to the applications or
modules that require them, not to all applications deployed to a domain.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>grant codeBase &quot;file:${com.sun.aas.instanceRoot}/applications/MyApp/-&quot; {
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>grant codeBase &quot;file:${com.sun.aas.instanceRoot}/applications/MyModule/-&quot; {
...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Deployment directories may change between Eclipse GlassFish releases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An alternative way to add permissions to a specific application or
module is to edit the <code>granted.policy</code> file for that application or
module. The <code>granted.policy</code> file is located in the
domain-dir`/generated/policy/`app-or-module-name directory. In this
case, you add permissions to the default grant block. Do not delete
permissions from this file.</p>
</div>
<div class="paragraph">
<p>When the Eclipse GlassFish policy subsystem determines that a permission
should not be granted, it logs a <code>server.policy</code> message specifying the
permission that was not granted and the protection domains, with
indicated code source and principals that failed the protection check.
For example, here is the first part of a typical message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[#|2005-12-17T16:16:32.671-0200|INFO|sun-appserver-pe9.1|
javax.enterprise.system.core.security|_ThreadID=14;_ThreadName=Thread-31;|
JACC Policy Provider: PolicyWrapper.implies, context(null)-
permission((java.util.PropertyPermission java.security.manager write))
domain that failed(ProtectionDomain
(file:/E:/glassfish/domains/domain1/applications/cejug-clfds/ ... )
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Granting the following permission eliminates the message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>grant codeBase &quot;file:${com.sun.aas.instanceRoot}/applications/cejug-clfds/-&quot; {
    permission java.util.PropertyPermission &quot;java.security.manager&quot;, &quot;write&quot;;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not add <code>java.security.AllPermission</code> to the <code>server.policy</code> file for
application code. Doing so completely defeats the purpose of the
security manager, yet you still get the performance overhead associated
with it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As noted in the Jakarta EE specification, an application should provide
documentation of the additional permissions it needs. If an application
requires extra permissions but does not document the set it needs,
contact the application author for details.</p>
</div>
<div class="paragraph">
<p>As a last resort, you can iteratively determine the permission set an
application needs by observing <code>AccessControlException</code> occurrences in
the server log.</p>
</div>
<div class="paragraph">
<p>If this is not sufficient, you can add the
<code>-Djava.security.debug=failure</code> JVM option to the domain. Use the
following <code>asadmin create-jvm-options</code> command, then restart the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -Djava.security.debug=failure</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin create-jvm-options</code> command, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>You can use the J2SE standard <code>policytool</code> or any text editor to edit
the <code>server.policy</code> file. For more information, see
<code><a href="http://docs.oracle.com/javase/tutorial/security/tour2/index.html" class="bare">http://docs.oracle.com/javase/tutorial/security/tour2/index.html</a></code>.</p>
</div>
<div class="paragraph">
<p>For detailed information about policy file syntax, see
<code><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html" class="bare">http://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html</a></code>.</p>
</div>
<div class="paragraph">
<p>For information about using system properties in the <code>server.policy</code>
file, see
<code><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html" class="bare">http://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html</a></code>.</p>
</div>
<div class="paragraph">
<p>For detailed information about the permissions you can set in the
<code>server.policy</code> file, see
<code><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html" class="bare">http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html</a></code>.</p>
</div>
<div class="paragraph">
<p>The Javadoc for the <code>Permission</code> class is at
<code><a href="http://docs.oracle.com/javase/8/docs/api/java/security/Permission.html" class="bare">http://docs.oracle.com/javase/8/docs/api/java/security/Permission.html</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling-and-disabling-the-security-manager"><a class="anchor" href="#enabling-and-disabling-the-security-manager"></a>Enabling and Disabling the Security Manager</h4>
<div class="paragraph">
<p>The security manager is disabled by default.</p>
</div>
<div class="paragraph">
<p>In a production environment, you may be able to safely disable the
security manager if all of the following are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Performance is critical</p>
</li>
<li>
<p>Deployment to the production server is carefully controlled</p>
</li>
<li>
<p>Only trusted applications are deployed</p>
</li>
<li>
<p>Applications don&#8217;t need policy enforcement</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Disabling the security manager may improve performance significantly for
some types of applications.</p>
</div>
<div class="paragraph">
<p>To enable the security manager, do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To use the Administration Console, open the Security component under
the relevant configuration, and check the Security Manager Enabled box.
Then restart the server. For details, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>Use the following <code>asadmin create-jvm-options</code> command, then restart
the server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -Djava.security.manager</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To disable the security manager, uncheck the Security Manager Enabled
box or use the corresponding <code>asadmin delete-jvm-options</code> command. For
more information about <code>create-jvm-options</code> and <code>delete-jvm-options</code>,
see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference
Manual</a>.</p>
</div>
<div class="paragraph">
<p>If the security manager is enabled and you are using the Java
Persistence API by calling <code>Persistence.createEMF()</code>, the EclipseLink
persistence provider requires that you set the
<code>eclipselink.security.usedoprivileged</code> JVM option to <code>true</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -Declipselink.security.usedoprivileged=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the security manager is enabled and you are using the Java
Persistence API by injecting or looking up an entity manager or entity
manager factory, the EJB container sets this JVM option for you.</p>
</div>
<div class="paragraph">
<p>You must grant additional permissions to CDI-enabled Jakarta EE
applications that are deployed in a Eclipse GlassFish 7 domain or
cluster for which security manager is enabled. These additional
permissions are not required when security manager is disabled.</p>
</div>
<div class="paragraph">
<p>To deploy CDI-enabled Jakarta EE applications in a Eclipse GlassFish 7
domain or cluster for which security manager is enabled, add the
following permissions to the applications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>grant codeBase &quot;file:${com.sun.aas.instanceRoot}/applications/[ApplicationName]&quot; {
 permission java.lang.reflect.ReflectPermission &quot;suppressAccessChecks&quot;;
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, for a CDI application named <code>foo.war</code>, add the following
permissions to the <code>server.policy</code> file, restart the domain or cluster,
and then deploy and use the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>grant codeBase &quot;file:${com.sun.aas.instanceRoot}/applications/foo&quot; {
 permission java.lang.reflect.ReflectPermission &quot;suppressAccessChecks&quot;;
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about modifying application permissions, see
<a href="#changing-permissions-for-an-application">Changing Permissions for an Application</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-message-security-for-web-services"><a class="anchor" href="#configuring-message-security-for-web-services"></a>Configuring Message Security for Web Services</h3>
<div class="paragraph">
<p>In message security, security information is applied at the message
layer and travels along with the web services message. Web Services
Security (WSS) is the use of XML Encryption and XML Digital Signatures
to secure messages. WSS profiles the use of various security tokens
including X.509 certificates, Security Assertion Markup Language (SAML)
assertions, and username/password tokens to achieve this.</p>
</div>
<div class="paragraph">
<p>Message layer security differs from transport layer security in that it
can be used to decouple message protection from message transport so
that messages remain protected after transmission, regardless of how
many hops they travel.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Message security (JSR 196) is supported only in the full Eclipse GlassFish, not in the Web Profile.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this release of the Eclipse GlassFish, message layer annotations are
not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information about web services, see
<a href="#developing-web-services">Developing Web Services</a>.</p>
</div>
<div class="paragraph">
<p>For more information about message security, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#security-2">Introduction to
Security in the Jakarta EE Platform</a>" in The Jakarta EE Tutorial</p>
</li>
<li>
<p><a href="security-guide.html#GSSCG">Eclipse GlassFish Security Guide</a></p>
</li>
<li>
<p><a href="http://www.jcp.org/en/jsr/detail?id=196">JSR 196</a>
(<code><a href="http://www.jcp.org/en/jsr/detail?id=196" class="bare">http://www.jcp.org/en/jsr/detail?id=196</a></code>), Java Authentication Service
Provider Interface for Containers</p>
</li>
<li>
<p>The Liberty Alliance Project specifications at
<code><a href="http://www.projectliberty.org/resources/specifications.php/?f=resources/specifications.php" class="bare">http://www.projectliberty.org/resources/specifications.php/?f=resources/specifications.php</a></code></p>
</li>
<li>
<p>The Oasis Web Services Security (WSS) specification at
<code><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf" class="bare">http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf</a></code></p>
</li>
<li>
<p>The Web Services Interoperability Organization (WS-I) Basic Security
Profile (BSP) specification at
<code><a href="http://www.ws-i.org/Profiles/BasicSecurityProfile-1.0.html" class="bare">http://www.ws-i.org/Profiles/BasicSecurityProfile-1.0.html</a></code></p>
</li>
<li>
<p>The XML and Web Services Security page at <code><a href="http://xwss.java.net/" class="bare">http://xwss.java.net/</a></code></p>
</li>
<li>
<p>The WSIT page at <code><a href="http://wsit.java.net/" class="bare">http://wsit.java.net/</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#message-security-providers">Message Security Providers</a></p>
</li>
<li>
<p><a href="#message-security-responsibilities">Message Security Responsibilities</a></p>
</li>
<li>
<p><a href="#application-specific-message-protection">Application-Specific Message Protection</a></p>
</li>
<li>
<p><a href="#understanding-and-running-the-sample-application">Understanding and Running the Sample Application</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="message-security-providers"><a class="anchor" href="#message-security-providers"></a>Message Security Providers</h4>
<div class="paragraph">
<p>When you first install the Eclipse GlassFish, the providers
<code>XWS_ClientProvider</code> and <code>XWS_ServerProvider</code> are configured but
disabled. You can enable them in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To enable the message security providers using the Administration
Console, open the Security component under the relevant configuration,
select the Message Security component, and select SOAP. Then select
<code>XWS_ServerProvider</code> from the Default Provider list and
<code>XWS_ClientProvider</code> from the Default Client Provider list. For details,
click the Help button in the Administration Console.</p>
</li>
<li>
<p>You can enable the message security providers using the following
commands.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set
server-config.security-service.message-security-config.SOAP.default_provider=XWS_ServerProvider
asadmin set
server-config.security-service.message-security-config.SOAP.default_client_provider=XWS_ClientProvider</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin set</code> command, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example described in <a href="#understanding-and-running-the-sample-application">Understanding and Running the
Sample Application</a> uses the <code>ClientProvider</code> and <code>ServerProvider</code>
providers, which are enabled when the Ant targets are run. You don&#8217;t
need to enable these on the Eclipse GlassFish prior to running the
example.</p>
</div>
<div class="paragraph">
<p>If you install the OpenSSO, you have these additional provider choices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AMClientProvider</code> and <code>AMServerProvider</code> - These providers secure web
services and Simple Object Access Protocol (SOAP) messages using either
WS-I BSP or Liberty ID-WSF tokens. These providers are used
automatically if they are configured as the default providers. If you
wish to override any provider settings, you can configure these
providers in <code>message-security-binding</code> elements in the
<code>glassfish-web.xml</code>, <code>glassfish-ejb-jar.xml</code>, and
<code>glassfish-application-client.xml</code> deployment descriptor files.</p>
</li>
<li>
<p><code>AMHttpProvider</code> - This provider handles the initial end user
authentication for securing web services using Liberty ID-WSF tokens and
redirects requests to the OpenSSO for single sign-on. To use this
provider, specify it in the <code>httpservlet-security-provider</code> attribute of
the <code>glassfish-web-app</code> element in the <code>glassfish-web.xml</code> file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Liberty specifications can be viewed at
<code><a href="http://www.projectliberty.org/resources/specifications.php/?f=resources/specifications.php" class="bare">http://www.projectliberty.org/resources/specifications.php/?f=resources/specifications.php</a></code>.
The WS-I BSP specification can be viewed at
<code><a href="http://www.ws-i.org/Profiles/BasicSecurityProfile-1.0.html" class="bare">http://www.ws-i.org/Profiles/BasicSecurityProfile-1.0.html</a></code>.</p>
</div>
<div class="paragraph">
<p>For more information about the Eclipse GlassFish deployment descriptor
files, see the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish
Application Deployment Guide</a>.</p>
</div>
<div class="paragraph">
<p>For information about configuring these providers in the Eclipse GlassFish, see the <a href="security-guide.html#GSSCG">Eclipse GlassFish
Security Guide</a>. For additional information about overriding provider
settings, see <a href="#application-specific-message-protection">Application-Specific Message Protection</a>.</p>
</div>
<div class="paragraph">
<p>You can create new message security providers in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To create a message security provider using the Administration
Console, open the Security component under the relevant configuration,
and select the Message Security component. For details, click the Help
button in the Administration Console.</p>
</li>
<li>
<p>You can use the <code>asadmin create-message-security-provider</code> command to
create a message security provider. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, you can set a few optional provider properties using the
<code>asadmin set</code> command. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server-config.security-service.message-security-config.provider-config.property.debug=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table describes these message security provider properties.</p>
</div>
<div id="message-security-provider-props" class="paragraph">
<p>Table 4-2 Message Security Provider Properties</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 24%;">
<col style="width: 46%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>security.config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain-dir`/<code>config/</code>wss-server-<code>`config-1.0.xml</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the location of the message security configuration file. To
point to a configuration file in the domain-dir<code>/config</code> directory, use
the system property <code>${com.sun.aas.instanceRoot}/``config/</code>, for
example:</p>
</div>
<div class="paragraph">
<p><code>${com.sun.aas.instanceRoot}/config/``wss-server-config-1.0.xml</code></p>
</div>
<div class="paragraph">
<p>See <a href="#system-properties">System Properties</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, enables dumping of server provider debug messages to the server log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dynamic.username.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, signals the provider runtime to collect the user name and password from the <code>CallbackHandler</code>
for each request.
If <code>false</code>, the user name and password for <code>wsse:UsernameToken(s)</code> is collected once, during module initialization.
This property is only applicable for a <code>ClientAuthModule</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>encryption.key.alias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s1as</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the encryption key used by the provider. The key is identified by its <code>keystore</code> alias.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signature.key.alias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s1as</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the signature key used by the provider. The key is identified by its <code>keystore</code> alias.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="message-security-responsibilities"><a class="anchor" href="#message-security-responsibilities"></a>Message Security Responsibilities</h4>
<div class="paragraph">
<p>In the Eclipse GlassFish, the system administrator and application
deployer roles are expected to take primary responsibility for
configuring message security. In some situations, the application
developer may also contribute, although in the typical case either of
the other roles may secure an existing application without changing its
implementation and without involving the developer.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#application-developer-responsibilities">Application Developer Responsibilities</a></p>
</li>
<li>
<p><a href="#application-deployer-responsibilities">Application Deployer Responsibilities</a></p>
</li>
<li>
<p><a href="#system-administrator-responsibilities">System Administrator Responsibilities</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="application-developer-responsibilities"><a class="anchor" href="#application-developer-responsibilities"></a>Application Developer Responsibilities</h5>
<div class="paragraph">
<p>The application developer can turn on message security, but is not
responsible for doing so. Message security can be set up by the system
administrator so that all web services are secured, or set up by the
application deployer when the provider or protection policy bound to the
application must be different from that bound to the container.</p>
</div>
<div class="paragraph">
<p>The application developer is responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Determining if an application-specific message protection policy is
required by the application. If so, ensuring that the required policy is
specified at application assembly which may be accomplished by
communicating with the application deployer.</p>
</li>
<li>
<p>Determining if message security is necessary at the Eclipse GlassFish
level. If so, ensuring that this need is communicated to the system
administrator, or taking care of implementing message security at the
Eclipse GlassFish level.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="application-deployer-responsibilities"><a class="anchor" href="#application-deployer-responsibilities"></a>Application Deployer Responsibilities</h5>
<div class="paragraph">
<p>The application deployer is responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specifying (at application assembly) any required application-specific
message protection policies if such policies have not already been
specified by upstream roles (the developer or assembler)</p>
</li>
<li>
<p>Modifying Eclipse GlassFish deployment descriptors to specify
application-specific message protection policies information
(message-security-binding elements) to web service endpoint and service
references</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These security tasks are discussed in <a href="#application-specific-message-protection">Application-Specific
Message Protection</a>. A sample application using message security is
discussed in <a href="#understanding-and-running-the-sample-application">Understanding and Running the Sample
Application</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="system-administrator-responsibilities"><a class="anchor" href="#system-administrator-responsibilities"></a>System Administrator Responsibilities</h5>
<div class="paragraph">
<p>The system administrator is responsible for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuring message security providers on the Eclipse GlassFish.</p>
</li>
<li>
<p>Managing user databases.</p>
</li>
<li>
<p>Managing keystore and truststore files.</p>
</li>
<li>
<p>Installing the sample. This is only done if the <code>xms</code> sample
application is used to demonstrate the use of message layer web services
security.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A system administrator uses the Administration Console to manage server
security settings and uses a command line tool to manage certificate
databases. Certificates and private keys are stored in key stores and
are managed with <code>keytool</code>. If Network Security Services (NSS) is
installed, certificates and private keys are stored in an NSS database,
where they are managed using <code>certutil</code>. System administrator tasks are
discussed in the <a href="security-guide.html#GSSCG">Eclipse GlassFish
Security Guide</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="application-specific-message-protection"><a class="anchor" href="#application-specific-message-protection"></a>Application-Specific Message Protection</h4>
<div class="paragraph">
<p>When the Eclipse GlassFish provided configuration is insufficient for
your security needs, and you want to override the default protection,
you can apply application-specific message security to a web service.</p>
</div>
<div class="paragraph">
<p>Application-specific security is implemented by adding the message
security binding to the web service endpoint, whether it is an EJB or
servlet web service endpoint. Modify Eclipse GlassFish XML files to add
the message binding information.</p>
</div>
<div class="paragraph">
<p>Message security can also be specified using a WSIT security policy in
the WSDL file. For details, see the WSIT page at
<code><a href="http://wsit.java.net/" class="bare">http://wsit.java.net/</a></code>.</p>
</div>
<div class="paragraph">
<p>For more information about message security providers, see
<a href="#message-security-providers">Message Security Providers</a>.</p>
</div>
<div class="paragraph">
<p>For more details on message security binding for EJB web services,
servlet web services, and clients, see the XML file descriptions in
"<a href="application-deployment-guide.html#c-elements-of-the-glassfish-server-deployment-descriptors">Elements of the Eclipse GlassFish Deployment
Descriptors</a>" in Eclipse GlassFish Application
Deployment Guide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <code>glassfish-ejb-jar.xml</code>, see "<a href="application-deployment-guide.html#GSDPG00079">The
glassfish-ejb-jar.xml File</a>" in Eclipse GlassFish
Application Deployment Guide.</p>
</li>
<li>
<p>For <code>glassfish-web.xml</code>, see "<a href="application-deployment-guide.html#GSDPG00078">The glassfish-web.xml
File</a>" in Eclipse GlassFish Application Deployment
Guide.</p>
</li>
<li>
<p>For <code>glassfish-application-client.xml</code>, see "<a href="application-deployment-guide.html#GSDPG00081">The
glassfish-application-client.xml file</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-a-signature-to-enable-message-protection-for-all-methods">Using a Signature to Enable Message Protection for All
Methods</a></p>
</li>
<li>
<p><a href="#configuring-message-protection-for-a-specific-method-based-on-digital-signatures">Configuring Message Protection for a Specific Method Based
on Digital Signatures</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="using-a-signature-to-enable-message-protection-for-all-methods"><a class="anchor" href="#using-a-signature-to-enable-message-protection-for-all-methods"></a>Using a Signature to Enable Message Protection for All Methods</h5>
<div class="paragraph">
<p>To enable message protection for all methods using digital signature,
update the <code>message-security-binding</code> element for the EJB web service
endpoint in the application&#8217;s <code>glassfish-ejb-jar.xml</code> file. In this
file, add <code>request-protection</code> and <code>response-protection</code> elements, which
are analogous to the <code>request-policy</code> and <code>response-policy</code> elements
discussed in the <a href="security-guide.html#GSSCG">Eclipse GlassFish
Security Guide</a>. To apply the same protection mechanisms for all
methods, leave the method-name element blank. <a href="#configuring-message-protection-for-a-specific-method-based-on-digital-signatures">Configuring
Message Protection for a Specific Method Based on Digital Signatures</a>
discusses listing specific methods or using wildcard characters.</p>
</div>
<div class="paragraph">
<p>This section uses the sample application discussed in
<a href="#understanding-and-running-the-sample-application">Understanding and Running the Sample Application</a> to apply
application-level message security to show only the differences
necessary for protecting web services using various mechanisms.</p>
</div>
<div id="to-enable-message-protection-for-all-methods-using-digital-signature" class="paragraph">
<p>To Enable Message Protection for All Methods Using Digital Signature</p>
</div>
<div class="paragraph">
<p>Follow this procedure.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a text editor, open the application&#8217;s <code>glassfish-ejb-jar.xml</code>
file.</p>
<div class="paragraph">
<p>For the <code>xms</code> example, this file is located in the directory
app-dir`/xms-ejb/src/conf`, where app-dir is defined in <a href="#to-set-up-the-sample-application">To
Set Up the Sample Application</a>.</p>
</div>
</li>
<li>
<p>Modify the <code>glassfish-ejb-jar.xml</code> file by adding the
<code>message-security-binding</code> element as shown:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-ejb-jar&gt;</span>
  <span class="tag">&lt;enterprise-beans&gt;</span>
    <span class="tag">&lt;unique-id&gt;</span>1<span class="tag">&lt;/unique-id&gt;</span>
    <span class="tag">&lt;ejb&gt;</span>
      <span class="tag">&lt;ejb-name&gt;</span>HelloWorld<span class="tag">&lt;/ejb-name&gt;</span>
      <span class="tag">&lt;jndi-name&gt;</span>HelloWorld<span class="tag">&lt;/jndi-name&gt;</span>
      <span class="tag">&lt;webservice-endpoint&gt;</span>
        <span class="tag">&lt;port-component-name&gt;</span>HelloIF<span class="tag">&lt;/port-component-name&gt;</span>
        <span class="tag">&lt;endpoint-address-uri&gt;</span>service/HelloWorld<span class="tag">&lt;/endpoint-address-uri&gt;</span>
        <span class="tag">&lt;message-security-binding</span> <span class="attribute-name">auth-layer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SOAP</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;message-security&gt;</span>
            <span class="tag">&lt;request-protection</span> <span class="attribute-name">auth-source</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;response-protection</span> <span class="attribute-name">auth-source</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/message-security&gt;</span>
        <span class="tag">&lt;/message-security-binding&gt;</span>
      <span class="tag">&lt;/webservice-endpoint&gt;</span>
    <span class="tag">&lt;/ejb&gt;</span>
  <span class="tag">&lt;/enterprise-beans&gt;</span>
<span class="tag">&lt;/glassfish-ejb-jar&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Compile, deploy, and run the application as described in
<a href="#to-run-the-sample-application">To Run the Sample Application</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="configuring-message-protection-for-a-specific-method-based-on-digital-signatures"><a class="anchor" href="#configuring-message-protection-for-a-specific-method-based-on-digital-signatures"></a>Configuring Message Protection for a Specific Method Based on Digital Signatures</h5>
<div class="paragraph">
<p>To enable message protection for a specific method, or for a set of
methods that can be identified using a wildcard value, follow these
steps. As in the example discussed in <a href="#using-a-signature-to-enable-message-protection-for-all-methods">Using a Signature to
Enable Message Protection for All Methods</a>, to enable message protection
for a specific method, update the <code>message-security-binding</code> element for
the EJB web service endpoint in the application&#8217;s
<code>glassfish-ejb-jar.xml</code> file. To this file, add <code>request-protection</code> and
<code>response-protection</code> elements, which are analogous to the
<code>request-policy</code> and <code>response-policy</code> elements discussed in the
<a href="security-guide.html#GSSCG">Eclipse GlassFish Security Guide</a>. The
administration guide includes a table listing the set and order of
security operations for different request and response policy
configurations.</p>
</div>
<div class="paragraph">
<p>This section uses the sample application discussed in
<a href="#understanding-and-running-the-sample-application">Understanding and Running the Sample Application</a> to apply
application-level message security to show only the differences
necessary for protecting web services using various mechanisms.</p>
</div>
<div id="to-enable-message-protection-for-a-particular-method-or-set-of-methods-using-digital-signature" class="paragraph">
<p>To Enable Message Protection for a Particular Method or Set of Methods
Using Digital Signature</p>
</div>
<div class="paragraph">
<p>Follow this procedure.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a text editor, open the application&#8217;s <code>glassfish-ejb-jar.xml</code>
file.</p>
<div class="paragraph">
<p>For the <code>xms</code> example, this file is located in the directory
app-dir`/xms-ejb/src/conf`, where app-dir is defined in <a href="#to-set-up-the-sample-application">To
Set Up the Sample Application</a>.</p>
</div>
</li>
<li>
<p>Modify the <code>glassfish-ejb-jar.xml</code> file by adding the
<code>message-security-binding</code> element as shown:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-ejb-jar&gt;</span>
  <span class="tag">&lt;enterprise-beans&gt;</span>
  <span class="tag">&lt;unique-id&gt;</span>1<span class="tag">&lt;/unique-id&gt;</span>
    <span class="tag">&lt;ejb&gt;</span>
      <span class="tag">&lt;ejb-name&gt;</span>HelloWorld<span class="tag">&lt;/ejb-name&gt;</span>
      <span class="tag">&lt;jndi-name&gt;</span>HelloWorld<span class="tag">&lt;/jndi-name&gt;</span>
      <span class="tag">&lt;webservice-endpoint&gt;</span>
        <span class="tag">&lt;port-component-name&gt;</span>HelloIF<span class="tag">&lt;/port-component-name&gt;</span>
        <span class="tag">&lt;endpoint-address-uri&gt;</span>service/HelloWorld<span class="tag">&lt;/endpoint-address-uri&gt;</span>
        <span class="tag">&lt;message-security-binding</span> <span class="attribute-name">auth-layer</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SOAP</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;message-security&gt;</span>
            <span class="tag">&lt;message&gt;</span>
              <span class="tag">&lt;java-method&gt;</span>
                <span class="tag">&lt;method-name&gt;</span>ejbCreate<span class="tag">&lt;/method-name&gt;</span>
              <span class="tag">&lt;/java-method&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;message&gt;</span>
              <span class="tag">&lt;java-method&gt;</span>
                <span class="tag">&lt;method-name&gt;</span>sayHello<span class="tag">&lt;/method-name&gt;</span>
              <span class="tag">&lt;/java-method&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;request-protection</span> <span class="attribute-name">auth-source</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;response-protection</span> <span class="attribute-name">auth-source</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/message-security&gt;</span>
        <span class="tag">&lt;/message-security-binding&gt;</span>
      <span class="tag">&lt;/webservice-endpoint&gt;</span>
    <span class="tag">&lt;/ejb&gt;</span>
  <span class="tag">&lt;/enterprise-beans&gt;</span>
<span class="tag">&lt;/glassfish-ejb-jar&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Compile, deploy, and run the application as described in
<a href="#to-run-the-sample-application">To Run the Sample Application</a>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="understanding-and-running-the-sample-application"><a class="anchor" href="#understanding-and-running-the-sample-application"></a>Understanding and Running the Sample Application</h4>
<div class="paragraph">
<p>This section discusses the WSS sample application. This sample
application is installed on your system only if you installed the J2EE
1.4 samples. If you have not installed these samples, see <a href="#to-set-up-the-sample-application">To
Set Up the Sample Application</a>.</p>
</div>
<div class="paragraph">
<p>The objective of this sample application is to demonstrate how a web
service can be secured with WSS. The web service in the <code>xms</code> example is
a simple web service implemented using a Jakarta EE EJB endpoint and a web
service endpoint implemented using a servlet. In this example, a service
endpoint interface is defined with one operation, <code>sayHello</code>, which
takes a string then sends a response with <code>Hello</code> prefixed to the given
string. You can view the WSDL file for the service endpoint interface at
app-dir`/xms-ejb/src/<code>`conf/HelloWorld.wsdl</code>, where app-dir is defined
in <a href="#to-set-up-the-sample-application">To Set Up the Sample Application</a>.</p>
</div>
<div class="paragraph">
<p>In this application, the client looks up the service using the JNDI name
<code>java:comp/env/service/HelloWorld</code> and gets the port information using a
static stub to invoke the operation using a given name. For the name
Duke, the client gets the response <code>Hello Duke!</code></p>
</div>
<div class="paragraph">
<p>This example shows how to use message security for web services at the
Eclipse GlassFish level. For information about using message security at
the application level, see <a href="#application-specific-message-protection">Application-Specific Message
Protection</a>. The WSS message security mechanisms implement message-level
authentication (for example, XML digital signature and encryption) of
SOAP web services invocations using the X.509 and username/password
profiles of the OASIS WS-Security standard, which can be viewed from the
following URL:
<code><a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf" class="bare">http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf</a></code>.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#to-set-up-the-sample-application">To Set Up the Sample Application</a></p>
</li>
<li>
<p><a href="#to-run-the-sample-application">To Run the Sample Application</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="to-set-up-the-sample-application"><a class="anchor" href="#to-set-up-the-sample-application"></a>To Set Up the Sample Application</h5>
<div class="paragraph">
<p>Before You Begin</p>
</div>
<div class="paragraph">
<p>To have access to this sample application, you must have previously
installed the J2EE 1.4 samples. If the samples are not installed, follow
the steps in the following section.</p>
</div>
<div class="paragraph">
<p>After you follow these steps, the sample application is located in the
directory
as-install<code>/j2ee14-samples/samples/webservices/security/ejb/apps/xms/</code>
or in a directory of your choice. For easy reference throughout the rest
of this section, this directory is referred to as simply app-dir.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the
<a href="https://www.oracle.com/java/technologies/java-archive-eesdk-downloads.html">J2EE
1.4 download URL</a>
(<code><a href="https://www.oracle.com/java/technologies/java-archive-eesdk-downloads.html" class="bare">https://www.oracle.com/java/technologies/java-archive-eesdk-downloads.html</a></code>)
in your browser.</p>
</li>
<li>
<p>Click on the Download button for the Samples Bundle.</p>
</li>
<li>
<p>Click on Accept License Agreement.</p>
</li>
<li>
<p>Click on the J2EE SDK Samples link.</p>
</li>
<li>
<p>Choose a location for the <code>j2eesdk-1_4_03-samples.zip</code> file.</p>
<div class="paragraph">
<p>Saving the file to as-install is recommended.</p>
</div>
</li>
<li>
<p>Unzip the file.</p>
<div class="paragraph">
<p>Unzipping to the as-install<code>/j2ee14-samples</code> directory is recommended.
For example, you can use the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>unzip j2eesdk-1_4_03-samples.zip -d j2ee14-samples</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-sample-application"><a class="anchor" href="#to-run-the-sample-application"></a>To Run the Sample Application</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that the Eclipse GlassFish is running.<br>
Message security providers are set up when the Ant targets are run, so
you do not need to configure these on the Eclipse GlassFish prior to
running this example.</p>
</li>
<li>
<p>If you are not running HTTP on the default port of 8080, change the
WSDL file for the example to reflect the change, and change the
<code>common.properties</code> file to reflect the change as well.<br>
The WSDL file for this example is located at
app-dir`/xms-ejb/<code>`src/conf/HelloWorld.wsdl</code>. The port number is in the
following section:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloWorld</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;port</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloIFPort</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tns:HelloIFBinding</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;soap:address</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/service/HelloWorld</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/port&gt;</span>
<span class="tag">&lt;/service&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify that the properties in the as-install<code>/samples/common.properties`
file are set properly for your installation and environment. If you need
a more detailed description of this file, refer to the "Configuration"
section for the web services security applications at
as-install</code>/j2ee14-samples/samples/webservices/security/docs/common.html#Logging`.</p>
</div>
</li>
<li>
<p>Change to the app-dir directory.</p>
</li>
<li>
<p>Run the following Ant targets to compile, deploy, and run the
example application:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To compile samples: <code>ant</code></p>
</li>
<li>
<p>To deploy samples: <code>ant deploy</code></p>
</li>
<li>
<p>To run samples: <code>ant run</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the sample has compiled and deployed properly, you see the following
response on your screen after the application has run:<br>
<code>run:[echo] Running the xms program:[exec] Established message level security : Hello Duke!</code></p>
</div>
</li>
<li>
<p>To undeploy the sample, run the following Ant target:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ant undeploy</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>All of the web services security examples use the same web service name
(<code>HelloWorld</code>) and web service ports. These examples show only the
differences necessary for protecting web services using various
mechanisms. Make sure to undeploy an application when you have completed
running it. If you do not, you receive an <code>Already in Use</code> error and
deployment failures when you try to deploy another web services example
application.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="programmatic-login-using-the-programmaticlogin-class"><a class="anchor" href="#programmatic-login-using-the-programmaticlogin-class"></a>Programmatic Login Using the ProgrammaticLogin Class</h3>
<div class="paragraph">
<p>Programmatic login allows a deployed Jakarta EE application or module to
invoke a login method. If the login is successful, a <code>SecurityContext</code>
is established as if the client had authenticated using any of the
conventional Jakarta EE mechanisms. Programmatic login is supported for
servlet and EJB components on the server side, and for stand-alone or
application clients on the client side. Programmatic login is useful for
an application having special needs that cannot be accommodated by any
of the Jakarta EE standard authentication mechanisms.</p>
</div>
<div class="paragraph">
<p>This section describes a proprietary GlassFish mechanism, but see also
the standard security APIs in the Jakarta EE tutorial.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>com.sun.appserv.security.ProgrammaticLogin</code> class in Eclipse GlassFish is not a Jakarta EE API; therefore, it is not portable to other
application servers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#programmatic-login-precautions">Programmatic Login Precautions</a></p>
</li>
<li>
<p><a href="#granting-programmatic-login-permission">Granting Programmatic Login Permission</a></p>
</li>
<li>
<p><a href="#the-programmaticlogin-class">The <code>ProgrammaticLogin</code> Class</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="programmatic-login-precautions"><a class="anchor" href="#programmatic-login-precautions"></a>Programmatic Login Precautions</h4>
<div class="paragraph">
<p>The Eclipse GlassFish is not involved in how the login information
(<code>user</code>, <code>password</code>) is obtained by the deployed application.
Programmatic login places the burden on the application developer with
respect to assuring that the resulting system meets security
requirements. If the application code reads the authentication
information across the network, the application determines whether to
trust the user.</p>
</div>
<div class="paragraph">
<p>Programmatic login allows the application developer to bypass the
Eclipse GlassFish-supported authentication mechanisms and feed
authentication data directly to the security service. While flexible,
this capability should not be used without some understanding of
security issues.</p>
</div>
<div class="paragraph">
<p>Since this mechanism bypasses the container-managed authentication
process and sequence, the application developer must be very careful in
making sure that authentication is established before accessing any
restricted resources or methods. It is also the application developer&#8217;s
responsibility to verify the status of the login attempt and to alter
the behavior of the application accordingly.</p>
</div>
<div class="paragraph">
<p>The programmatic login state does not necessarily persist in sessions or
participate in single sign-on.</p>
</div>
<div class="paragraph">
<p>Lazy authentication is not supported for programmatic login. If an
access check is reached and the deployed application has not properly
authenticated using the programmatic login method, access is denied
immediately and the application might fail if not coded to account for
this occurrence. One way to account for this occurrence is to catch the
access control or security exception, perform a programmatic login, and
repeat the request.</p>
</div>
</div>
<div class="sect3">
<h4 id="granting-programmatic-login-permission"><a class="anchor" href="#granting-programmatic-login-permission"></a>Granting Programmatic Login Permission</h4>
<div class="paragraph">
<p>The <code>ProgrammaticLoginPermission</code> permission is required to invoke the
programmatic login mechanism for an application if the security manager
is enabled. For information about the security manager, see
<a href="#GSDVG00121">The <code>server.policy</code> File</a>. This permission is not granted by
default to deployed applications because this is not a standard Jakarta EE
mechanism.</p>
</div>
<div class="paragraph">
<p>To grant the required permission to the application, add the following
to the domain-dir`/config/server.policy` file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>grant codeBase &quot;file:jar-file-path&quot; {
     permission com.sun.appserv.security.ProgrammaticLoginPermission
     &quot;login&quot;;
 };</code></pre>
</div>
</div>
<div class="paragraph">
<p>The jar-file-path is the path to the application&#8217;s JAR file.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-programmaticlogin-class"><a class="anchor" href="#the-programmaticlogin-class"></a>The <code>ProgrammaticLogin</code> Class</h4>
<div class="paragraph">
<p>The <code>com.sun.appserv.security.ProgrammaticLogin</code> class enables a user to
perform login programmatically.</p>
</div>
<div class="paragraph">
<p>For Javadoc tool pages relevant to programmatic login, see the
<code>com.sun.appserv.security</code> package.</p>
</div>
<div class="paragraph">
<p>The <code>ProgrammaticLogin</code> class has four <code>login</code> methods, two for servlets
or JSP files and two for EJB components.</p>
</div>
<div class="paragraph">
<p>The login methods for servlets or JSP files have the following
signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> java.lang.Boolean login(<span class="predefined-type">String</span> user, <span class="predefined-type">String</span> password,
    javax.servlet.http.HttpServletRequest request,
    javax.servlet.http.HttpServletResponse response)

<span class="directive">public</span> java.lang.Boolean login(<span class="predefined-type">String</span> user, <span class="predefined-type">String</span> password,
    <span class="predefined-type">String</span> realm, javax.servlet.http.HttpServletRequest request,
    javax.servlet.http.HttpServletResponse response, <span class="type">boolean</span> errors)
    <span class="directive">throws</span> java.lang.Exception</code></pre>
</div>
</div>
<div class="paragraph">
<p>The login methods for EJB components have the following signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> java.lang.Boolean login(<span class="predefined-type">String</span> user, <span class="predefined-type">String</span> password)

<span class="directive">public</span> java.lang.Boolean login(<span class="predefined-type">String</span> user, <span class="predefined-type">String</span> password,
    <span class="predefined-type">String</span> realm, <span class="type">boolean</span> errors) <span class="directive">throws</span> java.lang.Exception</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of these <code>login</code> methods accomplish the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Perform the authentication</p>
</li>
<li>
<p>Return <code>true</code> if login succeeded, <code>false</code> if login failed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The login occurs on the realm specified unless it is null, in which case
the domain&#8217;s default realm is used. The methods with no realm parameter
use the domain&#8217;s default realm.</p>
</div>
<div class="paragraph">
<p>If the errors flag is set to <code>true</code>, any exceptions encountered during
the login are propagated to the caller. If set to <code>false</code>, exceptions
are thrown.</p>
</div>
<div class="paragraph">
<p>On the client side, realm and errors parameters are ignored and the
actual login does not occur until a resource requiring a login is
accessed. A <code>java.rmi.AccessException</code> with <code>COBRA NO_PERMISSION</code> occurs
if the actual login fails.</p>
</div>
<div class="paragraph">
<p>The logout methods for servlets or JSP files have the following
signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> java.lang.Boolean logout(HttpServletRequest request,
    HttpServletResponse response)

<span class="directive">public</span> java.lang.Boolean logout(HttpServletRequest request,
    HttpServletResponse response, <span class="type">boolean</span> errors)
    <span class="directive">throws</span> java.lang.Exception</code></pre>
</div>
</div>
<div class="paragraph">
<p>The logout methods for EJB components have the following signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> java.lang.Boolean logout()

<span class="directive">public</span> java.lang.Boolean logout(<span class="type">boolean</span> errors)
    <span class="directive">throws</span> java.lang.Exception</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of these <code>logout</code> methods return <code>true</code> if logout succeeded, <code>false</code>
if logout failed.</p>
</div>
<div class="paragraph">
<p>If the errors flag is set to <code>true</code>, any exceptions encountered during
the logout are propagated to the caller. If set to <code>false</code>, exceptions
are thrown.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-authentication-for-single-sign-on"><a class="anchor" href="#user-authentication-for-single-sign-on"></a>User Authentication for Single Sign-on</h3>
<div class="paragraph">
<p>The single sign-on feature of the Eclipse GlassFish allows multiple web
applications deployed to the same virtual server to share the user
authentication state. With single sign-on enabled, users who log in to
one web application become implicitly logged into other web applications
on the same virtual server that require the same authentication
information. Otherwise, users would have to log in separately to each
web application whose protected resources they tried to access.</p>
</div>
<div class="paragraph">
<p>A sample application using the single sign-on scenario could be a
consolidated airline booking service that searches all airlines and
provides links to different airline web sites. After the user signs on
to the consolidated booking service, the user information can be used by
each individual airline site without requiring another sign-on.</p>
</div>
<div class="paragraph">
<p>Single sign-on operates according to the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Single sign-on applies to web applications configured for the same
realm and virtual server. The realm is defined by the <code>realm-name</code>
element in the <code>web.xml</code> file. For information about virtual servers,
see "<a href="administration-guide.html#administering-internet-connectivity">Administering Internet Connectivity</a>" in Eclipse GlassFish Administration Guide.</p>
</li>
<li>
<p>As long as users access only unprotected resources in any of the web
applications on a virtual server, they are not challenged to
authenticate themselves.</p>
</li>
<li>
<p>As soon as a user accesses a protected resource in any web application
associated with a virtual server, the user is challenged to authenticate
himself or herself, using the login method defined for the web
application currently being accessed.</p>
</li>
<li>
<p>After authentication, the roles associated with this user are used for
access control decisions across all associated web applications, without
challenging the user to authenticate to each application individually.</p>
</li>
<li>
<p>When the user logs out of one web application (for example, by
invalidating the corresponding session), the user&#8217;s sessions in all web
applications are invalidated. Any subsequent attempt to access a
protected resource in any application requires the user to authenticate
again.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The single sign-on feature utilizes HTTP cookies to transmit a token
that associates each request with the saved user identity, so it can
only be used in client environments that support cookies.</p>
</div>
<div class="paragraph">
<p>To configure single sign-on, set the following virtual server
properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sso-enabled</code> - If <code>false</code>, single sign-on is disabled for this
virtual server, and users must authenticate separately to every
application on the virtual server. The default is <code>false</code>.</p>
</li>
<li>
<p><code>sso-max-inactive-seconds</code> - Specifies the time after which a user&#8217;s
single sign-on record becomes eligible for purging if no client activity
is received. Since single sign-on applies across several applications on
the same virtual server, access to any of the applications keeps the
single sign-on record active. The default value is 5 minutes (<code>300</code>
seconds). Higher values provide longer single sign-on persistence for
the users at the expense of more memory use on the server.</p>
</li>
<li>
<p><code>sso-reap-interval-seconds</code> - Specifies the interval between purges of
expired single sign-on records. The default value is <code>60</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here are example <code>asadmin set</code> commands with default values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server-config.http-service.virtual-server.vsrv1.property.sso-enabled=&quot;true&quot;
asadmin set server-config.http-service.virtual-server.vsrv1.property.sso-max-inactive-seconds=&quot;300&quot;
asadmin set server-config.http-service.virtual-server.vsrv1.property.sso-reap-interval-seconds=&quot;60&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin set</code> command, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-authentication-mechanisms-to-the-servlet-container"><a class="anchor" href="#adding-authentication-mechanisms-to-the-servlet-container"></a>Adding Authentication Mechanisms to the Servlet Container</h3>
<div class="paragraph">
<p>You can use JSR 196 in the web tier to facilitate the injection of
pluggable authentication modules within the servlet constraint
processing engine. The Eclipse GlassFish includes implementations of a
number of HTTP layer authentication mechanisms such as basic, form, and
digest authentication. You can add alternative implementations of the
included mechanisms or implementations of new mechanisms such as HTTP
Negotiate/SPNEGO, OpenID, or CAS.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-glassfish-server-and-jsr-375">The Eclipse GlassFish and JSR-375</a></p>
</li>
<li>
<p><a href="#the-glassfish-server-and-jsr-196">The Eclipse GlassFish and JSR 196</a></p>
</li>
<li>
<p><a href="#writing-a-server-authentication-module">Writing a Server Authentication Module</a></p>
</li>
<li>
<p><a href="#sample-server-authentication-module">Sample Server Authentication Module</a></p>
</li>
<li>
<p><a href="#compiling-and-installing-a-server-authentication-module">Compiling and Installing a Server Authentication Module</a></p>
</li>
<li>
<p><a href="#configuring-a-server-authentication-module">Configuring a Server Authentication Module</a></p>
</li>
<li>
<p><a href="#binding-a-server-authentication-module-to-your-application">Binding a Server Authentication Module to Your
Application</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="the-glassfish-server-and-jsr-375"><a class="anchor" href="#the-glassfish-server-and-jsr-375"></a>The Eclipse GlassFish and JSR-375</h4>
<div class="paragraph">
<p>The Eclipse GlassFish implements JSR-375 to provide built-in support for
BASIC, FORM and Custom FORM authentication mechanisms. JSR-375 also
defines plug-in interfaces for authentication and identity stores, that
is, the <code>HttpAuthenticationMechanism</code> interface and the <code>IdentityStore</code>
interface, respectively. Though <code>HttpAuthenticationMechanism</code>
implementations can authenticate users in any manner they choose, the
<code>IdentityStore</code> interface provides a convenient mechanism. A significant
advantage of using <code>HttpAuthenticationMechanism</code> and <code>IdentityStore</code>
over the declarative mechanisms defined by the Servlet specification is
that it allows an application to control the identity stores that it
authenticates against, in a standard, portable way. You can use the
built-in implementations of these APIs, or define custom
implementations.</p>
</div>
<div class="paragraph">
<p>Jakarta EE Security API defines several annotations, with names that end
with Definition, which when used makes the corresponding built-in
mechanism available as a CDI bean. Jakarta EE Security API also supports
the use of Expression Language 3.0 in these annotations to allow dynamic
configuration.</p>
</div>
<div class="sect4">
<h5 id="built-in-authentication-mechanisms"><a class="anchor" href="#built-in-authentication-mechanisms"></a>Built-in Authentication Mechanisms</h5>
<div class="paragraph">
<p>An application packages its own <code>HttpAuthenticationMechanism</code> by
including in a bean archive that is a part of the application.
Alternatively, it may select and configure one of the container&#8217;s
built-in mechanisms using the corresponding annotation, as listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BasicAuthenticationMechanismDefintion</code>—implements BASIC
authentication that conforms to the behavior of the servlet container
when BASIC &lt;auth-method&gt; is declared in web.xml.</p>
</li>
<li>
<p><code>CustomFormAuthenticationMechanismDefinition</code>—implements FORM
authentication that conforms to the behavior of the servlet container
when the FORM &lt;auth-method&gt; is declared in web.xml.</p>
</li>
<li>
<p><code>FormAuthenticationMechanismDefinition</code>—implements a modified version
of FORM authentication in which custom handling replaces the POST to
j_security_check.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Eclipse GlassFish, all built-in authentication mechanisms need to be
authenticated using an identity store. The <code>IdentityStore</code> interface,
included in the Jakarta EE Security API, defines an SPI for interacting
with identity stores, which are directories or databases containing user
account information. The <code>IdentityStore</code> interface has four methods:
<code>validate(Credential)</code>, <code>getCallerGroups(CredentialValidationResult)</code>,
<code>validationTypes()</code> and <code>priority()</code>.Developers can provide their own
implementation of this interface, or use one of the built-in Identity
Stores. The <code>RememberMeIdentityStore</code> interface, which is a variation on
the IdentityStore interface, can be used when an application wants to
"remember" a user&#8217;s authenticated session for an extended period, so
that the caller can return to the application periodically without
needing to present primary authentication credentials each time.</p>
</div>
<div class="paragraph">
<p>There are two built-in implementations of <code>IdentityStore</code>: an LDAP
identity store, and a Database identity store. The following snippet
shows the usage of <code>DatabaseIdentityStoreDefinition</code>, which makes
<code>DatabaseIdentityStore</code> available as CDI bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DatabaseIdentityStoreDefinition</span>(
    callerQuery = <span class="string"><span class="delimiter">&quot;</span><span class="content">#{'select password from caller where name = ?'}</span><span class="delimiter">&quot;</span></span>,
    groupsQuery = <span class="string"><span class="delimiter">&quot;</span><span class="content">select group_name from caller_groups where caller_name = ?</span><span class="delimiter">&quot;</span></span>,
    hashAlgorithm = Pbkdf2PasswordHash.class,
    priorityExpression = <span class="string"><span class="delimiter">&quot;</span><span class="content">#{100}</span><span class="delimiter">&quot;</span></span>,
    hashAlgorithmParameters = {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Pbkdf2PasswordHash.Iterations=3072</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">${applicationConfig.dyna}</span><span class="delimiter">&quot;</span></span>
    }
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since Jakarta EE Security API provides support for Expression Langauge 3.0,
regular expressions can be used to set value of annotation attributes.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish provides out of the box implementation of
<code>Pbkdf2PasswordHash</code> that supports PBKDF2 password hashing. It is
suggested that you use <code>Pbkdf2PasswordHash</code> for generating and
validating passwords, unless there are specific requirements which
cannot be met any other way.</p>
</div>
</div>
<div class="sect4">
<h5 id="custom-authentication-mechanism"><a class="anchor" href="#custom-authentication-mechanism"></a>Custom Authentication Mechanism</h5>
<div class="paragraph">
<p>An application provider can choose to provide its own custom
authentication mechanism, apart from built-in authentication mechanism.</p>
</div>
<div class="paragraph">
<p>A custom authentication mechanism implements the
<code>HttpAuthenticationMechanism</code> interface, introduced in Jakarta EE Security
API. This interface defines the following three methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AuthenticationStatus validateRequest(HttpServletRequest request,
                                     HttpServletResponse response,
                                     HttpMessageContext httpMessageContext
                                    ) <span class="directive">throws</span> <span class="exception">AuthenticationException</span>;

AuthenticationStatus secureResponse(HttpServletRequest request,
                                    HttpServletResponse response,
                                    HttpMessageContext httpMessageContext
                                    ) <span class="directive">throws</span> <span class="exception">AuthenticationException</span>;

<span class="type">void</span> cleanSubject(HttpServletRequest request,
                  HttpServletResponse response,
                  HttpMessageContext   httpMessageContext);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>HttpAuthenticationMechanism</code> returns <code>AuthenticationStatus</code> to indicate
the status of authentication request. Internally, it gets translated to
corresponding JASPIC <code>AuthStatus</code> as shown below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AuthenticationStatus.NOT_DONE</code> to <code>AuthStatus.SUCCESS</code></p>
</li>
<li>
<p><code>AuthenticationStatus.SEND_CONTINUE</code> to <code>AuthStatus.SEND_CONTINUE</code></p>
</li>
<li>
<p><code>AuthenticationStatus.SUCCESS</code> to <code>AuthStatus.SUCCESS</code></p>
</li>
<li>
<p><code>AuthenticationStatus.SEND_FAILURE</code> to <code>AuthStatus.SEND_FAILURE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each method of the <code>HttpAuthenticationMechanism</code> interface performs the
same function as the corresponding <code>ServerAuth</code> methods. Unlike JASPIC,
<code>HttpAuthenticationMechanism</code> is specified for the servlet container
only. Only the <code>validateRequest()</code> must be implemented, for other two
methods, default behaviors are specified.</p>
</div>
<div class="paragraph">
<p><code>validateRequest</code> allows a caller to authenticate. The request gets
inspected inside <code>validateRequest</code> to read credential or any other
information, or it can write to standard response with status of the
authentication request or redirect the caller to an OAuth provider. Once
the credential is validated, the result of the validation is
communicated to the container using the <code>HttpMessageContext</code> parameter.</p>
</div>
<div id="GSDVG567" class="paragraph">
<p>Sample Http Authentication Mechanism</p>
</div>
<div class="paragraph">
<p>The class <code>MyAuthenticationMechanism.java</code> is a sample
<code>HttpAuthenticationMechanism</code> implementation. Note that only
<code>validateRequest</code> method has been implemented, since Jakarta EE Security
API provides default implementation of other two methods. An application
provider may choose to override the default implementation depending on
the requirement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.enterprise.context.RequestScoped</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">javax.security.enterprise.AuthenticationException</span>;
<span class="keyword">import</span> <span class="include">javax.security.enterprise.AuthenticationStatus</span>;
<span class="keyword">import</span> <span class="include">javax.security.enterprise.authentication.mechanism.http.HttpAuthenticationMechanism</span>;
<span class="keyword">import</span> <span class="include">javax.security.enterprise.authentication.mechanism.http.HttpMessageContext</span>;
<span class="keyword">import</span> <span class="include">javax.security.enterprise.credential.UsernamePasswordCredential</span>;
<span class="keyword">import</span> <span class="include">javax.security.enterprise.identitystore.CredentialValidationResult</span>;
<span class="keyword">import</span> <span class="include">javax.security.enterprise.identitystore.IdentityStoreHandler</span>;
<span class="keyword">import</span> <span class="include">javax.servlet.http.HttpServletRequest</span>;
<span class="keyword">import</span> <span class="include">javax.servlet.http.HttpServletResponse</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">javax.security.enterprise.identitystore.CredentialValidationResult.Status.VALID</span>;

<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyAuthenticationMechanism</span> <span class="directive">implements</span> HttpAuthenticationMechanism {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> IdentityStoreHandler identityStoreHandler;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> AuthenticationStatus validateRequest(HttpServletRequest request, HttpServletResponse response, HttpMessageContext httpMessageContext) <span class="directive">throws</span> <span class="exception">AuthenticationException</span> {

          <span class="comment">// Get the (caller) name and password from the request</span>
        <span class="comment">// NOTE: This is for the smallest possible example only. In practice</span>
        <span class="comment">// putting the password in a request query parameter is highly</span>
        <span class="comment">// insecure and is discouraged.</span>
        <span class="predefined-type">String</span> name = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">String</span> password = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">if</span> (name != <span class="predefined-constant">null</span> &amp;&amp; password != <span class="predefined-constant">null</span>) {

            <span class="comment">// Delegate the {credentials in -&gt; identity data out} function to</span>
            <span class="comment">// the Identity Store</span>
            CredentialValidationResult result = identityStoreHandler.validate(
                <span class="keyword">new</span> UsernamePasswordCredential(name, password));

            <span class="keyword">if</span> (result.getStatus() == VALID) {
                <span class="comment">// Communicate the details of the authenticated user to the</span>
                <span class="comment">// container.</span>
                response.addHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Authentication Mechanism</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyAuthenticationMechanism</span><span class="delimiter">&quot;</span></span>);
                <span class="keyword">return</span> httpMessageContext.notifyContainerAboutLogin(
                    result.getCallerPrincipal(), result.getCallerGroups());
            } <span class="keyword">else</span> {
                <span class="keyword">return</span> httpMessageContext.responseUnauthorized();
            }
        }

        <span class="keyword">return</span> httpMessageContext.doNothing();
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-glassfish-server-and-jsr-196"><a class="anchor" href="#the-glassfish-server-and-jsr-196"></a>The Eclipse GlassFish and JSR 196</h4>
<div class="paragraph">
<p>The Eclipse GlassFish implements the Servlet Container Profile of JSR
196, Java Authentication Service Provider Interface for Containers. JSR
196 defines a standard service provider interface (SPI) that extends the
concepts of the Java Authentication and Authorization Service (JAAS) to
enable pluggability of message authentication modules in message
processing runtimes. The JSR 196 standard defines profiles that
establish contracts for the use of the SPI in specific contexts. The
Servlet Container Profile of JSR 196 defines the use of the SPI by a
Servlet container such that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The resulting container can be configured with new authentication
mechanisms.</p>
</li>
<li>
<p>The container employs the configured mechanisms in its enforcement of
the declarative servlet security model (declared in a <code>web.xml</code> file
using <code>security-constraint</code> elements).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The JSR 196 specification defines a simple message processing model
composed of four interaction points:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>secureRequest</code> on the client</p>
</li>
<li>
<p><code>validateRequest</code> on the server</p>
</li>
<li>
<p><code>secureResponse</code> on the server</p>
</li>
<li>
<p><code>validateResponse</code> on the client</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A message processing runtime uses the SPI at these interaction points to
delegate the corresponding message security processing to authentication
providers, also called authentication modules, integrated into the
runtime by way of the SPI.</p>
</div>
<div class="paragraph">
<p>A compatible server-side message processing runtime, such as the
Eclipse GlassFish servlet container, supports the <code>validateRequest</code> and
<code>secureResponse</code> interaction points of the message processing model. The
servlet container uses the SPI at these interaction points to delegate
the corresponding message security processing to a server authentication
module (SAM), integrated by the SPI into the container.</p>
</div>
</div>
<div class="sect3">
<h4 id="writing-a-server-authentication-module"><a class="anchor" href="#writing-a-server-authentication-module"></a>Writing a Server Authentication Module</h4>
<div class="paragraph">
<p>A key step in adding an authentication mechanism to a compatible
server-side message processing runtime such as the Eclipse GlassFish
servlet container is acquiring a SAM that implements the desired
authentication mechanism. One way to do that is to write the SAM
yourself.</p>
</div>
<div class="paragraph">
<p>A SAM implements the javax.security.auth.message.module.ServerAuthModule
interface as defined by JSR 196. A SAM is invoked indirectly by the
message processing runtime at the <code>validateRequest</code> and <code>secureResponse</code>
interaction points. A SAM must implement the five methods of the
ServerAuthModule interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getSupportedMessageTypes</code> — An array of <code>Class</code> objects where each
element defines a message type supported by the SAM. For a SAM to be
compatible with the Servlet Container Profile, the returned array must
include the <code>HttpServletRequest.class</code> and <code>HttpServletResponse.class</code>
objects.</p>
</li>
<li>
<p><code>initialize(MessagePolicy requestPolicy, MessagePolicy responsePolicy, CallbackHandler Map options)</code>
— The container calls this method to provide the SAM with configuration
values and with a <code>CallbackHandler</code>. The configuration values are
returned in the policy arguments and in the options <code>Map</code>. The SAM uses
<code>CallbackHandler</code> to access services, such as password validation,
provided by the container.</p>
</li>
<li>
<p><code>AuthStatus validateRequest(MessageInfo messageInfo, Subject clientSubject, Subject serviceSubject)</code>
— The container calls this method to process each received
<code>HttpServletRequest</code>. The request and its associated
<code>HttpServletResponse</code> are passed by the container to the SAM in the
<code>messageInfo</code> argument. The SAM processes the request and may establish
the response to be returned by the container. The SAM uses the provided
<code>Subject</code> arguments to convey its authentication results. The SAM
returns different status values to control the container&#8217;s invocation
processing. The status values and the circumstances under which they are
returned are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>AuthStatus.SUCCESS</code> is returned when the application request message
is successfully validated. The container responds to this status value
by using the returned client <code>Subject</code> to invoke the target of the
request. When this value is returned, the SAM (provided a custom
<code>AuthConfigProvider</code> is not being used) must use its <code>CallbackHandler</code>
to handle a <code>CallerPrincipalCallback</code> using the <code>clientSubject</code> as an
argument to the callback.</p>
</li>
<li>
<p><code>AuthStatus.SEND_CONTINUE</code> indicates that message validation is
incomplete and that the SAM has established a preliminary response as
the response message in <code>messageInfo</code>. The container responds to this
status value by sending the response to the client.</p>
</li>
<li>
<p><code>AuthStatus.SEND_FAILURE</code> indicates that message validation failed
and that the SAM has established an appropriate failure response message
in <code>messageInfo</code>. The container responds to this status value by sending
the response to the client.</p>
</li>
<li>
<p><code>AuthStatus.SEND_SUCCESS</code> is not typically returned. This status
value indicates the end of a multi-message security dialog originating
after the service interaction and during the processing of the
application response. The container responds to this status value by
sending the response to the client.</p>
<div class="paragraph">
<p>The <code>validateRequest</code> method may also throw an <code>AuthException</code> to
indicate that the message processing by the SAM failed without
establishing a failure response message in <code>messageInfo</code>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>secureResponse(MessageInfo messageInfo, Subject serviceSubject)</code> —
The container calls this method before sending a response, resulting
from an application invocation, to the client. The response is passed to
the SAM in the <code>messageInfo</code> argument. In most cases, this method should
just return the <code>SEND_SUCCESS</code> status.</p>
</li>
<li>
<p><code>cleanSubject(MessageInfo messageInfo, Subject subject)</code> — This method
removes the mechanism-specific principals, credentials, or both from the
subject. This method is not currently called by the container. A
legitimate implementation could remove all the principals from the
argument subject.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the Servlet Container Profile section in the JSR 196 specification
for additional background and details.</p>
</div>
</div>
<div class="sect3">
<h4 id="sample-server-authentication-module"><a class="anchor" href="#sample-server-authentication-module"></a>Sample Server Authentication Module</h4>
<div class="paragraph">
<p>The class <code>MySam.java</code> is a sample SAM implementation. Notice that the
sample implements the five methods of the ServerAuthModule interface.
This SAM implements an approximation of HTTP basic authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">tip.sam</span>;

   <span class="keyword">import</span> <span class="include">java.io.IOException</span>;
   <span class="keyword">import</span> <span class="include">java.util.Map</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.Subject</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.callback.Callback</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.callback.CallbackHandler</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.callback.UnsupportedCallbackException</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.message.AuthException</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.message.AuthStatus</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.message.MessageInfo</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.message.MessagePolicy</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.message.callback.CallerPrincipalCallback</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.message.callback.GroupPrincipalCallback</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.message.callback.PasswordValidationCallback</span>;
   <span class="keyword">import</span> <span class="include">javax.security.auth.message.module.ServerAuthModule</span>;
   <span class="keyword">import</span> <span class="include">javax.servlet.http.HttpServletRequest</span>;
   <span class="keyword">import</span> <span class="include">javax.servlet.http.HttpServletResponse</span>;
   <span class="keyword">import</span> <span class="include">org.apache.catalina.util.Base64</span>;

   <span class="directive">public</span> <span class="type">class</span> <span class="class">MySam</span> <span class="directive">implements</span> ServerAuthModule {

      <span class="directive">protected</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Class</span><span class="type">[]</span>
        supportedMessageTypes = <span class="keyword">new</span> <span class="predefined-type">Class</span><span class="type">[]</span>{
          HttpServletRequest.class,
          HttpServletResponse.class
      };

      <span class="directive">private</span> MessagePolicy requestPolicy;
      <span class="directive">private</span> MessagePolicy responsePolicy;
      <span class="directive">private</span> <span class="predefined-type">CallbackHandler</span> handler;
      <span class="directive">private</span> <span class="predefined-type">Map</span> options;
      <span class="directive">private</span> <span class="predefined-type">String</span> realmName = <span class="predefined-constant">null</span>;
      <span class="directive">private</span> <span class="predefined-type">String</span> defaultGroup<span class="type">[]</span> = <span class="predefined-constant">null</span>;
      privte <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> REALM_PROPERTY_NAME =
          <span class="string"><span class="delimiter">&quot;</span><span class="content">realm.name</span><span class="delimiter">&quot;</span></span>;
      <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> GROUP_PROPERTY_NAME =
          <span class="string"><span class="delimiter">&quot;</span><span class="content">group.name</span><span class="delimiter">&quot;</span></span>;
      <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> BASIC = <span class="string"><span class="delimiter">&quot;</span><span class="content">Basic</span><span class="delimiter">&quot;</span></span>;
      <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> AUTHORIZATION_HEADER =
          <span class="string"><span class="delimiter">&quot;</span><span class="content">authorization</span><span class="delimiter">&quot;</span></span>;
      <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> AUTHENTICATION_HEADER =
          <span class="string"><span class="delimiter">&quot;</span><span class="content">WWW-Authenticate</span><span class="delimiter">&quot;</span></span>;

      <span class="directive">public</span> <span class="type">void</span> initialize(MessagePolicy reqPolicy,
              MessagePolicy resPolicy,
              <span class="predefined-type">CallbackHandler</span> cBH, <span class="predefined-type">Map</span> opts)
              <span class="directive">throws</span> AuthException {
          requestPolicy = reqPolicy;
          responsePolicy = resPolicy;
          handler = cBH;
          options = opts;
          <span class="keyword">if</span> (options != <span class="predefined-constant">null</span>) {
              realmName = (<span class="predefined-type">String</span>)
                  options.get(REALM_PROPERTY_NAME);
              <span class="keyword">if</span> (options.containsKey(GROUP_PROPERTY_NAME)) {
                  defaultGroup = <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span>{(<span class="predefined-type">String</span>)
                      options.get(GROUP_PROPERTY_NAME)};
              }
          }
      }

      <span class="directive">public</span> <span class="predefined-type">Class</span><span class="type">[]</span> getSupportedMessageTypes() {
          <span class="keyword">return</span> supportedMessageTypes;
      }

      <span class="directive">public</span> AuthStatus validateRequest(
              MessageInfo msgInfo, <span class="predefined-type">Subject</span> client,
              <span class="predefined-type">Subject</span> server) <span class="directive">throws</span> AuthException {
          <span class="keyword">try</span> {

              <span class="predefined-type">String</span> username =
                  processAuthorizationToken(msgInfo, client);
              <span class="keyword">if</span> (username ==
                  <span class="predefined-constant">null</span> &amp;&amp; requestPolicy.isMandatory()) {
                  <span class="keyword">return</span> sendAuthenticateChallenge(msgInfo);
              }

             setAuthenticationResult(
                 username, client, msgInfo);
             <span class="keyword">return</span> AuthStatus.SUCCESS;

          } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
              AuthException ae = <span class="keyword">new</span> AuthException();
              ae.initCause(e);
              <span class="keyword">throw</span> ae;
          }
      }

      <span class="directive">private</span> <span class="predefined-type">String</span> processAuthorizationToken(
              MessageInfo msgInfo, <span class="predefined-type">Subject</span> s)
              <span class="directive">throws</span> AuthException {

          HttpServletRequest request =
                  (HttpServletRequest)
                  msgInfo.getRequestMessage();

          <span class="predefined-type">String</span> token =
                  request.getHeader(AUTHORIZATION_HEADER);

          <span class="keyword">if</span> (token != <span class="predefined-constant">null</span> &amp;&amp; token.startsWith(BASIC + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>)) {

              token = token.substring(<span class="integer">6</span>).trim();

              <span class="comment">// Decode and parse the authorization token</span>
              <span class="predefined-type">String</span> decoded =
                  <span class="keyword">new</span> <span class="predefined-type">String</span>(Base64.decode(token.getBytes()));

              <span class="type">int</span> colon = decoded.indexOf(<span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span>);
              <span class="keyword">if</span> (colon &lt;= <span class="integer">0</span> || colon == decoded.length() - <span class="integer">1</span>) {
                  <span class="keyword">return</span> (<span class="predefined-constant">null</span>);
              }

              <span class="predefined-type">String</span> username = decoded.substring(<span class="integer">0</span>, colon);

             <span class="comment">// use the callback to ask the container to</span>
             <span class="comment">// validate the password</span>
            PasswordValidationCallback pVC =
                    <span class="keyword">new</span> PasswordValidationCallback(s, username,
                    decoded.substring(colon + <span class="integer">1</span>).toCharArray());
            <span class="keyword">try</span> {
                handler.handle(<span class="keyword">new</span> <span class="predefined-type">Callback</span><span class="type">[]</span>{pVC});
                pVC.clearPassword();
            } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
                AuthException ae = <span class="keyword">new</span> AuthException();
                ae.initCause(e);
                <span class="keyword">throw</span> ae;
            }

            <span class="keyword">if</span> (pVC.getResult()) {
                <span class="keyword">return</span> username;
            }
      }
      <span class="keyword">return</span> <span class="predefined-constant">null</span>;
   }

   <span class="directive">private</span> AuthStatus sendAuthenticateChallenge(
           MessageInfo msgInfo) {

       <span class="predefined-type">String</span> realm = realmName;
         <span class="comment">// if the realm property is set use it,</span>
         <span class="comment">// otherwise use the name of the server</span>
         <span class="comment">// as the realm name.</span>
         <span class="keyword">if</span> (realm == <span class="predefined-constant">null</span>) {

          HttpServletRequest request =
                  (HttpServletRequest)
                  msgInfo.getRequestMessage();

          realm = request.getServerName();
        }

       HttpServletResponse response =
               (HttpServletResponse)
               msgInfo.getResponseMessage();

       <span class="predefined-type">String</span> header = BASIC + <span class="string"><span class="delimiter">&quot;</span><span class="content"> realm=</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + realm + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>;
       response.setHeader(AUTHENTICATION_HEADER, header);
       response.setStatus(
               HttpServletResponse.SC_UNAUTHORIZED);
       <span class="keyword">return</span> AuthStatus.SEND_CONTINUE;
   }

   <span class="directive">public</span> AuthStatus secureResponse(
           MessageInfo msgInfo, <span class="predefined-type">Subject</span> service)
           <span class="directive">throws</span> AuthException {
       <span class="keyword">return</span> AuthStatus.SEND_SUCCESS;
   }

   <span class="directive">public</span> <span class="type">void</span> cleanSubject(MessageInfo msgInfo,
           <span class="predefined-type">Subject</span> subject)
           <span class="directive">throws</span> AuthException {
      <span class="keyword">if</span> (subject != <span class="predefined-constant">null</span>) {
          subject.getPrincipals().clear();
      }
   }

   <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> AUTH_TYPE_INFO_KEY =
           <span class="string"><span class="delimiter">&quot;</span><span class="content">javax.servlet.http.authType</span><span class="delimiter">&quot;</span></span>;

   <span class="comment">// distinguish the caller principal</span>
   <span class="comment">// and assign default groups</span>
   <span class="directive">private</span> <span class="type">void</span> setAuthenticationResult(<span class="predefined-type">String</span> name,
           <span class="predefined-type">Subject</span> s, MessageInfo m)
           <span class="directive">throws</span> <span class="exception">IOException</span>,
           <span class="exception">UnsupportedCallbackException</span> {
       handler.handle(<span class="keyword">new</span> <span class="predefined-type">Callback</span><span class="type">[]</span>{
           <span class="keyword">new</span> CallerPrincipalCallback(s, name)
       });
       <span class="keyword">if</span> (name != <span class="predefined-constant">null</span>) {
         <span class="comment">// add the default group if the property is set</span>
           <span class="keyword">if</span> (defaultGroup != <span class="predefined-constant">null</span>) {
               handler.handle(<span class="keyword">new</span> <span class="predefined-type">Callback</span><span class="type">[]</span>{
                   <span class="keyword">new</span> GroupPrincipalCallback(s, defaultGroup)
               });
           }
           m.getMap().put(AUTH_TYPE_INFO_KEY, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>MySAM<span class="string"><span class="delimiter">&quot;</span><span class="content">);
       }
   }
  }</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>initialize</code> method looks for the <code>group.name</code> and
<code>realm.name</code> properties. The <code>group.name</code> property configures the
default group assigned as a result of any successful authentication. The
<code>realm.name</code> property defines the realm value sent back to the browser
in the <code>WWW-Authenticate</code> challenge.</p>
</div>
</div>
<div class="sect3">
<h4 id="compiling-and-installing-a-server-authentication-module"><a class="anchor" href="#compiling-and-installing-a-server-authentication-module"></a>Compiling and Installing a Server Authentication Module</h4>
<div class="paragraph">
<p>Before you can use the sample SAM, you need to compile, install, and
configure it. Then you can bind it to an application.</p>
</div>
<div class="paragraph">
<p>To compile the SAM, include the SPI in your classpath. When the
Eclipse GlassFish is installed, the JAR file containing the SPI,
<code>jmac-api.jar</code>, is installed in the as-install<code>/lib</code> directory. After
you compile the SAM, install it by copying a JAR file containing the
compiled SAM to the as-install<code>/lib</code> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-a-server-authentication-module"><a class="anchor" href="#configuring-a-server-authentication-module"></a>Configuring a Server Authentication Module</h4>
<div class="paragraph">
<p>You can configure a SAM in one of these ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, open the Security component under the
relevant configuration and go to the Message Security page. Set the
following options:</p>
<div class="ulist">
<ul>
<li>
<p>Authentication Layer — <code>HttpServlet</code></p>
</li>
<li>
<p>Provider Type — <code>server</code> or <code>client-server</code></p>
</li>
<li>
<p>Provider ID — Specify a unique name for the SAM, for example <code>MySAM</code></p>
</li>
<li>
<p>Class Name — Specify the fully qualified class name, for example
<code>tip.sam.MySam</code></p>
</li>
<li>
<p>Additional Property — Name: <code>group-name</code> Value: <code>user</code></p>
</li>
<li>
<p>Additional Property — Name: <code>realm-name</code> Value: <code>Sam</code></p>
<div class="paragraph">
<p>For details, click the Help button in the Administration Console.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Use the <code>asadmin create-message-security-provider</code> command to
configure a SAM. Set the following options:</p>
<div class="ulist">
<ul>
<li>
<p><code>--layer HttpServlet</code></p>
</li>
<li>
<p><code>--providertype server</code> or <code>--providertype client-server</code></p>
</li>
<li>
<p><code>--classname tip.sam.MySam</code></p>
</li>
<li>
<p><code>--property group-name=user:realm-name=Sam</code></p>
</li>
<li>
<p>Provider name operand — Specify a unique name for the SAM, for
example <code>MySAM</code></p>
<div class="paragraph">
<p>For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="binding-a-server-authentication-module-to-your-application"><a class="anchor" href="#binding-a-server-authentication-module-to-your-application"></a>Binding a Server Authentication Module to Your Application</h4>
<div class="paragraph">
<p>After you install and configure the SAM, you can bind it for use by the
container on behalf of one or more of your applications. You have two
options in how you bind the SAM, depending on whether you are willing to
repackage and redeploy your application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are willing to repackage and redeploy, you can bind the SAM
using the <code>glassfish-web.xml</code> file. Set the value of the
<code>httpservlet-security-provider</code> attribute of the <code>glassfish-web-app</code>
element to the SAM&#8217;s configured provider ID, for example, <code>MySAM</code>. For
more information about the <code>glassfish-web.xml</code> file, see the
<a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment
Guide</a>. This option leverages the native <code>AuthConfigProvider</code>
implementation that ships with the Eclipse GlassFish.</p>
</li>
<li>
<p>Another approach is to develop your own <code>AuthConfigProvider</code> and
register it with the Eclipse GlassFish <code>AuthConfigFactory</code> for use on
behalf of your applications. For example, a simple <code>AuthConfigProvider</code>
can obtain, through its initialization properties, the classname of a
SAM to configure on behalf of the applications for which the provider is
registered. You can find a description of the functionality of an
<code>AuthConfigProvider</code> and of the registration facilities provided by an
<code>AuthConfigFactory</code> in the JSR 196 specification.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing-web-services"><a class="anchor" href="#developing-web-services"></a>10. Developing Web Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Eclipse GlassFish support for web services.
The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#creating-portable-web-service-artifacts">Creating Portable Web Service Artifacts</a></p>
</li>
<li>
<p><a href="#deploying-a-web-service">Deploying a Web Service</a></p>
</li>
<li>
<p><a href="#the-web-service-uri-wsdl-file-and-test-page">The Web Service URI, WSDL File, and Test Page</a></p>
</li>
<li>
<p><a href="#the-databinding-provider">The Databinding Provider</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you installed the Web Profile, web services are not supported unless
the optional Metro Web Services Stack add-on component is downloaded
from the Update Tool. Without the Metro add-on component, a servlet or
EJB component cannot be a web service endpoint, and the
<code>glassfish-web.xml</code> and <code>glassfish-ejb-jar.xml</code> elements related to web
services are ignored.</p>
</div>
<div class="paragraph">
<p>In addition, the as-install<code>/modules/webservices-osgi.jar</code> and
as-install<code>/modules/webservices-api-osgi.jar</code> files must be in
the classpath of your web services application. IDEs such as NetBeans
and Eclipse do this automatically.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>"<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#web-services">Web Services</a>"
in The Jakarta EE Tutorial shows how to deploy simple web services to
Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>For additional information about JAXB (Java Architecture for XML Binding), see
<a href="http://jcp.org/aboutJava/communityprocess/pfd/jsr222/index.html">Java
Specification Request (JSR) 222</a> and <a href="#the-databinding-provider">The Databinding Provider</a>.</p>
</div>
<div class="paragraph">
<p>For additional information about JAX-WS (Java API for XML-Based Web Services), see
<a href="http://jcp.org/aboutJava/communityprocess/pfd/jsr224/index.html">Java
Specification Request (JSR) 224</a> and
<a href="http://jcp.org/en/jsr/detail?id=109">Java Specification Request (JSR) 109</a>.</p>
</div>
<div class="paragraph">
<p>For information about web services security, see
<a href="#configuring-message-security-for-web-services">Configuring Message Security for Web Services</a>.</p>
</div>
<div class="paragraph">
<p>The Fast Infoset standard specifies a binary format based on the XML Information Set.
This format is an efficient alternative to XML.
For more information about using Fast Infoset,
see the <a href="https://eclipse-ee4j.github.io/metro-wsit/3.0.0/guide/ch02.html#using-fastinfoset">
Metro WSIT Guide</a></p>
</div>
<div class="sect2">
<h3 id="creating-portable-web-service-artifacts"><a class="anchor" href="#creating-portable-web-service-artifacts"></a>Creating Portable Web Service Artifacts</h3>
<div class="paragraph">
<p>For a tutorial that shows how to use the <code>wsimport</code> and <code>wsgen</code>
commands, see "<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#web-services">
Web Services</a>" in The Jakarta EE Tutorial.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploying-a-web-service"><a class="anchor" href="#deploying-a-web-service"></a>Deploying a Web Service</h3>
<div class="paragraph">
<p>You deploy a web service endpoint to the Eclipse GlassFish just as you
would any servlet, stateless session bean (SLSB), or application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For complex services with dependent classes, user specified WSDL files,
or other advanced features, autodeployment of an annotated file is not
sufficient.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish deployment descriptor files <code>glassfish-web.xml</code> and
<code>glassfish-ejb-jar.xml</code> provide optional web service enhancements in the
<code>webservice-endpoint</code> and <code>webservice-description</code> elements, including a
<code>debugging-enabled</code> subelement that enables the creation of a test page.
The test page feature is enabled by default and described in
<a href="#the-web-service-uri-wsdl-file-and-test-page">The Web Service URI, WSDL File, and Test Page</a>.</p>
</div>
<div class="paragraph">
<p>For more information about deployment, autodeployment, and deployment
descriptors, see the <a href="application-deployment-guide.html#GSDPG">
Eclipse GlassFish Application Deployment Guide</a>.
For more information about the
<code>asadmin deploy</code> command, see the <a href="reference-manual.html#GSRFM">
Eclipse GlassFish Reference Manual</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-web-service-uri-wsdl-file-and-test-page"><a class="anchor" href="#the-web-service-uri-wsdl-file-and-test-page"></a>The Web Service URI, WSDL File, and Test Page</h3>
<div class="paragraph">
<p>Clients can run a deployed web service by accessing its service endpoint
address URI, which has the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://host:port/context-root/servlet-mapping-url-pattern</code></pre>
</div>
</div>
<div class="paragraph">
<p>The context-root is defined in the <code>application.xml</code> or <code>web.xml</code> file,
and can be overridden in the <code>glassfish-application.xml</code> or
<code>glassfish-web.xml</code> file. The servlet-mapping-url-pattern is defined in
the <code>web.xml</code> file.</p>
</div>
<div class="paragraph">
<p>In the following example, the context-root is <code>my-ws</code> and the
servlet-mapping-url-pattern is <code>/simple</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:8080/my-ws/simple</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can view the WSDL file of the deployed service in a browser by
adding <code>?WSDL</code> to the end of the URI. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:8080/my-ws/simple?WSDL</code></pre>
</div>
</div>
<div class="paragraph">
<p>For debugging, you can run a test page for the deployed service in a
browser by adding <code>?Tester</code> to the end of the URL. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:8080/my-ws/simple?Tester</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also test a service using the Administration Console. Open the
Web Services component, select the web service in the listing on the
General tab, and select Test. For details, click the Help button in the
Administration Console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The test page works only for WS-I compliant web services. This means
that the tester servlet does not work for services with WSDL files that
use RPC/encoded binding.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Generation of the test page is enabled by default. You can disable the
test page for a web service by setting the value of the
<code>debugging-enabled</code> element in the <code>glassfish-web.xml</code> and
<code>glassfish-ejb-jar.xml</code> deployment descriptor to <code>false</code>. For more
information, see the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish
Application Deployment Guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-databinding-provider"><a class="anchor" href="#the-databinding-provider"></a>The Databinding Provider</h3>
<div class="paragraph">
<p>The JAX-WS reference implementation (RI) used to be dependent on the
JAXB RI for databinding. JAXB and JAX-WS implementations have been
decoupled, and databinding is modular. JAXB and JAX-WS are no longer
Jakarta EE APIs.</p>
</div>
<div class="paragraph">
<p>The EclipseLink JAXB implementation, plus EclipseLink extensions, is
called MOXy. The <code>org.eclipse.persistence.moxy.jar</code> file is bundled with
Eclipse GlassFish, which supports the JAXB RI and MOXy as databinding
providers.</p>
</div>
<div class="paragraph">
<p>To specify the databinding provider for the JVM, set the
<code>com.sun.xml.ws.spi.db.BindingContextFactory</code> JVM property to one of the
following values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">com.sun.xml.ws.db.glassfish.JAXBRIContextFactory</dt>
<dd>
<p>Specifies the JAXB reference implementation. This is the default.</p>
</dd>
<dt class="hdlist1">com.sun.xml.ws.db.toplink.JAXBContextFactory</dt>
<dd>
<p>Specifies Eclipselink MOXy JAXB binding.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -Dcom.sun.xml.ws.spi.db.BindingContextFactory=com.sun.xml.ws.db.toplink.JAXBContextFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify the databinding provider for a web service endpoint:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>org.jvnet.ws.databinding.DatabindingModeFeature</code> feature
during <code>WebServiceFeature</code> initialization or using the <code>add</code> method.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed values are as follows</dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">org.jvnet.ws.databinding.DatabindingModeFeature.GLASSFISH_JAXB</dt>
<dd>
<p>Specifies the JAXB reference implementation. This is the default.</p>
</dd>
<dt class="hdlist1">com.sun.xml.ws.db.toplink.JAXBContextFactory.ECLIPSELINK_JAXB</dt>
<dd>
<p>Specifies Eclipselink MOXy JAXB binding.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.xml.ws.WebServiceFeature</span>;
<span class="keyword">import</span> <span class="include">org.jvnet.ws.databinding.DatabindingModeFeature</span>;
<span class="keyword">import</span> <span class="include">com.sun.xml.ws.db.toplink.JAXBContextFactory</span>;
...
WebServiceFeature<span class="type">[]</span> features = {<span class="keyword">new</span> DatabindingModeFeature(JAXBContextFactory.ECLIPSELINK_JAXB)};
...</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Set the <code>org.jvnet.ws.databinding.DatabindingModeFeature</code> feature
using the <code>@DatabindingMode</code> annotation. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.jws.WebService</span>;
<span class="keyword">import</span> <span class="include">org.jvnet.ws.databinding.DatabindingMode</span>;
<span class="keyword">import</span> <span class="include">com.sun.xml.ws.db.toplink.JAXBContextFactory</span>;
...
<span class="annotation">@WebService</span>()
<span class="annotation">@DatabindingMode</span>(JAXBContextFactory.ECLIPSELINK_JAXB);
...</code></pre>
</div>
</div>
</li>
<li>
<p>Set the <code>databinding</code> attribute of the <code>endpoint</code> element in the
<code>sun-jaxws.xml</code> file. Allowed values are <code>glassfish.jaxb</code> or
<code>eclipselink.jaxb</code>. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>
  <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">'</span><span class="content">hello.HelloImpl</span><span class="delimiter">'</span></span>
  <span class="attribute-name">url-pattern</span>=<span class="string"><span class="delimiter">'</span><span class="content">/hello</span><span class="delimiter">'</span></span>
  <span class="attribute-name">databinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">eclipselink.jaxb</span><span class="delimiter">'</span></span>
<span class="tag">/&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The EclipseLink JAXB compiler is not included but can be used with
Eclipse GlassFish. Download the EclipseLink zip file at
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code> and unzip it. The
compiler files are located here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>bin/jaxb-compiler.cmd
bin/jaxb-compiler.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-the-java-persistence-provider"><a class="anchor" href="#configuring-the-java-persistence-provider"></a>11. Configuring the Java Persistence Provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Oracle TopLink, the default persistence provider
in Eclipse GlassFish, and introduces how to use it.
This chapter also tells how to set the default persistence provider in
Eclipse GlassFish and how to use persistence-related features specific to
Eclipse GlassFish such as automatic schema generation.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-of-oracle-toplink">Overview of Oracle TopLink</a></p>
</li>
<li>
<p><a href="#using-oracle-toplink-in-glassfish-server">Using Oracle TopLink in Eclipse GlassFish</a></p>
</li>
<li>
<p><a href="#specifying-the-database-for-an-application">Specifying the Database for an Application</a></p>
</li>
<li>
<p><a href="#specifying-the-persistence-provider-for-an-application">Specifying the Persistence Provider for an Application</a></p>
</li>
<li>
<p><a href="#primary-key-generation-defaults">Primary Key Generation Defaults</a></p>
</li>
<li>
<p><a href="#automatic-schema-generation">Automatic Schema Generation</a></p>
</li>
<li>
<p><a href="#restrictions-and-optimizations">Restrictions and Optimizations</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="overview-of-oracle-toplink"><a class="anchor" href="#overview-of-oracle-toplink"></a>Overview of Oracle TopLink</h3>
<div class="paragraph">
<p>Oracle TopLink is the default persistence provider in Eclipse GlassFish. It is a comprehensive standards-based object-persistence and
object-transformation framework that provides APIs, schemas, and
run-time services for the persistence layer of an application.</p>
</div>
<div class="paragraph">
<p>TopLink includes all of EclipseLink, from the Eclipse Foundation.
EclipseLink is the default persistence provider in Eclipse GlassFish. EclipseLink is the open source implementation of the
development framework and the runtime provided in TopLink. EclipseLink
implements the following specifications, plus value-added extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java Persistence Architecture (JPA) 2.0.</p>
<div class="paragraph">
<p>JPA 2.0 is part of Java Platform, Enterprise Edition 6 (Jakarta EE 6). It
includes improvements and enhancements to domain modeling,
object/relational mapping, <code>EntityManager</code> and <code>Query</code> interfaces, and
the Java Persistence Query Language (JPQL). It includes an API for
criteria queries, a metamodel API, and support for validation. The Java
Persistence API can be used with non-EJB components outside the EJB
container.</p>
</div>
<div class="paragraph">
<p>For the JPA 2.0 Specification, see
<a href="http://jcp.org/aboutJava/communityprocess/pfd/jsr317/index.html">Java
Specification Request (JSR) 317</a>. For basic information about the Java
Persistence API, see
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#persistence">Persistence</a>
in The Jakarta EE Tutorial.</p>
</div>
</li>
<li>
<p>Java Architecture for XML Binding (JAXB) 2.0. The EclipseLink JAXB
implementation, plus EclipseLink extensions, is called MOXy. The
<code>org.eclipse.persistence.moxy.jar</code> file is bundled with Eclipse GlassFish. For more information about MOXy support in Eclipse GlassFish, see
<a href="#the-databinding-provider">The Databinding Provider</a>.</p>
<div class="paragraph">
<p>For the JAXB 2.0 specification, see
<a href="http://jcp.org/aboutJava/communityprocess/pfd/jsr222/index.html">Java
Specification Request (JSR) 222</a>.</p>
</div>
</li>
<li>
<p>EclipseLink utilities are not included but can be used with Eclipse GlassFish. Download the EclipseLink zip file at
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code> and unzip it. The
utility files are located here:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>bin/jaxb-compiler.cmd
bin/jaxb-compiler.sh</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to all of EclipseLink, Oracle TopLink includes TopLink Grid,
an integration between TopLink and Oracle Coherence that allows TopLink
to use Oracle Coherence as a level 2 (L2) cache and persistence layer
for entities. The <code>toplink-grid.jar</code> file is bundled with Eclipse GlassFish.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must have a license for Oracle Coherence to be able to use TopLink
Grid.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For information about developing, deploying, and configuring Oracle
TopLink, EclipseLink, and TopLink Grid applications, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.oracle.com/html/E25034_01.html">Oracle Fusion Middleware
Solution Guide for Oracle TopLink</a></p>
</li>
<li>
<p>EclipseLink project home at <code><a href="http://wiki.eclipse.org/EclipseLink" class="bare">http://wiki.eclipse.org/EclipseLink</a></code></p>
</li>
<li>
<p>EclipseLink Documentation Center at
<code><a href="http://wiki.eclipse.org/EclipseLink/UserGuide" class="bare">http://wiki.eclipse.org/EclipseLink/UserGuide</a></code></p>
</li>
<li>
<p>Java API Reference for EclipseLink at
<code><a href="http://www.eclipse.org/eclipselink/api/latest/index.html" class="bare">http://www.eclipse.org/eclipselink/api/latest/index.html</a></code></p>
</li>
<li>
<p>EclipseLink examples at <code><a href="http://wiki.eclipse.org/EclipseLink/Examples" class="bare">http://wiki.eclipse.org/EclipseLink/Examples</a></code></p>
</li>
<li>
<p><a href="http://docs.oracle.com/cd/E18686_01/coh.37/e18677.html">Oracle
Coherence Developer&#8217;s Guide</a></p>
</li>
<li>
<p><a href="http://docs.oracle.com/cd/E17904_01/doc.1111/e16596.html">Oracle
Fusion Middleware Integration Guide for Oracle TopLink with Coherence
Grid</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-oracle-toplink-in-glassfish-server"><a class="anchor" href="#using-oracle-toplink-in-glassfish-server"></a>Using Oracle TopLink in Eclipse GlassFish</h3>
<div class="paragraph">
<p>To run TopLink JPA applications in Eclipse GlassFish, you must configure
the server and coordinate certain server and application settings. These
are described in the following steps. For a summary of these steps, see
"<a href="http://docs.oracle.com/html/E25034_01/tlandgs.html#CIHDDACF">Using
TopLink with WebLogic Server</a>" in Oracle Fusion Middleware Solution
Guide for Oracle TopLink. For more detailed explanations of these steps,
see the links in the steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up the datasource. See "<a href="administration-guide.html#administering-database-connectivity">
Administering Database Connectivity</a>"
in Eclipse GlassFish Administration Guide.</p>
</li>
<li>
<p>Create the application. For guidance in writing your application,
see <a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#persistence">Persistence</a>
in The Jakarta EE Tutorial.</p>
</li>
<li>
<p>Create the <code>persistence.xml</code> file. See <a href="#specifying-the-database-for-an-application">Specifying the
Database for an Application</a> for considerations specific to Eclipse GlassFish.</p>
<div class="paragraph">
<p>If you are using the Java Persistence API by calling
<code>Persistence.createEMF()</code>, see <a href="#specifying-the-persistence-provider-for-an-application">Specifying the Persistence
Provider for an Application</a>.</p>
</div>
</li>
<li>
<p>If the security manager is enabled and you are using the Java
Persistence API by calling <code>Persistence.createEMF()</code>, see
<a href="#enabling-and-disabling-the-security-manager">Enabling and Disabling the Security
Manager</a>.</p>
</li>
<li>
<p>Deploy the application. See the Eclipse GlassFish
Application Deployment Guide.</p>
</li>
<li>
<p>Run the application. See "Application Client Launch" and "To Launch
an Application" in Administration Console online help.</p>
</li>
<li>
<p>Monitor the application. See "<a href="administration-guide.html#administering-the-monitoring-service">
Administering the Monitoring Service</a>"
in Eclipse GlassFish Administration Guide.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="specifying-the-database-for-an-application"><a class="anchor" href="#specifying-the-database-for-an-application"></a>Specifying the Database for an Application</h3>
<div class="paragraph">
<p>Eclipse GlassFish uses the bundled Apache Derby database by default,
named <code>jdbc/__default</code>. If the <code>transaction-type</code> element is omitted or
specified as <code>JTA</code> and both the <code>jta-data-source</code> and
<code>non-jta-data-source</code> elements are omitted in the <code>persistence.xml</code>
file, Apache Derby is used as a JTA data source. If <code>transaction-type</code>
is specified as <code>RESOURCE_LOCAL</code> and both <code>jta-data-source</code> and
<code>non-jta-data-source</code> are omitted, Apache Derby is used as a non-JTA
data source.</p>
</div>
<div class="paragraph">
<p>To use a non-default database, either specify a value for the
<code>jta-data-source</code> element, or set the <code>transaction-type</code> element to
<code>RESOURCE_LOCAL</code> and specify a value for the <code>non-jta-data-source</code>
element.</p>
</div>
<div class="paragraph">
<p>If you are using the default persistence provider, the provider attempts
to automatically detect the database type based on the connection
metadata. This database type is used to issue SQL statements specific to
the detected database type&#8217;s dialect. You can specify the optional
<code>eclipselink.target-database</code> property to guarantee that the database
type is correct. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tag">&lt;persistence</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span> =<span class="string"><span class="delimiter">&quot;</span><span class="content">em1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;jta-data-source&gt;</span>jdbc/MyDB2DB<span class="tag">&lt;/jta-data-source&gt;</span>
            <span class="tag">&lt;properties&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.target-database</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DB2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/persistence-unit&gt;</span>
    <span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following <code>eclipselink.target-database</code> property values are allowed.
Supported platforms have been tested with the Eclipse GlassFish and are
found to be Jakarta EE compatible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>//Supported platforms
JavaDB
Derby
Oracle
MySQL4
//Others available
SQLServer
DB2
Sybase
PostgreSQL
Informix
TimesTen
Attunity
HSQL
SQLAnyWhere
DBase
DB2Mainframe
Cloudscape
PointBase</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>eclipselink.target-database</code> property,
see
<a href="http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_(ELUG)#Using_EclipseLink_JPA_Extensions_for_Session.2C_Target_Database_and_Target_Application_Server">Using
EclipseLink JPA Extensions for Session, Target Database and Target
Application Server</a>
(<code><a href="http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_(ELUG)#Using_EclipseLink_JPA_Extensions_for_Session.2C_Target_Database_and_Target_Application_Server" class="bare">http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_(ELUG)#Using_EclipseLink_JPA_Extensions_for_Session.2C_Target_Database_and_Target_Application_Server</a></code>).</p>
</div>
<div class="paragraph">
<p>If you are using the Java Persistence API by calling
<code>Persistence.createEMF()</code>, do not specify the <code>jta-data-source</code> or
<code>non-jta-data-source</code> elements. Instead, specify the <code>provider</code> element
and any additional properties required by the JDBC driver or the
database. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tag">&lt;persistence</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span> =<span class="string"><span class="delimiter">&quot;</span><span class="content">em2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;provider&gt;</span>org.eclipse.persistence.jpa.PersistenceProvider<span class="tag">&lt;/provider&gt;</span>
            <span class="tag">&lt;class&gt;</span>ejb3.war.servlet.JpaBean<span class="tag">&lt;/class&gt;</span>
            <span class="tag">&lt;properties&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.target-database</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Derby</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="comment">&lt;!-- JDBC connection properties --&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.jdbc.driver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.derby.jdbc.ClientDriver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.jdbc.url</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:derby://localhost:1527/testdb;retrieveMessagesFromServerOnGetMessage=true;create=true;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.jdbc.user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">APP</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.jdbc.password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">APP</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/persistence-unit&gt;</span>
    <span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a list of the JDBC drivers currently supported by the Eclipse GlassFish, see the <a href="release-notes.html#GSRLN">Eclipse GlassFish Release
Notes</a>. For configurations of supported and other drivers, see
"<a href="administration-guide.html#configuration-specifics-for-jdbc-drivers">Configuration Specifics for JDBC Drivers</a>" in
Eclipse GlassFish Administration Guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="specifying-the-persistence-provider-for-an-application"><a class="anchor" href="#specifying-the-persistence-provider-for-an-application"></a>Specifying the Persistence Provider for an Application</h3>
<div class="paragraph">
<p>If you are using the default persistence provider in an application that
uses the Java Persistence API by injecting or looking up an entity
manager or entity manager factory, you do not need to specify the
provider.</p>
</div>
<div class="paragraph">
<p>If you are using the Java Persistence API by calling
<code>Persistence.createEMF()</code>, you should always specify the persistence
provider for specification compliance. To specify the default provider,
set the <code>provider</code> element of the <code>persistence.xml</code> file to
<code>org.eclipse.persistence.jpa.PersistenceProvider</code>.</p>
</div>
<div class="paragraph">
<p>You can specify a non-default persistence provider for an application in
the manner described in the Java Persistence API Specification:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the provider. Copy the provider JAR files to the
domain-dir<code>/lib</code> directory, and restart the Eclipse GlassFish. For more
information about the domain-dir<code>/lib</code> directory, see
<a href="#using-the-common-class-loader">Using the Common Class Loader</a>. The new
persistence provider is now available to all modules and applications
deployed on servers that share the same configuration.</p>
<div class="paragraph">
<p>However, the default provider remains the same, Oracle TopLink or
EclipseLink.</p>
</div>
</li>
<li>
<p>In your persistence unit, specify the provider and any properties
the provider requires in the <code>persistence.xml</code> file. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tag">&lt;persistence</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span> =<span class="string"><span class="delimiter">&quot;</span><span class="content">em3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;provider&gt;</span>com.company22.persistence.PersistenceProviderImpl<span class="tag">&lt;/provider&gt;</span>
            <span class="tag">&lt;properties&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">company22.database.name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/persistence-unit&gt;</span>
    <span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To specify the provider programmatically instead of in the
<code>persistence.xml</code> file, set the <code>javax.persistence.provider</code> property
and pass it to the <code>Map</code> parameter of the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">javax.persistence.Persistence.createEntityManagerFactory(<span class="predefined-type">String</span>, <span class="predefined-type">Map</span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="primary-key-generation-defaults"><a class="anchor" href="#primary-key-generation-defaults"></a>Primary Key Generation Defaults</h3>
<div class="paragraph">
<p>In the descriptions of the <code>@GeneratedValue</code>, <code>@SequenceGenerator</code>, and
<code>@TableGenerator</code> annotations in the Java Persistence Specification,
certain defaults are noted as specific to the persistence provider. The
default persistence provider&#8217;s primary key generation defaults are
listed here.</p>
</div>
<div class="paragraph">
<p><code>@GeneratedValue</code> defaults are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using <code>strategy=AUTO</code> (or no <code>strategy</code>) creates a <code>@TableGenerator</code>
named <code>SEQ_GEN</code> with default settings. Specifying a <code>generator</code> has no
effect.</p>
</li>
<li>
<p>Using <code>strategy=TABLE</code> without specifying a <code>generator</code> creates a
<code>@TableGenerator</code> named <code>SEQ_GEN_TABLE</code> with default settings.
Specifying a <code>generator</code> but no <code>@TableGenerator</code> creates and names a
<code>@TableGenerator</code> with default settings.</p>
</li>
<li>
<p>Using <code>strategy=IDENTITY</code> or <code>strategy=SEQUENCE</code> produces the same
results, which are database-specific.</p>
<div class="ulist">
<ul>
<li>
<p>For Oracle databases, not specifying a <code>generator</code> creates a
<code>@SequenceGenerator</code> named <code>SEQ_GEN_SEQUENCE</code> with default settings.
Specifying a <code>generator</code> but no <code>@SequenceGenerator</code> creates and names a
<code>@SequenceGenerator</code> with default settings.</p>
</li>
<li>
<p>For PostgreSQL databases, a <code>SERIAL</code> column named
entity-table`_`pk-column`_SEQ` is created.</p>
</li>
<li>
<p>For MySQL databases, an <code>AUTO_INCREMENT</code> column is created.</p>
</li>
<li>
<p>For other supported databases, an <code>IDENTITY</code> column is created.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>@SequenceGenerator</code> annotation has one default specific to the
default provider. The default <code>sequenceName</code> is the specified <code>name</code>.</p>
</div>
<div class="paragraph">
<p><code>@TableGenerator</code> defaults are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default <code>table</code> is <code>SEQUENCE</code>.</p>
</li>
<li>
<p>The default <code>pkColumnName</code> is <code>SEQ_NAME</code>.</p>
</li>
<li>
<p>The default <code>valueColumnName</code> is <code>SEQ_COUNT</code>.</p>
</li>
<li>
<p>The default <code>pkColumnValue</code> is the specified <code>name</code>, or the default
<code>name</code> if no <code>name</code> is specified.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="automatic-schema-generation"><a class="anchor" href="#automatic-schema-generation"></a>Automatic Schema Generation</h3>
<div class="paragraph">
<p>The automatic schema generation feature of the Eclipse GlassFish defines
database tables based on the fields or properties in entities and the
relationships between the fields or properties. This insulates
developers from many of the database related aspects of development,
allowing them to focus on entity development. The resulting schema is
usable as-is or can be given to a database administrator for tuning with
respect to performance, security, and so on.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#annotations">Annotations</a></p>
</li>
<li>
<p><a href="#generation-options">Generation Options</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automatic schema generation is supported on an all-or-none basis: it
expects that no tables exist in the database before it is executed. It
is not intended to be used as a tool to generate extra tables or
constraints.</p>
</div>
<div class="paragraph">
<p>Deployment won&#8217;t fail if all tables are not created, and undeployment
won&#8217;t fail if not all tables are dropped. Instead, an error is written
to the server log. This is done to allow you to investigate the problem
and fix it manually. You should not rely on the partially created
database schema to be correct for running the application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="annotations"><a class="anchor" href="#annotations"></a>Annotations</h4>
<div class="paragraph">
<p>The following annotations are used in automatic schema generation:
<code>@AssociationOverride</code>, <code>@AssociationOverrides</code>, <code>@AttributeOverride</code>,
<code>@AttributeOverrides</code>, <code>@Column</code>, <code>@DiscriminatorColumn</code>,
<code>@DiscriminatorValue</code>, <code>@Embedded</code>, <code>@EmbeddedId</code>, <code>@GeneratedValue</code>,
<code>@Id</code>, <code>@IdClass</code>, <code>@JoinColumn</code>, <code>@JoinColumns</code>, <code>@JoinTable</code>, <code>@Lob</code>,
<code>@ManyToMany</code>, <code>@ManyToOne</code>, <code>@OneToMany</code>, <code>@OneToOne</code>,
<code>@PrimaryKeyJoinColumn</code>, <code>@PrimaryKeyJoinColumns</code>, <code>@SecondaryTable</code>,
<code>@SecondaryTables</code>, <code>@SequenceGenerator</code>, <code>@Table</code>, <code>@TableGenerator</code>,
<code>@UniqueConstraint</code>, and <code>@Version</code>. For information about these
annotations, see the Java Persistence Specification.</p>
</div>
<div class="paragraph">
<p>For <code>@Column</code> annotations, the <code>insertable</code> and <code>updatable</code> elements are
not used in automatic schema generation.</p>
</div>
<div class="paragraph">
<p>For <code>@OneToMany</code> and <code>@ManyToOne</code> annotations, no <code>ForeignKeyConstraint</code>
is created in the resulting DDL files.</p>
</div>
</div>
<div class="sect3">
<h4 id="generation-options"><a class="anchor" href="#generation-options"></a>Generation Options</h4>
<div class="paragraph">
<p>Schema generation properties or <code>asadmin</code> command line options can
control automatic schema generation by the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating tables during deployment</p>
</li>
<li>
<p>Dropping tables during undeployment</p>
</li>
<li>
<p>Dropping and creating tables during redeployment</p>
</li>
<li>
<p>Generating the DDL files</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before using these options, make sure you have a properly configured
database. See <a href="#specifying-the-database-for-an-application">Specifying the Database for an Application</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Optional schema generation properties control the automatic creation of
database tables. You can specify them in the <code>persistence.xml</code> file. For
more information, see
<a href="http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_(ELUG)#Using_EclipseLink_JPA_Extensions_for_Schema_Generation">Using
EclipseLink JPA Extensions for Schema Generation</a>
(<code><a href="http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_(ELUG)#Using_EclipseLink_JPA_Extensions_for_Schema_Generation" class="bare">http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_(ELUG)#Using_EclipseLink_JPA_Extensions_for_Schema_Generation</a></code>).</p>
</div>
<div class="paragraph">
<p>The following options of the <code>asadmin deploy</code> or <code>asadmin deploydir</code>
command control the automatic creation of database tables at deployment.</p>
</div>
<div id="gbwlr" class="paragraph">
<p>Table 6-1 The <code>asadmin deploy</code> and <code>asadmin deploydir</code> Generation Options</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14%;">
<col style="width: 49%;">
<col style="width: 37%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--createtables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, causes database tables to be created
for entities that need them. No unique constraints are created. If
<code>false</code>, does not create tables. If not specified, the value of the
<code>eclipselink.ddl-generation</code> property in <code>persistence.xml</code> is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dropandcreatetables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If <code>true</code>, and if tables were automatically created when this
application was last deployed, tables from the earlier deployment are
dropped and fresh ones are created.</p>
</div>
<div class="paragraph">
<p>If <code>true</code>, and if tables were not automatically created when this
application was last deployed, no attempt is made to drop any tables. If
tables with the same names as those that would have been automatically
created are found, the deployment proceeds, but a warning is thrown to
indicate that tables could not be created.</p>
</div>
<div class="paragraph">
<p>If <code>false</code>, the <code>eclipselink.ddl-generation</code> property setting in
<code>persistence.xml</code> is overridden.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following options of the <code>asadmin undeploy</code> command control the
automatic removal of database tables at undeployment.</p>
</div>
<div id="gbwmm" class="paragraph">
<p>Table 6-2 The <code>asadmin undeploy</code> Generation Options</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9%;">
<col style="width: 49%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--droptables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If <code>true</code>, causes database tables that were automatically created when
the entities were last deployed to be dropped when the entities are
undeployed. If <code>false</code>, does not drop tables.</p>
</div>
<div class="paragraph">
<p>If not specified, tables are dropped only if the
<code>eclipselink.ddl-generation</code> property setting in <code>persistence.xml</code> is
<code>drop-and-create-tables</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information about the <code>asadmin deploy</code>, <code>asadmin deploydir</code>,
and <code>asadmin undeploy</code> commands, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>When <code>asadmin</code> deployment options and <code>persistence.xml</code> options are both
specified, the <code>asadmin</code> deployment options take precedence.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restrictions-and-optimizations"><a class="anchor" href="#restrictions-and-optimizations"></a>Restrictions and Optimizations</h3>
<div class="paragraph">
<p>This section discusses restrictions and performance optimizations that
affect using the Java Persistence API.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#oracle-database-enhancements">Oracle Database Enhancements</a></p>
</li>
<li>
<p><a href="#extended-persistence-context">Extended Persistence Context</a></p>
</li>
<li>
<p><a href="#using-orderby-with-a-shared-session-cache">Using @OrderBy with a Shared Session Cache</a></p>
</li>
<li>
<p><a href="#using-blob-or-clob-types-with-the-inet-oraxo-jdbc-driver">Using BLOB or CLOB Types with the Inet Oraxo JDBC Driver</a></p>
</li>
<li>
<p><a href="#database-case-sensitivity">Database Case Sensitivity</a></p>
</li>
<li>
<p><a href="#sybase-finder-limitation">Sybase Finder Limitation</a></p>
</li>
<li>
<p><a href="#mysql-database-restrictions">MySQL Database Restrictions</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="oracle-database-enhancements"><a class="anchor" href="#oracle-database-enhancements"></a>Oracle Database Enhancements</h4>
<div class="paragraph">
<p>EclipseLink features a number of enhancements for use with Oracle
databases. These enhancements require classes from the Oracle JDBC
driver JAR files to be visible to EclipseLink at runtime. If you place
the JDBC driver JAR files in domain-dir<code>/lib</code>, the classes are not
visible to Eclipse GlassFish components, including EclipseLink.</p>
</div>
<div class="paragraph">
<p>If you are using an Oracle database, put JDBC driver JAR files in
domain-dir<code>/lib/ext</code> instead. This ensures that the JDBC driver classes
are visible to EclipseLink.</p>
</div>
<div class="paragraph">
<p>If you do not want to take advantage of Oracle-specific extensions from
EclipseLink or you cannot put JDBC driver JAR files in
domain-dir<code>/lib/ext</code>, set the <code>eclipselink.target-database</code> property to
the value <code>org.eclipse.persistence.platform.database.OraclePlatform</code>.
For more information about the <code>eclipselink.target-database</code> property,
see <a href="#specifying-the-database-for-an-application">Specifying the Database for an Application</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="extended-persistence-context"><a class="anchor" href="#extended-persistence-context"></a>Extended Persistence Context</h4>
<div class="paragraph">
<p>The Java Persistence API specification does not specify how the
container and persistence provider should work together to serialize an
extended persistence context. This also prevents successful
serialization of a reference to an extended persistence context in a
stateful session bean.</p>
</div>
<div class="paragraph">
<p>Even in a single-instance environment, if a stateful session bean is
passivated, its extended persistence context could be lost when the
stateful session bean is activated.</p>
</div>
<div class="paragraph">
<p>Therefore, in Eclipse GlassFish, a stateful session bean with an extended
persistence context is never passivated and cannot be failed over.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-orderby-with-a-shared-session-cache"><a class="anchor" href="#using-orderby-with-a-shared-session-cache"></a>Using @OrderBy with a Shared Session Cache</h4>
<div class="paragraph">
<p>Setting <code>@OrderBy</code> on a <code>ManyToMany</code> or <code>OneToMany</code> relationship field
in which a <code>List</code> represents the Many side doesn&#8217;t work if the session
cache is shared. Use one of the following workarounds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Have the application maintain the order so the <code>List</code> is cached
properly.</p>
</li>
<li>
<p>Refresh the session cache using <code>EntityManager.refresh()</code> if you don&#8217;t
want to maintain the order during creation or modification of the
<code>List</code>.</p>
</li>
<li>
<p>Disable session cache sharing in <code>persistence.xml</code> as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.cache.shared.default</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using-blob-or-clob-types-with-the-inet-oraxo-jdbc-driver"><a class="anchor" href="#using-blob-or-clob-types-with-the-inet-oraxo-jdbc-driver"></a>Using BLOB or CLOB Types with the Inet Oraxo JDBC Driver</h4>
<div class="paragraph">
<p>To use BLOB or CLOB data types larger than 4 KB for persistence using
the Inet Oraxo JDBC Driver for Oracle Databases, you must set the
database&#8217;s <code>streamstolob</code> property value to <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="database-case-sensitivity"><a class="anchor" href="#database-case-sensitivity"></a>Database Case Sensitivity</h4>
<div class="paragraph">
<p>Mapping references to column or table names must be in accordance with
the expected column or table name case, and ensuring this is the
programmer&#8217;s responsibility. If column or table names are not explicitly
specified for a field or entity, the Eclipse GlassFish uses upper case
column names by default, so any mapping references to the column or
table names must be in upper case. If column or table names are
explicitly specified, the case of all mapping references to the column
or table names must be in accordance with the case used in the specified
names.</p>
</div>
<div class="paragraph">
<p>The following are examples of how case sensitivity affects mapping
elements that refer to columns or tables. Keep case sensitivity in mind
when writing these mappings.</p>
</div>
<div class="sect4">
<h5 id="unique-constraints"><a class="anchor" href="#unique-constraints"></a>Unique Constraints</h5>
<div class="paragraph">
<p>If column names are not explicitly specified on a field, unique
constraints and foreign key mappings must be specified using uppercase
references. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Department</span><span class="delimiter">&quot;</span></span>, uniqueConstraints={ <span class="annotation">@UniqueConstraint</span> ( columnNames= { <span class="string"><span class="delimiter">&quot;</span><span class="content">DEPTNAME</span><span class="delimiter">&quot;</span></span> } ) } )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other way to handle this is by specifying explicit column names for
each field with the required case. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Department</span><span class="delimiter">&quot;</span></span>, uniqueConstraints={ <span class="annotation">@UniqueConstraint</span> ( columnNames= { <span class="string"><span class="delimiter">&quot;</span><span class="content">deptName</span><span class="delimiter">&quot;</span></span> } ) } )
<span class="directive">public</span> <span class="type">class</span> <span class="class">Department</span>{ <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">deptName</span><span class="delimiter">&quot;</span></span>) <span class="directive">private</span> <span class="predefined-type">String</span> deptName; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise, the <code>ALTER TABLE</code> statement generated by the Eclipse GlassFish
uses the incorrect case, and the creation of the unique constraint
fails.</p>
</div>
</div>
<div class="sect4">
<h5 id="foreign-key-mapping"><a class="anchor" href="#foreign-key-mapping"></a>Foreign Key Mapping</h5>
<div class="paragraph">
<p>Use <code>@OneToMany(mappedBy="COMPANY")</code> or specify an explicit column name
for the <code>Company</code> field on the <code>Many</code> side of the relationship.</p>
</div>
</div>
<div class="sect4">
<h5 id="sql-result-set-mapping"><a class="anchor" href="#sql-result-set-mapping"></a>SQL Result Set Mapping</h5>
<div class="paragraph">
<p>Use the following elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;sql-result-set-mapping</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SRSMName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;entity-result</span> <span class="attribute-name">entity-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entities.someEntity</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
   <span class="tag">&lt;column-result</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UPPERCASECOLUMNNAME</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/sql-result-set-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or specify an explicit column name for the <code>upperCaseColumnName</code> field.</p>
</div>
</div>
<div class="sect4">
<h5 id="named-native-queries-and-jdbc-queries"><a class="anchor" href="#named-native-queries-and-jdbc-queries"></a>Named Native Queries and JDBC Queries</h5>
<div class="paragraph">
<p>Column or table names specified in SQL queries must be in accordance
with the expected case. For example, MySQL requires column names in the
<code>SELECT</code> clause of JDBC queries to be uppercase, while PostgreSQL and
Sybase require table names to be uppercase in all JDBC queries.</p>
</div>
</div>
<div class="sect4">
<h5 id="postgresql-case-sensitivity"><a class="anchor" href="#postgresql-case-sensitivity"></a>PostgreSQL Case Sensitivity</h5>
<div class="paragraph">
<p>PostgreSQL stores column and table names in lower case. JDBC queries on
PostgreSQL retrieve column or table names in lowercase unless the names
are quoted. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">use aliases <span class="class">Select</span> m.ID <span class="keyword">AS</span> <span class="error">\</span><span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="char">\&quot;</span><span class="content"> from Department m</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the backslash as an escape character in the class file, but not in
the <code>persistence.xml</code> file.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sybase-finder-limitation"><a class="anchor" href="#sybase-finder-limitation"></a>Sybase Finder Limitation</h4>
<div class="paragraph">
<p>If a finder method with an input greater than 255 characters is executed
and the primary key column is mapped to a VARCHAR column, Sybase
attempts to convert type VARCHAR to type TEXT and generates the
following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>com.sybase.jdbc2.jdbc.SybSQLException: Implicit conversion from datatype
'TEXT' to 'VARCHAR' is not allowed. Use the CONVERT function to run this query.</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid this error, make sure the finder method input is less than 255
characters.</p>
</div>
</div>
<div class="sect3">
<h4 id="mysql-database-restrictions"><a class="anchor" href="#mysql-database-restrictions"></a>MySQL Database Restrictions</h4>
<div class="paragraph">
<p>The following restrictions apply when you use a MySQL database with the
Eclipse GlassFish for persistence.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MySQL treats <code>int1</code> and <code>int2</code> as reserved words. If you want to
define <code>int1</code> and <code>int2</code> as fields in your table, use <code>\`int1`</code> and
<code>\`int2\`</code> field names in your SQL file.</p>
</li>
<li>
<p>When <code>VARCHAR</code> fields get truncated, a warning is displayed instead of
an error. To get an error message, start the MySQL database in strict
SQL mode.</p>
</li>
<li>
<p>The order of fields in a foreign key index must match the order in the
explicitly created index on the primary table.</p>
</li>
<li>
<p>The <code>CREATE TABLE</code> syntax in the SQL file must end with the following
line.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">)  <span class="directive">Engine</span>=InnoDB;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>InnoDB</code> provides MySQL with a transaction-safe (ACID compliant) storage
engine having commit, rollback, and crash recovery capabilities.</p>
</div>
</li>
<li>
<p>For a <code>FLOAT</code> type field, the correct precision must be defined. By
default, MySQL uses four bytes to store a <code>FLOAT</code> type that does not
have an explicit precision definition. For example, this causes a number
such as 12345.67890123 to be rounded off to 12345.7 during an <code>INSERT</code>.
To prevent this, specify <code>FLOAT(10,2)</code> in the DDL file, which forces the
database to use an eight-byte double-precision column. For more
information, see <code><a href="http://dev.mysql.com/doc/mysql/en/numeric-types.html" class="bare">http://dev.mysql.com/doc/mysql/en/numeric-types.html</a></code>.</p>
</li>
<li>
<p>To use <code>||</code> as the string concatenation symbol, start the MySQL server
with the <code>--sql-mode="PIPES_AS_CONCAT"</code> option. For more information,
see <code><a href="http://dev.mysql.com/doc/refman/5.0/en/server-sql-mode.html" class="bare">http://dev.mysql.com/doc/refman/5.0/en/server-sql-mode.html</a></code> and
<code><a href="http://dev.mysql.com/doc/mysql/en/ansi-mode.html" class="bare">http://dev.mysql.com/doc/mysql/en/ansi-mode.html</a></code>.</p>
</li>
<li>
<p>MySQL always starts a new connection when <code>autoCommit==true</code> is set.
This ensures that each SQL statement forms a single transaction on its
own. If you try to rollback or commit an SQL statement, you get an error
message.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>javax.transaction.SystemException: java.sql.SQLException:
Can't call rollback when autocommit=true

javax.transaction.SystemException: java.sql.SQLException:
Error open transaction is not closed</code></pre>
</div>
</div>
<div class="paragraph">
<p>To resolve this issue, add <code>relaxAutoCommit=true</code> to the JDBC URL. For
more information, see <code><a href="http://forums.mysql.com/read.php?39,31326,31404" class="bare">http://forums.mysql.com/read.php?39,31326,31404</a></code>.</p>
</div>
</li>
<li>
<p>MySQL does not allow a <code>DELETE</code> on a row that contains a reference to
itself. Here is an example that illustrates the issue.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">create</span> <span class="type">table</span> EMPLOYEE (
        empId   <span class="predefined-type">int</span>         <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
        salary  <span class="predefined-type">float</span>(<span class="integer">25</span>,<span class="integer">2</span>) <span class="predefined-constant">NULL</span>,
        mgrId   <span class="predefined-type">int</span>         <span class="predefined-constant">NULL</span>,
        <span class="directive">PRIMARY</span> <span class="type">KEY</span> (empId),
        <span class="directive">FOREIGN</span> <span class="type">KEY</span> (mgrId) <span class="keyword">REFERENCES</span> EMPLOYEE (empId)
        ) <span class="directive">ENGINE</span>=InnoDB;

        <span class="class">insert</span> <span class="class">into</span> Employee <span class="keyword">values</span> (<span class="integer">1</span>, <span class="float">1234.34</span>, <span class="integer">1</span>);
        <span class="class">delete</span> <span class="keyword">from</span> Employee <span class="keyword">where</span> empId = <span class="integer">1</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example fails with the following error message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ERROR <span class="integer">1217</span> (<span class="integer">23000</span>): Cannot delete or update a parent row:
a foreign key constraint fails</code></pre>
</div>
</div>
<div class="paragraph">
<p>To resolve this issue, change the table creation script to the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">create table EMPLOYEE (
        empId   <span class="type">int</span>         NOT NULL,
        salary  <span class="type">float</span>(<span class="integer">25</span>,<span class="integer">2</span>) NULL,
        mgrId   <span class="type">int</span>         NULL,
        PRIMARY KEY (empId),
        FOREIGN KEY (mgrId) REFERENCES EMPLOYEE (empId)
        ON DELETE SET NULL
        ) ENGINE=InnoDB;

        insert into Employee values (<span class="integer">1</span>, <span class="float">1234.34</span>, <span class="integer">1</span>);
        delete from Employee where empId = <span class="integer">1</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be done only if the foreign key field is allowed to be null.
For more information, see
<code><a href="http://dev.mysql.com/doc/mysql/en/innodb-foreign-key-constraints.html" class="bare">http://dev.mysql.com/doc/mysql/en/innodb-foreign-key-constraints.html</a></code>.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing-web-applications"><a class="anchor" href="#developing-web-applications"></a>12. Developing Web Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how web applications are supported in the Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-servlets">Using Servlets</a></p>
</li>
<li>
<p><a href="#using-javaserver-pages">Using JavaServer Pages</a></p>
</li>
<li>
<p><a href="#creating-and-managing-sessions">Creating and Managing Sessions</a></p>
</li>
<li>
<p><a href="#using-comet">Using Comet</a></p>
</li>
<li>
<p><a href="#advanced-web-application-features">Advanced Web Application Features</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For general information about web applications, see
"<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#getting-started-with-web-applications">
The Web Tier</a>" in The Jakarta EE Tutorial.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Web Profile of the Eclipse GlassFish supports the EJB 3.1 Lite
specification, which allows enterprise beans within web applications,
among other features. The full Eclipse GlassFish supports the entire EJB
3.1 specification. For details, see
<a href="http://jcp.org/en/jsr/detail?id=318">JSR 318</a>
(<code><a href="http://jcp.org/en/jsr/detail?id=318" class="bare">http://jcp.org/en/jsr/detail?id=318</a></code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="using-servlets"><a class="anchor" href="#using-servlets"></a>Using Servlets</h3>
<div class="paragraph">
<p>Eclipse GlassFish supports the Java Servlet Specification version 4.0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Servlet API version 4.0 is fully backward compatible with versions 3.0,
2.3, 2.4, and 2.5, so all existing servlets should work without
modification or recompilation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To develop servlets, use the Java Servlet API. For information about
using the Java Servlet API, see the documentation at
<code><a href="https://jakarta.ee/specifications/servlet/" class="bare">https://jakarta.ee/specifications/servlet/</a></code>.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish provides the <code>wscompile</code> and <code>wsdeploy</code> tools to
help you implement a web service endpoint as a servlet. For more
information about these tools, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>This section describes how to create effective servlets to control
application interactions running on a Eclipse GlassFish, including
standard-based servlets. In addition, this section describes the
Eclipse GlassFish features to use to augment the standards.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#caching-servlet-results">Caching Servlet Results</a></p>
</li>
<li>
<p><a href="#about-the-servlet-engine">About the Servlet Engine</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="caching-servlet-results"><a class="anchor" href="#caching-servlet-results"></a>Caching Servlet Results</h4>
<div class="paragraph">
<p>The Eclipse GlassFish can cache the results of invoking a servlet, a JSP,
or any URL pattern to make subsequent invocations of the same servlet,
JSP, or URL pattern faster. The Eclipse GlassFish caches the request
results for a specific amount of time. In this way, if another data call
occurs, the Eclipse GlassFish can return the cached data instead of
performing the operation again. For example, if your servlet returns a
stock quote that updates every 5 minutes, you set the cache to expire
after 300 seconds.</p>
</div>
<div class="paragraph">
<p>Whether to cache results and how to cache them depends on the data
involved. For example, it makes no sense to cache the results of a quiz
submission, because the input to the servlet is different each time.
However, it makes sense to cache a high level report showing demographic
data taken from quiz results that is updated once an hour.</p>
</div>
<div class="paragraph">
<p>To define how a Eclipse GlassFish web application handles response
caching, you edit specific fields in the <code>glassfish-web.xml</code> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A servlet that uses caching is not portable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For Javadoc tool pages relevant to caching servlet results, see the
<code>com.sun.appserv.web.cache</code> package.</p>
</div>
<div class="paragraph">
<p>For information about JSP caching, see <a href="#jsp-caching">JSP Caching</a>.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#caching-features">Caching Features</a></p>
</li>
<li>
<p><a href="#default-cache-configuration">Default Cache Configuration</a></p>
</li>
<li>
<p><a href="#caching-example">Caching Example</a></p>
</li>
<li>
<p><a href="#the-cachekeygenerator-interface">The CacheKeyGenerator Interface</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="caching-features"><a class="anchor" href="#caching-features"></a>Caching Features</h5>
<div class="paragraph">
<p>The Eclipse GlassFish has the following web application response caching
capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Caching is configurable based on the servlet name or the URI.</p>
</li>
<li>
<p>When caching is based on the URI, this includes user specified
parameters in the query string. For example, a response from
<code>/garden/catalog?category=roses</code> is different from a response from
<code>/garden/catalog?category=lilies</code>. These responses are stored under
different keys in the cache.</p>
</li>
<li>
<p>Cache size, entry timeout, and other caching behaviors are
configurable.</p>
</li>
<li>
<p>Entry timeout is measured from the time an entry is created or
refreshed. To override this timeout for an individual cache mapping,
specify the <code>cache-mapping</code> subelement <code>timeout</code>.</p>
</li>
<li>
<p>To determine caching criteria programmatically, write a class that
implements the com.sun.appserv.web.cache.CacheHelper interface. For
example, if only a servlet knows when a back end data source was last
modified, you can write a helper class to retrieve the last modified
timestamp from the data source and decide whether to cache the response
based on that timestamp.</p>
</li>
<li>
<p>To determine cache key generation programmatically, write a class that
implements the com.sun.appserv.web.cache.CacheKeyGenerator interface.
See <a href="#the-cachekeygenerator-interface">The CacheKeyGenerator Interface</a>.</p>
</li>
<li>
<p>All non-ASCII request parameter values specified in cache key elements
must be URL encoded. The caching subsystem attempts to match the raw
parameter values in the request query string.</p>
</li>
<li>
<p>Since newly updated classes impact what gets cached, the web container
clears the cache during dynamic deployment or reloading of classes.</p>
</li>
<li>
<p>The following <code>HttpServletRequest</code> request attributes are exposed.</p>
<div class="ulist">
<ul>
<li>
<p><code>com.sun.appserv.web.cachedServletName</code>, the cached servlet target</p>
</li>
<li>
<p><code>com.sun.appserv.web.cachedURLPattern</code>, the URL pattern being cached</p>
</li>
</ul>
</div>
</li>
<li>
<p>Results produced by resources that are the target of a
<code>RequestDispatcher.include()</code> or <code>RequestDispatcher.forward()</code> call are
cached if caching has been enabled for those resources. For details, see
"<a href="application-deployment-guide.html#cache-mapping">cache-mapping</a>" in Eclipse GlassFish Application Deployment Guide and "<a href="../application-deployment-guide.html#dispatcher">dispatcher</a>"
in Eclipse GlassFish Application Deployment Guide.
These are elements in the <code>glassfish-web.xml</code> file.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="default-cache-configuration"><a class="anchor" href="#default-cache-configuration"></a>Default Cache Configuration</h5>
<div class="paragraph">
<p>If you enable caching but do not provide any special configuration for a
servlet or JSP, the default cache configuration is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default cache timeout is 30 seconds.</p>
</li>
<li>
<p>Only the HTTP GET method is eligible for caching.</p>
</li>
<li>
<p>HTTP requests with cookies or sessions automatically disable caching.</p>
</li>
<li>
<p>No special consideration is given to <code>Pragma:</code>, <code>Cache-control:</code>, or
<code>Vary:</code> headers.</p>
</li>
<li>
<p>The default key consists of the Servlet Path (minus <code>pathInfo</code> and the
query string).</p>
</li>
<li>
<p>A "least recently used" list is maintained to evict cache entries if
the maximum cache size is exceeded.</p>
</li>
<li>
<p>Key generation concatenates the servlet path with key field values, if
any are specified.</p>
</li>
<li>
<p>Results produced by resources that are the target of a
<code>RequestDispatcher.include()</code> or <code>RequestDispatcher.forward()</code> call are
never cached.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="caching-example"><a class="anchor" href="#caching-example"></a>Caching Example</h5>
<div class="paragraph">
<p>Here is an example cache element in the <code>glassfish-web.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cache</span> <span class="attribute-name">max-capacity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8192</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;cache-helper</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myHelper</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyCacheHelper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;cache-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>myservlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;timeout</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timefield</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>120<span class="tag">&lt;/timeout&gt;</span>
    <span class="tag">&lt;http-method&gt;</span>GET<span class="tag">&lt;/http-method&gt;</span>
    <span class="tag">&lt;http-method&gt;</span>POST<span class="tag">&lt;/http-method&gt;</span>
<span class="tag">&lt;/cache-mapping&gt;</span>
<span class="tag">&lt;cache-mapping&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span> /catalog/* <span class="tag">&lt;/url-pattern&gt;</span>
    <span class="comment">&lt;!-- cache the best selling category; cache the responses to
       -- this resource only when the given parameters exist. Cache
       -- only when the catalog parameter has 'lilies' or 'roses'
       -- but no other catalog varieties:
      -- /orchard/catalog?best&amp;category='lilies'
      -- /orchard/catalog?best&amp;category='roses'
      -- but not the result of
       -- /orchard/catalog?best&amp;category='wild'
    --&gt;</span>
    <span class="tag">&lt;constraint-field</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">best</span><span class="delimiter">'</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">'</span><span class="content">request.parameter</span><span class="delimiter">'</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;constraint-field</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">category</span><span class="delimiter">'</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">'</span><span class="content">request.parameter</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span> roses <span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;value&gt;</span> lilies <span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/constraint-field&gt;</span>
     <span class="comment">&lt;!-- Specify that a particular field is of given range but the
       -- field doesn't need to be present in all the requests --&gt;</span>
    <span class="tag">&lt;constraint-field</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">SKUnum</span><span class="delimiter">'</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">'</span><span class="content">request.parameter</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value</span> <span class="attribute-name">match-expr</span>=<span class="string"><span class="delimiter">'</span><span class="content">in-range</span><span class="delimiter">'</span></span><span class="tag">&gt;</span> 1000 - 2000 <span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/constraint-field&gt;</span>
    <span class="comment">&lt;!-- cache when the category matches with any value other than
       -- a specific value --&gt;</span>
    <span class="tag">&lt;constraint-field</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">category</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">request.parameter</span></span><span class="error">&gt;</span>
        <span class="tag">&lt;value</span> <span class="attribute-name">match-expr</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">equals</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">cache-on-match-failure</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
       bogus
        <span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/constraint-field&gt;</span>
<span class="tag">&lt;/cache-mapping&gt;</span>
<span class="tag">&lt;cache-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span> InfoServlet <span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;cache-helper-ref&gt;</span>myHelper<span class="tag">&lt;/cache-helper-ref&gt;</span>
<span class="tag">&lt;/cache-mapping&gt;</span>
<span class="tag">&lt;/cache&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>glassfish-web.xml</code> caching settings, see
"<a href="application-deployment-guide.html#cache">cache</a>" in Eclipse GlassFish
Application Deployment Guide.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-cachekeygenerator-interface"><a class="anchor" href="#the-cachekeygenerator-interface"></a>The CacheKeyGenerator Interface</h5>
<div class="paragraph">
<p>The built-in default CacheHelper implementation allows web applications
to customize the key generation. An application component (in a servlet
or JSP) can set up a custom CacheKeyGenerator implementation as an
attribute in the <code>ServletContext</code>.</p>
</div>
<div class="paragraph">
<p>The name of the context attribute is configurable as the <code>value</code> of the
<code>cacheKeyGeneratorAttrName</code> property in the <code>default-helper</code> element of
the <code>glassfish-web.xml</code> deployment descriptor. For more information, see
"<a href="application-deployment-guide.html#default-helper">default-helper</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="about-the-servlet-engine"><a class="anchor" href="#about-the-servlet-engine"></a>About the Servlet Engine</h4>
<div class="paragraph">
<p>Servlets exist in and are managed by the servlet engine in the Eclipse GlassFish. The servlet engine is an internal object that handles all
servlet meta functions. These functions include instantiation,
initialization, destruction, access from other components, and
configuration management.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#instantiating-and-removing-servlets">Instantiating and Removing Servlets</a></p>
</li>
<li>
<p><a href="#request-handling">Request Handling</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="instantiating-and-removing-servlets"><a class="anchor" href="#instantiating-and-removing-servlets"></a>Instantiating and Removing Servlets</h5>
<div class="paragraph">
<p>After the servlet engine instantiates the servlet, the servlet engine
calls the servlet&#8217;s <code>init</code> method to perform any necessary
initialization. You can override this method to perform an
initialization function for the servlet&#8217;s life, such as initializing a
counter.</p>
</div>
<div class="paragraph">
<p>When a servlet is removed from service, the servlet engine calls the
<code>destroy</code> method in the servlet so that the servlet can perform any
final tasks and deallocate resources. You can override this method to
write log messages or clean up any lingering connections that won&#8217;t be
caught in garbage collection.</p>
</div>
</div>
<div class="sect4">
<h5 id="request-handling"><a class="anchor" href="#request-handling"></a>Request Handling</h5>
<div class="paragraph">
<p>When a request is made, the Eclipse GlassFish hands the incoming data to
the servlet engine. The servlet engine processes the request&#8217;s input
data, such as form data, cookies, session information, and URL
name-value pairs, into an <code>HttpServletRequest</code> request object type.</p>
</div>
<div class="paragraph">
<p>The servlet engine also creates an <code>HttpServletResponse</code> response object
type. The engine then passes both as parameters to the servlet&#8217;s
<code>service</code> method.</p>
</div>
<div class="paragraph">
<p>In an HTTP servlet, the default <code>service</code> method routes requests to
another method based on the HTTP transfer method: <code>POST</code>, <code>GET</code>,
<code>DELETE</code>, <code>HEAD</code>, <code>OPTIONS</code>, <code>PUT</code>, or <code>TRACE</code>. For example, HTTP <code>POST</code>
requests are sent to the <code>doPost</code> method, HTTP <code>GET</code> requests are sent
to the <code>doGet</code> method, and so on. This enables the servlet to process
request data differently, depending on which transfer method is used.
Since the routing takes place in the service method, you generally do
not override <code>service</code> in an HTTP servlet. Instead, override <code>doGet</code>,
<code>doPost</code>, and so on, depending on the request type you expect.</p>
</div>
<div class="paragraph">
<p>To perform the tasks to answer a request, override the <code>service</code> method
for generic servlets, and the <code>doGet</code> or <code>doPost</code> methods for HTTP
servlets. Very often, this means accessing EJB components to perform
business transactions, then collating the information in the request
object or in a JDBC <code>ResultSet</code> object.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-javaserver-pages"><a class="anchor" href="#using-javaserver-pages"></a>Using JavaServer Pages</h3>
<div class="paragraph">
<p>The Eclipse GlassFish supports the following JSP features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JavaServer Pages (JSP) Specification</p>
</li>
<li>
<p>Precompilation of JSP files, which is especially useful for production
servers</p>
</li>
<li>
<p>JSP tag libraries and standard portable tags</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about creating JSP files, see the JavaServer Pages web
site at <code><a href="https://jakarta.ee/specifications/pages/" class="bare">https://jakarta.ee/specifications/pages/</a></code>.</p>
</div>
<div class="paragraph">
<p>This section describes how to use JavaServer Pages (JSP files) as page
templates in a Eclipse GlassFish web application.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#jsp-tag-libraries-and-standard-portable-tags">JSP Tag Libraries and Standard Portable Tags</a></p>
</li>
<li>
<p><a href="#jsp-caching">JSP Caching</a></p>
</li>
<li>
<p><a href="#options-for-compiling-jsp-files">Options for Compiling JSP Files</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="jsp-tag-libraries-and-standard-portable-tags"><a class="anchor" href="#jsp-tag-libraries-and-standard-portable-tags"></a>JSP Tag Libraries and Standard Portable Tags</h4>
<div class="paragraph">
<p>Eclipse GlassFish supports tag libraries and standard portable tags. For
more information, see the JavaServer Pages Standard Tag Library (JSTL)
page at <code><a href="https://jakarta.ee/specifications/tags/" class="bare">https://jakarta.ee/specifications/tags/</a></code>.</p>
</div>
<div class="paragraph">
<p>Web applications don&#8217;t need to bundle copies of the <code>jsf-impl.jar</code> or
<code>appserv-jstl.jar</code> JSP tag libraries (in as-install<code>/lib</code>) to use
JavaServer Faces technology or JSTL, respectively. These tag libraries
are automatically available to all web applications.</p>
</div>
<div class="paragraph">
<p>However, the as-install<code>/lib/jspcachtags.jar</code> tag library for JSP
caching is not automatically available to web applications. See
<a href="#jsp-caching">JSP Caching</a>, next.</p>
</div>
</div>
<div class="sect3">
<h4 id="jsp-caching"><a class="anchor" href="#jsp-caching"></a>JSP Caching</h4>
<div class="paragraph">
<p>JSP caching lets you cache tag invocation results within the Java
engine. Each can be cached using different cache criteria. For example,
suppose you have invocations to view stock quotes, weather information,
and so on. The stock quote result can be cached for 10 minutes, the
weather report result for 30 minutes, and so on.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#enabling-jsp-caching">Enabling JSP Caching</a></p>
</li>
<li>
<p><a href="#caching-scope">Caching Scope</a></p>
</li>
<li>
<p><a href="#the-cache-tag">The <code>cache</code> Tag</a></p>
</li>
<li>
<p><a href="#the-flush-tag">The <code>flush</code> Tag</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about response caching as it pertains to servlets,
see <a href="#caching-servlet-results">Caching Servlet Results</a>.</p>
</div>
<div class="sect4">
<h5 id="enabling-jsp-caching"><a class="anchor" href="#enabling-jsp-caching"></a>Enabling JSP Caching</h5>
<div class="paragraph">
<p>To globally enable JSP caching, set the <code>jspCachingEnabled</code> property to
<code>true</code>. The default is <code>false</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server-config.web-container.property.jspCachingEnabled=&quot;true&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin set</code> command, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>To enable JSP caching for a single web application, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extract the <code>META-INF/jspcachtags.tld</code> file from the
as-install<code>/modules/web-glue.jar</code> file.</p>
</li>
<li>
<p>Create a new JAR file (for example, <code>jspcachtags.jar</code>) containing
just the <code>META-INF/jspcachtags.tld</code> file previously extracted.</p>
</li>
<li>
<p>Bundle this new JAR file in the <code>WEB-INF/lib</code> directory of your web
application.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Web applications that use JSP caching without bundling the tag library
are not portable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Refer to Eclipse GlassFish tags in JSP files as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="error">&lt;</span>%@ taglib prefix=&quot;prefix&quot; uri=&quot;http://glassfish.org/taglibs/cache&quot; %<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Subsequently, the cache tags are available as <code>&lt;`prefix</code>:cache&gt;` and
<code>&lt;`prefix</code>:flush&gt;`. For example, if your prefix is <code>mypfx</code>, the cache
tags are available as <code>&lt;mypfx:cache&gt;</code> and <code>&lt;mypfx:flush&gt;</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="caching-scope"><a class="anchor" href="#caching-scope"></a>Caching Scope</h5>
<div class="paragraph">
<p>JSP caching is available in three different scopes: <code>request</code>,
<code>session</code>, and <code>application</code>. The default is <code>application</code>. To use a
cache in <code>request</code> scope, a web application must specify the
<code>com.sun.appserv.web.taglibs.cache.CacheRequestListener</code> in its
<code>web.xml</code> deployment descriptor, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;listener&gt;</span>
   <span class="tag">&lt;listener-class&gt;</span>
      com.sun.appserv.web.taglibs.cache.CacheRequestListener
   <span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Likewise, for a web application to utilize a cache in <code>session</code> scope,
it must specify the
<code>com.sun.appserv.web.taglibs.cache.CacheSessionListener</code> in its
<code>web.xml</code> deployment descriptor, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;listener&gt;</span>
   <span class="tag">&lt;listener-class&gt;</span>
      com.sun.appserv.web.taglibs.cache.CacheSessionListener
   <span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To utilize a cache in <code>application</code> scope, a web application need not
specify any listener. The
<code>com.sun.appserv.web.taglibs.cache.CacheContextListener</code> is already
specified in the <code>jspcachtags.tld</code> file.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-cache-tag"><a class="anchor" href="#the-cache-tag"></a>The <code>cache</code> Tag</h5>
<div class="paragraph">
<p>The cache tag caches the body between the beginning and ending tags
according to the attributes specified. The first time the tag is
encountered, the body content is executed and cached. Each subsequent
time it is run, the cached content is checked to see if it needs to be
refreshed and if so, it is executed again, and the cached data is
refreshed. Otherwise, the cached data is served.</p>
</div>
<div id="attributes-of-cache" class="paragraph">
<p>Attributes of <code>cache</code></p>
</div>
<div class="paragraph">
<p>The following table describes attributes for the <code>cache</code> tag.</p>
</div>
<div id="fvygg" class="paragraph">
<p>Table 7-1 The <code>cache</code> Attributes</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 16%;">
<col style="width: 74%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletPath`_`Suffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) The name used by the container
to access the cached entry. The cache key is suffixed to the servlet
path to generate a key to access the cached entry. If no key is
specified, a number is generated according to the position of the tag in
the page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) The time in seconds after which the body
of the tag is executed and the cache is refreshed. By default, this
value is interpreted in seconds. To specify a different unit of time,
add a suffix to the timeout value as follows: <code>s</code> for seconds, <code>m</code> for
minutes, <code>h</code> for hours, <code>d</code> for days. For example, <code>2h</code> specifies two
hours.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nocache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) If set to <code>true</code>, the body content is
executed and served as if there were no <code>cache</code> tag. This offers a way
to programmatically decide whether the cached response is sent or
whether the body has to be executed, though the response is not cached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>refresh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) If set to <code>true</code>, the body content is
executed and the response is cached again. This lets you
programmatically refresh the cache immediately regardless of the
<code>timeout</code> setting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) The scope of the cache. Can be
<code>request</code>, <code>session</code>, or <code>application</code>. See <a href="#caching-scope">Caching Scope</a>.</p></td>
</tr>
</tbody>
</table>
<div id="example-of-cache" class="paragraph">
<p>Example of <code>cache</code></p>
</div>
<div class="paragraph">
<p>The following example represents a cached JSP file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="error">&lt;</span>%@ taglib prefix=&quot;mypfx&quot; uri=&quot;http://glassfish.org/taglibs/cache&quot; %<span class="error">&gt;</span>
<span class="error">&lt;</span>%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %<span class="error">&gt;</span>
<span class="tag">&lt;mypfx:cache</span>                 <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${sessionScope.loginId}</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">nocache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${param.nocache}</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">refresh</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${param.refresh}</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10m</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;c:choose&gt;</span>
    <span class="tag">&lt;c:when</span> <span class="attribute-name">test</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${param.page == 'frontPage'}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="error">&lt;</span>%-- get headlines from database --%<span class="error">&gt;</span>
    <span class="tag">&lt;/c:when&gt;</span>
    <span class="tag">&lt;c:otherwise&gt;</span>
        ...
    <span class="tag">&lt;/c:otherwise&gt;</span>
<span class="tag">&lt;/c:choose&gt;</span>
<span class="tag">&lt;/mypfx:cache&gt;</span>
<span class="tag">&lt;mypfx:cache</span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1h</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;h2&gt;</span> Local News <span class="tag">&lt;/h2&gt;</span>
    <span class="error">&lt;</span>%-- get the headline news and cache them --%<span class="error">&gt;</span>
<span class="tag">&lt;/mypfx:cache&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-flush-tag"><a class="anchor" href="#the-flush-tag"></a>The <code>flush</code> Tag</h5>
<div class="paragraph">
<p>Forces the cache to be flushed. If a <code>key</code> is specified, only the entry
with that key is flushed. If no key is specified, the entire cache is
flushed.</p>
</div>
<div id="attributes-of-flush" class="paragraph">
<p>Attributes of <code>flush</code></p>
</div>
<div class="paragraph">
<p>The following table describes attributes for the <code>flush</code> tag.</p>
</div>
<div id="fvyep" class="paragraph">
<p>Table 7-2 The <code>flush</code> Attributes</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11%;">
<col style="width: 20%;">
<col style="width: 69%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletPath`_`Suffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) The name used by the container
to access the cached entry. The cache key is suffixed to the servlet
path to generate a key to access the cached entry. If no key is
specified, a number is generated according to the position of the tag in
the page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(optional) The scope of the cache. Can be
<code>request</code>, <code>session</code>, or <code>application</code>. See <a href="#caching-scope">Caching Scope</a>.</p></td>
</tr>
</tbody>
</table>
<div id="examples-of-flush" class="paragraph">
<p>Examples of <code>flush</code></p>
</div>
<div class="paragraph">
<p>To flush the entry with <code>key="foobar"</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mypfx:flush</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foobar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To flush the entire cache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;c:if</span> <span class="attribute-name">test</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${empty sessionScope.clearCache}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;mypfx:flush</span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/c:if&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="options-for-compiling-jsp-files"><a class="anchor" href="#options-for-compiling-jsp-files"></a>Options for Compiling JSP Files</h4>
<div class="paragraph">
<p>Eclipse GlassFish provides the following ways of compiling JSP source
files into servlets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JSP files are automatically compiled at runtime.</p>
</li>
<li>
<p>The <code>asadmin deploy</code> command has a <code>--precompilejsp</code> option. For
details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</li>
<li>
<p>The <code>jspc</code> command line tool allows you to precompile JSP files at the
command line. For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-and-managing-sessions"><a class="anchor" href="#creating-and-managing-sessions"></a>Creating and Managing Sessions</h3>
<div class="paragraph">
<p>This section describes how to create and manage HTTP sessions that
allows users and transaction information to persist between
interactions.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-sessions">Configuring Sessions</a></p>
</li>
<li>
<p><a href="#session-managers">Session Managers</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-sessions"><a class="anchor" href="#configuring-sessions"></a>Configuring Sessions</h4>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#http-sessions-cookies-and-url-rewriting">HTTP Sessions, Cookies, and URL Rewriting</a></p>
</li>
<li>
<p><a href="#coordinating-session-access">Coordinating Session Access</a></p>
</li>
<li>
<p><a href="#saving-sessions-during-redeployment">Saving Sessions During Redeployment</a></p>
</li>
<li>
<p><a href="#logging-session-attributes">Logging Session Attributes</a></p>
</li>
<li>
<p><a href="#distributed-sessions-and-persistence">Distributed Sessions and Persistence</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="http-sessions-cookies-and-url-rewriting"><a class="anchor" href="#http-sessions-cookies-and-url-rewriting"></a>HTTP Sessions, Cookies, and URL Rewriting</h5>
<div class="paragraph">
<p>To configure whether and how HTTP sessions use cookies and URL
rewriting, edit the <code>session-properties</code> and <code>cookie-properties</code>
elements in the <code>glassfish-web.xml</code> file for an individual web
application. For more about the properties you can configure, see
"<a href="application-deployment-guide.html#session-properties">session-properties</a>" in Eclipse GlassFish Application Deployment Guide and
"<a href="application-deployment-guide.html#cookie-properties">cookie-properties</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>For information about configuring default session properties for the
entire web container, see <a href="#GSDVG00410">Using the <code>default-web.xml</code> File</a>
and the <a href="ha-administration-guide.html#GSHAG">Eclipse GlassFish High
Availability Administration Guide</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="coordinating-session-access"><a class="anchor" href="#coordinating-session-access"></a>Coordinating Session Access</h5>
<div class="paragraph">
<p>Make sure that multiple threads don&#8217;t simultaneously modify the same
session object in conflicting ways. If the persistence type is
<code>replicated</code> (see <a href="#the-replicated-persistence-type">The <code>replicated</code> Persistence Type</a>), the
following message in the log file indicates that this might be
happening:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Primary Key Constraint violation while saving session session_id</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is especially likely to occur in web applications that use HTML
frames where multiple servlets are executing simultaneously on behalf of
the same client. A good solution is to ensure that one of the servlets
modifies the session and the others have read-only access.</p>
</div>
</div>
<div class="sect4">
<h5 id="saving-sessions-during-redeployment"><a class="anchor" href="#saving-sessions-during-redeployment"></a>Saving Sessions During Redeployment</h5>
<div class="paragraph">
<p>Whenever a redeployment is done, the sessions at that transit time
become invalid unless you use the <code>--keepstate=true</code> option of the
<code>asadmin redeploy</code> command. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin redeploy --keepstate=true --name hello.war</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>The default for <code>--keepstate</code> is false. This option is supported only on
the default server instance, named <code>server</code>. It is not supported and
ignored for any other target.</p>
</div>
<div class="paragraph">
<p>For web applications, this feature is applicable only if in the
<code>glassfish-web-app.xml</code> file the <code>persistence-type</code> attribute of the
<code>session-manager</code> element is <code>file</code>.</p>
</div>
<div class="paragraph">
<p>If any active web session fails to be preserved or restored, none of the
sessions will be available when the redeployment is complete. However,
the redeployment continues and a warning is logged.</p>
</div>
<div class="paragraph">
<p>The new class loader of the redeployed application is used to
deserialize any sessions previously saved. The usual restrictions about
serialization and deserialization apply. For example, any
application-specific class referenced by a session attribute may evolve
only in a backward-compatible fashion. For more information about class
loaders, see <a href="#class-loaders">Class Loaders</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="logging-session-attributes"><a class="anchor" href="#logging-session-attributes"></a>Logging Session Attributes</h5>
<div class="paragraph">
<p>You can write session attribute values to an access log. The access log
format token <code>%session.</code>name<code>%</code> logs one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The value of the session attribute with the name name</p>
</li>
<li>
<p><code>NULL-SESSION-ATTRIBUTE-</code>name if the named attribute does not exist in the session</p>
</li>
<li>
<p><code>NULL-SESSION</code> if no session exists</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about access logging and format tokens, see online
help for the Access Log tab of the HTTP Service page in the
Administration Console.</p>
</div>
</div>
<div class="sect4">
<h5 id="distributed-sessions-and-persistence"><a class="anchor" href="#distributed-sessions-and-persistence"></a>Distributed Sessions and Persistence</h5>
<div class="paragraph">
<p>A distributed HTTP session can run in multiple Eclipse GlassFish
instances, provided the following criteria are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each server instance has the same distributable web application
deployed to it. The <code>web-app</code> element of the <code>web.xml</code> deployment
descriptor file must have the <code>distributable</code> subelement specified.</p>
</li>
<li>
<p>The web application uses high-availability session persistence. If a
non-distributable web application is configured to use high-availability
session persistence, a warning is written to the server log, and the
session persistence type reverts to <code>memory</code>. See <a href="#the-replicated-persistence-type">The
<code>replicated</code> Persistence Type</a>.</p>
</li>
<li>
<p>All objects bound into a distributed session must be of the types
listed in <a href="#fvyem">Table 7-3</a>.</p>
</li>
<li>
<p>The web application must be deployed using the <code>deploy</code> or <code>deploydir</code>
command with the <code>--availabilityenabled</code> option set to <code>true</code>. See the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Contrary to the Servlet 5.0 specification, Eclipse GlassFish does not
throw an <code>IllegalArgumentException</code> if an object type not supported for
failover is bound into a distributed session.</p>
</div>
<div class="paragraph">
<p>Keep the distributed session size as small as possible. Session size has
a direct impact on overall system throughput.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the event of an instance or hardware failure, another server instance
can take over a distributed session, with the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a distributable web application references a Jakarta EE component or
resource, the reference might be lost. See <a href="#fvyem">Table 7-3</a> for a
list of the types of references that <code>HTTPSession</code> failover supports.</p>
</li>
<li>
<p>References to open files or network connections are lost.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about how to work around these limitations, see the
<a href="deployment-planning-guide.html#GSPLG">Eclipse GlassFish Deployment Planning
Guide</a>.</p>
</div>
<div class="paragraph">
<p>In the following table, No indicates that failover for the object type
might not work in all cases and that no failover support is provided.
However, failover might work in some cases for that object type. For
example, failover might work because the class implementing that type is
serializable.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>InitialContext</code>, see
<a href="#accessing-the-naming-context">Accessing the Naming Context</a>. For more information
about transaction recovery, see <a href="#using-the-transaction-service">Using
the Transaction Service</a>. For more information about Administered
Objects, see "<a href="administration-guide.html#administering-jms-physical-destinations">Administering JMS Physical Destinations</a>"
in Eclipse GlassFish Administration Guide.</p>
</div>
<div id="fvyem" class="paragraph">
<p>Table 7-3 Object Types Supported for Jakarta EE Web Application Session State Failover</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 45%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java Object Type</th>
<th class="tableblock halign-left valign-top">Failover Support</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Colocated or distributed stateless session, stateful session, or entity
bean reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JNDI context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, <code>InitialContext</code> and <code>java:comp/env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UserTransaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, but if the instance that fails is never
restarted, any prepared global transactions are lost and might not be
correctly rolled back or committed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC DataSource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Message Service (JMS) ConnectionFactory, Destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jakarta Mail Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection Factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administered Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web service reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializable Java types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended persistence context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="session-managers"><a class="anchor" href="#session-managers"></a>Session Managers</h4>
<div class="paragraph">
<p>A session manager automatically creates new session objects whenever a
new session starts. In some circumstances, clients do not join the
session, for example, if the session manager uses cookies and the client
does not accept cookies.</p>
</div>
<div class="paragraph">
<p>Eclipse GlassFish offers these session management options, determined by
the <code>session-manager</code> element&#8217;s <code>persistence-type</code> attribute in the
<code>glassfish-web.xml</code> file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-memory-persistence-type">The <code>memory</code> Persistence Type</a>, the default</p>
</li>
<li>
<p><a href="#the-file-persistence-type">The <code>file</code> Persistence Type</a>, which uses a file to store
session data</p>
</li>
<li>
<p><a href="#the-replicated-persistence-type">The <code>replicated</code> Persistence Type</a>, which uses other
servers in the cluster for session persistence</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the session manager configuration contains an error, the error is
written to the server log and the default (<code>memory</code>) configuration is
used.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information, see "<a href="application-deployment-guide.html#session-manager">session-manager</a>" in
Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="sect4">
<h5 id="the-memory-persistence-type"><a class="anchor" href="#the-memory-persistence-type"></a>The <code>memory</code> Persistence Type</h5>
<div class="paragraph">
<p>This persistence type is not designed for a production environment that
requires session persistence. It provides no session persistence.
However, you can configure it so that the session state in memory is
written to the file system prior to server shutdown.</p>
</div>
<div class="paragraph">
<p>To specify the <code>memory</code> persistence type for a specific web application,
edit the <code>glassfish-web.xml</code> file as in the following example. The
<code>persistence-type</code> attribute is optional, but must be set to <code>memory</code> if
included. This overrides the web container availability settings for the
web application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-web-app&gt;</span>
...

<span class="tag">&lt;session-config&gt;</span>
    <span class="tag">&lt;session-manager</span> <span class="attribute-name">persistence-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memory</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;manager-properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFilename</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionstate</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/manager-properties&gt;</span>
    <span class="tag">&lt;/session-manager&gt;</span>
    ...
<span class="tag">&lt;/session-config&gt;</span>
...
<span class="tag">&lt;/glassfish-web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The only manager property that the <code>memory</code> persistence type supports is
<code>sessionFilename</code>, which is listed under
"<a href="application-deployment-guide.html#manager-properties">manager-properties</a>" in Eclipse GlassFish Application Deployment Guide. The <code>sessionFilename</code> property
specifies the name of the file where sessions are serialized and
persisted if the web application or the server is stopped. To disable
this behavior, specify an empty string as the value of
<code>sessionFilename</code>. The default value is an empty string.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>glassfish-web.xml</code> file, see the
<a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment
Guide</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-file-persistence-type"><a class="anchor" href="#the-file-persistence-type"></a>The <code>file</code> Persistence Type</h5>
<div class="paragraph">
<p>This persistence type provides session persistence to the local file
system, and allows a single server domain to recover the session state
after a failure and restart. The session state is persisted in the
background, and the rate at which this occurs is configurable. The store
also provides passivation and activation of the session state to help
control the amount of memory used. This option is not supported in a
production environment. However, it is useful for a development system
with a single server instance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure the <code>delete</code> option is set in the <code>server.policy</code> file, or
expired file-based sessions might not be deleted properly. For more
information about <code>server.policy</code>, see <a href="#GSDVG00121">The
<code>server.policy</code> File</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To specify the <code>file</code> persistence type for a specific web application,
edit the <code>glassfish-web.xml</code> file as in the following example. Note that
<code>persistence-type</code> must be set to <code>file</code>. This overrides the web
container availability settings for the web application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-web-app&gt;</span>
...
<span class="tag">&lt;session-config&gt;</span>
    <span class="tag">&lt;session-manager</span> <span class="attribute-name">persistence-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;store-properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">directory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessiondir</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/store-properties&gt;</span>
    <span class="tag">&lt;/session-manager&gt;</span>
    ...
<span class="tag">&lt;/session-config&gt;</span>
...
<span class="tag">&lt;/glassfish-web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>file</code> persistence type supports all the manager properties listed
under "<a href="application-deployment-guide.html#manager-properties">manager-properties</a>" in Eclipse GlassFish Application Deployment Guide except <code>sessionFilename</code>,
and supports the <code>directory</code> store property listed under
"<a href="application-deployment-guide.html#store-properties">store-properties</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>glassfish-web.xml</code> file, see the
<a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment
Guide</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-replicated-persistence-type"><a class="anchor" href="#the-replicated-persistence-type"></a>The <code>replicated</code> Persistence Type</h5>
<div class="paragraph">
<p>The replicated persistence type uses other servers in the cluster for
session persistence. Clustered server instances replicate session state.
Each backup instance stores the replicated data in memory. This allows
sessions to be distributed. For details, see <a href="#distributed-sessions-and-persistence">Distributed
Sessions and Persistence</a>. In addition, you can configure the frequency
and scope of session persistence. The other servers are also used as the
passivation and activation store. Use this option in a production
environment that requires session persistence.</p>
</div>
<div class="paragraph">
<p>To use the replicated persistence type, you must enable availability.
Select the Availability Service component under the relevant
configuration in the Administration Console. Check the Availability
Service box. To enable availability for the web container, select the
Web Container Availability tab, then check the Availability Service box.
All instances in an Eclipse GlassFish cluster should have the same
availability settings to ensure consistent behavior. For details, see
the <a href="ha-administration-guide.html#GSHAG">Eclipse GlassFish High Availability
Administration Guide</a>.</p>
</div>
<div class="paragraph">
<p>To change settings such as persistence frequency and persistence scope
for the entire web container, use the Persistence Frequency and
Persistence Scope drop-down lists on the Web Container Availability tab
in the Administration Console, or use the <code>asadmin set</code> command. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set
server-config.availability-service.web-container-availability.persistence-frequency=time-based</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the description of the <code>asadmin set</code> command
in the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference
Manual</a>.</p>
</div>
<div class="paragraph">
<p>To specify the <code>replicated</code> persistence type for a specific web
application, edit the <code>glassfish-web.xml</code> file as in the following
example. Note that <code>persistence-type</code> must be set to <code>replicated</code>. This
overrides the web container availability settings for the web
application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-web-app&gt;</span>
...
<span class="tag">&lt;session-config&gt;</span>
    <span class="tag">&lt;session-manager</span> <span class="attribute-name">persistence-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicated</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;manager-properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistenceFrequency</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">web-method</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/manager-properties&gt;</span>
        <span class="tag">&lt;store-properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistenceScope</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/store-properties&gt;</span>
    <span class="tag">&lt;/session-manager&gt;</span>
    ...
<span class="tag">&lt;/session-config&gt;</span>
...
<span class="tag">&lt;/glassfish-web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>replicated</code> persistence type supports all the manager properties
listed under "<a href="application-deployment-guide.html#manager-properties">manager-properties</a>" in Eclipse GlassFish Application Deployment Guide except
<code>sessionFilename</code>, and supports the <code>persistenceScope</code> store property
listed under "<a href="application-deployment-guide.html#store-properties">store-properties</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>glassfish-web.xml</code> file, see the
<a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment
Guide</a>.</p>
</div>
<div class="paragraph">
<p>To specify that web sessions for which high availability is enabled are
first buffered and then replicated using a separate asynchronous thread,
use the <code>--asyncreplication=true</code> option of the <code>asadmin deploy</code>
command. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin deploy --availabilityenabled=true --asyncreplication=true --name hello.war</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>--asyncreplication</code> is set to true (the default), performance is
improved but availability is reduced. If the instance where states are
buffered but not yet replicated fails, the states are lost. If set to
false, performance is reduced but availability is guaranteed. States are
not buffered but immediately transmitted to other instances in the
cluster.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-comet"><a class="anchor" href="#using-comet"></a>Using Comet</h3>
<div class="paragraph">
<p>This section explains the Comet programming technique and how to create
and deploy a Comet-enabled application with the Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#introduction-to-comet">Introduction to Comet</a></p>
</li>
<li>
<p><a href="#grizzly-comet">Grizzly Comet</a></p>
</li>
<li>
<p><a href="#bayeux-protocol">Bayeux Protocol</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="introduction-to-comet"><a class="anchor" href="#introduction-to-comet"></a>Introduction to Comet</h4>
<div class="paragraph">
<p>Comet is a programming technique that allows a web server to send
updates to clients without requiring the clients to explicitly request
them.</p>
</div>
<div class="paragraph">
<p>This kind of programming technique is called server push, which means
that the server pushes data to the client. The opposite style is client
pull, which means that the client must pull the data from the server,
usually through a user-initiated event, such as a button click.</p>
</div>
<div class="paragraph">
<p>Web applications that use the Comet technique can deliver updates to
clients in a more timely manner than those that use the client-pull
style while avoiding the latency that results from clients frequently
polling the server.</p>
</div>
<div class="paragraph">
<p>One of the many use cases for Comet is a chat room application. When the
server receives a message from one of the chat clients, it needs to send
the message to the other clients without requiring them to ask for it.
With Comet, the server can deliver messages to the clients as they are
posted rather than expecting the clients to poll the server for new
messages.</p>
</div>
<div class="paragraph">
<p>To accomplish this scenario, a Comet application establishes a
long-lived HTTP connection. This connection is suspended on the server
side, waiting for an event to happen before resuming. This kind of
connection remains open, allowing an application that uses the Comet
technique to send updates to clients when they are available rather than
expecting clients to reopen the connection to poll the server for
updates.</p>
</div>
<div class="sect4">
<h5 id="the-grizzly-implementation-of-comet"><a class="anchor" href="#the-grizzly-implementation-of-comet"></a>The Grizzly Implementation of Comet</h5>
<div class="paragraph">
<p>A limitation of the Comet technique is that you must use it with a web
server that supports non-blocking connections to avoid poor performance.
Non-blocking connections are those that do not need to allocate one
thread for each request. If the web server were to use blocking
connections then it might end up holding many thousands of threads,
thereby hindering its scalability.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish includes the Grizzly HTTP Engine, which enables
asynchronous request processing (ARP) by avoiding blocking connections.
Grizzly&#8217;s ARP implementation accomplishes this by using the Java NIO
API.</p>
</div>
<div class="paragraph">
<p>With Java NIO, Grizzly enables greater performance and scalability by
avoiding the limitations experienced by traditional web servers that
must run a thread for each request. Instead, Grizzly&#8217;s ARP mechanism
makes efficient use of a thread pool system and also keeps the state of
requests so that it can keep requests alive without holding a single
thread for each of them.</p>
</div>
<div class="paragraph">
<p>Grizzly supports two different implementations of Comet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#grizzly-comet">Grizzly Comet</a> — Based on ARP, this includes a set of APIs
that you use from a web component to enable Comet functionality in your
web application. Grizzly Comet is specific to the Eclipse GlassFish.</p>
</li>
<li>
<p><a href="#bayeux-protocol">Bayeux Protocol</a> — Often referred to as <code>Cometd</code>, it
consists of the JSON-based Bayeux message protocol, a set of Dojo or
Ajax libraries, and an event handler. The Bayeux protocol uses a
publish/subscribe model for server/client communication. The Bayeux
protocol is portable, but it is container dependent if you want to
invoke it from an Enterprise Java Beans (EJB ) component. The Grizzly
implementation of <code>Cometd</code> consists of a servlet that you reference from
your web application.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="client-technologies-to-use-with-comet"><a class="anchor" href="#client-technologies-to-use-with-comet"></a>Client Technologies to Use With Comet</h5>
<div class="paragraph">
<p>In addition to creating a web component that uses the Comet APIs, you
need to enable your client to accept asynchronous updates from the web
component. To accomplish this, you can use JavaScript, IFrames, or a
framework, such as <a href="http://dojotoolkit.org">Dojo</a>
(<code><a href="http://dojotoolkit.org" class="bare">http://dojotoolkit.org</a></code>).</p>
</div>
<div class="paragraph">
<p>An IFrame is an HTML element that allows you to include other content in
an HTML page. As a result, the client can embed updated content in the
IFrame without having to reload the page.</p>
</div>
<div class="paragraph">
<p>The example in this tutorial employs a combination of JavaScript and
IFrames to allow the client to accept asynchronous updates. A servlet
included in the example writes out JavaScript code to one of the
IFrames. The JavaScript code contains the updated content and invokes a
function in the page that updates the appropriate elements in the page
with the new content.</p>
</div>
<div class="paragraph">
<p>The next section explains the two kinds of connections that you can make
to the server. While you can use any of the client technologies listed
in this section with either kind of connection, it is more difficult to
use JavaScript with an HTTP-streaming connection.</p>
</div>
</div>
<div class="sect4">
<h5 id="types-of-comet-connections"><a class="anchor" href="#types-of-comet-connections"></a>Types of Comet Connections</h5>
<div class="paragraph">
<p>When working with Comet, as implemented in Grizzly, you have two
different ways to handle client connections to the server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP Streaming</p>
</li>
<li>
<p>Long Polling</p>
</li>
</ul>
</div>
<div id="http-streaming" class="paragraph">
<p>HTTP Streaming</p>
</div>
<div class="paragraph">
<p>The HTTP Streaming technique keeps a connection open indefinitely. It
never closes, even after the server pushes data to the client.</p>
</div>
<div class="paragraph">
<p>In the case of HTTP streaming, the application sends a single request
and receives responses as they come, reusing the same connection
forever. This technique significantly reduces the network latency
because the client and the server don&#8217;t need to open and close the
connection.</p>
</div>
<div class="paragraph">
<p>The basic life cycle of an application using HTTP-streaming is:</p>
</div>
<div class="paragraph">
<p>request &gt; suspend &gt; data available &gt; write response &gt; data available &gt;
write response</p>
</div>
<div class="paragraph">
<p>The client makes an initial request and then suspends the request,
meaning that it waits for a response. Whenever data is available, the
server writes it to the response.</p>
</div>
<div id="long-polling" class="paragraph">
<p>Long Polling</p>
</div>
<div class="paragraph">
<p>The long-polling technique is a combination of server-push and
client-pull because the client needs to resume the connection after a
certain amount of time or after the server pushes an update to the
client.</p>
</div>
<div class="paragraph">
<p>The basic life cycle of an application using long-polling is:</p>
</div>
<div class="paragraph">
<p>request &gt; suspend &gt; data available &gt; write response &gt; resume</p>
</div>
<div class="paragraph">
<p>The client makes an initial request and then suspends the request. When
an update is available, the server writes it to the response. The
connection closes, and the client optionally resumes the connection.</p>
</div>
<div id="how-to-choose-the-type-of-connection" class="paragraph">
<p>How to Choose the Type of Connection</p>
</div>
<div class="paragraph">
<p>If you anticipate that your web application will need to send frequent
updates to the client, you should use the HTTP-streaming connection so
that the client does not have to frequently reestablish a connection. If
you anticipate less frequent updates, you should use the long-polling
connection so that the web server does not need to keep a connection
open when no updates are occurring. One caveat to using the
HTTP-streaming connection is that if you are streaming through a proxy,
the proxy can buffer the response from the server. So, be sure to test
your application if you plan to use HTTP-streaming behind a proxy.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="grizzly-comet"><a class="anchor" href="#grizzly-comet"></a>Grizzly Comet</h4>
<div class="paragraph">
<p>For details on using Grizzly Comet including a sample application, refer
to the <a href="https://eclipse-ee4j.github.io/grizzly/comet.html">Grizzly Comet documentation</a>.</p>
</div>
<div class="paragraph">
<p>Grizzly&#8217;s support for Comet includes a small set of APIs that make it
easy to add Comet functionality to your web applications. The Grizzly
Comet APIs that developers use most often are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CometContext</code>: A Comet context, which is a shareable space to which
applications subscribe to receive updates.</p>
</li>
<li>
<p><code>CometEngine</code>: The entry point to any component using Comet.
Components can be servlets, JavaServer Pages ( JSP), JavaServer Faces
components, or pure Java classes.</p>
</li>
<li>
<p><code>CometEvent</code>: Contains the state of the <code>CometContext</code> object</p>
</li>
<li>
<p><code>CometHandler</code>: The interface an application implements to be part of
one or more Comet contexts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The way a developer would use this API in a web component is to perform
the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register the context path of the application with the <code>CometContext</code>
object:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CometEngine cometEngine = CometEngine.getEngine();
CometContext cometContext = cometEngine.register(contextPath)</code></pre>
</div>
</div>
</li>
<li>
<p>Register the CometHandler implementation with the <code>CometContext</code>
object:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cometContext.addCometHandler(handler)</code></pre>
</div>
</div>
</li>
<li>
<p>Notify one or more CometHandler implementations when an event
happens:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cometContext.notify((<span class="predefined-type">Object</span>)(handler))</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="bayeux-protocol"><a class="anchor" href="#bayeux-protocol"></a>Bayeux Protocol</h4>
<div class="paragraph">
<p>The Bayeux protocol, often referred to as <code>Cometd</code>, greatly simplifies
the use of Comet. No server-side coding is needed for servers such as
Eclipse GlassFish that support the Bayeux protocol. Just enable Comet and
the Bayeux protocol, then write and deploy the client.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#enabling-comet">Enabling Comet</a></p>
</li>
<li>
<p><a href="#GSDVG00067">To Configure the <code>web.xml</code> File</a></p>
</li>
<li>
<p><a href="#to-write-deploy-and-run-the-client">To Write, Deploy, and Run the Client</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="enabling-comet"><a class="anchor" href="#enabling-comet"></a>Enabling Comet</h5>
<div class="paragraph">
<p>Before running a Comet-enabled application, you need to enable Comet in
the HTTP listener for your application by setting a special attribute in
the associated protocol configuration. The following example shows the
<code>asadmin set</code> command that adds this attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server-config.network-config.protocols.protocol.http-1.http.comet-support-enabled=&quot;true&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Substitute the name of the protocol for <code>http-1</code>.</p>
</div>
<div class="paragraph">
<p><a id="GSDVG00067"></a><a id="to-configure-the-web.xml-file"></a></p>
</div>
</div>
<div class="sect4">
<h5 id="to-configure-the-web-xml-file"><a class="anchor" href="#to-configure-the-web-xml-file"></a>To Configure the <code>web.xml</code> File</h5>
<div class="paragraph">
<p>To enable the Bayeux protocol on the Eclipse GlassFish, you must
reference the <code>CometdServlet</code> in your web application&#8217;s <code>web.xml</code> file.
In addition, if your web application includes a servlet, set the
<code>load-on-startup</code> value for your servlet to <code>0</code> (zero) so that it will
not load until the client makes a request to it.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <code>web.xml</code> file for your web application in a text editor.</p>
</li>
<li>
<p>Add the following XML code to the <code>web.xml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
   <span class="tag">&lt;servlet-name&gt;</span>Grizzly Cometd Servlet<span class="tag">&lt;/servlet-name&gt;</span>
   <span class="tag">&lt;servlet-class&gt;</span>
      com.sun.grizzly.cometd.servlet.CometdServlet
   <span class="tag">&lt;/servlet-class&gt;</span>
   <span class="tag">&lt;init-param&gt;</span>
      <span class="tag">&lt;description&gt;</span>
         expirationDelay is the long delay before a request is
         resumed. -1 means never.
      <span class="tag">&lt;/description&gt;</span>
      <span class="tag">&lt;param-name&gt;</span>expirationDelay<span class="tag">&lt;/param-name&gt;</span>
      <span class="tag">&lt;param-value&gt;</span>-1<span class="tag">&lt;/param-value&gt;</span>
   <span class="tag">&lt;/init-param&gt;</span>
   <span class="tag">&lt;load-on-startup&gt;</span>1<span class="tag">&lt;/load-on-startup&gt;</span>
<span class="tag">&lt;/servlet&gt;</span>
<span class="tag">&lt;servlet-mapping&gt;</span>
   <span class="tag">&lt;servlet-name&gt;</span>Grizzly Cometd Servlet<span class="tag">&lt;/servlet-name&gt;</span>
   <span class="tag">&lt;url-pattern&gt;</span>/cometd/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>load-on-startup</code> value for the <code>CometdServlet</code> is <code>1</code>.</p>
</div>
</li>
<li>
<p>If your web application includes a servlet, set the
<code>load-on-startup</code> value to <code>0</code> for your servlet (not the
<code>CometdServlet</code>) as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
   ...
   <span class="tag">&lt;load-on-startup&gt;</span>0<span class="tag">&lt;/load-on-startup&gt;</span>
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Save the <code>web.xml</code> file.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-write-deploy-and-run-the-client"><a class="anchor" href="#to-write-deploy-and-run-the-client"></a>To Write, Deploy, and Run the Client</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add script tags to the HTML page. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">chat.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>In the script, call the needed libraries. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>dojo.require(&quot;dojo.io.cometd&quot;);</code></pre>
</div>
</div>
</li>
<li>
<p>In the script, use <code>publish</code> and <code>subscribe</code> methods to send and
receive messages. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cometd.subscribe(&quot;/chat/demo&quot;, false, room, &quot;_chat&quot;);
cometd.publish(&quot;/chat/demo&quot;, { user: room._username, chat: text});</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the web application as you would any other web application.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin deploy cometd-example.war</code></pre>
</div>
</div>
</li>
<li>
<p>Run the application as you would any other web application.</p>
<div class="paragraph">
<p>The context root for the example chat application is <code>/cometd</code> and the
HTML page is <code>index.html</code>. So the URL might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:8080/cometd/index.html</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>See Also</p>
</div>
<div class="paragraph">
<p>For more information about deployment in the Eclipse GlassFish, see the
<a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment
Guide</a>.</p>
</div>
<div class="paragraph">
<p>For more information about the Bayeux protocol, see
<a href="https://docs.cometd.org/current/reference/#_bayeux">Bayeux Protocol</a>
(<code><a href="https://docs.cometd.org/current/reference/#_bayeux" class="bare">https://docs.cometd.org/current/reference/#_bayeux</a></code>).</p>
</div>
<div class="paragraph">
<p>For more information about the Dojo toolkit, see
<code><a href="http://dojotoolkit.org/" class="bare">http://dojotoolkit.org/</a></code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-web-application-features"><a class="anchor" href="#advanced-web-application-features"></a>Advanced Web Application Features</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#internationalization-issues">Internationalization Issues</a></p>
</li>
<li>
<p><a href="#virtual-server-properties">Virtual Server Properties</a></p>
</li>
<li>
<p><a href="#class-loader-delegation">Class Loader Delegation</a></p>
</li>
<li>
<p><a href="#GSDVG00410">Using the <code>default-web.xml</code> File</a></p>
</li>
<li>
<p><a href="#configuring-logging-and-monitoring-in-the-web-container">Configuring Logging and Monitoring in the Web Container</a></p>
</li>
<li>
<p><a href="#configuring-idempotent-url-requests">Configuring Idempotent URL Requests</a></p>
</li>
<li>
<p><a href="#header-management">Header Management</a></p>
</li>
<li>
<p><a href="#configuring-valves-and-catalina-listeners">Configuring Valves and Catalina Listeners</a></p>
</li>
<li>
<p><a href="#alternate-document-roots">Alternate Document Roots</a></p>
</li>
<li>
<p><a href="#GSDVG00416">Using a context.xml File</a></p>
</li>
<li>
<p><a href="#enabling-webdav">Enabling WebDav</a></p>
</li>
<li>
<p><a href="#using-ssi">Using SSI</a></p>
</li>
<li>
<p><a href="#using-cgi">Using CGI</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="internationalization-issues"><a class="anchor" href="#internationalization-issues"></a>Internationalization Issues</h4>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-servers-default-locale">The Server&#8217;s Default Locale</a></p>
</li>
<li>
<p><a href="#servlet-character-encoding">Servlet Character Encoding</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="the-servers-default-locale"><a class="anchor" href="#the-servers-default-locale"></a>The Server&#8217;s Default Locale</h5>
<div class="paragraph">
<p>To set the default locale of the entire Eclipse GlassFish, which
determines the locale of the Administration Console, the logs, and so
on, use the Administration Console. Select the domain component. Then
type a value in the Locale field. For details, click the Help button in
the Administration Console.</p>
</div>
</div>
<div class="sect4">
<h5 id="servlet-character-encoding"><a class="anchor" href="#servlet-character-encoding"></a>Servlet Character Encoding</h5>
<div class="paragraph">
<p>This section explains how the Eclipse GlassFish determines the character
encoding for the servlet request and the servlet response. For encodings
you can use, see
<code><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/intl/encoding.doc.html" class="bare">http://docs.oracle.com/javase/8/docs/technotes/guides/intl/encoding.doc.html</a></code>.</p>
</div>
<div id="servlet-request" class="paragraph">
<p>Servlet Request</p>
</div>
<div class="paragraph">
<p>When processing a servlet request, the server uses the following order
of precedence, first to last, to determine the request character
encoding:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>getCharacterEncoding</code> method</p>
</li>
<li>
<p>A hidden field in the form, specified by the <code>form-hint-field</code>
attribute of the <code>parameter-encoding</code> element in the <code>glassfish-web.xml</code>
file</p>
</li>
<li>
<p>The <code>default-charset</code> attribute of the <code>parameter-encoding</code> element in
the <code>glassfish-web.xml</code> file</p>
</li>
<li>
<p>The default, which is <code>ISO-8859-1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For details about the <code>parameter-encoding</code> element, see
"<a href="application-deployment-guide.html#parameter-encoding">parameter-encoding</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div id="servlet-response" class="paragraph">
<p>Servlet Response</p>
</div>
<div class="paragraph">
<p>When processing a servlet response, the server uses the following order
of precedence, first to last, to determine the response character
encoding:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>setCharacterEncoding</code> or <code>setContentType</code> method</p>
</li>
<li>
<p>The <code>setLocale</code> method</p>
</li>
<li>
<p>The default, which is <code>ISO-8859-1</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="virtual-server-properties"><a class="anchor" href="#virtual-server-properties"></a>Virtual Server Properties</h4>
<div class="paragraph">
<p>You can set virtual server properties in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can define virtual server properties using the
<code>asadmin create-virtual-server</code> command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-virtual-server --hosts localhost --property authRealm=ldap MyVS</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details and a complete list of virtual server properties, see
<a href="reference-manual.html#create-virtual-server"><code>create-virtual-server</code>(1)</a>.</p>
</div>
</li>
<li>
<p>You can define virtual server properties using the <code>asadmin set</code>
command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server-config.http-service.virtual-server.MyVS.property.authRealm=&quot;ldap&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details, see <a href="reference-manual.html#set"><code>set</code>(1)</a>.</p>
</div>
</li>
<li>
<p>You can define virtual server properties using the Administration
Console. Select the HTTP Service component under the relevant
configuration, select Virtual Servers, and select the desired virtual
server. Select Add Property, enter the property name and value, check
the enable box, and select Save. For details and a complete list of
virtual server properties, click the Help button in the Administration
Console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some virtual server properties can be set for a specific web
application. For details, see "<a href="application-deployment-guide.html#glassfish-web-app">glassfish-web-app</a>" in
Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="class-loader-delegation"><a class="anchor" href="#class-loader-delegation"></a>Class Loader Delegation</h4>
<div class="paragraph">
<p>The Servlet specification recommends that a web application class loader
look in the local class loader before delegating to its parent. To make
the web application class loader follow the delegation model in the
Servlet specification, set <code>delegate="false"</code> in the <code>class-loader</code>
element of the <code>glassfish-web.xml</code> file. It&#8217;s safe to do this only for a
web module that does not interact with any other modules.</p>
</div>
<div class="paragraph">
<p>The default value is <code>delegate="true"</code>, which causes the web application
class loader to delegate in the same manner as the other class loaders.
Use <code>delegate="true"</code> for a web application that accesses EJB components
or that acts as a web service client or endpoint. For details about
<code>glassfish-web.xml</code>, see the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment Guide</a>.</p>
</div>
<div class="paragraph">
<p>For a number of packages, including <code>java.<strong></code> and <code>javax.</strong></code>, symbol
resolution is always delegated to the parent class loader regardless of
the <code>delegate</code> setting. This prevents applications from overriding core
Java runtime classes or changing the API versions of specifications that
are part of the Jakarta EE platform.</p>
</div>
<div class="paragraph">
<p>For general information about class loaders, see
<a href="#class-loaders">Class Loaders</a>.</p>
</div>
<div class="paragraph">
<p><a id="GSDVG00410"></a><a id="using-the-default-web.xml-file"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-default-web-xml-file"><a class="anchor" href="#using-the-default-web-xml-file"></a>Using the <code>default-web.xml</code> File</h4>
<div class="paragraph">
<p>You can use the <code>default-web.xml</code> file to define features such as
filters and security constraints that apply to all web applications.</p>
</div>
<div class="paragraph">
<p>For example, directory listings are disabled by default for added
security. To enable directory listings, in your domain&#8217;s
<code>default-web.xml</code> file, search for the definition of the servlet whose
<code>servlet-name</code> is equal to <code>default</code>, and set the value of the
<code>init-param</code> named <code>listings</code> to <code>true</code>. Then redeploy your web
application if it has already been deployed, or restart the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;init-param&gt;</span>
   <span class="tag">&lt;param-name&gt;</span>listings<span class="tag">&lt;/param-name&gt;</span>
   <span class="tag">&lt;param-value&gt;</span>true<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/init-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>listings</code> is set to <code>true</code>, you can also determine how directory
listings are sorted. Set the value of the <code>init-param</code> named <code>sortedBy</code>
to <code>NAME</code>, <code>SIZE</code>, or <code>LAST_MODIFIED</code>. Then redeploy your web
application if it has already been deployed, or restart the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;init-param&gt;</span>
   <span class="tag">&lt;param-name&gt;</span>sortedBy<span class="tag">&lt;/param-name&gt;</span>
   <span class="tag">&lt;param-value&gt;</span>LAST_MODIFIED<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/init-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mime-mapping</code> elements in <code>default-web.xml</code> are global and
inherited by all web applications. You can override these mappings or
define your own using <code>mime-mapping</code> elements in your web application&#8217;s
<code>web.xml</code> file. For more information about <code>mime-mapping</code> elements, see
the Servlet specification.</p>
</div>
<div class="paragraph">
<p>You can use the Administration Console to edit the <code>default-web.xml</code>
file. For details, click the Help button in the Administration Console.
As an alternative, you can edit the file directly using the following
steps.</p>
</div>
<div class="sect4">
<h5 id="to-use-the-default-web.xml-file"><a class="anchor" href="#to-use-the-default-web.xml-file"></a>To Use the <code>default-web.xml</code> File</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Place the JAR file for the filter, security constraint, or other
feature in the domain-dir<code>/lib</code> directory.</p>
</li>
<li>
<p>Edit the domain-dir<code>/config/default-web.xml</code> file to refer to the
JAR file.</p>
</li>
<li>
<p>Restart the server.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-logging-and-monitoring-in-the-web-container"><a class="anchor" href="#configuring-logging-and-monitoring-in-the-web-container"></a>Configuring Logging and Monitoring in the Web Container</h4>
<div class="paragraph">
<p>For information about configuring logging and monitoring in the web
container using the Administration Console, click the Help button in the
Administration Console. Select Logger Settings under the relevant
configuration, or select the Stand-Alone Instances component, select the
instance from the table, and select the Monitor tab.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-idempotent-url-requests"><a class="anchor" href="#configuring-idempotent-url-requests"></a>Configuring Idempotent URL Requests</h4>
<div class="paragraph">
<p>An idempotent request is one that does not cause any change or
inconsistency in an application when retried. To enhance the
availability of your applications deployed on an Eclipse GlassFish
cluster, configure the load balancer to retry failed idempotent HTTP
requests on all the Eclipse GlassFish instances in a cluster. This option
can be used for read-only requests, for example, to retry a search
request.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#specifying-an-idempotent-url">Specifying an Idempotent URL</a></p>
</li>
<li>
<p><a href="#characteristics-of-an-idempotent-url">Characteristics of an Idempotent URL</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="specifying-an-idempotent-url"><a class="anchor" href="#specifying-an-idempotent-url"></a>Specifying an Idempotent URL</h5>
<div class="paragraph">
<p>To configure idempotent URL response, specify the URLs that can be
safely retried in <code>idempotent-url-pattern</code> elements in the
<code>glassfish-web.xml</code> file. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;idempotent-url-pattern</span> <span class="attribute-name">url-pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sun_java/*</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">no-of-retries</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For details, see "<a href="application-deployment-guide.html#idempotent-url-pattern">idempotent-url-pattern</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>If none of the server instances can successfully serve the request, an
error page is returned.</p>
</div>
</div>
<div class="sect4">
<h5 id="characteristics-of-an-idempotent-url"><a class="anchor" href="#characteristics-of-an-idempotent-url"></a>Characteristics of an Idempotent URL</h5>
<div class="paragraph">
<p>Since all requests for a given session are sent to the same application
server instance, and if that Eclipse GlassFish instance is unreachable,
the load balancer returns an error message. Normally, the request is not
retried on another Eclipse GlassFish instance. However, if the URL
pattern matches that specified in the <code>glassfish-web.xml</code> file, the
request is implicitly retried on another Eclipse GlassFish instance in
the cluster.</p>
</div>
<div class="paragraph">
<p>In HTTP, some methods (such as GET) are idempotent, while other methods
(such as POST) are not. In effect, retrying an idempotent URL should not
cause values to change on the server or in the database. The only
difference should be a change in the response received by the user.</p>
</div>
<div class="paragraph">
<p>Examples of idempotent requests include search engine queries and
database queries. The underlying principle is that the retry does not
cause an update or modification of data.</p>
</div>
<div class="paragraph">
<p>A search engine, for example, sends HTTP requests with the same URL
pattern to the load balancer. Specifying the URL pattern of the search
request to the load balancer ensures that HTTP requests with the
specified URL pattern are implicitly retried on another Eclipse GlassFish
instance.</p>
</div>
<div class="paragraph">
<p>For example, if the request URL sent to the Eclipse GlassFish is of the
type <code>/search/</code>something<code>.html</code>, then the URL pattern can be specified
as <code>/search/*</code>.</p>
</div>
<div class="paragraph">
<p>Examples of non-idempotent requests include banking transactions and
online shopping. If you retry such requests, money might be transferred
twice from your account.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="header-management"><a class="anchor" href="#header-management"></a>Header Management</h4>
<div class="paragraph">
<p>In all Editions of the Eclipse GlassFish, the <code>Enumeration</code> from
<code>request.getHeaders()</code> contains multiple elements (one element per
request header) instead of a single, aggregated value.</p>
</div>
<div class="paragraph">
<p>The header names used in <code>HttpServletResponse.add</code>XXX<code>Header()</code> and
<code>HttpServletResponse.set</code>XXX<code>Header()</code> are returned as they were
created.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-valves-and-catalina-listeners"><a class="anchor" href="#configuring-valves-and-catalina-listeners"></a>Configuring Valves and Catalina Listeners</h4>
<div class="paragraph">
<p>You can configure custom valves and Catalina listeners for web modules
or virtual servers by defining properties. A valve class must implement
the org.apache.catalina.Valve interface from Tomcat or previous
Eclipse GlassFish releases, or the org.glassfish.web.valve.GlassFishValve
interface from the current Eclipse GlassFish release. A listener class
for a virtual server must implement the
org.apache.catalina.ContainerListener or
org.apache.catalina.LifecycleListener interface. A listener class for a
web module must implement the org.apache.catalina.ContainerListener ,
org.apache.catalina.LifecycleListener, or
org.apache.catalina.InstanceListener interface.</p>
</div>
<div class="paragraph">
<p>In the <code>glassfish-web.xml</code> file, valve and listener properties for a web
module look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-web-app</span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">valve_1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.glassfish.extension.Valve</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">listener_1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.glassfish.extension.MyLifecycleListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/glassfish-web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define these same properties for a virtual server. For more
information, see <a href="#virtual-server-properties">Virtual Server Properties</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="alternate-document-roots"><a class="anchor" href="#alternate-document-roots"></a>Alternate Document Roots</h4>
<div class="paragraph">
<p>An alternate document root (docroot) allows a web application to serve
requests for certain resources from outside its own docroot, based on
whether those requests match one (or more) of the URI patterns of the
web application&#8217;s alternate docroots.</p>
</div>
<div class="paragraph">
<p>To specify an alternate docroot for a web application or a virtual
server, use the <code>alternatedocroot_n</code> property, where n is a positive
integer that allows specification of more than one. This property can be
a subelement of a <code>glassfish-web-app</code> element in the <code>glassfish-web.xml</code>
file or a virtual server property. For more information about these
elements, see "<a href="application-deployment-guide.html#glassfish-web-app">glassfish-web-app</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>A virtual server&#8217;s alternate docroots are considered only if a request
does not map to any of the web modules deployed on that virtual server.
A web module&#8217;s alternate docroots are considered only once a request has
been mapped to that web module.</p>
</div>
<div class="paragraph">
<p>If a request matches an alternate docroot&#8217;s URI pattern, it is mapped to
the alternate docroot by appending the request URI (minus the web
application&#8217;s context root) to the alternate docroot&#8217;s physical location
(directory). If a request matches multiple URI patterns, the alternate
docroot is determined according to the following precedence order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exact match</p>
</li>
<li>
<p>Longest path match</p>
</li>
<li>
<p>Extension match</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following properties specify three <code>glassfish-web.xml</code>
docroots. The URI pattern of the first alternate docroot uses an exact
match, whereas the URI patterns of the second and third alternate
docroots use extension and longest path prefix matches, respectively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">alternatedocroot_1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from=/my.jpg dir=/srv/images/jpg</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">alternatedocroot_2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from=*.jpg dir=/srv/images/jpg</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">alternatedocroot_3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from=/jpg/* dir=/src/images</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>value</code> of each alternate docroot has two components: The first
component, <code>from</code>, specifies the alternate docroot&#8217;s URI pattern, and
the second component, <code>dir</code>, specifies the alternate docroot&#8217;s physical
location (directory).</p>
</div>
<div class="paragraph">
<p>Suppose the above examples belong to a web application deployed at
<code><a href="http://company22.com/myapp" class="bare">http://company22.com/myapp</a></code>. The first alternate docroot maps any
requests with this URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://company22.com/myapp/my.jpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>To this resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/svr/images/jpg/my.jpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second alternate docroot maps any requests with a <code>*.jpg</code> suffix,
such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://company22.com/myapp/*.jpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>To this physical location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/svr/images/jpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>The third alternate docroot maps any requests whose URI starts with
<code>/myapp/jpg/</code>, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://company22.com/myapp/jpg/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>To the same directory as the second alternate docroot.</p>
</div>
<div class="paragraph">
<p>For example, the second alternate docroot maps this request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://company22.com/myapp/abc/def/my.jpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>To:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/srv/images/jpg/abc/def/my.jpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>The third alternate docroot maps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://company22.com/myapp/jpg/abc/resource</code></pre>
</div>
</div>
<div class="paragraph">
<p>To:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/srv/images/jpg/abc/resource</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a request does not match any of the target web application&#8217;s
alternate docroots, or if the target web application does not specify
any alternate docroots, the request is served from the web application&#8217;s
standard docroot, as usual.</p>
</div>
<div class="paragraph">
<p><a id="GSDVG00416"></a><a id="using-a-context.xml-file"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="using-a-context-xml-file"><a class="anchor" href="#using-a-context-xml-file"></a>Using a context.xml File</h4>
<div class="paragraph">
<p>You can define a <code>context.xml</code> file for all web applications, for web
applications assigned to a specific virtual server, or for a specific
web application.</p>
</div>
<div class="paragraph">
<p>To define a global <code>context.xml</code> file, place the file in the
domain-dir<code>/config</code> directory and name it <code>context.xml</code>.</p>
</div>
<div class="paragraph">
<p>Use the <code>contextXmlDefault</code> property to specify the name and the
location, relative to domain-dir, of the <code>context.xml</code> file for a
specific virtual server. Specify this property in one of the following
ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, open the HTTP Service component under
the relevant configuration. Open the Virtual Servers component and
scroll down to the bottom of the page. Enter <code>contextXmlDefault</code> as the
property name and the path and file name relative to domain-dir as the
property value.</p>
</li>
<li>
<p>Use the <code>asadmin create-virtual-server</code> command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-virtual-server --property contextXmlDefault=config/vs1ctx.xml vs1</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>asadmin set</code> command for an existing virtual server. For
example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server-config.http-service.virtual-server.vs1.property.contextXmlDefault=config/myctx.xml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To define a <code>context.xml</code> file for a specific web application, place the
file in the <code>META-INF</code> directory and name it <code>context.xml</code>.</p>
</div>
<div class="paragraph">
<p>For more information about virtual server properties, see
<a href="#virtual-server-properties">Virtual Server Properties</a>. For more information about the
<code>context.xml</code> file, see
<a href="http://tomcat.apache.org/tomcat-5.5-doc/config/context.html">The Context
Container</a>
(<code><a href="http://tomcat.apache.org/tomcat-5.5-doc/config/context.html" class="bare">http://tomcat.apache.org/tomcat-5.5-doc/config/context.html</a></code>). Context
parameters, environment entries, and resource definitions in
<code>context.xml</code> are supported in the Eclipse GlassFish.</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling-webdav"><a class="anchor" href="#enabling-webdav"></a>Enabling WebDav</h4>
<div class="paragraph">
<p>To enable WebDav in the Eclipse GlassFish, you edit the <code>web.xml</code> and
<code>glassfish-web.xml</code> files as follows.</p>
</div>
<div class="paragraph">
<p>First, enable the WebDav servlet in your <code>web.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
   <span class="tag">&lt;servlet-name&gt;</span>webdav<span class="tag">&lt;/servlet-name&gt;</span>
   <span class="tag">&lt;servlet-class&gt;</span>org.apache.catalina.servlets.WebdavServlet<span class="tag">&lt;/servlet-class&gt;</span>
   <span class="tag">&lt;init-param&gt;</span>
      <span class="tag">&lt;param-name&gt;</span>debug<span class="tag">&lt;/param-name&gt;</span>
      <span class="tag">&lt;param-value&gt;</span>0<span class="tag">&lt;/param-value&gt;</span>
   <span class="tag">&lt;/init-param&gt;</span>
   <span class="tag">&lt;init-param&gt;</span>
      <span class="tag">&lt;param-name&gt;</span>listings<span class="tag">&lt;/param-name&gt;</span>
      <span class="tag">&lt;param-value&gt;</span>true<span class="tag">&lt;/param-value&gt;</span>
   <span class="tag">&lt;/init-param&gt;</span>
   <span class="tag">&lt;init-param&gt;</span>
      <span class="tag">&lt;param-name&gt;</span>readonly<span class="tag">&lt;/param-name&gt;</span>
      <span class="tag">&lt;param-value&gt;</span>false<span class="tag">&lt;/param-value&gt;</span>
   <span class="tag">&lt;/init-param&gt;</span>
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then define the servlet mapping associated with your WebDav servlet in
your <code>web.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
   <span class="tag">&lt;servlet-name&gt;</span>webdav<span class="tag">&lt;/servlet-name&gt;</span>
   <span class="tag">&lt;url-pattern&gt;</span>/webdav/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To protect the WebDav servlet so other users can&#8217;t modify it, add a
security constraint in your <code>web.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-constraint&gt;</span>
   <span class="tag">&lt;web-resource-collection&gt;</span>
      <span class="tag">&lt;web-resource-name&gt;</span>Login Resources<span class="tag">&lt;/web-resource-name&gt;</span>
      <span class="tag">&lt;url-pattern&gt;</span>/webdav/*<span class="tag">&lt;/url-pattern&gt;</span>
   <span class="tag">&lt;/web-resource-collection&gt;</span>
   <span class="tag">&lt;auth-constraint&gt;</span>
      <span class="tag">&lt;role-name&gt;</span>Admin<span class="tag">&lt;/role-name&gt;</span>
   <span class="tag">&lt;/auth-constraint&gt;</span>
   <span class="tag">&lt;user-data-constraint&gt;</span>
      <span class="tag">&lt;transport-guarantee&gt;</span>NONE<span class="tag">&lt;/transport-guarantee&gt;</span>
   <span class="tag">&lt;/user-data-constraint&gt;</span>
   <span class="tag">&lt;login-config&gt;</span>
      <span class="tag">&lt;auth-method&gt;</span>BASIC<span class="tag">&lt;/auth-method&gt;</span>
      <span class="tag">&lt;realm-name&gt;</span>default<span class="tag">&lt;/realm-name&gt;</span>
   <span class="tag">&lt;/login-config&gt;</span>
   <span class="tag">&lt;security-role&gt;</span>
      <span class="tag">&lt;role-name&gt;</span>Admin<span class="tag">&lt;/role-name&gt;</span>
   <span class="tag">&lt;/security-role&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then define a security role mapping in your <code>glassfish-web.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-role-mapping&gt;</span>
   <span class="tag">&lt;role-name&gt;</span>Admin<span class="tag">&lt;/role-name&gt;</span>
   <span class="tag">&lt;group-name&gt;</span>Admin<span class="tag">&lt;/group-name&gt;</span>
<span class="tag">&lt;/security-role-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using the <code>file</code> realm, create a user and password. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-file-user --groups Admin --authrealmname default admin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enable the security manager as described in
<a href="#enabling-and-disabling-the-security-manager">Enabling and Disabling the Security
Manager</a>.</p>
</div>
<div class="paragraph">
<p>You can now use any WebDav client by connecting to the WebDav servlet
URL, which has this format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://host:port/context-root/webdav/file</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:80/glassfish-webdav/webdav/index.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add the WebDav servlet to your <code>default-web.xml</code> file to enable
it for all applications, but you can&#8217;t set up a security role mapping to
protect it.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-ssi"><a class="anchor" href="#using-ssi"></a>Using SSI</h4>
<div class="paragraph">
<p>To enable SSI (server-side includes) processing for a specific web
module, add the <code>SSIServlet</code> to your <code>web.xml</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;web-app&gt;</span>
   <span class="tag">&lt;servlet&gt;</span>
      <span class="tag">&lt;servlet-name&gt;</span>ssi<span class="tag">&lt;/servlet-name&gt;</span>
      <span class="tag">&lt;servlet-class&gt;</span>org.apache.catalina.ssi.SSIServlet<span class="tag">&lt;/servlet-class&gt;</span>
   <span class="tag">&lt;/servlet&gt;</span>
   ...
   <span class="tag">&lt;servlet-mapping&gt;</span>
      <span class="tag">&lt;servlet-name&gt;</span>ssi<span class="tag">&lt;/servlet-name&gt;</span>
      <span class="tag">&lt;url-pattern&gt;</span>*.shtml<span class="tag">&lt;/url-pattern&gt;</span>
   <span class="tag">&lt;/servlet-mapping&gt;</span>
   ...
   <span class="tag">&lt;mime-mapping&gt;</span>
      <span class="tag">&lt;extension&gt;</span>shtml<span class="tag">&lt;/extension&gt;</span>
      <span class="tag">&lt;mime-type&gt;</span>text/html<span class="tag">&lt;/mime-type&gt;</span>
   <span class="tag">&lt;/mime-mapping&gt;</span>
<span class="tag">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable SSI processing for all web modules, un-comment the
corresponding sections in the <code>default-web.xml</code> file.</p>
</div>
<div class="paragraph">
<p>If the <code>mime-mapping</code> is not specified in <code>web.xml</code>, Eclipse GlassFish
attempts to determine the MIME type from <code>default-web.xml</code> or the
operating system default.</p>
</div>
<div class="paragraph">
<p>You can configure the following <code>init-param</code> values for the
<code>SSIServlet</code>.</p>
</div>
<div id="gheoy" class="paragraph">
<p>Table 7-4 <code>SSIServlet</code> <code>init-param</code> Values</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28%;">
<col style="width: 11%;">
<col style="width: 20%;">
<col style="width: 41%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">init-param</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buffered</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the output should be
buffered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> (for no debugging)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the debugging level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">expires</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Expires</code> header in HTTP response not set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies
the expiration time in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inputEncoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operating system encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies encoding
for the SSI input if there is no URL content encoding specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">isVirtualWebappRelative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code> (relative to the given SSI
file)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the virtual path of the <code>#include</code> directive is
relative to the <code>content-root</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputEncoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UTF-8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies encoding for the SSI output.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information about SSI, see
<code><a href="http://httpd.apache.org/docs/2.2/mod/mod_include.html" class="bare">http://httpd.apache.org/docs/2.2/mod/mod_include.html</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-cgi"><a class="anchor" href="#using-cgi"></a>Using CGI</h4>
<div class="paragraph">
<p>To enable CGI (common gateway interface) processing for a specific web
module, add the <code>CGIServlet</code> to your <code>web.xml</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;web-app&gt;</span>
   <span class="tag">&lt;servlet&gt;</span>
      <span class="tag">&lt;servlet-name&gt;</span>cgi<span class="tag">&lt;/servlet-name&gt;</span>
      <span class="tag">&lt;servlet-class&gt;</span>org.apache.catalina.servlets.CGIServlet<span class="tag">&lt;/servlet-class&gt;</span>
   <span class="tag">&lt;/servlet&gt;</span>
   ...
   <span class="tag">&lt;servlet-mapping&gt;</span>
      <span class="tag">&lt;servlet-name&gt;</span>cgi<span class="tag">&lt;/servlet-name&gt;</span>
      <span class="tag">&lt;url-pattern&gt;</span>/cgi-bin/*<span class="tag">&lt;/url-pattern&gt;</span>
   <span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable CGI processing for all web modules, un-comment the
corresponding sections in the <code>default-web.xml</code> file.</p>
</div>
<div class="paragraph">
<p>Package the CGI program under the <code>cgiPathPrefix</code>. The default
<code>cgiPathPrefix</code> is <code>WEB-INF/cgi</code>. For security, it is highly recommended
that the contents and binaries of CGI programs be prohibited from direct
viewing or download. For information about hiding directory listings,
see <a href="#GSDVG00410">Using the <code>default-web.xml</code> File</a>.</p>
</div>
<div class="paragraph">
<p>Invoke the CGI program using a URL of the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://host:8080/context-root/cgi-bin/cgi-name</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:8080/mycontext/cgi-bin/hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure the following <code>init-param</code> values for the
<code>CGIServlet</code>.</p>
</div>
<div id="ghern" class="paragraph">
<p>Table 7-5 <code>CGIServlet</code> <code>init-param</code> Values</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 11%;">
<col style="width: 27%;">
<col style="width: 37%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">init-param</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cgiPathPrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WEB-INF/cgi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the subdirectory
containing the CGI programs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> (for no debugging)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the debugging level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>perl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the executable for running the
CGI script.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameterEncoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>System.getProperty`</code>("file.encoding",`
<code>"UTF-8")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the parameter&#8217;s encoding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">passShellEnvironment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether to pass
shell environment properties to the CGI program.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To work with a native executable, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the value of the <code>init-param</code> named executable to an empty
<code>String</code> in the <code>web.xml</code> file.</p>
</li>
<li>
<p>Make sure the executable has its executable bits set correctly.</p>
</li>
<li>
<p>Use directory deployment to deploy the web module. Do not deploy it
as a WAR file, because the executable bit information is lost during the
process of <code>jar</code> and <code>unjar</code>. For more information about directory
deployment, see the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish
Application Deployment Guide</a>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-enterprise-javabeans-technology"><a class="anchor" href="#using-enterprise-javabeans-technology"></a>13. Using Enterprise JavaBeans Technology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how Enterprise JavaBeans ( EJB) technology is
supported in the Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#value-added-features">Value Added Features</a></p>
</li>
<li>
<p><a href="#ejb-timer-service">EJB Timer Service</a></p>
</li>
<li>
<p><a href="#using-session-beans">Using Session Beans</a></p>
</li>
<li>
<p><a href="#using-read-only-beans">Using Read-Only Beans</a></p>
</li>
<li>
<p><a href="#using-message-driven-beans">Using Message-Driven Beans</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For general information about enterprise beans, see
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#enterprise-beans">Enterprise Beans</a>
in The Jakarta EE Tutorial.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Web Profile of the Eclipse GlassFish supports the EJB 3.1 Lite
specification, which allows enterprise beans within web applications,
among other features. The full Eclipse GlassFish supports the entire EJB
3.1 specification. For details, see
<a href="http://jcp.org/en/jsr/detail?id=318">JSR 318</a>
(<code><a href="http://jcp.org/en/jsr/detail?id=318" class="bare">http://jcp.org/en/jsr/detail?id=318</a></code>).</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish is backward compatible with 1.1, 2.0, 2.1, and 3.0
enterprise beans. However, to take advantage of version 3.1 features,
you should develop new beans as 3.1 enterprise beans.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="value-added-features"><a class="anchor" href="#value-added-features"></a>Value Added Features</h3>
<div class="paragraph">
<p>The Eclipse GlassFish provides a number of value additions that relate to
EJB development. References to more in-depth material are included.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#read-only-beans">Read-Only Beans</a></p>
</li>
<li>
<p><a href="#the-pass-by-reference-element">The <code>pass-by-reference</code> Element</a></p>
</li>
<li>
<p><a href="#pooling-and-caching">Pooling and Caching</a></p>
</li>
<li>
<p><a href="#priority-based-scheduling-of-remote-bean-invocations">Priority Based Scheduling of Remote Bean Invocations</a></p>
</li>
<li>
<p><a href="#immediate-flushing">Immediate Flushing</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="read-only-beans"><a class="anchor" href="#read-only-beans"></a>Read-Only Beans</h4>
<div class="paragraph">
<p>Another feature that the Eclipse GlassFish provides is the read-only
bean, an EJB 2.1 entity bean that is never modified by an EJB client.
Read-only beans avoid database updates completely.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Read-only beans are specific to the Eclipse GlassFish and are not part of
the Enterprise JavaBeans Specification, v2.1. Use of this feature for an
EJB 2.1 bean results in a non-portable application.</p>
</div>
<div class="paragraph">
<p>To make an EJB 3.0 entity read-only, use <code>@Column</code> annotations to mark
its columns <code>insertable=false</code> and <code>updatable=false</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A read-only bean can be used to cache a database entry that is
frequently accessed but rarely updated (externally by other beans). When
the data that is cached by a read-only bean is updated by another bean,
the read-only bean can be notified to refresh its cached data.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish provides a number of ways by which a read-only
bean&#8217;s state can be refreshed. By setting the
<code>refresh-period-in-seconds</code> element in the <code>glassfish-ejb-jar.xml</code> file
and the <code>trans-attribute</code> element (or <code>@TransactionAttribute</code>
annotation) in the <code>ejb-jar.xml</code> file, it is easy to configure a
read-only bean that is one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always refreshed</p>
</li>
<li>
<p>Periodically refreshed</p>
</li>
<li>
<p>Never refreshed</p>
</li>
<li>
<p>Programmatically refreshed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Read-only beans are best suited for situations where the underlying data
never changes, or changes infrequently. For further information and
usage guidelines, see <a href="#using-read-only-beans">Using Read-Only Beans</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-pass-by-reference-element"><a class="anchor" href="#the-pass-by-reference-element"></a>The <code>pass-by-reference</code> Element</h4>
<div class="paragraph">
<p>The <code>pass-by-reference</code> element in the <code>glassfish-ejb-jar.xml</code> file
allows you to specify the parameter passing semantics for colocated
remote EJB invocations. This is an opportunity to improve performance.
However, use of this feature results in non-portable applications. See
"<a href="application-deployment-guide.html#pass-by-reference">pass-by-reference</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="pooling-and-caching"><a class="anchor" href="#pooling-and-caching"></a>Pooling and Caching</h4>
<div class="paragraph">
<p>The EJB container of the Eclipse GlassFish pools anonymous instances
(message-driven beans, stateless session beans, and entity beans) to
reduce the overhead of creating and destroying objects. The EJB
container maintains the free pool for each bean that is deployed. Bean
instances in the free pool have no identity (that is, no primary key
associated) and are used to serve method calls. The free beans are also
used to serve all methods for stateless session beans.</p>
</div>
<div class="paragraph">
<p>Bean instances in the free pool transition from a Pooled state to a
Cached state after <code>ejbCreate</code> and the business methods run. The size
and behavior of each pool is controlled using pool-related properties in
the EJB container or the <code>glassfish-ejb-jar.xml</code> file.</p>
</div>
<div class="paragraph">
<p>In addition, the Eclipse GlassFish supports a number of tunable
parameters that can control the number of "stateful" instances (stateful
session beans and entity beans) cached as well as the duration they are
cached. Multiple bean instances that refer to the same database row in a
table can be cached. The EJB container maintains a cache for each bean
that is deployed.</p>
</div>
<div class="paragraph">
<p>To achieve scalability, the container selectively evicts some bean
instances from the cache, usually when cache overflows. These evicted
bean instances return to the free bean pool. The size and behavior of
each cache can be controlled using the cache-related properties in the
EJB container or the <code>glassfish-ejb-jar.xml</code> file.</p>
</div>
<div class="paragraph">
<p>Pooling and caching parameters for the <code>glassfish-ejb-jar.xml</code> file are
described in "<a href="application-deployment-guide.html#bean-cache">bean-cache</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="sect4">
<h5 id="pooling-parameters"><a class="anchor" href="#pooling-parameters"></a>Pooling Parameters</h5>
<div class="paragraph">
<p>One of the most important parameters for Eclipse GlassFish pooling is
<code>steady-pool-size</code>. When <code>steady-pool-size</code> is set to a value greater
than 0, the container not only pre-populates the bean pool with the
specified number of beans, but also attempts to ensure that this number
of beans is always available in the free pool. This ensures that there
are enough beans in the ready-to-serve state to process user requests.</p>
</div>
<div class="paragraph">
<p>Note that the <code>steady-pool-size</code> and <code>max-pool-size</code> parameters only
govern the number of instances that are pooled over a long period of
time. They do not necessarily guarantee that the number of instances
that may exist in the JVM at a given time will not exceed the value
specified by <code>max-pool-size</code>. For example, suppose an idle stateless
session container has a fully-populated pool with a <code>steady-pool-size</code>
of 10. If 20 concurrent requests arrive for the EJB component, the
container creates 10 additional instances to satisfy the burst of
requests. The advantage of this is that it prevents the container from
blocking any of the incoming requests. However, if the activity dies
down to 10 or fewer concurrent requests, the additional 10 instances are
discarded.</p>
</div>
<div class="paragraph">
<p>Another parameter, <code>pool-idle-timeout-in-seconds</code>, allows the
administrator to specify the amount of time a bean instance can be idle
in the pool. When <code>pool-idle-timeout-in-seconds</code> is set to greater than
0, the container removes or destroys any bean instance that is idle for
this specified duration.</p>
</div>
</div>
<div class="sect4">
<h5 id="caching-parameters"><a class="anchor" href="#caching-parameters"></a>Caching Parameters</h5>
<div class="paragraph">
<p>Eclipse GlassFish provides a way that completely avoids caching of entity
beans, using commit option C. Commit option C is particularly useful if
beans are accessed in large number but very rarely reused. For
additional information, refer to
<a href="#commit-options">Commit Options</a>.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish caches can be either bounded or unbounded. Bounded
caches have limits on the number of beans that they can hold beyond
which beans are passivated. For stateful session beans, there are three
ways (LRU, NRU and FIFO) of picking victim beans when cache overflow
occurs. Caches can also passivate beans that are idle (not accessed for
a specified duration).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="priority-based-scheduling-of-remote-bean-invocations"><a class="anchor" href="#priority-based-scheduling-of-remote-bean-invocations"></a>Priority Based Scheduling of Remote Bean Invocations</h4>
<div class="paragraph">
<p>You can create multiple thread pools, each having its own work queues.
An optional element in the <code>glassfish-ejb-jar.xml</code> file,
<code>use-thread-pool-id</code>, specifies the thread pool that processes the
requests for the bean. The bean must have a remote interface, or
<code>use-thread-pool-id</code> is ignored. You can create different thread pools
and specify the appropriate thread pool ID for a bean that requires a
quick response time. If there is no such thread pool configured or if
the element is absent, the default thread pool is used.</p>
</div>
</div>
<div class="sect3">
<h4 id="immediate-flushing"><a class="anchor" href="#immediate-flushing"></a>Immediate Flushing</h4>
<div class="paragraph">
<p>Normally, all entity bean updates within a transaction are batched and
executed at the end of the transaction. The only exception is the
database flush that precedes execution of a finder or select query.</p>
</div>
<div class="paragraph">
<p>Since a transaction often spans many method calls, you might want to
find out if the updates made by a method succeeded or failed immediately
after method execution. To force a flush at the end of a method&#8217;s
execution, use the <code>flush-at-end-of-method</code> element in the
<code>glassfish-ejb-jar.xml</code> file. Only non-finder methods in an entity bean
can be flush-enabled. (For an EJB 2.1 bean, these methods must be in the
Local, Local Home, Remote, or Remote Home interface.) See
"<a href="application-deployment-guide.html#flush-at-end-of-method">flush-at-end-of-method</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>Upon completion of the method, the EJB container updates the database.
Any exception thrown by the underlying data store is wrapped as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the method that triggered the flush is a <code>create</code> method, the
exception is wrapped with <code>CreateException</code>.</p>
</li>
<li>
<p>If the method that triggered the flush is a <code>remove</code> method, the
exception is wrapped with <code>RemoveException</code>.</p>
</li>
<li>
<p>For all other methods, the exception is wrapped with <code>EJBException</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All normal end-of-transaction database synchronization steps occur
regardless of whether the database has been flushed during the
transaction.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ejb-timer-service"><a class="anchor" href="#ejb-timer-service"></a>EJB Timer Service</h3>
<div class="paragraph">
<p>The EJB Timer Service uses a database to store persistent information
about EJB timers. The EJB Timer Service in Eclipse GlassFish is
preconfigured to use an embedded version of the Apache Derby database.</p>
</div>
<div class="paragraph">
<p>The EJB Timer Service configuration can store persistent timer
information in any database supported by the Eclipse GlassFish for
persistence. For a list of the JDBC drivers currently supported by the
Eclipse GlassFish, see the <a href="release-notes.html#GSRLN">Eclipse GlassFish Release Notes</a>. For configurations of supported and other
drivers, see "<a href="administration-guide.html#configuration-specifics-for-jdbc-drivers">Configuration Specifics for JDBC
Drivers</a>" in Eclipse GlassFish Administration Guide.</p>
</div>
<div class="paragraph">
<p>The timer service is automatically enabled when you deploy an
application or module that uses it. You can verify that the timer
service is running by accessing the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:8080/ejb-timer-service-app/timer</code></pre>
</div>
</div>
<div class="paragraph">
<p>To change the database used by the EJB Timer Service, set the EJB Timer
Service&#8217;s Timer DataSource setting to a valid JDBC resource. If the EJB
Timer Service has already been started in a server instance, you must
also create the timer database table. DDL files are located in
as-install<code>/lib/install/databases</code>.</p>
</div>
<div class="paragraph">
<p>Using the EJB Timer Service is equivalent to interacting with a single
JDBC resource manager. If an EJB component or application accesses a
database either directly through JDBC or indirectly (for example,
through an entity bean&#8217;s persistence mechanism), and also interacts with
the EJB Timer Service, its data source must be configured with an XA
JDBC driver.</p>
</div>
<div class="paragraph">
<p>You can change the following EJB Timer Service settings. You must
restart the server for the changes to take effect.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Minimum Delivery Interval</dt>
<dd>
<p>Specifies the minimum time in milliseconds before an expiration for a
particular timer can occur. This guards against extremely small timer
increments that can overload the server. The default is <code>1000</code>.</p>
</dd>
<dt class="hdlist1">Maximum Redeliveries</dt>
<dd>
<p>Specifies the maximum number of times the EJB timer service attempts
to redeliver a timer expiration after an exception or rollback of a
container-managed transaction. The default is <code>1</code>.</p>
</dd>
<dt class="hdlist1">Redelivery Interval</dt>
<dd>
<p>Specifies how long in milliseconds the EJB timer service waits after a
failed <code>ejbTimeout</code> delivery before attempting a redelivery. The
default is <code>5000</code>.</p>
</dd>
<dt class="hdlist1">Timer DataSource</dt>
<dd>
<p>Specifies the database used by the EJB Timer Service. The default is
<code>jdbc/__TimerPool</code>.</p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use the <code>jdbc/__TimerPool</code> resource for timers in clustered
Eclipse GlassFish environments.
You must instead use a custom JDBC resource or the <code>jdbc/__default</code> resource.
See the instructions below, in <a href="#to-deploy-an-ejb-timer-to-a-cluster">To Deploy an EJB Timer to a Cluster</a>.
Also refer to
"<a href="administration-guide.html#etjdbcdefault-cluster">Enabling the jdbc/__default Resource in a Clustered Environment</a>"
in Eclipse GlassFish Administration Guide.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For information about the <code>asadmin list-timers</code> and
<code>asadmin migrate-timers</code> subcommands, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>. For information about
migrating EJB timers, see "<a href="ha-administration-guide.html#migrating-ejb-timers">Migrating EJB Timers</a>" in
Eclipse GlassFish High Availability Administration
Guide.</p>
</div>
<div class="paragraph">
<p>You can use the <code>--keepstate</code> option of the <code>asadmin redeploy</code> command
to retain EJB timers between redeployments.</p>
</div>
<div class="paragraph">
<p>The default for <code>--keepstate</code> is false. This option is supported only on
the default server instance, named <code>server</code>. It is not supported and
ignored for any other target.</p>
</div>
<div class="paragraph">
<p>When the <code>--keepstate</code> is set to true, each application that uses an EJB
timer is assigned an ID in the timer database. The EJB object that is
associated with a given application is assigned an ID that is
constructed from the application ID and a numerical suffix. To preserve
active timer data, Eclipse GlassFish stores the application ID and the
EJB ID in the timer database. To restore the data, the class loader of
the newly redeployed application retrieves the EJB timers that
correspond to these IDs from the timer database.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin redeploy</code> command, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="sect3">
<h4 id="to-deploy-an-ejb-timer-to-a-cluster"><a class="anchor" href="#to-deploy-an-ejb-timer-to-a-cluster"></a>To Deploy an EJB Timer to a Cluster</h4>
<div class="paragraph">
<p>This procedure explains how to deploy an EJB timer to a cluster.</p>
</div>
<div class="paragraph">
<p>By default, the Eclipse GlassFish 7 timer service points to the
preconfigured <code>jdbc/__TimerPool</code> resource, which uses an embedded Apache
Derby database configuration that will not work in clustered
environments.</p>
</div>
<div class="paragraph">
<p>The problem is that embedded Apache Derby database runs in the Eclipse GlassFish Java VM, so when you use the <code>jdbc/__TimerPool</code> resource, each
DAS and each clustered server instance will have its own database table.
Because of this, clustered server instances will not be able to find the
database table on the DAS, and the DAS will not be able to find the
tables on the clustered server instances.</p>
</div>
<div class="paragraph">
<p>The solution is to use either a custom JDBC resource or the
<code>jdbc/<em>default</code> resource that is preconfigured but not enabled by
default in Eclipse GlassFish. The <code>jdbc/</em>default</code> resource does not use
the embedded Apache Derby database by default.</p>
</div>
<div class="paragraph">
<p>Before You Begin</p>
</div>
<div class="paragraph">
<p>If creating a new timer resource, the resource should be created before
deploying applications that will use the timer.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use the <code>jdbc/__TimerPool</code> resource for timers in clustered
Eclipse GlassFish environments.
You must instead use a custom JDBC resource or the <code>jdbc/__default</code> resource.
See "<a href="administration-guide.html#etjdbcdefault-cluster">Enabling the jdbc/__default Resource in a Clustered Environment</a>"
in Eclipse GlassFish Administration Guide.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set configs.config.cluster_name-config.ejb-container.ejb-timer-service.timer-
datasource=jdbc/my-timer-resource</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the DAS and the target cluster(s).</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin stop-cluster cluster-name
asadmin stop-domain domain-name
asadmin start-domain domain-name
asadmin start-cluster cluster-name</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div id="GSDVG548" class="paragraph">
<p>Troubleshooting</p>
</div>
<div class="paragraph">
<p>If you inadvertently used the <code>jdbc/__TimerPool</code> resource for your EJB
timer in a clustered Eclipse GlassFish environment, the DAS and the
clustered server instances will be using separate Apache Derby database
tables that are running in individual Java VMs. For timers to work in a
clustered environment, the DAS and the clustered server instances must
share a common database table.</p>
</div>
<div class="paragraph">
<p>If you attempt to deploy an application with EJB timers without setting
the timer resource correctly, the startup will fail, and you will be
left with a marker file, named <code>ejb-timer-service-app</code>, on the DAS that
will prevent the Timer Service from correctly creating the database
table.</p>
</div>
<div class="paragraph">
<p>The solution is to remove the marker file on the DAS, restart the DAS
and the clusters, and then redploy any applications that rely on the
offending EJB timer. The marker file is located on the DAS in
domain-dir`/generated/ejb/<code>`ejb-timer-service-app</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-session-beans"><a class="anchor" href="#using-session-beans"></a>Using Session Beans</h3>
<div class="paragraph">
<p>This section provides guidelines for creating session beans in the
Eclipse GlassFish environment.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#about-the-session-bean-containers">About the Session Bean Containers</a></p>
</li>
<li>
<p><a href="#stateful-session-bean-failover">Stateful Session Bean Failover</a></p>
</li>
<li>
<p><a href="#session-bean-restrictions-and-optimizations">Session Bean Restrictions and Optimizations</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Information on session beans is contained in the Enterprise JavaBeans
Specification, v3.1.</p>
</div>
<div class="sect3">
<h4 id="about-the-session-bean-containers"><a class="anchor" href="#about-the-session-bean-containers"></a>About the Session Bean Containers</h4>
<div class="paragraph">
<p>Like an entity bean, a session bean can access a database through Java
Database Connectivity (JDBC) calls. A session bean can also provide
transaction settings. These transaction settings and JDBC calls are
referenced by the session bean&#8217;s container, allowing it to participate
in transactions managed by the container.</p>
</div>
<div class="paragraph">
<p>A container managing stateless session beans has a different charter
from a container managing stateful session beans.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#stateless-container">Stateless Container</a></p>
</li>
<li>
<p><a href="#stateful-container">Stateful Container</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="stateless-container"><a class="anchor" href="#stateless-container"></a>Stateless Container</h5>
<div class="paragraph">
<p>The stateless container manages stateless session beans, which, by
definition, do not carry client-specific states. All session beans (of a
particular type) are considered equal.</p>
</div>
<div class="paragraph">
<p>A stateless session bean container uses a bean pool to service requests.
The Eclipse GlassFish specific deployment descriptor file,
<code>glassfish-ejb-jar.xml</code>, contains the properties that define the pool:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>steady-pool-size</code></p>
</li>
<li>
<p><code>resize-quantity</code></p>
</li>
<li>
<p><code>max-pool-size</code></p>
</li>
<li>
<p><code>pool-idle-timeout-in-seconds</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about <code>glassfish-ejb-jar.xml</code>, see
"<a href="application-deployment-guide.html#GSDPG00079">The glassfish-ejb-jar.xml File</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish provides the <code>wscompile</code> and <code>wsdeploy</code> tools to
help you implement a web service endpoint as a stateless session bean.
For more information about these tools, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="stateful-container"><a class="anchor" href="#stateful-container"></a>Stateful Container</h5>
<div class="paragraph">
<p>The stateful container manages the stateful session beans, which, by
definition, carry the client-specific state. There is a one-to-one
relationship between the client and the stateful session beans. At
creation, each stateful session bean (SFSB) is given a unique session ID
that is used to access the session bean so that an instance of a
stateful session bean is accessed by a single client only.</p>
</div>
<div class="paragraph">
<p>Stateful session beans are managed using cache. The size and behavior of
stateful session beans cache are controlled by specifying the following
<code>glassfish-ejb-jar.xml</code> parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>max-cache-size</code></p>
</li>
<li>
<p><code>resize-quantity</code></p>
</li>
<li>
<p><code>cache-idle-timeout-in-seconds</code></p>
</li>
<li>
<p><code>removal-timeout-in-seconds</code></p>
</li>
<li>
<p><code>victim-selection-policy</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>max-cache-size</code> element specifies the maximum number of session
beans that are held in cache. If the cache overflows (when the number of
beans exceeds <code>max-cache-size</code>), the container then passivates some
beans or writes out the serialized state of the bean into a file. The
directory in which the file is created is obtained from the EJB
container using the configuration APIs.</p>
</div>
<div class="paragraph">
<p>For more information about <code>glassfish-ejb-jar.xml</code>, see
"<a href="application-deployment-guide.html#GSDPG00079">The glassfish-ejb-jar.xml File</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>The passivated beans are stored on the file system. The Session Store
Location setting in the EJB container allows the administrator to
specify the directory where passivated beans are stored. By default,
passivated stateful session beans are stored in application-specific
subdirectories created under domain-dir`/session-store`.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure the <code>delete</code> option is set in the <code>server.policy</code> file, or
expired file-based sessions might not be deleted properly. For more
information about <code>server.policy</code>, see <a href="#GSDVG00121">The
<code>server.policy</code> File</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Session Store Location setting also determines where the session
state is persisted if it is not highly available; see
<a href="#choosing-a-persistence-store">Choosing a Persistence Store</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="stateful-session-bean-failover"><a class="anchor" href="#stateful-session-bean-failover"></a>Stateful Session Bean Failover</h4>
<div class="paragraph">
<p>An SFSB&#8217;s state can be saved in a persistent store in case a server
instance fails. The state of an SFSB is saved to the persistent store at
predefined points in its life cycle. This is called checkpointing. If
SFSB checkpointing is enabled, checkpointing generally occurs after any
transaction involving the SFSB is completed, even if the transaction
rolls back.</p>
</div>
<div class="paragraph">
<p>However, if an SFSB participates in a bean-managed transaction, the
transaction might be committed in the middle of the execution of a bean
method. Since the bean&#8217;s state might be undergoing transition as a
result of the method invocation, this is not an appropriate instant to
checkpoint the bean&#8217;s state. In this case, the EJB container checkpoints
the bean&#8217;s state at the end of the corresponding method, provided the
bean is not in the scope of another transaction when that method ends.
If a bean-managed transaction spans across multiple methods,
checkpointing is delayed until there is no active transaction at the end
of a subsequent method.</p>
</div>
<div class="paragraph">
<p>The state of an SFSB is not necessarily transactional and might be
significantly modified as a result of non-transactional business
methods. If this is the case for an SFSB, you can specify a list of
checkpointed methods. If SFSB checkpointing is enabled, checkpointing
occurs after any checkpointed methods are completed.</p>
</div>
<div class="paragraph">
<p>The following table lists the types of references that SFSB failover
supports. All objects bound into an SFSB must be one of the supported
types. In the table, No indicates that failover for the object type
might not work in all cases and that no failover support is provided.
However, failover might work in some cases for that object type. For
example, failover might work because the class implementing that type is
serializable.</p>
</div>
<div id="fvyed" class="paragraph">
<p>Table 8-1 Object Types Supported for Jakarta EE Stateful Session Bean State
Failover</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 45%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java Object Type</th>
<th class="tableblock halign-left valign-top">Failover Support</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Colocated or distributed stateless session, stateful session, or entity bean reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JNDI context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, <code>InitialContext</code> and <code>java:comp/env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UserTransaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, but if the instance that fails is never
restarted, any prepared global transactions are lost and might not be
correctly rolled back or committed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC DataSource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Message Service (JMS) ConnectionFactory, Destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jakarta Mail Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection Factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administered Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web service reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializable Java types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended persistence context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information about the <code>InitialContext</code>, see
<a href="#accessing-the-naming-context">Accessing the Naming Context</a>. For more information
about transaction recovery, see <a href="#using-the-transaction-service">Using
the Transaction Service</a>. For more information about Administered
Objects, see "<a href="administration-guide.html#administering-jms-physical-destinations">Administering JMS Physical Destinations</a>"
in Eclipse GlassFish Administration Guide.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Idempotent URLs are supported along the HTTP path, but not the RMI-IIOP
path. For more information, see <a href="#configuring-idempotent-url-requests">Configuring
Idempotent URL Requests</a>.</p>
</div>
<div class="paragraph">
<p>If a server instance to which an RMI-IIOP client request is sent crashes
during the request processing (before the response is prepared and sent
back to the client), an error is sent to the client. The client must
retry the request explicitly. When the client retries the request, the
request is sent to another server instance in the cluster, which
retrieves session state information for this client.</p>
</div>
<div class="paragraph">
<p>HTTP sessions can also be saved in a persistent store in case a server
instance fails. In addition, if a distributable web application
references an SFSB, and the web application&#8217;s session fails over, the
EJB reference is also failed over. For more information, see
<a href="#distributed-sessions-and-persistence">Distributed Sessions and Persistence</a>.</p>
</div>
<div class="paragraph">
<p>If an SFSB that uses session persistence is undeployed while the
Eclipse GlassFish instance is stopped, the session data in the
persistence store might not be cleared. To prevent this, undeploy the
SFSB while the Eclipse GlassFish instance is running.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configure SFSB failover by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#choosing-a-persistence-store">Choosing a Persistence Store</a></p>
</li>
<li>
<p><a href="#enabling-checkpointing">Enabling Checkpointing</a></p>
</li>
<li>
<p><a href="#specifying-methods-to-be-checkpointed">Specifying Methods to Be Checkpointed</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="choosing-a-persistence-store"><a class="anchor" href="#choosing-a-persistence-store"></a>Choosing a Persistence Store</h5>
<div class="paragraph">
<p>The following types of persistent storage are supported for passivation
and checkpointing of the SFSB state:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The local file system - Allows a single server instance to recover the
SFSB state after a failure and restart. This store also provides
passivation and activation of the state to help control the amount of
memory used. This option is not supported in a production environment
that requires SFSB state persistence. This is the default storage
mechanism if availability is not enabled.</p>
</li>
<li>
<p>Other servers - Uses other server instances in the cluster for session
persistence. Clustered server instances replicate session state. Each
backup instance stores the replicated data in memory. This is the
default storage mechanism if availability is enabled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Choose the persistence store in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To use the local file system, first disable availability. Select the
Availability Service component under the relevant configuration in the
Administration Console. Uncheck the Availability Service box. Then
select the EJB Container component and edit the Session Store Location
value. The default is domain-dir`/session-store`.</p>
</li>
<li>
<p>To use other servers, select the Availability Service component under
the relevant configuration in the Administration Console. Check the
Availability Service box. To enable availability for the EJB container,
select the EJB Container Availability tab, then check the Availability
Service box. All instances in an Eclipse GlassFish cluster should have
the same availability settings to ensure consistent behavior.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about SFSB state persistence, see the
<a href="ha-administration-guide.html#GSHAG">Eclipse GlassFish High Availability
Administration Guide</a>.</p>
</div>
<div id="using-the---keepstate-option" class="paragraph">
<p>Using the <code>--keepstate</code> Option</p>
</div>
<div class="paragraph">
<p>If you are using the file system for persistence, you can use the
<code>--keepstate</code> option of the <code>asadmin redeploy</code> command to retain the
SFSB state between redeployments.</p>
</div>
<div class="paragraph">
<p>The default for <code>--keepstate</code> is false. This option is supported only on
the default server instance, named <code>server</code>. It is not supported and
ignored for any other target.</p>
</div>
<div class="paragraph">
<p>Some changes to an application between redeployments prevent this
feature from working properly. For example, do not change the set of
instance variables in the SFSB bean class.</p>
</div>
<div class="paragraph">
<p>If any active SFSB instance fails to be preserved or restored, none of
the SFSB instances will be available when the redeployment is complete.
However, the redeployment continues and a warning is logged.</p>
</div>
<div class="paragraph">
<p>To preserve active state data, Eclipse GlassFish serializes the data and
saves it in memory. To restore the data, the class loader of the newly
redeployed application deserializes the data that was previously saved.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin redeploy</code> command, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div id="using-the---asyncreplication-option" class="paragraph">
<p>Using the <code>--asyncreplication</code> Option</p>
</div>
<div class="paragraph">
<p>If you are using replication on other servers for persistence, you can
use the <code>--asyncreplication</code> option of the <code>asadmin deploy</code> command to
specify that SFSB states are first buffered and then replicated using a
separate asynchronous thread. If <code>--asyncreplication</code> is set to true
(default), performance is improved but availability is reduced. If the
instance where states are buffered but not yet replicated fails, the
states are lost. If set to false, performance is reduced but
availability is guaranteed. States are not buffered but immediately
transmitted to other instances in the cluster.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin deploy</code> command, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="enabling-checkpointing"><a class="anchor" href="#enabling-checkpointing"></a>Enabling Checkpointing</h5>
<div class="paragraph">
<p>The following sections describe how to enable SFSB checkpointing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#server-instance-and-ejb-container-levels">Server Instance and EJB Container Levels</a></p>
</li>
<li>
<p><a href="#application-and-ejb-module-levels">Application and EJB Module Levels</a></p>
</li>
<li>
<p><a href="#sfsb-level">SFSB Level</a></p>
</li>
</ul>
</div>
<div id="server-instance-and-ejb-container-levels" class="paragraph">
<p>Server Instance and EJB Container Levels</p>
</div>
<div class="paragraph">
<p>To enable SFSB checkpointing at the server instance or EJB container
level, see <a href="#choosing-a-persistence-store">Choosing a Persistence Store</a>.</p>
</div>
<div id="application-and-ejb-module-levels" class="paragraph">
<p>Application and EJB Module Levels</p>
</div>
<div class="paragraph">
<p>To enable SFSB checkpointing at the application or EJB module level
during deployment, use the <code>asadmin deploy</code> or <code>asadmin deploydir</code>
command with the <code>--availabilityenabled</code> option set to <code>true</code>. For
details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</div>
<div id="sfsb-level" class="paragraph">
<p>SFSB Level</p>
</div>
<div class="paragraph">
<p>To enable SFSB checkpointing at the SFSB level, set
<code>availability-enabled="true"</code> in the <code>ejb</code> element of the SFSB&#8217;s
<code>glassfish-ejb-jar.xml</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-ejb-jar&gt;</span>
   ...
   <span class="tag">&lt;enterprise-beans&gt;</span>
      ...
      <span class="tag">&lt;ejb</span> <span class="attribute-name">availability-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;ejb-name&gt;</span>MySFSB<span class="tag">&lt;/ejb-name&gt;</span>
      <span class="tag">&lt;/ejb&gt;</span>
   ...
   <span class="tag">&lt;/enterprise-beans&gt;</span>
<span class="tag">&lt;/glassfish-ejb-jar&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="specifying-methods-to-be-checkpointed"><a class="anchor" href="#specifying-methods-to-be-checkpointed"></a>Specifying Methods to Be Checkpointed</h5>
<div class="paragraph">
<p>If SFSB checkpointing is enabled, checkpointing generally occurs after
any transaction involving the SFSB is completed, even if the transaction
rolls back.</p>
</div>
<div class="paragraph">
<p>To specify additional optional checkpointing of SFSBs at the end of
non-transactional business methods that cause important modifications to
the bean&#8217;s state, use the <code>checkpoint-at-end-of-method</code> element within
the <code>ejb</code> element in <code>glassfish-ejb-jar.xml</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-ejb-jar&gt;</span>
   ...
   <span class="tag">&lt;enterprise-beans&gt;</span>
      ...
      <span class="tag">&lt;ejb</span> <span class="attribute-name">availability-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;ejb-name&gt;</span>ShoppingCartEJB<span class="tag">&lt;/ejb-name&gt;</span>
         <span class="tag">&lt;checkpoint-at-end-of-method&gt;</span>
            <span class="tag">&lt;method&gt;</span>
               <span class="tag">&lt;method-name&gt;</span>addToCart<span class="tag">&lt;/method-name&gt;</span>
            <span class="tag">&lt;/method&gt;</span>
         <span class="tag">&lt;/checkpoint-at-end-of-method&gt;</span>
      <span class="tag">&lt;/ejb&gt;</span>
      ...
   <span class="tag">&lt;/enterprise-beans&gt;</span>
<span class="tag">&lt;/glassfish-ejb-jar&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For details, see "<a href="application-deployment-guide.html#checkpoint-at-end-of-method">checkpoint-at-end-of-method</a>" in
Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>The non-transactional methods in the <code>checkpoint-at-end-of-method</code>
element can be the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>create</code> methods defined in the home or business interface of the
SFSB, if you want to checkpoint the initial state of the SFSB
immediately after creation</p>
</li>
<li>
<p>For SFSBs using container managed transactions only, methods in the
remote interface of the bean marked with the transaction attribute
TX_NOT_SUPPORTED or TX_NEVER</p>
</li>
<li>
<p>For SFSBs using bean managed transactions only, methods in which a
bean managed transaction is neither started nor committed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any other methods mentioned in this list are ignored. At the end of
invocation of each of these methods, the EJB container saves the state
of the SFSB to persistent store.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If an SFSB does not participate in any transaction, and if none of its
methods are explicitly specified in the <code>checkpoint-at-end-of-method</code>
element, the bean&#8217;s state is not checkpointed at all even if
<code>availability-enabled="true"</code> for this bean.</p>
</div>
<div class="paragraph">
<p>For better performance, specify a small subset of methods. The methods
chosen should accomplish a significant amount of work in the context of
the Jakarta EE application or should result in some important modification
to the bean&#8217;s state.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="session-bean-restrictions-and-optimizations"><a class="anchor" href="#session-bean-restrictions-and-optimizations"></a>Session Bean Restrictions and Optimizations</h4>
<div class="paragraph">
<p>This section discusses restrictions on developing session beans and
provides some optimization guidelines.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#optimizing-session-bean-performance">Optimizing Session Bean Performance</a></p>
</li>
<li>
<p><a href="#restricting-transactions">Restricting Transactions</a></p>
</li>
<li>
<p><a href="#ejb-singletons">EJB Singletons</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="optimizing-session-bean-performance"><a class="anchor" href="#optimizing-session-bean-performance"></a>Optimizing Session Bean Performance</h5>
<div class="paragraph">
<p>For stateful session beans, colocating the stateful beans with their
clients so that the client and bean are executing in the same process
address space improves performance.</p>
</div>
</div>
<div class="sect4">
<h5 id="restricting-transactions"><a class="anchor" href="#restricting-transactions"></a>Restricting Transactions</h5>
<div class="paragraph">
<p>The following restrictions on transactions are enforced by the container
and must be observed as session beans are developed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A session bean can participate in, at most, a single transaction at a
time.</p>
</li>
<li>
<p>If a session bean is participating in a transaction, a client cannot
invoke a method on the bean such that the <code>trans-attribute</code> element (or
<code>@TransactionAttribute</code> annotation) in the <code>ejb-jar.xml</code> file would
cause the container to execute the method in a different or unspecified
transaction context or an exception is thrown.</p>
</li>
<li>
<p>If a session bean instance is participating in a transaction, a client
cannot invoke the <code>remove</code> method on the session object&#8217;s home or
business interface object, or an exception is thrown.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="ejb-singletons"><a class="anchor" href="#ejb-singletons"></a>EJB Singletons</h5>
<div class="paragraph">
<p>EJB Singletons are created for each server instance in a cluster, and
not once per cluster.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-read-only-beans"><a class="anchor" href="#using-read-only-beans"></a>Using Read-Only Beans</h3>
<div class="paragraph">
<p>A read-only bean is an EJB 2.1 entity bean that is never modified by an
EJB client. The data that a read-only bean represents can be updated
externally by other enterprise beans, or by other means, such as direct
database updates.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Read-only beans are specific to the Eclipse GlassFish and are not part of
the Enterprise JavaBeans Specification, v2.1. Use of this feature for an
EJB 2.1 bean results in a non-portable application.</p>
</div>
<div class="paragraph">
<p>To make an EJB 3.0 entity bean read-only, use <code>@Column</code> annotations to
mark its columns <code>insertable=false</code> and <code>updatable=false</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Read-only beans are best suited for situations where the underlying data
never changes, or changes infrequently.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#read-only-bean-characteristics-and-life-cycle">Read-Only Bean Characteristics and Life Cycle</a></p>
</li>
<li>
<p><a href="#read-only-bean-good-practices">Read-Only Bean Good Practices</a></p>
</li>
<li>
<p><a href="#refreshing-read-only-beans">Refreshing Read-Only Beans</a></p>
</li>
<li>
<p><a href="#deploying-read-only-beans">Deploying Read-Only Beans</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="read-only-bean-characteristics-and-life-cycle"><a class="anchor" href="#read-only-bean-characteristics-and-life-cycle"></a>Read-Only Bean Characteristics and Life Cycle</h4>
<div class="paragraph">
<p>Read-only beans are best suited for situations where the underlying data
never changes, or changes infrequently. For example, a read-only bean
can be used to represent a stock quote for a particular company, which
is updated externally. In such a case, using a regular entity bean might
incur the burden of calling <code>ejbStore</code>, which can be avoided by using a
read-only bean.</p>
</div>
<div class="paragraph">
<p>Read-only beans have the following characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only entity beans can be read-only beans.</p>
</li>
<li>
<p>Either bean-managed persistence (BMP) or container-managed persistence
(CMP) is allowed. If CMP is used, do not create the database schema
during deployment. Instead, work with your database administrator to
populate the data into the tables. See
<a href="#using-container-managed-persistence">Using Container-Managed
Persistence</a>.</p>
</li>
<li>
<p>Only container-managed transactions are allowed; read-only beans
cannot start their own transactions.</p>
</li>
<li>
<p>Read-only beans don&#8217;t update any bean state.</p>
</li>
<li>
<p><code>ejbStore</code> is never called by the container.</p>
</li>
<li>
<p><code>ejbLoad</code> is called only when a transactional method is called or when
the bean is initially created (in the cache), or at regular intervals
controlled by the bean&#8217;s <code>refresh-period-in-seconds</code> element in the
<code>glassfish-ejb-jar.xml</code> file.</p>
</li>
<li>
<p>The home interface can have any number of find methods. The return
type of the find methods must be the primary key for the same bean type
(or a collection of primary keys).</p>
</li>
<li>
<p>If the data that the bean represents can change, then
<code>refresh-period-in-seconds</code> must be set to refresh the beans at regular
intervals. <code>ejbLoad</code> is called at this regular interval.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A read-only bean comes into existence using the appropriate find
methods.</p>
</div>
<div class="paragraph">
<p>Read-only beans are cached and have the same cache properties as entity
beans. When a read-only bean is selected as a victim to make room in the
cache, <code>ejbPassivate</code> is called and the bean is returned to the free
pool. When in the free pool, the bean has no identity and is used only
to serve any finder requests.</p>
</div>
<div class="paragraph">
<p>Read-only beans are bound to the naming service like regular read-write
entity beans, and clients can look up read-only beans the same way
read-write entity beans are looked up.</p>
</div>
</div>
<div class="sect3">
<h4 id="read-only-bean-good-practices"><a class="anchor" href="#read-only-bean-good-practices"></a>Read-Only Bean Good Practices</h4>
<div class="paragraph">
<p>For best results, follow these guidelines when developing read-only
beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avoid having any <code>create</code> or <code>remove</code> methods in the home interface.</p>
</li>
<li>
<p>Use any of the valid EJB 2.1 transaction attributes for the
<code>trans-attribute</code> element.</p>
<div class="paragraph">
<p>The reason for having <code>TX_SUPPORTED</code> is to allow reading uncommitted
data in the same transaction. Also, the transaction attributes can be
used to force <code>ejbLoad</code>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="refreshing-read-only-beans"><a class="anchor" href="#refreshing-read-only-beans"></a>Refreshing Read-Only Beans</h4>
<div class="paragraph">
<p>There are several ways of refreshing read-only beans, as addressed in
the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#invoking-a-transactional-method">Invoking a Transactional Method</a></p>
</li>
<li>
<p><a href="#refreshing-periodically">Refreshing Periodically</a></p>
</li>
<li>
<p><a href="#refreshing-programmatically">Refreshing Programmatically</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="invoking-a-transactional-method"><a class="anchor" href="#invoking-a-transactional-method"></a>Invoking a Transactional Method</h5>
<div class="paragraph">
<p>Invoking any transactional method invokes <code>ejbLoad</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="refreshing-periodically"><a class="anchor" href="#refreshing-periodically"></a>Refreshing Periodically</h5>
<div class="paragraph">
<p>Use the <code>refresh-period-in-seconds</code> element in the
<code>glassfish-ejb-jar.xml</code> file to refresh a read-only bean periodically.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the value specified in <code>refresh-period-in-seconds</code> is zero or not
specified, which is the default, the bean is never refreshed (unless a
transactional method is accessed).</p>
</li>
<li>
<p>If the value is greater than zero, the bean is refreshed at the rate
specified.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is the only way to refresh the bean state if the data can be
modified external to the Eclipse GlassFish.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, a single timer is used for all instances of a read-only
bean. When that timer fires, all bean instances are marked as expired
and are refreshed from the database the next time they are used.</p>
</div>
<div class="paragraph">
<p>Use the <code>-Dcom.sun.ejb.containers.readonly.relative.refresh.mode=true</code>
flag to refresh each bean instance independently upon access if its
refresh period has expired. The default is <code>false</code>. Note that each
instance still has the same refresh period. This additional level of
granularity can improve the performance of read-only beans that do not
need to be refreshed at the same time.</p>
</div>
<div class="paragraph">
<p>To set this flag, use the <code>asadmin create-jvm-options</code> command. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -Dcom.sun.ejb.containers.readonly.relative.refresh.mode=true</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="refreshing-programmatically"><a class="anchor" href="#refreshing-programmatically"></a>Refreshing Programmatically</h5>
<div class="paragraph">
<p>Typically, beans that update any data that is cached by read-only beans
need to notify the read-only beans to refresh their state. Use
ReadOnlyBeanNotifier to force the refresh of read-only beans.</p>
</div>
<div class="paragraph">
<p>To do this, invoke the following methods on the ReadOnlyBeanNotifier
bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ReadOnlyBeanNotifier</span> <span class="directive">extends</span> java.rmi.Remote {
   refresh(<span class="predefined-type">Object</span> PrimaryKey) <span class="directive">throws</span> <span class="exception">RemoteException</span>;
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of the ReadOnlyBeanNotifier interface is provided by
the container. The bean looks up ReadOnlyBeanNotifier using a fragment
of code such as the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">com.sun.appserv.ejb.ReadOnlyBeanHelper helper =
  <span class="keyword">new</span> com.sun.appserv.ejb.ReadOnlyBeanHelper();
com.sun.appserv.ejb.ReadOnlyBeanNotifier notifier =
  helper.getReadOnlyBeanNotifier(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/ejb/ReadOnlyCustomer</span><span class="delimiter">&quot;</span></span>);
notifier.refresh(PrimaryKey);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a local read-only bean notifier, the lookup has this modification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">helper.getReadOnlyBeanLocalNotifier(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/ejb/LocalReadOnlyCustomer</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beans that update any data that is cached by read-only beans need to
call the <code>refresh</code> methods. The next (non-transactional) call to the
read-only bean invokes <code>ejbLoad</code>.</p>
</div>
<div class="paragraph">
<p>For Javadoc tool pages relevant to read-only beans, go to
<code><a href="http://glassfish.java.net/nonav/docs/v3/api/" class="bare">http://glassfish.java.net/nonav/docs/v3/api/</a></code> and click on the
<code>com.sun.appserv.ejb</code> package.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deploying-read-only-beans"><a class="anchor" href="#deploying-read-only-beans"></a>Deploying Read-Only Beans</h4>
<div class="paragraph">
<p>Read-only beans are deployed in the same manner as other entity beans.
However, in the entry for the bean in the <code>glassfish-ejb-jar.xml</code> file,
the <code>is-read-only-bean</code> element must be set to true. That is:</p>
</div>
<div class="paragraph">
<p><code>&lt;is-read-only-bean&gt;true&lt;/is-read-only-bean&gt;</code></p>
</div>
<div class="paragraph">
<p>Also, the <code>refresh-period-in-seconds</code> element in the
<code>glassfish-ejb-jar.xml</code> file can be set to some value that specifies the
rate at which the bean is refreshed. If this element is missing, no
refresh occurs.</p>
</div>
<div class="paragraph">
<p>All requests in the same transaction context are routed to the same
read-only bean instance. Set the <code>allow-concurrent-access</code> element to
either <code>true</code> (to allow concurrent accesses) or <code>false</code> (to serialize
concurrent access to the same read-only bean). The default is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>For further information on these elements, refer to
"<a href="application-deployment-guide.html#GSDPG00079">The glassfish-ejb-jar.xml File</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-message-driven-beans"><a class="anchor" href="#using-message-driven-beans"></a>Using Message-Driven Beans</h3>
<div class="paragraph">
<p>This section describes message-driven beans and explains the
requirements for creating them in the Eclipse GlassFish environment.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#message-driven-bean-configuration">Message-Driven Bean Configuration</a></p>
</li>
<li>
<p><a href="#message-driven-bean-restrictions-and-optimizations">Message-Driven Bean Restrictions and Optimizations</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="message-driven-bean-configuration"><a class="anchor" href="#message-driven-bean-configuration"></a>Message-Driven Bean Configuration</h4>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#connection-factory-and-destination">Connection Factory and Destination</a></p>
</li>
<li>
<p><a href="#message-driven-bean-pool">Message-Driven Bean Pool</a></p>
</li>
<li>
<p><a href="#domain-level-settings">Domain-Level Settings</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about setting up load balancing for message-driven
beans, see <a href="#load-balanced-message-inflow">Load-Balanced Message Inflow</a>.</p>
</div>
<div class="sect4">
<h5 id="connection-factory-and-destination"><a class="anchor" href="#connection-factory-and-destination"></a>Connection Factory and Destination</h5>
<div class="paragraph">
<p>A message-driven bean is a client to a Connector inbound resource
adapter. The message-driven bean container uses the JMS service
integrated into the Eclipse GlassFish for message-driven beans that are
JMS clients. JMS clients use JMS Connection Factory- and
Destination-administered objects. A JMS Connection Factory administered
object is a resource manager Connection Factory object that is used to
create connections to the JMS provider.</p>
</div>
<div class="paragraph">
<p>The <code>mdb-connection-factory</code> element in the <code>glassfish-ejb-jar.xml</code> file
for a message-driven bean specifies the connection factory that creates
the container connection to the JMS provider.</p>
</div>
<div class="paragraph">
<p>The <code>jndi-name</code> element of the <code>ejb</code> element in the
<code>glassfish-ejb-jar.xml</code> file specifies the JNDI name of the administered
object for the JMS Queue or Topic destination that is associated with
the message-driven bean.</p>
</div>
</div>
<div class="sect4">
<h5 id="message-driven-bean-pool"><a class="anchor" href="#message-driven-bean-pool"></a>Message-Driven Bean Pool</h5>
<div class="paragraph">
<p>The container manages a pool of message-driven beans for the concurrent
processing of a stream of messages. The <code>glassfish-ejb-jar.xml</code> file
contains the elements that define the pool (that is, the <code>bean-pool</code>
element):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>steady-pool-size</code></p>
</li>
<li>
<p><code>resize-quantity</code></p>
</li>
<li>
<p><code>max-pool-size</code></p>
</li>
<li>
<p><code>pool-idle-timeout-in-seconds</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about <code>glassfish-ejb-jar.xml</code>, see
"<a href="application-deployment-guide.html#GSDPG00079">The glassfish-ejb-jar.xml File</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
<div class="sect4">
<h5 id="domain-level-settings"><a class="anchor" href="#domain-level-settings"></a>Domain-Level Settings</h5>
<div class="paragraph">
<p>You can control the following domain-level message-driven bean settings
in the EJB container:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Initial and Minimum Pool Size</dt>
<dd>
<p>Specifies the initial and minimum number of beans maintained in the
pool. The default is <code>0</code>.</p>
</dd>
<dt class="hdlist1">Maximum Pool Size</dt>
<dd>
<p>Specifies the maximum number of beans that can be created to satisfy
client requests. The default is <code>2</code>.</p>
</dd>
<dt class="hdlist1">Pool Resize Quantity</dt>
<dd>
<p>Specifies the number of beans to be created if a request arrives when
the pool is empty (subject to the Initial and Minimum Pool Size), or
the number of beans to remove if idle for more than the Idle Timeout.
The default is <code>8</code>.</p>
</dd>
<dt class="hdlist1">Idle Timeout</dt>
<dd>
<p>Specifies the maximum time in seconds that a bean can remain idle in
the pool. After this amount of time, the bean is destroyed. The
default is <code>600</code> (10 minutes). A value of <code>0</code> means a bean can remain
idle indefinitely.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For information on monitoring message-driven beans, click the Help
button in the Administration Console. Select the Stand-Alone Instances
component, select the instance from the table, and select the Monitor
tab. Or select the Clusters component, select the cluster from the
table, select the Instances tab, select the instance from the table, and
select the Monitor tab.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Running monitoring when it is not needed might impact performance, so
you might choose to turn monitoring off when it is not in use. For
details, see "<a href="administration-guide.html#administering-the-monitoring-service">Administering the Monitoring Service</a>" in
Eclipse GlassFish Administration Guide.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="message-driven-bean-restrictions-and-optimizations"><a class="anchor" href="#message-driven-bean-restrictions-and-optimizations"></a>Message-Driven Bean Restrictions and Optimizations</h4>
<div class="paragraph">
<p>This section discusses the following restrictions and performance
optimizations that pertain to developing message-driven beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#pool-tuning-and-monitoring">Pool Tuning and Monitoring</a></p>
</li>
<li>
<p><a href="#the-onmessage-runtime-exception">The <code>onMessage</code> Runtime Exception</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="pool-tuning-and-monitoring"><a class="anchor" href="#pool-tuning-and-monitoring"></a>Pool Tuning and Monitoring</h5>
<div class="paragraph">
<p>The message-driven bean pool is also a pool of threads, with each
message-driven bean instance in the pool associating with a server
session, and each server session associating with a thread. Therefore, a
large pool size also means a high number of threads, which impacts
performance and server resources.</p>
</div>
<div class="paragraph">
<p>When configuring message-driven bean pool properties, make sure to
consider factors such as message arrival rate and pattern, <code>onMessage</code>
method processing time, overall server resources (threads, memory, and
so on), and any concurrency requirements and limitations from other
resources that the message-driven bean accesses.</p>
</div>
<div class="paragraph">
<p>When tuning performance and resource usage, make sure to consider
potential JMS provider properties for the connection factory used by the
container (the <code>mdb-connection-factory</code> element in the
<code>glassfish-ejb-jar.xml</code> file). For example, you can tune the Open
Message Queue flow control related properties for connection factory in
situations where the message incoming rate is much higher than
<code>max-pool-size</code> can handle.</p>
</div>
<div class="paragraph">
<p>Refer to "<a href="administration-guide.html#administering-the-monitoring-service">Administering the Monitoring Service</a>" in
Eclipse GlassFish Administration Guide for
information on how to get message-driven bean pool statistics.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-onmessage-runtime-exception"><a class="anchor" href="#the-onmessage-runtime-exception"></a>The <code>onMessage</code> Runtime Exception</h5>
<div class="paragraph">
<p>Message-driven beans, like other well-behaved MessageListeners, should
not, in general, throw runtime exceptions. If a message-driven bean&#8217;s
<code>onMessage</code> method encounters a system-level exception or error that
does not allow the method to successfully complete, the Enterprise
JavaBeans Specification, v3.0 provides the following guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the bean method encounters a runtime exception or error, it should
simply propagate the error from the bean method to the container.</p>
</li>
<li>
<p>If the bean method performs an operation that results in a checked
exception that the bean method cannot recover, the bean method should
throw the <code>javax.ejb.EJBException</code> that wraps the original exception.</p>
</li>
<li>
<p>Any other unexpected error conditions should be reported using
<code>javax.ejb.EJBException</code> (<code>javax.ejb.EJBException</code> is a subclass of
<code>java.lang.RuntimeException</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Under container-managed transaction demarcation, upon receiving a
runtime exception from a message-driven bean&#8217;s <code>onMessage</code> method, the
container rolls back the container-started transaction and the message
is redelivered. This is because the message delivery itself is part of
the container-started transaction. By default, the Eclipse GlassFish
container closes the container&#8217;s connection to the JMS provider when the
first runtime exception is received from a message-driven bean
instance&#8217;s <code>onMessage</code> method. This avoids potential message redelivery
looping and protects server resources if the message-driven bean&#8217;s
<code>onMessage</code> method continues misbehaving. To change this default
container behavior, use the <code>cmt-max-runtime-exceptions</code> property of the
MDB container. Here is an example <code>asadmin set</code> command that sets this
property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server-config.mdb-container.property.cmt-max-runtime-exceptions=&quot;5&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin set</code> command, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>The <code>cmt-max-runtime-exceptions</code> property specifies the maximum number
of runtime exceptions allowed from a message-driven bean&#8217;s <code>onMessage</code>
method before the container starts to close the container&#8217;s connection
to the message source. By default this value is 1; -1 disables this
container protection.</p>
</div>
<div class="paragraph">
<p>A message-driven bean&#8217;s <code>onMessage</code> method can use the
<code>jakarta.jms.Message.getJMSRedelivered</code> method to check whether a received
message is a redelivered message.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>cmt-max-runtime-exceptions</code> property is deprecated.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-container-managed-persistence"><a class="anchor" href="#using-container-managed-persistence"></a>14. Using Container-Managed Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter contains information on how EJB 2.1 container-managed
persistence (CMP) works in Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#glassfish-server-support-for-cmp">Eclipse GlassFish Support for CMP</a></p>
</li>
<li>
<p><a href="#cmp-mapping">CMP Mapping</a></p>
</li>
<li>
<p><a href="#automatic-schema-generation-for-cmp">Automatic Schema Generation for CMP</a></p>
</li>
<li>
<p><a href="#schema-capture">Schema Capture</a></p>
</li>
<li>
<p><a href="#configuring-the-cmp-resource">Configuring the CMP Resource</a></p>
</li>
<li>
<p><a href="#performance-related-features">Performance-Related Features</a></p>
</li>
<li>
<p><a href="#configuring-queries-for-1-1-finders">Configuring Queries for 1.1 Finders</a></p>
</li>
<li>
<p><a href="#cmp-restrictions-and-optimizations">CMP Restrictions and Optimizations</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Web Profile of the Eclipse GlassFish supports the EJB 3.1 Lite
specification, which allows enterprise beans within web applications,
among other features. The full Eclipse GlassFish supports the entire EJB
3.1 specification. For details, see
<a href="http://jcp.org/en/jsr/detail?id=318">JSR 318</a>
(<code><a href="http://jcp.org/en/jsr/detail?id=318" class="bare">http://jcp.org/en/jsr/detail?id=318</a></code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="glassfish-server-support-for-cmp"><a class="anchor" href="#glassfish-server-support-for-cmp"></a>Eclipse GlassFish Support for CMP</h3>
<div class="paragraph">
<p>Eclipse GlassFish support for EJB 2.1 CMP beans includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Full support for the J2EE v1.4 specification&#8217;s CMP model. Extensive
information on CMP is contained in chapters 10, 11, and 14 of the
Enterprise JavaBeans Specification, v2.1. This includes the following:</p>
<div class="ulist">
<ul>
<li>
<p>Support for commit options B and C for transactions.
See <a href="#commit-options">Commit Options</a>.</p>
</li>
<li>
<p>The primary key class must be a subclass of <code>java.lang.Object</code>.
This ensures portability, and is noted because some vendors allow primitive
types (such as <code>int</code>) to be used as the primary key class.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The Eclipse GlassFish CMP implementation, which provides the following:</p>
<div class="ulist">
<ul>
<li>
<p>An Object/Relational (O/R) mapping tool that creates XML deployment
descriptors for EJB JAR files that contain beans that use CMP.</p>
</li>
<li>
<p>Support for compound (multi-column) primary keys.</p>
</li>
<li>
<p>Support for sophisticated custom finder methods.</p>
</li>
<li>
<p>Standards-based query language (EJB QL).</p>
</li>
<li>
<p>CMP runtime support. See <a href="#configuring-the-cmp-resource">Configuring the CMP Resource</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Eclipse GlassFish performance-related features, including the following:</p>
<div class="ulist">
<ul>
<li>
<p>Version column consistency checking</p>
</li>
<li>
<p>Relationship prefetching</p>
</li>
<li>
<p>Read-Only Beans</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For details, see <a href="#performance-related-features">Performance-Related Features</a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cmp-mapping"><a class="anchor" href="#cmp-mapping"></a>CMP Mapping</h3>
<div class="paragraph">
<p>Implementation for entity beans that use CMP is mostly a matter of
mapping CMP fields and CMR fields (relationships) to the database.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#mapping-capabilities">Mapping Capabilities</a></p>
</li>
<li>
<p><a href="#the-mapping-deployment-descriptor-file">The Mapping Deployment Descriptor File</a></p>
</li>
<li>
<p><a href="#mapping-considerations">Mapping Considerations</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="mapping-capabilities"><a class="anchor" href="#mapping-capabilities"></a>Mapping Capabilities</h4>
<div class="paragraph">
<p>Mapping refers to the ability to tie an object-based model to a
relational model of data, usually the schema of a relational database.
The CMP implementation provides the ability to tie a set of interrelated
beans containing data and associated behaviors to the schema. This
object representation of the database becomes part of the Java
application. You can also customize this mapping to optimize these beans
for the particular needs of an application. The result is a single data
model through which both persistent database information and regular
transient program data are accessed.</p>
</div>
<div class="paragraph">
<p>The mapping capabilities provided by the Eclipse GlassFish include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mapping a CMP bean to one or more tables</p>
</li>
<li>
<p>Mapping CMP fields to one or more columns</p>
</li>
<li>
<p>Mapping CMP fields to different column types</p>
</li>
<li>
<p>Mapping tables with compound primary keys</p>
</li>
<li>
<p>Mapping tables with unknown primary keys</p>
</li>
<li>
<p>Mapping CMP relationships to foreign keys</p>
</li>
<li>
<p>Mapping tables with overlapping primary and foreign keys</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-mapping-deployment-descriptor-file"><a class="anchor" href="#the-mapping-deployment-descriptor-file"></a>The Mapping Deployment Descriptor File</h4>
<div class="paragraph">
<p>Each module with CMP beans must have the following files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ejb-jar.xml</code> - The J2EE standard file for assembling enterprise
beans. For a detailed description, see the Enterprise JavaBeans
Specification, v2.1.</p>
</li>
<li>
<p><code>glassfish-ejb-jar.xml</code> - The Eclipse GlassFish standard file for
assembling enterprise beans. For a detailed description, see
"<a href="application-deployment-guide.html#GSDPG00079">The glassfish-ejb-jar.xml File</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</li>
<li>
<p><code>sun-cmp-mappings.xml</code> - The mapping deployment descriptor file, which
describes the mapping of CMP beans to tables in a database. For a
detailed description, see "<a href="application-deployment-guide.html#GSDPG00080">The sun-cmp-mappings.xml
File</a>" in Eclipse GlassFish Application Deployment
Guide.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>sun-cmp-mappings.xml</code> file can be automatically generated and does
not have to exist prior to deployment. For details, see
<a href="#generation-options-for-cmp">Generation Options for CMP</a>.</p>
</div>
<div class="paragraph">
<p>The <code>sun-cmp-mappings.xml</code> file maps CMP fields and CMR fields
(relationships) to the database. A primary table must be selected for
each CMP bean, and optionally, multiple secondary tables. CMP fields are
mapped to columns in either the primary or secondary table(s). CMR
fields are mapped to pairs of column lists (normally, column lists are
the lists of columns associated with primary and foreign keys).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Table names in databases can be case-sensitive. Make sure that the table
names in the <code>sun-cmp-mappings.xml</code> file match the names in the
database.</p>
</div>
<div class="paragraph">
<p>Relationships should always be mapped to the primary key field(s) of the
related table.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>sun-cmp-mappings.xml</code> file conforms to the
<code>sun-cmp-mapping_1_2.dtd</code> file and is packaged with the user-defined
bean classes in the EJB JAR file under the <code>META-INF</code> directory.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish creates the mappings in the <code>sun-cmp-mappings.xml</code>
file automatically during deployment if the file is not present.</p>
</div>
<div class="paragraph">
<p>To map the fields and relationships of your entity beans manually, edit
the <code>sun-cmp-mappings.xml</code> deployment descriptor. Only do this if you
are proficient in editing XML.</p>
</div>
<div class="paragraph">
<p>The mapping information is developed in conjunction with the database
schema (<code>.dbschema</code>) file, which can be automatically captured when you
deploy the bean (see <a href="#automatic-database-schema-capture">Automatic Database Schema Capture</a>).
You can manually generate the schema using the <code>capture-schema</code> utility
(<a href="#using-the-capture-schema-utility">Using the <code>capture-schema</code> Utility</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-considerations"><a class="anchor" href="#mapping-considerations"></a>Mapping Considerations</h4>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#join-tables-and-relationships">Join Tables and Relationships</a></p>
</li>
<li>
<p><a href="#automatic-primary-key-generation">Automatic Primary Key Generation</a></p>
</li>
<li>
<p><a href="#fixed-length-char-primary-keys">Fixed Length CHAR Primary Keys</a></p>
</li>
<li>
<p><a href="#managed-fields">Managed Fields</a></p>
</li>
<li>
<p><a href="#blob-support">BLOB Support</a></p>
</li>
<li>
<p><a href="#clob-support">CLOB Support</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data types used in automatic schema generation are also suggested
for manual mapping. These data types are described in
<a href="#supported-data-types-for-cmp">Supported Data Types for CMP</a>.</p>
</div>
<div class="sect4">
<h5 id="join-tables-and-relationships"><a class="anchor" href="#join-tables-and-relationships"></a>Join Tables and Relationships</h5>
<div class="paragraph">
<p>Use of join tables in the database schema is supported for all types of
relationships, not just many-to-many relationships. For general
information about relationships, see section 10.3.7 of the Enterprise
JavaBeans Specification, v2.1.</p>
</div>
</div>
<div class="sect4">
<h5 id="automatic-primary-key-generation"><a class="anchor" href="#automatic-primary-key-generation"></a>Automatic Primary Key Generation</h5>
<div class="paragraph">
<p>The Eclipse GlassFish supports automatic primary key generation for EJB
1.1, 2.0, and 2.1 CMP beans. To specify automatic primary key
generation, give the <code>prim-key-class</code> element in the <code>ejb-jar.xml</code> file
the value <code>java.lang.Object</code>. CMP beans with automatically generated
primary keys can participate in relationships with other CMP beans. The
Eclipse GlassFish does not support database-generated primary key values.</p>
</div>
<div class="paragraph">
<p>If the database schema is created during deployment, the Eclipse GlassFish creates the schema with the primary key column, then generates
unique values for the primary key column at runtime.</p>
</div>
<div class="paragraph">
<p>If the database schema is not created during deployment, the primary key
column in the mapped table must be of type <code>NUMERIC</code> with a precision of
19 or more, and must not be mapped to any CMP field. The Eclipse GlassFish generates unique values for the primary key column at runtime.</p>
</div>
</div>
<div class="sect4">
<h5 id="fixed-length-char-primary-keys"><a class="anchor" href="#fixed-length-char-primary-keys"></a>Fixed Length CHAR Primary Keys</h5>
<div class="paragraph">
<p>If an existing database table has a primary key column in which the
values vary in length, but the type is <code>CHAR</code> instead of <code>VARCHAR</code>, the
Eclipse GlassFish automatically trims any extra spaces when retrieving
primary key values. It is not a good practice to use a fixed length
<code>CHAR</code> column as a primary key. Use this feature with schemas that
cannot be changed, such as a schema inherited from a legacy application.</p>
</div>
</div>
<div class="sect4">
<h5 id="managed-fields"><a class="anchor" href="#managed-fields"></a>Managed Fields</h5>
<div class="paragraph">
<p>A managed field is a CMP or CMR field that is mapped to the same
database column as another CMP or CMR field. CMP fields mapped to the
same column and CMR fields mapped to exactly the same column lists
always have the same value in memory. For CMR fields that share only a
subset of their mapped columns, changes to the columns affect the
relationship fields in memory differently. Basically, the Eclipse GlassFish always tries to keep the state of the objects in memory
synchronized with the database.</p>
</div>
<div class="paragraph">
<p>A managed field can have any <code>fetched-with</code> subelement. If the
<code>fetched-with</code> subelement is <code>&lt;default/&gt;</code>, the
<code>-DAllowManagedFieldsInDefaultFetchGroup</code> flag must be set to <code>true</code>.
See <a href="#default-fetch-group-flags">Default Fetch Group Flags</a> and
"<a href="application-deployment-guide.html#fetched-with">fetched-with</a>" in Eclipse GlassFish
Application Deployment Guide.</p>
</div>
</div>
<div class="sect4">
<h5 id="blob-support"><a class="anchor" href="#blob-support"></a>BLOB Support</h5>
<div class="paragraph">
<p>Binary Large Object (BLOB) is a data type used to store values that do
not correspond to other types such as numbers, strings, or dates. Java
fields whose types implement java.io.Serializable or are represented as
<code>byte[]</code> can be stored as BLOBs.</p>
</div>
<div class="paragraph">
<p>If a CMP field is defined as Serializable, it is serialized into a
<code>byte[]</code> before being stored in the database. Similarly, the value
fetched from the database is deserialized. However, if a CMP field is
defined as <code>byte[]</code>, it is stored directly instead of being serialized
and deserialized when stored and fetched, respectively.</p>
</div>
<div class="paragraph">
<p>To enable BLOB support in the Eclipse GlassFish environment, define a CMP
field of type <code>byte[]</code> or a user-defined type that implements the
java.io.Serializable interface. If you map the CMP bean to an existing
database schema, map the field to a column of type BLOB.</p>
</div>
<div class="paragraph">
<p>To use BLOB or CLOB data types larger than 4 KB for CMP using the Inet
Oraxo JDBC Driver for Oracle Databases, you must set the <code>streamstolob</code>
property value to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>For a list of the JDBC drivers currently supported by the Eclipse GlassFish, see the <a href="release-notes.html#GSRLN">Eclipse GlassFish Release
Notes</a>. For configurations of supported and other drivers, see
"<a href="administration-guide.html#configuration-specifics-for-jdbc-drivers">Configuration Specifics for JDBC Drivers</a>" in
Eclipse GlassFish Administration Guide.</p>
</div>
<div class="paragraph">
<p>For automatic mapping, you might need to change the default BLOB column
length for the generated schema using the <code>schema-generator-properties</code>
element in <code>glassfish-ejb-jar.xml</code>. See your database vendor
documentation to determine whether you need to specify the length. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;schema-generator-properties&gt;</span>
   <span class="tag">&lt;property&gt;</span>
      <span class="tag">&lt;name&gt;</span>Employee.voiceGreeting.jdbc-type<span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;value&gt;</span>BLOB<span class="tag">&lt;/value&gt;</span>
   <span class="tag">&lt;/property&gt;</span>
   <span class="tag">&lt;property&gt;</span>
      <span class="tag">&lt;name&gt;</span>Employee.voiceGreeting.jdbc-maximum-length<span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;value&gt;</span>10240<span class="tag">&lt;/value&gt;</span>
   <span class="tag">&lt;/property&gt;</span>
   ...
<span class="tag">&lt;/schema-generator-properties&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="clob-support"><a class="anchor" href="#clob-support"></a>CLOB Support</h5>
<div class="paragraph">
<p>Character Large Object (CLOB) is a data type used to store and retrieve
very long text fields. CLOBs translate into long strings.</p>
</div>
<div class="paragraph">
<p>To enable CLOB support in the Eclipse GlassFish environment, define a CMP
field of type <code>java.lang.String</code>. If you map the CMP bean to an existing
database schema, map the field to a column of type CLOB.</p>
</div>
<div class="paragraph">
<p>To use BLOB or CLOB data types larger than 4 KB for CMP using the Inet
Oraxo JDBC Driver for Oracle Databases, you must set the <code>streamstolob</code>
property value to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>For a list of the JDBC drivers currently supported by the Eclipse GlassFish, see the <a href="release-notes.html#GSRLN">Eclipse GlassFish Release
Notes</a>. For configurations of supported and other drivers, see
"<a href="administration-guide.html#configuration-specifics-for-jdbc-drivers">Configuration Specifics for JDBC Drivers</a>" in
Eclipse GlassFish Administration Guide.</p>
</div>
<div class="paragraph">
<p>For automatic mapping, you might need to change the default CLOB column
length for the generated schema using the <code>schema-generator-properties</code>
element in <code>glassfish-ejb-jar.xml</code>. See your database vendor
documentation to determine whether you need to specify the length. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;schema-generator-properties&gt;</span>
   <span class="tag">&lt;property&gt;</span>
      <span class="tag">&lt;name&gt;</span>Employee.resume.jdbc-type<span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;value&gt;</span>CLOB<span class="tag">&lt;/value&gt;</span>
   <span class="tag">&lt;/property&gt;</span>
   <span class="tag">&lt;property&gt;</span>
      <span class="tag">&lt;name&gt;</span>Employee.resume.jdbc-maximum-length<span class="tag">&lt;/name&gt;</span>
      <span class="tag">&lt;value&gt;</span>10240<span class="tag">&lt;/value&gt;</span>
   <span class="tag">&lt;/property&gt;</span>
   ...
<span class="tag">&lt;/schema-generator-properties&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="automatic-schema-generation-for-cmp"><a class="anchor" href="#automatic-schema-generation-for-cmp"></a>Automatic Schema Generation for CMP</h3>
<div class="paragraph">
<p>The automatic schema generation feature provided in the Eclipse GlassFish
defines database tables based on the fields in entity beans and the
relationships between the fields. This insulates developers from many of
the database related aspects of development, allowing them to focus on
entity bean development. The resulting schema is usable as-is or can be
given to a database administrator for tuning with respect to
performance, security, and so on.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#supported-data-types-for-cmp">Supported Data Types for CMP</a></p>
</li>
<li>
<p><a href="#generation-options-for-cmp">Generation Options for CMP</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automatic schema generation is supported on an all-or-none basis: it
expects that no tables exist in the database before it is executed. It
is not intended to be used as a tool to generate extra tables or
constraints.</p>
</div>
<div class="paragraph">
<p>Deployment won&#8217;t fail if all tables are not created, and undeployment
won&#8217;t fail if not all tables are dropped. This is done to allow you to
investigate the problem and fix it manually. You should not rely on the
partially created database schema to be correct for running the
application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="supported-data-types-for-cmp"><a class="anchor" href="#supported-data-types-for-cmp"></a>Supported Data Types for CMP</h4>
<div class="paragraph">
<p>CMP supports a set of JDBC data types that are used in mapping Java data
fields to SQL types. Supported JDBC data types are as follows: BIGINT,
BIT, BLOB, CHAR, CLOB, DATE, DECIMAL, DOUBLE, FLOAT, INTEGER, NUMERIC,
REAL, SMALLINT, TIME, TIMESTAMP, TINYINT, VARCHAR.</p>
</div>
<div class="paragraph">
<p>The following table contains the mappings of Java types to JDBC types
when automatic mapping is used.</p>
</div>
<div id="fvyaq" class="paragraph">
<p>Table 9-1 Java Type to JDBC Type Mappings for CMP</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 39%;">
<col style="width: 40%;">
<col style="width: 21%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java Type</th>
<th class="tableblock halign-left valign-top">JDBC Type</th>
<th class="tableblock halign-left valign-top">Nullability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TINYINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Byte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TINYINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DOUBLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DOUBLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>float</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Float</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INTEGER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Integer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INTEGER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>short</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Short</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DECIMAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigInteger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DECIMAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Character</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code> or <code>CLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>DATE</code> (Oracle only)</p>
</div>
<div class="paragraph">
<p><code>TIMESTAMP</code> (all other databases)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Java types assigned to CMP fields must be restricted to Java primitive
types, Java Serializable types, <code>java.util.Date</code>, <code>java.sql.Date</code>,
<code>java.sql.Time</code>, or <code>java.sql.Timestamp</code>. An entity bean local interface
type (or a collection of such) can be the type of a CMR field.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table contains the mappings of JDBC types to database
vendor-specific types when automatic mapping is used. For a list of the
JDBC drivers currently supported by the Eclipse GlassFish, see the
<a href="release-notes.html#GSRLN">Eclipse GlassFish Release Notes</a>. For
configurations of supported and other drivers, see
"<a href="administration-guide.html#configuration-specifics-for-jdbc-drivers">Configuration Specifics for JDBC Drivers</a>" in
Eclipse GlassFish Administration Guide.</p>
</div>
<div id="fvymp" class="paragraph">
<p>Table 9-2 Mappings of JDBC Types to Database Vendor Specific Types for
CMP</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 17%;">
<col style="width: 17%;">
<col style="width: 17%;">
<col style="width: 17%;">
<col style="width: 17%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JDBC Type</th>
<th class="tableblock halign-left valign-top">Apache Derby, CloudScape</th>
<th class="tableblock halign-left valign-top">Oracle</th>
<th class="tableblock halign-left valign-top">DB2</th>
<th class="tableblock halign-left valign-top">Sybase ASE 12.5</th>
<th class="tableblock halign-left valign-top">MS-SQL Server</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TINYINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TINYINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TINYINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TINYINT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INTEGER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INTEGER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INTEGER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INTEGER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INTEGER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INTEGER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NUMBER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NUMERIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NUMERIC</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FLOAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FLOAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REAL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DOUBLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DOUBLE PRECISION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DOUBLE PRECISION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DOUBLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DOUBLE PRECISION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FLOAT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DECIMAL(p,s)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DECIMAL(p,s)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NUMBER(p,s)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DECIMAL(p,s)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DECIMAL(p,s)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DECIMAL(p,s)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VARCHAR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATETIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATETIME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATETIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATETIME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMP(9)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATETIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATETIME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMAGE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMAGE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLOB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TEXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NTEXT</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="generation-options-for-cmp"><a class="anchor" href="#generation-options-for-cmp"></a>Generation Options for CMP</h4>
<div class="paragraph">
<p>Deployment descriptor elements or <code>asadmin</code> command line options can
control automatic schema generation by the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating tables during deployment</p>
</li>
<li>
<p>Dropping tables during undeployment</p>
</li>
<li>
<p>Dropping and creating tables during redeployment</p>
</li>
<li>
<p>Specifying the database vendor</p>
</li>
<li>
<p>Specifying that table names are unique</p>
</li>
<li>
<p>Specifying type mappings for individual CMP fields</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before using these options, make sure you have a properly configured CMP
resource. See <a href="#configuring-the-cmp-resource">Configuring the CMP Resource</a>.</p>
</div>
<div class="paragraph">
<p>For a read-only bean, do not create the database schema during
deployment. Instead, work with your database administrator to populate
the data into the tables. See <a href="#using-read-only-beans">Using Read-Only Beans</a>.</p>
</div>
<div class="paragraph">
<p>Automatic schema generation is not supported for beans with version
column consistency checking. Instead, work with your database
administrator to create the schema and add the required triggers. See
<a href="#version-column-consistency-checking">Version Column Consistency Checking</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following optional data subelements of the <code>cmp-resource</code> element in
the <code>glassfish-ejb-jar.xml</code> file control the automatic creation of
database tables at deployment. For more information about the
<code>cmp-resource</code> element, see "<a href="application-deployment-guide.html#cmp-resource">cmp-resource</a>" in
Eclipse GlassFish Application Deployment Guide and
<a href="#configuring-the-cmp-resource">Configuring the CMP Resource</a>.</p>
</div>
<div id="fvymo" class="paragraph">
<p>Table 9-3 The <code>glassfish-ejb-jar.xml</code> Generation Elements</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 46%;">
<col style="width: 34%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="application-deployment-guide.html#create-tables-at-deploy"><code>create-tables-at-deploy</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, causes
database tables to be created for beans that are automatically mapped by
the EJB container. No unique constraints are created. If <code>false</code>, does
not create tables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="application-deployment-guide.html#drop-tables-at-undeploy"><code>drop-tables-at-undeploy</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, causes
database tables that were automatically created when the bean(s) were
last deployed to be dropped when the bean(s) are undeployed. If <code>false</code>,
does not drop tables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="application-deployment-guide.html#database-vendor-name"><code>database-vendor-name</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the name of the database vendor for which tables are created.
Allowed values are <code>javadb</code>, <code>db2</code>, <code>mssql</code>, <code>mysql</code>, <code>oracle</code>,
<code>postgresql</code>, <code>pointbase</code>, <code>derby</code> (also for CloudScape), and <code>sybase</code>,
case-insensitive.</p>
</div>
<div class="paragraph">
<p>If no value is specified, a connection is made to the resource specified
by the <code>jndi-name</code> subelement of the <code>cmp-resource</code> element in the
<code>glassfish-ejb-jar.xml</code> file, and the database vendor name is read. If
the connection cannot be established, or if the value is not recognized,
SQL-92 compliance is presumed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="application-deployment-guide.html#schema-generator-properties"><code>schema-generator-properties</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies field-specific column attributes in <code>property</code> subelements.
Each property name is of the following format:</p>
</div>
<div class="paragraph">
<p>bean-name`.<code>field-name</code>.`attribute</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p><code>Employee.firstName.jdbc-type</code></p>
</div>
<div class="paragraph">
<p>Also allows you to set the <code>use-unique-table-names</code> property. If <code>true</code>,
this property specifies that generated table names are unique within
each Eclipse GlassFish domain. The default is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>For further information and an example, see
"<a href="application-deployment-guide.html#schema-generator-properties">schema-generator-properties</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following options of the <code>asadmin deploy</code> or <code>asadmin deploydir</code>
command control the automatic creation of database tables at deployment.</p>
</div>
<div id="fvymn" class="paragraph">
<p>Table 9-4 The <code>asadmin deploy</code> and <code>asadmin deploydir</code> Generation
Options for CMP</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16%;">
<col style="width: 46%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--createtables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, causes database tables to be created
for beans that need them. No unique constraints are created. If <code>false</code>,
does not create tables. If not specified, the value of the
<code>create-tables-at-deploy</code> attribute in <code>glassfish-ejb-jar.xml</code> is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dropandcreatetables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If <code>true</code>, and if tables were automatically created when this
application was last deployed, tables from the earlier deployment are
dropped and fresh ones are created.</p>
</div>
<div class="paragraph">
<p>If <code>true</code>, and if tables were not automatically created when this
application was last deployed, no attempt is made to drop any tables. If
tables with the same names as those that would have been automatically
created are found, the deployment proceeds, but a warning indicates that
tables could not be created.</p>
</div>
<div class="paragraph">
<p>If <code>false</code>, settings of <code>create-tables-at-deploy</code> or
<code>drop-tables-at-undeploy</code> in the <code>glassfish-ejb-jar.xml</code> file are
overridden.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--uniquetablenames</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, specifies that table names are
unique within each Eclipse GlassFish domain. If not specified, the value
of the <code>use-unique-table-names</code> property in <code>glassfish-ejb-jar.xml</code> is
used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dbvendorname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the name of the database vendor for which tables are created.
Allowed values are <code>javadb</code>, <code>db2</code>, <code>mssql</code>, <code>oracle</code>, <code>postgresql</code>,
<code>pointbase</code>, <code>derby</code> (also for CloudScape), and <code>sybase</code>,
case-insensitive.</p>
</div>
<div class="paragraph">
<p>If not specified, the value of the <code>database-vendor-name</code> attribute in
<code>glassfish-ejb-jar.xml</code> is used.</p>
</div>
<div class="paragraph">
<p>If no value is specified, a connection is made to the resource specified
by the <code>jndi-name</code> subelement of the <code>cmp-resource</code> element in the
<code>glassfish-ejb-jar.xml</code> file, and the database vendor name is read. If
the connection cannot be established, or if the value is not recognized,
SQL-92 compliance is presumed.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If one or more of the beans in the module are manually mapped and you
use any of the <code>asadmin deploy</code> or <code>asadmin deploydir</code> options, the
deployment is not harmed in any way, but the options have no effect, and
a warning is written to the server log.</p>
</div>
<div class="paragraph">
<p>The following options of the <code>asadmin undeploy</code> command control the
automatic removal of database tables at undeployment.</p>
</div>
<div id="fvymt" class="paragraph">
<p>Table 9-5 The <code>asadmin undeploy</code> Generation Options for CMP</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 46%;">
<col style="width: 44%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--droptables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If <code>true</code>, causes database tables that were automatically created when
the bean(s) were last deployed to be dropped when the bean(s) are
undeployed. If <code>false</code>, does not drop tables.</p>
</div>
<div class="paragraph">
<p>If not specified, the value of the <code>drop-tables-at-undeploy</code> attribute
in <code>glassfish-ejb-jar.xml</code> is used.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information about the <code>asadmin deploy</code>, <code>asadmin deploydir</code>,
and <code>asadmin undeploy</code> commands, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>When command line and <code>glassfish-ejb-jar.xml</code> options are both
specified, the <code>asadmin</code> options take precedence.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema-capture"><a class="anchor" href="#schema-capture"></a>Schema Capture</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#automatic-database-schema-capture">Automatic Database Schema Capture</a></p>
</li>
<li>
<p><a href="#using-the-capture-schema-utility">Using the <code>capture-schema</code> Utility</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="automatic-database-schema-capture"><a class="anchor" href="#automatic-database-schema-capture"></a>Automatic Database Schema Capture</h4>
<div class="paragraph">
<p>You can configure a CMP bean in Eclipse GlassFish to automatically
capture the database metadata and save it in a <code>.dbschema</code> file during
deployment. If the <code>sun-cmp-mappings.xml</code> file contains an empty
<code>&lt;schema/&gt;</code> entry, the <code>cmp-resource</code> entry in the
<code>glassfish-ejb-jar.xml</code> file is used to get a connection to the
database, and automatic generation of the schema is performed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before capturing the database schema automatically, make sure you have a
properly configured CMP resource. See <a href="#configuring-the-cmp-resource">Configuring the CMP Resource</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="using-the-capture-schema-utility"><a class="anchor" href="#using-the-capture-schema-utility"></a>Using the <code>capture-schema</code> Utility</h4>
<div class="paragraph">
<p>You can use the <code>capture-schema</code> command to manually generate the
database metadata (<code>.dbschema</code>) file. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>The <code>capture-schema</code> utility does not modify the schema in any way. Its
only purpose is to provide the persistence engine with information about
the structure of the database (the schema).</p>
</div>
<div class="paragraph">
<p>Keep the following in mind when using the <code>capture-schema</code> command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of a <code>.dbschema</code> file must be unique across all deployed
modules in a domain.</p>
</li>
<li>
<p>If more than one schema is accessible for the schema user, more than
one table with the same name might be captured if the <code>-schemaname</code>
option of <code>capture-schema</code> is not set.</p>
</li>
<li>
<p>The schema name must be upper case.</p>
</li>
<li>
<p>Table names in databases are case-sensitive. Make sure that the table
name matches the name in the database.</p>
</li>
<li>
<p>PostgreSQL databases internally convert all names to lower case.
Before running the <code>capture-schema</code> command on a PostgreSQL database,
make sure table and column names are lower case in the
<code>sun-cmp-mappings.xml</code> file.</p>
</li>
<li>
<p>An Oracle database user running the <code>capture-schema</code> command needs
ANALYZE ANY TABLE privileges if that user does not own the schema. These
privileges are granted to the user by the database administrator.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-cmp-resource"><a class="anchor" href="#configuring-the-cmp-resource"></a>Configuring the CMP Resource</h3>
<div class="paragraph">
<p>An EJB module that contains CMP beans requires the JNDI name of a JDBC
resource in the <code>jndi-name</code> subelement of the <code>cmp-resource</code> element in
the <code>glassfish-ejb-jar.xml</code> file. Set <code>PersistenceManagerFactory</code>
properties as properties of the <code>cmp-resource</code> element in the
<code>glassfish-ejb-jar.xml</code> file. See "<a href="application-deployment-guide.html#cmp-resource">cmp-resource</a>" in
Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>In the Administration Console, open the Resources component, then select
JDBC. Click the Help button in the Administration Console for
information on creating a new JDBC resource.</p>
</div>
<div class="paragraph">
<p>For a list of the JDBC drivers currently supported by the Eclipse GlassFish, see the <a href="release-notes.html#GSRLN">Eclipse GlassFish Release
Notes</a>. For configurations of supported and other drivers, see
"<a href="administration-guide.html#configuration-specifics-for-jdbc-drivers">Configuration Specifics for JDBC Drivers</a>" in
Eclipse GlassFish Administration Guide.</p>
</div>
<div class="paragraph">
<p>For example, if the JDBC resource has the JNDI name <code>jdbc/MyDatabase</code>,
set the CMP resource in the <code>glassfish-ejb-jar.xml</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cmp-resource&gt;</span>
   <span class="tag">&lt;jndi-name&gt;</span>jdbc/MyDatabase<span class="tag">&lt;/jndi-name&gt;</span>
<span class="tag">&lt;/cmp-resource&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="performance-related-features"><a class="anchor" href="#performance-related-features"></a>Performance-Related Features</h3>
<div class="paragraph">
<p>The Eclipse GlassFish provides the following features to enhance
performance or allow more fine-grained data checking. These features are
supported only for entity beans with container managed persistence.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#version-column-consistency-checking">Version Column Consistency Checking</a></p>
</li>
<li>
<p><a href="#relationship-prefetching">Relationship Prefetching</a></p>
</li>
<li>
<p><a href="#read-only-beans">Read-Only Beans</a></p>
</li>
<li>
<p><a href="#default-fetch-group-flags">Default Fetch Group Flags</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use of any of these features results in a non-portable application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="version-column-consistency-checking"><a class="anchor" href="#version-column-consistency-checking"></a>Version Column Consistency Checking</h4>
<div class="paragraph">
<p>The version consistency feature saves the bean state at first
transactional access and caches it between transactions. The state is
copied from the cache instead of being read from the database. The bean
state is verified by primary key and version column values at flush for
custom queries (for dirty instances only) and at commit (for clean and
dirty instances).</p>
</div>
<div class="sect4">
<h5 id="to-use-version-consistency"><a class="anchor" href="#to-use-version-consistency"></a>To Use Version Consistency</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the version column in the primary table.</p>
</li>
<li>
<p>Give the version column a numeric data type.</p>
</li>
<li>
<p>Provide appropriate update triggers on the version column.<br>
These triggers must increment the version column on each update of the
specified row.</p>
</li>
<li>
<p>Specify the version column.<br>
This is specified in the <code>check-version-of-accessed-instances</code>
subelement of the <code>consistency</code> element in the <code>sun-cmp-mappings.xml</code>
file. See "<a href="application-deployment-guide.html#consistency">consistency</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</li>
<li>
<p>Map the CMP bean to an existing schema.</p>
<div class="paragraph">
<p>Automatic schema generation is not supported for beans with version
column consistency checking. Instead, work with your database
administrator to create the schema and add the required triggers.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="relationship-prefetching"><a class="anchor" href="#relationship-prefetching"></a>Relationship Prefetching</h4>
<div class="paragraph">
<p>In many cases when an entity bean&#8217;s state is fetched from the database,
its relationship fields are always accessed in the same transaction.
Relationship prefetching saves database round trips by fetching data for
an entity bean and those beans referenced by its CMR fields in a single
database round trip.</p>
</div>
<div class="paragraph">
<p>To enable relationship prefetching for a CMR field, use the <code>default</code>
subelement of the <code>fetched-with</code> element in the <code>sun-cmp-mappings.xml</code>
file. By default, these CMR fields are prefetched whenever
<code>findByPrimaryKey</code> or a custom finder is executed for the entity, or
when the entity is navigated to from a relationship. (Recursive
prefetching is not supported, because it does not usually enhance
performance.) See "<a href="application-deployment-guide.html#fetched-with">fetched-with</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>To disable prefetching for specific custom finders, use the
<code>prefetch-disabled</code> element in the <code>glassfish-ejb-jar.xml</code> file. See
"<a href="application-deployment-guide.html#prefetch-disabled">prefetch-disabled</a>"
in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>Multilevel relationship prefetching is supported for CMP 2.1 entity
beans. To enable multilevel relationship prefetching, set the following
property using the <code>asadmin create-jvm-options</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -Dcom.sun.jdo.spi.persistence.support.sqlstore.MULTILEVEL_PREFETCH=true</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="read-only-beans-2"><a class="anchor" href="#read-only-beans-2"></a>Read-Only Beans</h4>
<div class="paragraph">
<p>Another feature that the Eclipse GlassFish provides is the read-only
bean, an entity bean that is never modified by an EJB client. Read-only
beans avoid database updates completely.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Read-only beans are specific to the Eclipse GlassFish and are not part of
the Enterprise JavaBeans Specification, v2.1. Use of this feature for an
EJB 2.1 bean results in a non-portable application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A read-only bean can be used to cache a database entry that is
frequently accessed but rarely updated (externally by other beans). When
the data that is cached by a read-only bean is updated by another bean,
the read-only bean can be notified to refresh its cached data.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish provides a number of ways by which a read-only
bean&#8217;s state can be refreshed. By setting the
<code>refresh-period-in-seconds</code> element in the <code>glassfish-ejb-jar.xml</code> file
and the <code>trans-attribute</code> element (or <code>@TransactionAttribute</code>
annotation) in the <code>ejb-jar.xml</code> file, it is easy to configure a
read-only bean that is one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always refreshed</p>
</li>
<li>
<p>Periodically refreshed</p>
</li>
<li>
<p>Never refreshed</p>
</li>
<li>
<p>Programmatically refreshed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Access to CMR fields of read-only beans is not supported. Deployment
will succeed, but an exception will be thrown at runtime if a get or set
method is invoked.</p>
</div>
<div class="paragraph">
<p>Read-only beans are best suited for situations where the underlying data
never changes, or changes infrequently. For further information and
usage guidelines, see <a href="#using-read-only-beans">Using Read-Only Beans</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="default-fetch-group-flags"><a class="anchor" href="#default-fetch-group-flags"></a>Default Fetch Group Flags</h3>
<div class="paragraph">
<p>Using the following flags can improve performance.</p>
</div>
<div class="paragraph">
<p>Setting <code>-DAllowManagedFieldsInDefaultFetchGroup=true</code> allows CMP fields
that by default cannot be placed into the default fetch group to be
loaded along with all other fields that are fetched when the CMP state
is loaded into memory. These could be multiple fields mapped to the same
column in the database table, for example, an instance field and a CMR.
By default this flag is set to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>For additional information, see "<a href="application-deployment-guide.html#level">level</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>Setting <code>-DAllowMediatedWriteInDefaultFetchGroup</code> specifies how updated
CMP fields are written back to the database. If the flag is <code>false</code>, all
fields in the CMP bean are written back to the database if at least one
field in the default fetch group has been changed in a transaction. If
the flag is <code>true</code>, only fields modified by the bean are written back to
the database. Specifying <code>true</code> can improve performance, particularly on
database tables with many columns that have not been updated. By default
this flag is set to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>To set one of these flags, use the <code>asadmin create-jvm-options</code> command.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -DAllowManagedFieldsInDefaultFetchGroup=true</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSDVG00157"></a><a id="configuring-queries-for-1.1-finders"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-queries-for-1-1-finders"><a class="anchor" href="#configuring-queries-for-1-1-finders"></a>Configuring Queries for 1.1 Finders</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#about-jdoql-queries">About JDOQL Queries</a></p>
</li>
<li>
<p><a href="#query-filter-expression">Query Filter Expression</a></p>
</li>
<li>
<p><a href="#query-parameters">Query Parameters</a></p>
</li>
<li>
<p><a href="#query-variables">Query Variables</a></p>
</li>
<li>
<p><a href="#jdoql-examples">JDOQL Examples</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="about-jdoql-queries"><a class="anchor" href="#about-jdoql-queries"></a>About JDOQL Queries</h4>
<div class="paragraph">
<p>The Enterprise JavaBeans Specification, v1.1 does not specify the format
of the finder method description. The Eclipse GlassFish uses an extension
of Java Data Objects Query Language (JDOQL) queries to implement finder
and selector methods. You can specify the following elements of the
underlying JDOQL query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Filter expression - A Java-like expression that specifies a condition
that each object returned by the query must satisfy. Corresponds to the
WHERE clause in EJB QL.</p>
</li>
<li>
<p>Query parameter declaration - Specifies the name and the type of one
or more query input parameters. Follows the syntax for formal parameters
in the Java language.</p>
</li>
<li>
<p>Query variable declaration - Specifies the name and type of one or
more query variables. Follows the syntax for local variables in the Java
language. A query filter might use query variables to implement joins.</p>
</li>
<li>
<p>Query ordering declaration - Specifies the ordering expression of the
query. Corresponds to the ORDER BY clause of EJB QL.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish specific deployment descriptor
(<code>glassfish-ejb-jar.xml</code>) provides the following elements to store the
EJB 1.1 finder method settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>query-filter
query-params
query-variables
query-ordering</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean developer uses these elements to construct a query. When the
finder method that uses these elements executes, the values of these
elements are used to execute a query in the database. The objects from
the JDOQL query result set are converted into primary key instances to
be returned by the EJB 1.1 <code>ejbFind</code> method.</p>
</div>
<div class="paragraph">
<p>The JDO specification, <a href="http://jcp.org/en/jsr/detail?id=12">JSR 12</a>
(<code><a href="http://jcp.org/en/jsr/detail?id=12" class="bare">http://jcp.org/en/jsr/detail?id=12</a></code>), provides a comprehensive
description of JDOQL. The following information summarizes the elements
used to define EJB 1.1 finders.</p>
</div>
</div>
<div class="sect3">
<h4 id="query-filter-expression"><a class="anchor" href="#query-filter-expression"></a>Query Filter Expression</h4>
<div class="paragraph">
<p>The filter expression is a String containing a Boolean expression
evaluated for each instance of the candidate class. If the filter is not
specified, it defaults to true. Rules for constructing valid expressions
follow the Java language, with the following differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Equality and ordering comparisons between primitives and instances of
wrapper classes are valid.</p>
</li>
<li>
<p>Equality and ordering comparisons of Date fields and Date parameters
are valid.</p>
</li>
<li>
<p>Equality and ordering comparisons of String fields and String
parameters are valid.</p>
</li>
<li>
<p>White space (non-printing characters space, tab, carriage return, and
line feed) is a separator and is otherwise ignored.</p>
</li>
<li>
<p>The following assignment operators are not supported.</p>
<div class="ulist">
<ul>
<li>
<p>Comparison operators such as =, +=, and so on</p>
</li>
<li>
<p>Pre- and post-increment</p>
</li>
<li>
<p>Pre- and post-decrement</p>
</li>
</ul>
</div>
</li>
<li>
<p>Methods, including object construction, are not supported, except for
these methods.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Collection</span>.contains(<span class="predefined-type">Object</span> o)
<span class="predefined-type">Collection</span>.isEmpty()
<span class="predefined-type">String</span>.startsWith(<span class="predefined-type">String</span> s)
<span class="predefined-type">String</span>.endsWith(<span class="predefined-type">String</span> e)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, the Eclipse GlassFish supports the following nonstandard
JDOQL methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span>.like(<span class="predefined-type">String</span> pattern)
<span class="predefined-type">String</span>.like(<span class="predefined-type">String</span> pattern, <span class="type">char</span> escape)
<span class="predefined-type">String</span>.substring(<span class="type">int</span> start, <span class="type">int</span> length)
<span class="predefined-type">String</span>.indexOf(<span class="predefined-type">String</span> str)
<span class="predefined-type">String</span>.indexOf(<span class="predefined-type">String</span> str, <span class="type">int</span> start)
<span class="predefined-type">String</span>.length()
<span class="predefined-type">Math</span>.abs(numeric n)
<span class="predefined-type">Math</span>.sqrt(<span class="type">double</span> d)</code></pre>
</div>
</div>
</li>
<li>
<p>Navigation through a null-valued field, which throws a
<code>NullPointerException</code>, is treated as if the sub-expression returned
<code>false</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Comparisons between floating point values are by nature inexact.
Therefore, equality comparisons (== and !=) with floating point values
should be used with caution. Identifiers in the expression are
considered to be in the name space of the candidate class, with the
addition of declared parameters and variables. As in the Java language,
<code>this</code> is a reserved word, and refers to the current instance being
evaluated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following expressions are supported.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Relational operators (==, !=,&gt;, &lt;,&gt;=, &#8656;)</p>
</li>
<li>
<p>Boolean operators (&amp;, &amp;&amp;, |, ||, ~, !)</p>
</li>
<li>
<p>Arithmetic operators (+, -, *, /)</p>
</li>
<li>
<p>String concatenation, only for String + String</p>
</li>
<li>
<p>Parentheses to explicitly mark operator precedence</p>
</li>
<li>
<p>Cast operator</p>
</li>
<li>
<p>Promotion of numeric operands for comparisons and arithmetic
operations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rules for promotion follow the Java rules extended by BigDecimal,
BigInteger, and numeric wrapper classes. See the numeric promotions of
the Java language specification.</p>
</div>
</div>
<div class="sect3">
<h4 id="query-parameters"><a class="anchor" href="#query-parameters"></a>Query Parameters</h4>
<div class="paragraph">
<p>The parameter declaration is a String containing one or more parameter
type declarations separated by commas. This follows the Java syntax for
method signatures.</p>
</div>
</div>
<div class="sect3">
<h4 id="query-variables"><a class="anchor" href="#query-variables"></a>Query Variables</h4>
<div class="paragraph">
<p>The type declarations follow the Java syntax for local variable
declarations.</p>
</div>
</div>
<div class="sect3">
<h4 id="jdoql-examples"><a class="anchor" href="#jdoql-examples"></a>JDOQL Examples</h4>
<div class="paragraph">
<p>This section provides a few query examples.</p>
</div>
<div class="sect4">
<h5 id="example-1"><a class="anchor" href="#example-1"></a>Example 1</h5>
<div class="paragraph">
<p>The following query returns all players called Michael. It defines a
filter that compares the name field with a string literal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">name == <span class="string"><span class="delimiter">&quot;</span><span class="content">Michael</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>finder</code> element of the <code>glassfish-ejb-jar.xml</code> file looks like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;finder&gt;</span>
   <span class="tag">&lt;method-name&gt;</span>findPlayerByName<span class="tag">&lt;/method-name&gt;</span>
   <span class="tag">&lt;query-filter&gt;</span>name == &quot;Michael&quot;<span class="tag">&lt;/query-filter&gt;</span>
<span class="tag">&lt;/finder&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-2"><a class="anchor" href="#example-2"></a>Example 2</h5>
<div class="paragraph">
<p>This query returns all products in a specified price range. It defines
two query parameters which are the lower and upper bound for the price:
double low, double high. The filter compares the query parameters with
the price field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">low &lt; price &amp;&amp; price &lt; high</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query ordering is set to <code>price ascending</code>.</p>
</div>
<div class="paragraph">
<p>The <code>finder</code> element of the <code>glassfish-ejb-jar.xml</code> file looks like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;finder&gt;</span>
   <span class="tag">&lt;method-name&gt;</span>findInRange<span class="tag">&lt;/method-name&gt;</span>
   <span class="tag">&lt;query-params&gt;</span>double low, double high<span class="tag">&lt;/query-params&gt;</span>
   <span class="tag">&lt;query-filter&gt;</span>low <span class="entity">&amp;lt;</span> price <span class="entity">&amp;amp;</span><span class="entity">&amp;amp;</span> price <span class="error">&amp;</span>lt high<span class="tag">&lt;/query-filter&gt;</span>
   <span class="tag">&lt;query-ordering&gt;</span>price ascending<span class="tag">&lt;/query-ordering&gt;</span>
<span class="tag">&lt;/finder&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-3"><a class="anchor" href="#example-3"></a>Example 3</h5>
<div class="paragraph">
<p>This query returns all players having a higher salary than the player
with the specified name. It defines a query parameter for the name
<code>java.lang.String name</code>. Furthermore, it defines a variable to which the
player&#8217;s salary is compared. It has the type of the persistence capable
class that corresponds to the bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    mypackage.PlayerEJB_170160966_JDOState player</code></pre>
</div>
</div>
<div class="paragraph">
<p>The filter compares the salary of the current player denoted by the
<code>this</code> keyword with the salary of the player with the specified name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    (<span class="local-variable">this</span>.salary&gt; player.salary) &amp;&amp; (player.name == name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>finder</code> element of the <code>glassfish-ejb-jar.xml</code> file looks like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;finder&gt;</span>
   <span class="tag">&lt;method-name&gt;</span>findByHigherSalary<span class="tag">&lt;/method-name&gt;</span>
   <span class="tag">&lt;query-params&gt;</span>java.lang.String name<span class="tag">&lt;/query-params&gt;</span>
   <span class="tag">&lt;query-filter&gt;</span>
      (this.salary <span class="entity">&amp;gt;</span> player.salary) <span class="entity">&amp;amp;</span><span class="entity">&amp;amp;</span> (player.name == name)
   <span class="tag">&lt;/query-filter&gt;</span>
   <span class="tag">&lt;query-variables&gt;</span>
      mypackage.PlayerEJB_170160966_JDOState player
   <span class="tag">&lt;/query-variables&gt;</span>
<span class="tag">&lt;/finder&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cmp-restrictions-and-optimizations"><a class="anchor" href="#cmp-restrictions-and-optimizations"></a>CMP Restrictions and Optimizations</h3>
<div class="paragraph">
<p>This section discusses restrictions and performance optimizations that
pertain to using CMP.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#disabling-order-by-validation">Disabling ORDER BY Validation</a></p>
</li>
<li>
<p><a href="#setting-the-heap-size-on-db2">Setting the Heap Size on DB2</a></p>
</li>
<li>
<p><a href="#eager-loading-of-field-state">Eager Loading of Field State</a></p>
</li>
<li>
<p><a href="#restrictions-on-remote-interfaces">Restrictions on Remote Interfaces</a></p>
</li>
<li>
<p><a href="#postgresql-case-insensitivity">PostgreSQL Case Insensitivity</a></p>
</li>
<li>
<p><a href="#no-support-for-lock-when-loaded-on-sybase">No Support for <code>lock-when-loaded</code> on Sybase</a></p>
</li>
<li>
<p><a href="#sybase-finder-limitation">Sybase Finder Limitation</a></p>
</li>
<li>
<p><a href="#date-and-time-fields">Date and Time Fields</a></p>
</li>
<li>
<p><a href="#set-recursive_triggers-to-false-on-mssql">Set <code>RECURSIVE_TRIGGERS</code> to <code>false</code> on MSSQL</a></p>
</li>
<li>
<p><a href="#mysql-database-restrictions">MySQL Database Restrictions</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="disabling-order-by-validation"><a class="anchor" href="#disabling-order-by-validation"></a>Disabling ORDER BY Validation</h4>
<div class="paragraph">
<p>EJB QL as defined in the EJB 2.1 Specification defines certain
restrictions for the SELECT clause of an ORDER BY query (see section
11.2.8 ORDER BY Clause). This ensures that a query does not order by a
field that is not returned by the query. By default, the EJB QL compiler
checks the above restriction and throws an exception if the query does
not conform.</p>
</div>
<div class="paragraph">
<p>However, some databases support SQL statements with an ORDER BY column
that is not included in the SELECT clause. To disable the validation of
the ORDER BY clause against the SELECT clause, set the
<code>DISABLE_ORDERBY_VALIDATION</code> JVM option as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options
-Dcom.sun.jdo.spi.persistence.support.ejb.ejbqlc.DISABLE_ORDERBY_VALIDATION=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DISABLE_ORDERBY_VALIDATION</code> option is set to <code>false</code> by default.
Setting it to <code>true</code> results in a non-portable module or application.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-the-heap-size-on-db2"><a class="anchor" href="#setting-the-heap-size-on-db2"></a>Setting the Heap Size on DB2</h4>
<div class="paragraph">
<p>On DB2, the database configuration parameter <code>APPLHEAPSZ</code> determines the
heap size. If you are using the Oracle or DataDirect database driver,
set this parameter to at least <code>2048</code> for CMP. For more information, see
<code><a href="http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp?topic=/com.ibm.db2.udb.doc/opt/tsbp2024.html" class="bare">http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp?topic=/com.ibm.db2.udb.doc/opt/tsbp2024.html</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="eager-loading-of-field-state"><a class="anchor" href="#eager-loading-of-field-state"></a>Eager Loading of Field State</h4>
<div class="paragraph">
<p>By default, the EJB container loads the state for all persistent fields
(excluding relationship, BLOB, and CLOB fields) before invoking the
<code>ejbLoad</code> method of the abstract bean. This approach might not be
optimal for entity objects with large state if most business methods
require access to only parts of the state.</p>
</div>
<div class="paragraph">
<p>Use the <code>fetched-with</code> element in <code>sun-cmp-mappings.xml</code> for fields that
are used infrequently. See "<a href="application-deployment-guide.html#fetched-with">fetched-with</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="restrictions-on-remote-interfaces"><a class="anchor" href="#restrictions-on-remote-interfaces"></a>Restrictions on Remote Interfaces</h4>
<div class="paragraph">
<p>The following restrictions apply to the remote interface of an EJB 2.1
bean that uses CMP:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not expose the <code>get</code> and <code>set</code> methods for CMR fields or the
persistence collection classes that are used in container-managed
relationships through the remote interface of the bean.</p>
<div class="paragraph">
<p>However, you are free to expose the <code>get</code> and <code>set</code> methods that
correspond to the CMP fields of the entity bean through the bean&#8217;s
remote interface.</p>
</div>
</li>
<li>
<p>Do not expose the container-managed collection classes that are used
for relationships through the remote interface of the bean.</p>
</li>
<li>
<p>Do not expose local interface types or local home interface types
through the remote interface or remote home interface of the bean.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dependent value classes can be exposed in the remote interface or remote
home interface, and can be included in the client EJB JAR file.</p>
</div>
</div>
<div class="sect3">
<h4 id="postgresql-case-insensitivity"><a class="anchor" href="#postgresql-case-insensitivity"></a>PostgreSQL Case Insensitivity</h4>
<div class="paragraph">
<p>Case-sensitive behavior cannot be achieved for PostgreSQL databases.
PostgreSQL databases internally convert all names to lower case, which
makes the following workarounds necessary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the CMP 2.1 runtime, PostgreSQL table and column names are not
quoted, which makes these names case insensitive.</p>
</li>
<li>
<p>Before running the <code>capture-schema</code> command on a PostgreSQL database,
make sure table and column names are lower case in the
<code>sun-cmp-mappings.xml</code> file.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="no-support-for-lock-when-loaded-on-sybase"><a class="anchor" href="#no-support-for-lock-when-loaded-on-sybase"></a>No Support for <code>lock-when-loaded</code> on Sybase</h4>
<div class="paragraph">
<p>For EJB 2.1 beans, the <code>lock-when-loaded</code> consistency level is
implemented by placing update locks on the data corresponding to a bean
when the data is loaded from the database. There is no suitable
mechanism available on Sybase databases to implement this feature.
Therefore, the <code>lock-when-loaded</code> consistency level is not supported on
Sybase databases. See "<a href="application-deployment-guide.html#consistency">consistency</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="sybase-finder-limitation-2"><a class="anchor" href="#sybase-finder-limitation-2"></a>Sybase Finder Limitation</h4>
<div class="paragraph">
<p>If a finder method with an input greater than 255 characters is executed
and the primary key column is mapped to a VARCHAR column, Sybase
attempts to convert type VARCHAR to type TEXT and generates the
following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>com.sybase.jdbc2.jdbc.SybSQLException: Implicit conversion from datatype
'TEXT' to 'VARCHAR' is not allowed. Use the CONVERT function to run this query.</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid this error, make sure the finder method input is less than 255
characters.</p>
</div>
</div>
<div class="sect3">
<h4 id="date-and-time-fields"><a class="anchor" href="#date-and-time-fields"></a>Date and Time Fields</h4>
<div class="paragraph">
<p>If a field type is a Java date or time type (<code>java.util.Date</code>,
<code>java.sql.Date</code>, <code>java.sql.Time</code>, <code>java.sql.Timestamp</code>), make sure that
the field value exactly matches the value in the database.</p>
</div>
<div class="paragraph">
<p>For example, the following code uses a <code>java.sql.Date</code> type as a primary
key field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java.sql.Date myDate = <span class="keyword">new</span> java.sql.Date(<span class="predefined-type">System</span>.currentTimeMillis())
BeanA.create(myDate, ...);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For some databases, this code results in only the year, month, and date
portion of the field value being stored in the database. Later if the
client tries to find this bean by primary key as follows, the bean is
not found in the database because the value does not match the one that
is stored in the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">myBean = BeanA.findByPrimaryKey(myDate);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar problems can happen if the database truncates the timestamp
value while storing it, or if a custom query has a date or time value
comparison in its WHERE clause.</p>
</div>
<div class="paragraph">
<p>For automatic mapping to an Oracle database, fields of type
<code>java.util.Date</code>, <code>java.sql.Date</code>, and <code>java.sql.Time</code> are mapped to
Oracle&#8217;s DATE data type. Fields of type <code>java.sql.Timestamp</code> are mapped
to Oracle&#8217;s <code>TIMESTAMP(9)</code> data type.</p>
</div>
</div>
<div class="sect3">
<h4 id="set-recursive_triggers-to-false-on-mssql"><a class="anchor" href="#set-recursive_triggers-to-false-on-mssql"></a>Set <code>RECURSIVE_TRIGGERS</code> to <code>false</code> on MSSQL</h4>
<div class="paragraph">
<p>For version consistency triggers on MSSQL, the property
<code>RECURSIVE_TRIGGERS</code> must be set to <code>false</code>, which is the default. If
set to <code>true</code>, triggers throw a <code>java.sql.SQLException</code>.</p>
</div>
<div class="paragraph">
<p>Set this property as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">EXEC sp_dboption <span class="string"><span class="delimiter">'</span><span class="content">database-name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">recursive triggers</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">FALSE</span><span class="delimiter">'</span></span>
go</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can test this property as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> DATABASEPROPERTYEX(<span class="string"><span class="delimiter">'</span><span class="content">database-name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">IsRecursiveTriggersEnabled</span><span class="delimiter">'</span></span>)
go</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mysql-database-restrictions-2"><a class="anchor" href="#mysql-database-restrictions-2"></a>MySQL Database Restrictions</h4>
<div class="paragraph">
<p>The following restrictions apply when you use a MySQL database with the
Eclipse GlassFish for persistence.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MySQL treats <code>int1</code> and <code>int2</code> as reserved words. If you want to
define <code>int1</code> and <code>int2</code> as fields in your table, use <code>\`int1`</code> and
<code>\`int2\`</code> field names in your SQL file.</p>
</li>
<li>
<p>When <code>VARCHAR</code> fields get truncated, a warning is displayed instead of
an error. To get an error message, start the MySQL database in strict
SQL mode.</p>
</li>
<li>
<p>The order of fields in a foreign key index must match the order in the
explicitly created index on the primary table.</p>
</li>
<li>
<p>The <code>CREATE TABLE</code> syntax in the SQL file must end with the following
line.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">)  <span class="directive">Engine</span>=InnoDB;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>InnoDB</code> provides MySQL with a transaction-safe (ACID compliant) storage
engine having commit, rollback, and crash recovery capabilities.</p>
</div>
</li>
<li>
<p>For a <code>FLOAT</code> type field, the correct precision must be defined. By
default, MySQL uses four bytes to store a <code>FLOAT</code> type that does not
have an explicit precision definition. For example, this causes a number
such as 12345.67890123 to be rounded off to 12345.7 during an <code>INSERT</code>.
To prevent this, specify <code>FLOAT(10,2)</code> in the DDL file, which forces the
database to use an eight-byte double-precision column. For more
information, see <code><a href="http://dev.mysql.com/doc/mysql/en/numeric-types.html" class="bare">http://dev.mysql.com/doc/mysql/en/numeric-types.html</a></code>.</p>
</li>
<li>
<p>To use <code>||</code> as the string concatenation symbol, start the MySQL server
with the <code>--sql-mode="PIPES_AS_CONCAT"</code> option. For more information,
see <code><a href="http://dev.mysql.com/doc/refman/5.0/en/server-sql-mode.html" class="bare">http://dev.mysql.com/doc/refman/5.0/en/server-sql-mode.html</a></code> and
<code><a href="http://dev.mysql.com/doc/mysql/en/ansi-mode.html" class="bare">http://dev.mysql.com/doc/mysql/en/ansi-mode.html</a></code>.</p>
</li>
<li>
<p>MySQL always starts a new connection when <code>autoCommit==true</code> is set.
This ensures that each SQL statement forms a single transaction on its
own. If you try to rollback or commit an SQL statement, you get an error
message.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>javax.transaction.SystemException: java.sql.SQLException:
Can't call rollback when autocommit=true

javax.transaction.SystemException: java.sql.SQLException:
Error open transaction is not closed</code></pre>
</div>
</div>
<div class="paragraph">
<p>To resolve this issue, add <code>relaxAutoCommit=true</code> to the JDBC URL. For
more information, see <code><a href="http://forums.mysql.com/read.php?39,31326,31404" class="bare">http://forums.mysql.com/read.php?39,31326,31404</a></code>.</p>
</div>
</li>
<li>
<p>Change the trigger create format from the following:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TRIGGER</span> T_UNKNOWNPKVC1
<span class="keyword">BEFORE</span> <span class="class">UPDATE</span> <span class="keyword">ON</span> UNKNOWNPKVC1
<span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span>
        <span class="keyword">WHEN</span> (NEW.VERSION = OLD.VERSION)
<span class="class">BEGIN</span>
        :NEW.VERSION := :OLD.VERSION + <span class="integer">1</span>;
<span class="keyword">END</span>;
/</code></pre>
</div>
</div>
<div class="paragraph">
<p>To the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">DELIMITER |
<span class="class">CREATE</span> <span class="type">TRIGGER</span> T_UNKNOWNPKVC1
<span class="keyword">BEFORE</span> <span class="class">UPDATE</span> <span class="keyword">ON</span> UNKNOWNPKVC1
<span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span>
        <span class="keyword">WHEN</span> (NEW.VERSION = OLD.VERSION)
<span class="class">BEGIN</span>
        :NEW.VERSION := :OLD.VERSION + <span class="integer">1</span>;
<span class="keyword">END</span>
|
DELIMITER ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see
<code><a href="http://dev.mysql.com/doc/mysql/en/create-trigger.html" class="bare">http://dev.mysql.com/doc/mysql/en/create-trigger.html</a></code>.</p>
</div>
</li>
<li>
<p>MySQL does not allow a <code>DELETE</code> on a row that contains a reference to
itself. Here is an example that illustrates the issue.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">create</span> <span class="type">table</span> EMPLOYEE (
        empId   <span class="predefined-type">int</span>         <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
        salary  <span class="predefined-type">float</span>(<span class="integer">25</span>,<span class="integer">2</span>) <span class="predefined-constant">NULL</span>,
        mgrId   <span class="predefined-type">int</span>         <span class="predefined-constant">NULL</span>,
        <span class="directive">PRIMARY</span> <span class="type">KEY</span> (empId),
        <span class="directive">FOREIGN</span> <span class="type">KEY</span> (mgrId) <span class="keyword">REFERENCES</span> EMPLOYEE (empId)
        ) <span class="directive">ENGINE</span>=InnoDB;

        <span class="class">insert</span> <span class="class">into</span> Employee <span class="keyword">values</span> (<span class="integer">1</span>, <span class="float">1234.34</span>, <span class="integer">1</span>);
        <span class="class">delete</span> <span class="keyword">from</span> Employee <span class="keyword">where</span> empId = <span class="integer">1</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example fails with the following error message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ERROR 1217 (23000): Cannot delete or update a parent row:
a foreign key constraint fails</code></pre>
</div>
</div>
<div class="paragraph">
<p>To resolve this issue, change the table creation script to the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">create</span> <span class="type">table</span> EMPLOYEE (
        empId   <span class="predefined-type">int</span>         <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span>,
        salary  <span class="predefined-type">float</span>(<span class="integer">25</span>,<span class="integer">2</span>) <span class="predefined-constant">NULL</span>,
        mgrId   <span class="predefined-type">int</span>         <span class="predefined-constant">NULL</span>,
        <span class="directive">PRIMARY</span> <span class="type">KEY</span> (empId),
        <span class="directive">FOREIGN</span> <span class="type">KEY</span> (mgrId) <span class="keyword">REFERENCES</span> EMPLOYEE (empId)
        <span class="keyword">ON</span> <span class="class">DELETE</span> <span class="class">SET</span> <span class="predefined-constant">NULL</span>
        ) <span class="directive">ENGINE</span>=InnoDB;

        <span class="class">insert</span> <span class="class">into</span> Employee <span class="keyword">values</span> (<span class="integer">1</span>, <span class="float">1234.34</span>, <span class="integer">1</span>);
        <span class="class">delete</span> <span class="keyword">from</span> Employee <span class="keyword">where</span> empId = <span class="integer">1</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be done only if the foreign key field is allowed to be null.
For more information, see
<code><a href="http://dev.mysql.com/doc/mysql/en/innodb-foreign-key-constraints.html" class="bare">http://dev.mysql.com/doc/mysql/en/innodb-foreign-key-constraints.html</a></code>.</p>
</div>
</li>
<li>
<p>When an SQL script has foreign key constraints defined,
<code>capture-schema</code> fails to capture the table information correctly. To
work around the problem, remove the constraints and then run
<code>capture-schema</code>. Here is an example that illustrates the issue.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> ADDRESSBOOKBEANTABLE (ADDRESSBOOKNAME <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>)
    <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span> <span class="directive">PRIMARY</span> <span class="type">KEY</span>,
CONNECTEDUSERS              <span class="predefined-type">BLOB</span> <span class="predefined-constant">NULL</span>,
OWNER                       <span class="predefined-type">VARCHAR</span>(<span class="integer">256</span>),
FK_FOR_ACCESSPRIVILEGES     <span class="predefined-type">VARCHAR</span>(<span class="integer">256</span>),
<span class="type">CONSTRAINT</span> FK_ACCESSPRIVILEGE <span class="directive">FOREIGN</span> <span class="type">KEY</span> (FK_FOR_ACCESSPRIVILEGES)
    <span class="keyword">REFERENCES</span> ACCESSPRIVILEGESBEANTABLE (ROOT)
) <span class="directive">ENGINE</span>=InnoDB;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To resolve this issue, change the table creation script to the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> ADDRESSBOOKBEANTABLE (ADDRESSBOOKNAME <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>)
    <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span> <span class="directive">PRIMARY</span> <span class="type">KEY</span>,
CONNECTEDUSERS              <span class="predefined-type">BLOB</span> <span class="predefined-constant">NULL</span>,
OWNER                       <span class="predefined-type">VARCHAR</span>(<span class="integer">256</span>),
FK_FOR_ACCESSPRIVILEGES     <span class="predefined-type">VARCHAR</span>(<span class="integer">256</span>)
) <span class="directive">ENGINE</span>=InnoDB;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing-java-clients"><a class="anchor" href="#developing-java-clients"></a>15. Developing Java Clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to develop, assemble, and deploy Java
clients.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#introducing-the-application-client-container">Introducing the Application Client Container</a></p>
</li>
<li>
<p><a href="#developing-clients-using-the-acc">Developing Clients Using the ACC</a></p>
</li>
<li>
<p><a href="#developing-clients-without-the-acc">Developing Clients Without the ACC</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Web Profile of the OracleEclipse GlassFish supports the EJB 3.1 Lite
specification, which allows enterprise beans within web applications,
among other features. The full Eclipse GlassFish supports the entire EJB
3.1 specification. For details, see
<a href="http://jcp.org/en/jsr/detail?id=318">JSR 318</a>.</p>
</div>
<div class="paragraph">
<p>Accordingly, the Application Client Container is supported only in the
full Eclipse GlassFish, not in the Web Profile.</p>
</div>
<div class="paragraph">
<p>JMS resources are supported only in the full Eclipse GlassFish, not in
the Web Profile. See <a href="#using-the-java-message-service">Using the Java Message Service</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="introducing-the-application-client-container"><a class="anchor" href="#introducing-the-application-client-container"></a>Introducing the Application Client Container</h3>
<div class="paragraph">
<p>The Application Client Container (ACC) includes a set of Java classes,
libraries, and other files that are required for and distributed with
Java client programs that execute in their own Java Virtual Machine
(JVM). The ACC manages the execution of Jakarta EE application client
components (application clients), which are used to access a variety of
Jakarta EE services (such as JMS resources, EJB components, web services,
security, and so on.) from a JVM outside the Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The ACC communicates with the Eclipse GlassFish using RMI-IIOP protocol
and manages the details of RMI-IIOP communication using the client ORB
that is bundled with it. Compared to other Jakarta EE containers, the ACC
is lightweight.</p>
</div>
<div class="paragraph">
<p>For information about debugging application clients, see
<a href="#application-client-debugging">Application Client Debugging</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Interoperability between application clients and Eclipse GlassFishs
running under different major versions is not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="acc-security"><a class="anchor" href="#acc-security"></a>ACC Security</h4>
<div class="paragraph">
<p>The ACC determines when authentication is needed. This typically occurs
when the client refers to an EJB component that requires authorization
or when annotations in the client&#8217;s <code>main</code> class trigger injection
which, in turn, requires contact with the Eclipse GlassFish&#8217;s naming
service. To authenticate the end user, the ACC prompts for any required
information, such as a username and password. The ACC itself provides a
very simple dialog box to prompt for and read these values.</p>
</div>
<div class="paragraph">
<p>The ACC integrates with the Eclipse GlassFish&#8217;s authentication system. It
also supports SSL (Secure Socket Layer)/IIOP if configured and when
necessary; see <a href="#using-rmiiiop-over-ssl">Using RMI/IIOP Over SSL</a>.</p>
</div>
<div class="paragraph">
<p>You can provide an alternate implementation to gather authentication
information, tailored to the needs of the application client. To do so,
include the class to perform these duties in the application client and
identify the fully-qualified name of this class in the
<code>callback-handler</code> element of the <code>application-client.xml</code> descriptor
for the client. The ACC uses this class instead of its default class for
asking for and reading the authentication information. The class must
implement the javax.security.auth.callback.CallbackHandler interface.
See the Jakarta EE specification, section 9.2, Application Clients:
Security, for more details.</p>
</div>
<div class="paragraph">
<p>Application clients can use <a href="#programmatic-login-using-the-programmaticlogin-class">Programmatic
Login Using the ProgrammaticLogin Class</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="acc-naming"><a class="anchor" href="#acc-naming"></a>ACC Naming</h4>
<div class="paragraph">
<p>The client container enables the application clients to use the Java
Naming and Directory Interface (JNDI) to look up Jakarta EE services (such
as JMS resources, EJB components, web services, security, and so on.)
and to reference configurable parameters set at the time of deployment.</p>
</div>
</div>
<div class="sect3">
<h4 id="application-client-annotation"><a class="anchor" href="#application-client-annotation"></a>Application Client Annotation</h4>
<div class="paragraph">
<p>Annotation is supported for the main class and the optional callback
handler class in application clients. For more information, see
"<a href="application-deployment-guide.html#deployment-descriptors-and-annotations">Deployment Descriptors and Annotations</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="java-web-start"><a class="anchor" href="#java-web-start"></a>Java Web Start</h4>
<div class="paragraph">
<p>Java Web Start allows your application client to be easily launched and
automatically downloaded and updated. It is enabled for all application
clients by default. For more information, see <a href="#using-java-web-start">Using Java Web
Start</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="application-client-jar-file"><a class="anchor" href="#application-client-jar-file"></a>Application Client JAR File</h4>
<div class="paragraph">
<p>In Eclipse GlassFish 7, the downloaded appclient JAR file is smaller
than in previous releases, with dependent classes in separate JAR files.
When copying the downloaded appclient to another location, make sure to
include the JAR files containing the dependent classes as well. You can
also use the <code>asadmin get-client-stubs</code> command to retrieve the
appclient and all associated application JAR files and place them in
another location.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="developing-clients-using-the-acc"><a class="anchor" href="#developing-clients-using-the-acc"></a>Developing Clients Using the ACC</h3>
<div class="paragraph">
<p>This section describes the procedure to develop, assemble, and deploy
client applications using the ACC.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#to-access-an-ejb-component-from-an-application-client">To Access an EJB Component From an Application Client</a></p>
</li>
<li>
<p><a href="#to-access-a-jms-resource-from-an-application-client">To Access a JMS Resource From an Application Client</a></p>
</li>
<li>
<p><a href="#using-java-web-start">Using Java Web Start</a></p>
</li>
<li>
<p><a href="#using-the-embeddable-acc">Using the Embeddable ACC</a></p>
</li>
<li>
<p><a href="#running-an-application-client-using-the-appclient-script">Running an Application Client Using the <code>appclient</code>
Script</a></p>
</li>
<li>
<p><a href="#using-the-package-appclient-script">Using the <code>package-appclient</code> Script</a></p>
</li>
<li>
<p><a href="#GSDVG00468">The <code>client.policy</code> File</a></p>
</li>
<li>
<p><a href="#using-rmiiiop-over-ssl">Using RMI/IIOP Over SSL</a></p>
</li>
<li>
<p><a href="#connecting-to-a-remote-ejb-module-through-a-firewall">Connecting to a Remote EJB Module Through a Firewall</a></p>
</li>
<li>
<p><a href="#specifying-a-splash-screen">Specifying a Splash Screen</a></p>
</li>
<li>
<p><a href="#setting-login-retries">Setting Login Retries</a></p>
</li>
<li>
<p><a href="#using-libraries-with-application-clients">Using Libraries with Application Clients</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="to-access-an-ejb-component-from-an-application-client"><a class="anchor" href="#to-access-an-ejb-component-from-an-application-client"></a>To Access an EJB Component From an Application Client</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your client code, reference the EJB component by using an <code>@EJB</code>
annotation or by looking up the JNDI name as defined in the <code>ejb-jar.xml</code> file.<br>
For more information about naming and lookups, see
<a href="#accessing-the-naming-context">Accessing the Naming Context</a>.<br>
If load balancing is enabled as in Step <a href="#accejb8">7</a> and the EJB
components being accessed are in a different cluster, the endpoint list
must be included in the lookup, as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>corbaname:host1:port1,host2:port2,.../NameService#ejb/jndi-name</code></pre>
</div>
</div>
</li>
<li>
<p>Define the <code>@EJB</code> annotations or the <code>ejb-ref</code> elements in the
<code>application-client.xml</code> file. Define the corresponding <code>ejb-ref</code>
elements in the <code>glassfish-application-client.xml</code> file.<br>
For more information on the <code>glassfish-application-client.xml</code> file, see
"<a href="application-deployment-guide.html#GSDPG00081">The glassfish-application-client.xml file</a>" in
Eclipse GlassFish Application Deployment Guide.
For a general explanation of how to map JNDI names using reference elements,
see <a href="#mapping-references">Mapping References</a>.</p>
</li>
<li>
<p>Deploy the application client and EJB component together in an application.<br>
For more information on deployment, see the
<a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment Guide</a>.
To get the client JAR file, use the <code>--retrieve</code> option of the <code>asadmin deploy</code> command.<br>
To retrieve the stubs and ties generated during deployment, use the
<code>asadmin get-client-stubs</code> command.<br>
For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Ensure that the client JAR file includes the following files:</p>
<div class="ulist">
<ul>
<li>
<p>A Java class to access the bean.</p>
</li>
<li>
<p><code>application-client.xml</code> - (optional) Jakarta EE application client
deployment descriptor.</p>
</li>
<li>
<p><code>glassfish-application-client.xml</code> - (optional) Eclipse GlassFish
specific client deployment descriptor. For information on the
<code>glassfish-application-client.xml</code> file, see "<a href="application-deployment-guide.html#GSDPG00081">The
glassfish-application-client.xml file</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</li>
<li>
<p>The <code>MANIFEST.MF</code> file. This file contains a reference to the <code>main</code>
class, which states the complete package prefix and class name of the
Java client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Prepare the client machine.<br>
This step is not needed for Java Web Start. This step is not needed if
the client and server machines are the same.<br>
If you are using the <code>appclient</code> script, package the Eclipse GlassFish
system files required to launch application clients on remote systems
using the <code>package-appclient</code> script, then retrieve the application
client itself using the <code>asadmin get-client-stubs</code> command.<br>
For more information, see <a href="#using-the-package-appclient-script">Using the <code>package-appclient</code> Script</a>
and the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>To access EJB components that are residing in a remote system, make
the following changes to the <code>sun-acc.xml</code> file or the <code>appclient</code>
script. This step is not needed for Java Web Start.</p>
<div class="ulist">
<ul>
<li>
<p>Define the <code>target-server</code> element&#8217;s <code>address</code> and <code>port</code> attributes
to reference the remote server machine and its ORB port. See
"<a href="application-deployment-guide.html#target-server">target-server</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</li>
<li>
<p>Use the <code>-targetserver</code> option of the appclient script to reference
the remote server machine and its ORB port. For more information, see
<a href="#running-an-application-client-using-the-appclient-script">Running an Application Client Using the <code>appclient</code> Script</a>.</p>
<div class="paragraph">
<p>To determine the ORB port on the remote server, use the <code>asadmin get</code> command. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin --host rmtsrv get server-config.iiop-service.iiop-listener.iiop-listener1.port</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin get</code> command, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a id="accejb8"></a>
To set up load balancing and failover of remote EJB references, define
at least two <code>target-server</code> elements in the <code>sun-acc.xml</code> file or the
<code>appclient</code> script. This step is not needed for Java Web Start.<br>
If the Eclipse GlassFish instance on which the application client is
deployed participates in a cluster, the ACC finds all currently active
IIOP endpoints in the cluster automatically. However, a client should
have at least two endpoints specified for bootstrapping purposes, in
case one of the endpoints has failed.<br>
The <code>target-server</code> elements in the <code>sun-acc.xml</code> file specify one or
more IIOP endpoints used for load balancing. The <code>address</code> attribute is
an IPv4 address or host name, and the <code>port</code> attribute specifies the
port number. See "<a href="application-deployment-guide.html#client-container">client-container</a>" in Eclipse GlassFish Application Deployment Guide.<br>
The <code>--targetserver</code> option of the appclient script specifies one or
more IIOP endpoints used for load balancing. For more information, see
<a href="#running-an-application-client-using-the-appclient-script">Running an Application Client Using the <code>appclient</code> Script</a>.</p>
</li>
</ol>
</div>
<div id="GSDVG555" class="paragraph">
<p>Next Steps</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For instructions on running the application client, see
<a href="#using-java-web-start">Using Java Web Start</a> or <a href="#running-an-application-client-using-the-appclient-script">Running an Application
Client Using the <code>appclient</code> Script</a>.</p>
</li>
<li>
<p>For more information about RMI-IIOP load balancing and failover, see
"<a href="ha-administration-guide.html#rmi-iiop-load-balancing-and-failover">RMI-IIOP Load Balancing and Failover</a>" in Eclipse GlassFish High Availability Administration Guide.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="to-access-a-jms-resource-from-an-application-client"><a class="anchor" href="#to-access-a-jms-resource-from-an-application-client"></a>To Access a JMS Resource From an Application Client</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JMS client.</p>
<div class="paragraph">
<p>For detailed instructions on developing a JMS client, see
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#jakarta-messaging-examples">
Java Message Service Examples</a>" in The Jakarta EE Tutorial.</p>
</div>
</li>
<li>
<p>Next, configure a JMS resource on the Eclipse GlassFish.</p>
<div class="paragraph">
<p>For information on configuring JMS resources, see
"<a href="administration-guide.html#administering-jms-connection-factories-and-destinations">Administering JMS Connection Factories and
Destinations</a>" in Eclipse GlassFish Administration
Guide.</p>
</div>
</li>
<li>
<p>Define the <code>@Resource</code> or <code>@Resources</code> annotations or the
<code>resource-ref</code> elements in the <code>application-client.xml</code> file. Define the
corresponding <code>resource-ref</code> elements in the
<code>glassfish-application-client.xml</code> file.</p>
<div class="paragraph">
<p>For more information on the <code>glassfish-application-client.xml</code> file, see
"<a href="application-deployment-guide.html#GSDPG00081">The glassfish-application-client.xml file</a>" in
Eclipse GlassFish Application Deployment Guide. For a
general explanation of how to map JNDI names using reference elements,
see <a href="#mapping-references">Mapping References</a>.</p>
</div>
</li>
<li>
<p>Ensure that the client JAR file includes the following files:</p>
<div class="ulist">
<ul>
<li>
<p>A Java class to access the resource.</p>
</li>
<li>
<p><code>application-client.xml</code> - (optional) Jakarta EE application client
deployment descriptor.</p>
</li>
<li>
<p><code>glassfish-application-client.xml</code> - (optional) Eclipse GlassFish
specific client deployment descriptor. For information on the
<code>glassfish-application-client.xml</code> file, see "<a href="application-deployment-guide.html#GSDPG00081">The
glassfish-application-client.xml file</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</li>
<li>
<p>The <code>MANIFEST.MF</code> file. This file contains a reference to the <code>main</code>
class, which states the complete package prefix and class name of the
Java client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Prepare the client machine.</p>
<div class="paragraph">
<p>This step is not needed for Java Web Start. This step is not needed if
the client and server machines are the same.</p>
</div>
<div class="paragraph">
<p>If you are using the <code>appclient</code> script, package the Eclipse GlassFish
system files required to launch application clients on remote systems
using the <code>package-appclient</code> script, then retrieve the application
client itself using the <code>asadmin get-client-stubs</code> command.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="#using-the-package-appclient-script">Using the <code>package-appclient</code>
Script</a> and the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</div>
</li>
<li>
<p>Run the application client.</p>
<div class="paragraph">
<p>See <a href="#using-java-web-start">Using Java Web Start</a> or <a href="#running-an-application-client-using-the-appclient-script">Running an
Application Client Using the <code>appclient</code> Script</a>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="using-java-web-start"><a class="anchor" href="#using-java-web-start"></a>Using Java Web Start</h4>
<div class="paragraph">
<p>Java Web Start allows your application client to be easily launched and
automatically downloaded and updated.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#enabling-and-disabling-java-web-start">Enabling and Disabling Java Web Start</a></p>
</li>
<li>
<p><a href="#downloading-and-launching-an-application-client">Downloading and Launching an Application Client</a></p>
</li>
<li>
<p><a href="#the-application-client-url">The Application Client URL</a></p>
</li>
<li>
<p><a href="#signing-jar-files-used-in-java-web-start">Signing JAR Files Used in Java Web Start</a></p>
</li>
<li>
<p><a href="#error-handling">Error Handling</a></p>
</li>
<li>
<p><a href="#vendor-icon-splash-screen-and-text">Vendor Icon, Splash Screen, and Text</a></p>
</li>
<li>
<p><a href="#creating-a-custom-jnlp-file">Creating a Custom JNLP File</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="enabling-and-disabling-java-web-start"><a class="anchor" href="#enabling-and-disabling-java-web-start"></a>Enabling and Disabling Java Web Start</h5>
<div class="paragraph">
<p>Java Web Start is enabled for all application clients by default.</p>
</div>
<div class="paragraph">
<p>The application developer or deployer can specify that Java Web Start is
always disabled for an application client by setting the value of the
<code>eligible</code> element to <code>false</code> in the <code>glassfish-application-client.xml</code>
file. See the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish
Application Deployment Guide</a>.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish administrator can disable Java Web Start for a
previously deployed eligible application client using the <code>asadmin set</code>
command.</p>
</div>
<div class="paragraph">
<p>To disable Java Web Start for all eligible application clients in an
application, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set applications.application.app-name.property.java-web-start-enabled=&quot;false&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To disable Java Web Start for a stand-alone eligible application client,
use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set applications.application.module-name.property.java-web-start-enabled=&quot;false&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting <code>java-web-start-enabled="true"</code> re-enables Java Web Start for an
eligible application client. For more information about the
<code>asadmin set</code> command, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="downloading-and-launching-an-application-client"><a class="anchor" href="#downloading-and-launching-an-application-client"></a>Downloading and Launching an Application Client</h5>
<div class="paragraph">
<p>If Java Web Start is enabled for your deployed application client, you
can launch it for testing. Simply click on the Launch button next to the
application client or application&#8217;s listing on the App Client Modules
page in the Administration Console.</p>
</div>
<div class="paragraph">
<p>On other machines, you can download and launch the application client
using Java Web Start in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a web browser, directly enter the URL for the application
client. See <a href="#the-application-client-url">The Application Client URL</a>.</p>
</li>
<li>
<p>Click on a link to the application client from a web page.</p>
</li>
<li>
<p>Use the Java Web Start command <code>javaws</code>, specifying the URL of the
application client as a command line argument.</p>
</li>
<li>
<p>If the application has previously been downloaded using Java Web
Start, you have additional alternatives.</p>
<div class="ulist">
<ul>
<li>
<p>Use the desktop icon that Java Web Start created for the application
client. When Java Web Start downloads an application client for the
first time it asks you if such an icon should be created.</p>
</li>
<li>
<p>Use the Java Web Start control panel to launch the application
client.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you launch an application client, Java Web Start contacts the
server to see if a newer client version is available. This means you can
redeploy an application client without having to worry about whether
client machines have the latest version.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-application-client-url"><a class="anchor" href="#the-application-client-url"></a>The Application Client URL</h5>
<div class="paragraph">
<p>The default URL for an application or module generally is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://host:port/context-root</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default URL for a stand-alone application client module is as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://host:port/appclient-module-id</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default URL for an application client module embedded within an
application is as follows. Note that the relative path to the
application client JAR file is included.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://host:port/application-id/appclient-path</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the context-root, appclient-module-id, or application-id is not
specified during deployment, the name of the JAR or EAR file without the
extension is used. If the application client module or application is
not in JAR or EAR file format, an appclient-module-id or application-id
is generated.</p>
</div>
<div class="paragraph">
<p>Regardless of how the context-root or id is determined, it is written to
the server log when you deploy the application. For details about
naming, see "<a href="application-deployment-guide.html#naming-standards">Naming Standards</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>To set a different URL for an application client, use the <code>context-root</code>
subelement of the <code>java-web-start-access</code> element in the
<code>glassfish-application-client.xml</code> file. This overrides the
appclient-module-id or application-id. See the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment Guide</a>.</p>
</div>
<div class="paragraph">
<p>You can also pass arguments to the ACC or to the application client&#8217;s
<code>main</code> method as query parameters in the URL. If multiple application
client arguments are specified, they are passed in the order specified.</p>
</div>
<div class="paragraph">
<p>A question mark separates the context root from the arguments.
Ampersands (<code>&amp;</code>) separate the arguments and their values. Each argument
and each value must begin with <code>arg=</code>. Here is an example URL with a
<code>-color</code> argument for a stand-alone application client. The <code>-color</code>
argument is passed to the application client&#8217;s <code>main</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://localhost:8080/testClient?arg=-color&amp;arg=red</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using the <code>javaws</code> URL command to launch Java Web Start with
a URL that contains arguments, enclose the URL in double quotes (<code>"</code>) to
avoid breaking the URL at the ampersand (<code>&amp;</code>) symbol.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ideally, you should build your production application clients with
user-friendly interfaces that collect information which might otherwise
be gathered as command-line arguments. This minimizes the degree to
which users must customize the URLs that launch application clients
using Java Web Start. Command-line argument support is useful in a
development environment and for existing application clients that depend
on it.</p>
</div>
</div>
<div class="sect4">
<h5 id="signing-jar-files-used-in-java-web-start"><a class="anchor" href="#signing-jar-files-used-in-java-web-start"></a>Signing JAR Files Used in Java Web Start</h5>
<div class="paragraph">
<p>Java Web Start enforces a security sandbox. By default it grants any
application, including application clients, only minimal privileges.
Because Java Web Start applications can be so easily downloaded, Java
Web Start provides protection from potentially harmful programs that
might be accessible over the network. If an application requires a
higher privilege level than the sandbox permits, the code that needs
privileges must be in a JAR file that was signed.</p>
</div>
<div class="paragraph">
<p>When Java Web Start downloads such a signed JAR file, it displays
information about the certificate that was used to sign the JAR if that
certificate is not trusted. It then asks you whether you want to trust
that signed code. If you agree, the code receives elevated permissions
and runs. If you reject the signed code, Java Web Start does not start
the downloaded application.</p>
</div>
<div class="paragraph">
<p>Your first Java Web Start launch of an application client is likely to
involve this prompting because by default Eclipse GlassFish uses a
self-signed certificate that is not linked to a trusted authority.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish serves two types of signed JAR files in response to
Java Web Start requests. One type is a JAR file installed as part of the
Eclipse GlassFish, which starts an application client during a Java Web
Start launch: as-install<code>/lib/gf-client.jar</code>.</p>
</div>
<div class="paragraph">
<p>The other type is a generated application client JAR file. As part of
deployment, the Eclipse GlassFish generates a new application client JAR
file that contains classes, resources, and descriptors needed to run the
application client on end-user systems. When you deploy an application
with the <code>asadmin deploy</code> command&#8217;s <code>--retrieve</code> option, use the
<code>asadmin get-client-stubs</code> command, or select the Generate RMIStubs
option from the EJB Modules deployment page in the Administration
Console, this is one of the JAR files retrieved to your system. Because
application clients need access beyond the minimal sandbox permissions
to work in the Java Web Start environment, the generated application
client JAR file must be signed before it can be downloaded to and
executed on an end-user system.</p>
</div>
<div class="paragraph">
<p>A JAR file can be signed automatically or manually.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#automatically-signing-jar-files">Automatically Signing JAR Files</a></p>
</li>
<li>
<p><a href="#using-the-jar-signing-alias-deployment-property">Using the <code>jar-signing-alias</code> Deployment Property</a></p>
</li>
</ul>
</div>
<div id="automatically-signing-jar-files" class="paragraph">
<p>Automatically Signing JAR Files</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish automatically creates a signed version of the
required JAR file if none exists. When a Java Web Start request for the
<code>gf-client.jar</code> file arrives, the Eclipse GlassFish looks for
domain-dir`/java-web-start/gf-client.jar`. When a request for an
application&#8217;s generated application client JAR file arrives, the
Eclipse GlassFish looks in the directory
domain-dir`/java-web-start/`app-name for a file with the same name as
the generated JAR file created during deployment.</p>
</div>
<div class="paragraph">
<p>In either case, if the requested signed JAR file is absent or older than
its unsigned counterpart, the Eclipse GlassFish creates a signed version
of the JAR file automatically and deposits it in the relevant directory.
Whether the Eclipse GlassFish just signed the JAR file or not, it serves
the file from the domain-dir`/java-web-start` directory tree in response
to the Java Web Start request.</p>
</div>
<div class="paragraph">
<p>To sign these JAR files, by default the Eclipse GlassFish uses its
self-signed certificate. When you create a new domain, either by
installing the Eclipse GlassFish or by using the <code>asadmin create-domain</code>
command, the Eclipse GlassFish creates a self-signed certificate and adds
it to the domain&#8217;s key store.</p>
</div>
<div class="paragraph">
<p>A self-signed certificate is generally untrustworthy because no
certification authority vouches for its authenticity. The automatic
signing feature uses the same certificate to create all required signed
JAR files.</p>
</div>
<div class="paragraph">
<p>Starting with Java SE 7 Update 21, stricter security is enforced for
applications launched using Java Web Start. Application users will see
various security messages, depending on their Java security settings. If
Java security is set to Very High on their systems, users will not be
able to launch application clients signed using the Eclipse GlassFish
self-signed certificate.</p>
</div>
<div class="paragraph">
<p>To minimize impacts to application users, all Java Web Start
applications should be signed with a trusted certificate instead of the
Eclipse GlassFish self-signed certificate. If you use the Eclipse GlassFish Java Web Start feature or deploy applications that provide their
own Java Web Start applications, perform the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain a trusted certificate from a certification authority if your
organization does not already have one.</p>
</li>
<li>
<p>Stop Eclipse GlassFish.</p>
</li>
<li>
<p>Replace the Eclipse GlassFish self-signed certificate with the
trusted certificate by importing the trusted certificate into the
Eclipse GlassFish keystore using the <code>s1as</code> alias. By default, the
keystore is located at domain-dir`/config/keystore.jks`.</p>
<div class="paragraph">
<p>For more information about importing a trusted certificate into the
domain keystore, see "<a href="security-guide.html#administering-jsse-certificates">Administering JSSE Certificates</a>"
in Eclipse GlassFish Security Guide.</p>
</div>
</li>
<li>
<p>Delete any signed JARs already generated by Eclipse GlassFish:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>At the command prompt, type:<br>
<code>rm -rf</code> domain-dir<code>/java_web_start</code></p>
</li>
<li>
<p>For each application that contains an application client launched
using Java Web Start, type:<br>
<code>rm -rf</code> domain-dir<code>/generated/xml/</code>app-name<code>/signed</code></p>
</li>
<li>
<p>Restart Eclipse GlassFish.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Ensure that the Java security setting on user systems is set to Very High.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After you perform these steps, the first time a user launches an
application client on their system, Java Web Start detects that the
server&#8217;s signed JARs are newer than those cached on the user&#8217;s system
and downloads them again. This happens on the first launch only,
regardless of the client. Even though the application client is now
signed using a trusted certificate, users will again be asked whether to
trust the downloaded application and can choose to skip that prompt for
future launches.</p>
</div>
<div id="using-the-jar-signing-alias-deployment-property" class="paragraph">
<p>Using the <code>jar-signing-alias</code> Deployment Property</p>
</div>
<div class="paragraph">
<p>The <code>asadmin deploy</code> command property <code>jar-signing-alias</code> specifies the
alias for the security certificate with which the application client
container JAR file is signed.</p>
</div>
<div class="paragraph">
<p>Java Web Start won&#8217;t execute code requiring elevated permissions unless
it resides in a JAR file signed with a certificate that the user&#8217;s
system trusts. For your convenience, Eclipse GlassFish signs the JAR file
automatically using the self-signed certificate from the domain, <code>s1as</code>.
Java Web Start then asks the user whether to trust the code and displays
the Eclipse GlassFish certificate information.</p>
</div>
<div class="paragraph">
<p>To sign this JAR file with a different certificate, first add the
certificate to the domain keystore. You can use a certificate from a
trusted authority, which avoids the Java Web Start prompt. To add a
certificate to the domain keystore, see "<a href="security-guide.html#administering-jsse-certificates">Administering
JSSE Certificates</a>" in Eclipse GlassFish Security
Guide.</p>
</div>
<div class="paragraph">
<p>Next, deploy your application using the <code>jar-signing-alias</code> property.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin deploy --property jar-signing-alias=MyAlias MyApp.ear</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>asadmin deploy</code> command, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="error-handling"><a class="anchor" href="#error-handling"></a>Error Handling</h5>
<div class="paragraph">
<p>When an application client is launched using Java Web Start, any error
that the application client logic does not catch and handle is written
to <code>System.err</code> and displayed in a dialog box. This display appears if
an error occurs even before the application client logic receives
control. It also appears if the application client code does not catch
and handle errors itself.</p>
</div>
</div>
<div class="sect4">
<h5 id="vendor-icon-splash-screen-and-text"><a class="anchor" href="#vendor-icon-splash-screen-and-text"></a>Vendor Icon, Splash Screen, and Text</h5>
<div class="paragraph">
<p>To specify a vendor-specific icon, splash screen, text string, or a
combination of these for Java Web Start download and launch screens, use
the <code>vendor</code> element in the <code>glassfish-application-client.xml</code> file. The
complete format of this element&#8217;s data is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;vendor&gt;</span>icon-image-URI::splash-screen-image-URI::vendor-text<span class="tag">&lt;/vendor&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example vendor element contains an icon, a splash screen,
and a text string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;vendor&gt;</span>images/icon.jpg::otherDir/splash.jpg::MyCorp, Inc.<span class="tag">&lt;/vendor&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example vendor element contains an icon and a text string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;vendor&gt;</span>images/icon.jpg::MyCorp, Inc.<span class="tag">&lt;/vendor&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example vendor element contains a splash screen and a text
string; note the initial double colon:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;vendor&gt;</span>::otherDir/splash.jpg::MyCorp, Inc.<span class="tag">&lt;/vendor&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example vendor element contains only a text string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;vendor&gt;</span>MyCorp, Inc.<span class="tag">&lt;/vendor&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default value is the text string <code>Application Client</code>.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>glassfish-application-client.xml</code> file,
see the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application
Deployment Guide</a>.</p>
</div>
<div class="paragraph">
<p>You can also specify a vendor-specific icon, splash screen, text string,
or a combination by using a custom JNLP file; see <a href="#creating-a-custom-jnlp-file">Creating a
Custom JNLP File</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-a-custom-jnlp-file"><a class="anchor" href="#creating-a-custom-jnlp-file"></a>Creating a Custom JNLP File</h5>
<div class="paragraph">
<p>You can partially customize the Java Network Launching Protocol (JNLP)
file that Eclipse GlassFish uses for Java Web Start.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#specifying-the-jnlp-file-in-the-deployment-descriptor">Specifying the JNLP File in the Deployment Descriptor</a></p>
</li>
<li>
<p><a href="#referring-to-jar-files-from-the-jnlp-file">Referring to JAR Files from the JNLP File</a></p>
</li>
<li>
<p><a href="#referring-to-other-jnlp-files">Referring to Other JNLP Files</a></p>
</li>
<li>
<p><a href="#combining-custom-and-automatically-generated-content">Combining Custom and Automatically Generated Content</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about JNLP, see the
<a href="http://java.sun.com/javase/technologies/desktop/javawebstart/download-spec.html">Java
Web Start Architecture JNLP Specification and API Documentation</a>
(<code><a href="http://java.sun.com/javase/technologies/desktop/javawebstart/download-spec.html" class="bare">http://java.sun.com/javase/technologies/desktop/javawebstart/download-spec.html</a></code>).</p>
</div>
<div id="specifying-the-jnlp-file-in-the-deployment-descriptor" class="paragraph">
<p>Specifying the JNLP File in the Deployment Descriptor</p>
</div>
<div class="paragraph">
<p>To specify a custom JNLP file for Java Web Start, use the <code>jnlp-doc</code>
element in the <code>glassfish-application-client.xml</code> file. If none is
specified, a default JNLP file is generated.</p>
</div>
<div class="paragraph">
<p>The value of the <code>jnlp-doc</code> element is a relative path with the
following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[path-to-JAR-in-EAR!]path-to-JNLP-in-JAR</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default path-to-JAR-in-EAR is the current application client JAR
file. For example, if the JNLP file is in the application client JAR
file at <code>custom/myInfo.jnlp</code>, the element value would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;java-web-start-access&gt;</span>
   <span class="tag">&lt;jnlp-doc&gt;</span>custom/myInfo.jnlp<span class="tag">&lt;/jnlp-doc&gt;</span>
<span class="tag">&lt;/java-web-start-access&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the application client is inside an EAR file, you can place the
custom JNLP file inside another JAR file in the EAR. For example, if the
JNLP file is in a JAR file at <code>other/myLib.jar</code>, the element value would
look like this, with an exclamation point (<code>!</code>) separating the path to
the JAR from the path in the JAR:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;java-web-start-access&gt;</span>
   <span class="tag">&lt;jnlp-doc&gt;</span>other/myLib.jar!custom/myInfo.jnlp<span class="tag">&lt;/jnlp-doc&gt;</span>
<span class="tag">&lt;/java-web-start-access&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>glassfish-application-client.xml</code> file,
see the Eclipse GlassFish Application Deployment
Guide.</p>
</div>
<div id="referring-to-jar-files-from-the-jnlp-file" class="paragraph">
<p>Referring to JAR Files from the JNLP File</p>
</div>
<div class="paragraph">
<p>As with any JNLP document, the custom JNLP file can refer to JAR files
the application client requires.</p>
</div>
<div class="paragraph">
<p>Do not specify every JAR on which the client depends. Eclipse GlassFish
automatically handles JAR files that the Jakarta EE specification requires
to be available to the application client. This includes JAR files
listed in the application client JAR file&#8217;s manifest <code>Class-Path</code> and
JAR files in the EAR file&#8217;s library directory (if any) and their
transitive closures. The custom JNLP file should specify only those JAR
files the client needs that Eclipse GlassFish would not otherwise
include.</p>
</div>
<div class="paragraph">
<p>Package these JAR files in the EAR file, as with any JAR file required
by an application client. Use relative URIs in the <code>&lt;jar href="&#8230;&#8203;"&gt;</code>
and <code>&lt;nativelib href="&#8230;&#8203;"&gt;</code> elements to point to the JAR files. The
codebase that Eclipse GlassFish assigns for the final client JNLP file
corresponds to the top level of the EAR file. Therefore, relative <code>href</code>
references correspond directly to the relative path to the JAR files
within the EAR file.</p>
</div>
<div class="paragraph">
<p>Neither the Jakarta EE specification nor Eclipse GlassFish supports
packaging JAR files inside the application client JAR file itself.
Nothing prevents this, but Eclipse GlassFish does no special processing
of such JAR files. They do not appear in the runtime class path and they
cannot be referenced from the custom JNLP file.</p>
</div>
<div id="referring-to-other-jnlp-files" class="paragraph">
<p>Referring to Other JNLP Files</p>
</div>
<div class="paragraph">
<p>The JNLP file can also refer to other custom JNLP files using
<code>&lt;extension href="&#8230;&#8203;"/&gt;</code> elements. To be consistent with relative
<code>href</code> references to JAR files, the relative <code>href</code> references to JNLP
files are resolved within the EAR file. You can place these JNLP files
directly in the EAR file or inside JAR files that the EAR file contains.
Use one of these formats for these <code>href</code> references:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[path-to-JAR-in-EAR!]path-to-JNLP-in-JAR

path-to-JNLP-in-EAR</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that these formats are not equivalent to the format of the
<code>jnlp-doc</code> element in the <code>glassfish-application-client.xml</code> file.</p>
</div>
<div class="paragraph">
<p>These formats follow the standard entry-within-a-JAR URI syntax and
semantics. Support for this syntax comes from the automated Java Web
Start support in Eclipse GlassFish. This is not a feature of Java Web
Start or the JNLP standard.</p>
</div>
<div id="combining-custom-and-automatically-generated-content" class="paragraph">
<p>Combining Custom and Automatically Generated Content</p>
</div>
<div class="paragraph">
<p>Eclipse GlassFish recognizes these types of content in the JNLP file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Owned — Eclipse GlassFish owns the content and ignores any custom
content</p>
</li>
<li>
<p>Merged — Automatically generated content and custom content are merged</p>
</li>
<li>
<p>Defaulted — Custom content is used if present, otherwise default
content is provided</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can compose a complete JNLP file and package it with the application
client. Eclipse GlassFish then combines it with its automatically
generated JNLP file. You can also provide content that only adds to or
replaces what Eclipse GlassFish generates. The custom content must
conform to the general structure of the JNLP format so that Eclipse GlassFish can properly place it in the final JNLP file.</p>
</div>
<div class="paragraph">
<p>For example, to specify a single native library to be included only for
Windows systems, the new element to add might be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;nativelib</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">windows/myLib.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, you must indicate where in the overall document this element
belongs. The actual custom JNLP file should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
   <span class="tag">&lt;resources</span> <span class="attribute-name">os</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Windows</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;nativelib</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">windows/myLib.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/resources&gt;</span>
<span class="tag">&lt;/jnlp&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Eclipse GlassFish provides default <code>&lt;information&gt;</code> and <code>&lt;resources&gt;</code>
elements, without specifying attributes such as <code>os</code>, <code>arch</code>,
<code>platform</code>, or <code>locale</code>. Eclipse GlassFish merges its own content within
those elements with custom content under those elements. Further, you
can provide your own <code>&lt;information&gt;</code> and <code>&lt;resources&gt;</code> elements (and
fragments within them) that specify at least one of these attributes.</p>
</div>
<div class="paragraph">
<p>In general, you can perform the following customizations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Override the Eclipse GlassFish defaults for the child elements of
<code>&lt;information&gt;</code> elements that have no attribute settings for <code>os</code>,
<code>arch</code>, <code>platform</code>, and <code>locale</code>. Among these child elements are
<code>&lt;title&gt;</code>, <code>&lt;vendor&gt;</code>, <code>&lt;description&gt;</code>, <code>&lt;icon&gt;</code>, and so on.</p>
</li>
<li>
<p>Add <code>&lt;information&gt;</code> elements with <code>os</code>, <code>arch</code>, <code>platform</code>, or
<code>locale</code> settings. You can also add child elements.</p>
</li>
<li>
<p>Add child elements of <code>&lt;resources&gt;</code> elements that have no attribute
settings for <code>os</code>, <code>arch</code>, or <code>locale</code>. Among these child elements are
<code>&lt;jar&gt;</code>, <code>&lt;property&gt;</code>, <code>&lt;nativelib&gt;</code>, and so on. You can also customize
attributes of the <code>&lt;java&gt;</code> child element.</p>
</li>
<li>
<p>Add <code>&lt;resources&gt;</code> elements that specify at least one of <code>os</code>, <code>arch</code>,
or <code>locale</code>. You can also add child elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This flexibility allows you to add JAR files to the application
(including platform-specific native libraries) and set properties to
control the behavior of your application clients.</p>
</div>
<div class="paragraph">
<p>The following tables provide more detail about what parts of the JNLP
file you can add to and modify.</p>
</div>
<div id="gkmbk" class="paragraph">
<p>Table 10-1 Owned JNLP File Content</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 32%;">
<col style="width: 68%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JNLP File Fragment</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp</span> <span class="attribute-name">codebase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xxx</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eclipse GlassFish controls this content for application clients
packaged in EAR files. The developer controls this content for
application clients packaged in WAR files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xxx</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eclipse GlassFish controls this content for application clients
packaged in EAR files. The developer controls this content for
application clients packaged in WAR files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;security&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eclipse GlassFish must control the permissions requested for each JNLP
file. All permissions are needed for the main file, which launches the
ACC. The permissions requested for other JNLP documents depend on
whether the JAR files referenced in those documents are signed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;application-desc&gt;</span>
    <span class="tag">&lt;argument&gt;</span> ...</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eclipse GlassFish sets the <code>main-class</code> and the arguments to be passed to the client.</p></td>
</tr>
</tbody>
</table>
<div id="gkmci" class="paragraph">
<p>Table 10-2 Defaulted JNLP File Content</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 39%;">
<col style="width: 61%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JNLP File Fragment</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp</span> <span class="attribute-name">spec</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xxx</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the JNLP specification version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;information</span> <span class="error">[</span><span class="attribute-name">no-attributes</span><span class="error">]</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the application title, vendor, home page, various
description text values, icon images, and whether offline execution is
allowed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;resources</span> <span class="error">[</span><span class="attribute-name">no-attributes</span><span class="error">]</span><span class="tag">&gt;</span>
    <span class="tag">&lt;java</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xxx</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">java-vm-args</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yyy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the Java SE version or selected VM parameter settings.</p></td>
</tr>
</tbody>
</table>
<div id="gkmcc" class="paragraph">
<p>Table 10-3 Merged JNLP File Content</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 37%;">
<col style="width: 63%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JNLP File Fragment</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;information</span> <span class="error">[</span><span class="attribute-name">attributes</span><span class="error">]</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can specify one or more of the <code>os</code>, <code>arch</code>, <code>platform</code>, and
<code>locale</code> attributes for the <code>&lt;information&gt;</code> element. You can also
specify child elements; Eclipse GlassFish provides no default children.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;resources</span> <span class="error">[</span><span class="attribute-name">attributes</span><span class="error">]</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can specify one or more of the <code>os</code>, <code>arch</code>, <code>platform</code>, and
<code>locale</code> attributes for the <code>&lt;resources&gt;</code> element. You can also specify
child elements; Eclipse GlassFish provides no default children.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;resources</span> <span class="error">[</span><span class="attribute-name">no-attributes</span><span class="error">]</span><span class="tag">&gt;</span>
    <span class="tag">&lt;jar</span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds JAR files to be included in the application to the JAR files
provided by Eclipse GlassFish.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;resources</span> <span class="error">[</span><span class="attribute-name">no-attributes</span><span class="error">]</span><span class="tag">&gt;</span>
    <span class="tag">&lt;nativelib</span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds native libraries to be included in the application. Each entry in
a JAR listed in a <code>&lt;nativelib&gt;</code> element must be a native library for the
correct platform. The full syntax of the <code>&lt;nativelib&gt;</code> element lets the
developer specify the platform for that native library.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;resources</span> <span class="error">[</span><span class="attribute-name">no-attributes</span><span class="error">]</span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds system properties to be included in the application to the system
properties defined by Eclipse GlassFish.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;resources</span> <span class="error">[</span><span class="attribute-name">no-attributes</span><span class="error">]</span><span class="tag">&gt;</span>
    <span class="tag">&lt;extension</span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies another custom JNLP file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;component-desc</span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes another custom JNLP file that specifies a component
extension.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jnlp&gt;</span>
  <span class="tag">&lt;installer-desc</span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes another custom JNLP file that specifies an installer
extension.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="using-the-embeddable-acc"><a class="anchor" href="#using-the-embeddable-acc"></a>Using the Embeddable ACC</h4>
<div class="paragraph">
<p>You can embed the ACC into your application client. If you place the
as-install<code>/lib/gf-client.jar</code> file in your runtime classpath, your
application creates the ACC after your application code has started,
then requests that the ACC start the application client portion. The
basic model for coding is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a builder object.</p>
</li>
<li>
<p>Operate on the builder to configure the ACC.</p>
</li>
<li>
<p>Obtain a new ACC instance from the builder.</p>
</li>
<li>
<p>Present a client archive or class to the ACC instance.</p>
</li>
<li>
<p>Start the client running within the newly created ACC instance.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Your code should follow this general pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// one TargetServer for each ORB endpoint for bootstrapping</span>
TargetServer<span class="type">[]</span> servers = ...;

<span class="comment">// Get a builder to set up the ACC</span>
AppClientContainer.Builder builder = AppClientContainer.newBuilder(servers);

<span class="comment">// Fine-tune the ACC's configuration. Note ability to &quot;chain&quot; invocations.</span>
builder.callbackHandler(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.MyHandler</span><span class="delimiter">&quot;</span></span>).authRealm(<span class="string"><span class="delimiter">&quot;</span><span class="content">myRealm</span><span class="delimiter">&quot;</span></span>); <span class="comment">// Modify config</span>

<span class="comment">// Get a container for a client.</span>
<span class="predefined-type">URI</span> clientURI = ...; <span class="comment">// URI to the client JAR</span>
AppClientContainer acc = builder.newContainer(clientURI);

or

<span class="predefined-type">Class</span> mainClass = ...;
AppClientContainer acc = builder.newContainer(mainClass);

<span class="comment">// In either case, start the client running.</span>
<span class="predefined-type">String</span><span class="type">[]</span> appArgs = ...;
acc.startClient(appArgs); <span class="comment">// Start the client</span>

...

acc.close(); <span class="comment">// close the ACC(optional)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ACC loads the application client&#8217;s <code>main</code> class, performs any
required injection, and transfers control to the <code>static main</code> method.
The ACC&#8217;s <code>run</code> method returns to the calling application as soon as the
client&#8217;s <code>main</code> method returns to the ACC.</p>
</div>
<div class="paragraph">
<p>If the application client&#8217;s <code>main</code> method starts any asynchronous
activity, that work continues after the ACC returns. The ACC has no
knowledge of whether the client&#8217;s <code>main</code> method triggers asynchronous
work. Therefore, if the client causes work on threads other than the
calling thread, and if the embedding application needs to know when the
client&#8217;s asynchronous work completes, the embedding application and the
client must agree on how this happens.</p>
</div>
<div class="paragraph">
<p>The ACC&#8217;s shutdown handling is invoked from the ACC&#8217;s <code>close</code> method.
The calling application can invoke <code>acc.close()</code> to close down any
services started by the ACC. If the application client code started any
asynchronous activity that might still depend on ACC services, invoking
<code>close</code> before that asynchronous activity completes could cause
unpredictable and undesirable results. The shutdown handling is also run
automatically at VM shutdown if the code has not invoked <code>close</code> before
then.</p>
</div>
<div class="paragraph">
<p>The ACC does not prevent the calling application from creating or
running more than one ACC instance during a single execution of the
application either serially or concurrently. However, other services
used by the ACC (transaction manager, security, ORB, and so on) might or
might not support such serial or concurrent reuse.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-an-application-client-using-the-appclient-script"><a class="anchor" href="#running-an-application-client-using-the-appclient-script"></a>Running an Application Client Using the <code>appclient</code> Script</h4>
<div class="paragraph">
<p>To run an application client, you can launch the ACC using the
<code>appclient</code> script, whether or not Java Web Start is enabled. This is
optional. This script is located in the as-install<code>/bin</code> directory. For
details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-package-appclient-script"><a class="anchor" href="#using-the-package-appclient-script"></a>Using the <code>package-appclient</code> Script</h4>
<div class="paragraph">
<p>You can package the Eclipse GlassFish system files required to launch
application clients on remote systems into a single JAR file using the
<code>package-appclient</code> script. This is optional. This script is located in
the as-install<code>/bin</code> directory. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p><a id="GSDVG00468"></a><a id="the-client.policy-file"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="the-client-policy-file"><a class="anchor" href="#the-client-policy-file"></a>The <code>client.policy</code> File</h4>
<div class="paragraph">
<p>The <code>client.policy</code> file is the J2SE policy file used by the application
client. Each application client has a <code>client.policy</code> file. The default
policy file limits the permissions of Jakarta EE deployed application
clients to the minimal set of permissions required for these
applications to operate correctly. If an application client requires
more than this default set of permissions, edit the <code>client.policy</code> file
to add the custom permissions that your application client needs. Use
the J2SE standard policy tool or any text editor to edit this file.</p>
</div>
<div class="paragraph">
<p>For more information on using the J2SE policy tool, see
<code><a href="http://docs.oracle.com/javase/tutorial/security/tour2/index.html" class="bare">http://docs.oracle.com/javase/tutorial/security/tour2/index.html</a></code>.</p>
</div>
<div class="paragraph">
<p>For more information about the permissions you can set in the
<code>client.policy</code> file, see
<code><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/permissions.html" class="bare">http://docs.oracle.com/javase/7/docs/technotes/guides/security/permissions.html</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-rmiiiop-over-ssl"><a class="anchor" href="#using-rmiiiop-over-ssl"></a>Using RMI/IIOP Over SSL</h4>
<div class="paragraph">
<p>You can configure RMI/IIOP over SSL in two ways: using a username and
password, or using a client certificate.</p>
</div>
<div class="paragraph">
<p>To use a username and password, configure the <code>ior-security-config</code>
element in the <code>glassfish-ejb-jar.xml</code> file. The following configuration
establishes SSL between an application client and an EJB component using
a username and password. The user has to login to the ACC using either
the <code>sun-acc.xml</code> mechanism or the
<a href="#programmatic-login-using-the-programmaticlogin-class">Programmatic Login Using the
ProgrammaticLogin Class</a> mechanism.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ior-security-config&gt;</span>
  <span class="tag">&lt;transport-config&gt;</span>
    <span class="tag">&lt;integrity&gt;</span>required<span class="tag">&lt;/integrity&gt;</span>
    <span class="tag">&lt;confidentiality&gt;</span>required<span class="tag">&lt;/confidentiality&gt;</span>
    <span class="tag">&lt;establish-trust-in-target&gt;</span>supported<span class="tag">&lt;/establish-trust-in-target&gt;</span>
    <span class="tag">&lt;establish-trust-in-client&gt;</span>none<span class="tag">&lt;/establish-trust-in-client&gt;</span>
  <span class="tag">&lt;/transport-config&gt;</span>
  <span class="tag">&lt;as-context&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>username_password<span class="tag">&lt;/auth-method&gt;</span>
    <span class="tag">&lt;realm&gt;</span>default<span class="tag">&lt;/realm&gt;</span>
    <span class="tag">&lt;required&gt;</span>true<span class="tag">&lt;/required&gt;</span>
  <span class="tag">&lt;/as-context&gt;</span>
 <span class="tag">&lt;sas-context&gt;</span>
    <span class="tag">&lt;caller-propagation&gt;</span>none<span class="tag">&lt;/caller-propagation&gt;</span>
 <span class="tag">&lt;/sas-context&gt;</span>
<span class="tag">&lt;/ior-security-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>glassfish-ejb-jar.xml</code> and <code>sun-acc.xml</code>
files, see the <a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish
Application Deployment Guide</a>.</p>
</div>
<div class="paragraph">
<p>To use a client certificate, configure the <code>ior-security-config</code> element
in the <code>glassfish-ejb-jar.xml</code> file. The following configuration
establishes SSL between an application client and an EJB component using
a client certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ior-security-config&gt;</span>
  <span class="tag">&lt;transport-config&gt;</span>
    <span class="tag">&lt;integrity&gt;</span>required<span class="tag">&lt;/integrity&gt;</span>
    <span class="tag">&lt;confidentiality&gt;</span>required<span class="tag">&lt;/confidentiality&gt;</span>
    <span class="tag">&lt;establish-trust-in-target&gt;</span>supported<span class="tag">&lt;/establish-trust-in-target&gt;</span>
    <span class="tag">&lt;establish-trust-in-client&gt;</span>required<span class="tag">&lt;/establish-trust-in-client&gt;</span>
  <span class="tag">&lt;/transport-config&gt;</span>
  <span class="tag">&lt;as-context&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>none<span class="tag">&lt;/auth-method&gt;</span>
    <span class="tag">&lt;realm&gt;</span>default<span class="tag">&lt;/realm&gt;</span>
    <span class="tag">&lt;required&gt;</span>false<span class="tag">&lt;/required&gt;</span>
  <span class="tag">&lt;/as-context&gt;</span>
  <span class="tag">&lt;sas-context&gt;</span>
    <span class="tag">&lt;caller-propagation&gt;</span>none<span class="tag">&lt;/caller-propagation&gt;</span>
  <span class="tag">&lt;/sas-context&gt;</span>
<span class="tag">&lt;/ior-security-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To use a client certificate, you must also specify the system properties
for the keystore and truststore to be used in establishing SSL. To use
SSL with the Application Client Container (ACC), you need to set these
system properties in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the new syntax of the <code>appclient</code> script and specify the system
properties as JVM options. See <a href="#running-an-application-client-using-the-appclient-script">Running an Application Client
Using the <code>appclient</code> Script</a>.</p>
</li>
<li>
<p>Set the environment variable <code>VMARGS</code> in the shell. For example, in
the <code>ksh</code> or <code>bash</code> shell, the command to set this environment variable
would be as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>export VMARGS=&quot;-Djavax.net.ssl.keyStore=${keystore.db.file}
-Djavax.net.ssl.trustStore=${truststore.db.file}
-Djavax.net.ssl.keyStorePass word=${ssl.password}
-Djavax.net.ssl.trustStorePassword=${ssl.password}&quot;</code></pre>
</div>
</div>
</li>
<li>
<p>Optionally, you can set the <code>env</code> element using Ant. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">runclient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;exec</span> <span class="attribute-name">executable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${S1AS_HOME}/bin/appclient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;env</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VMARGS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span> <span class="content">-Djavax.net.ssl.keyStore=${keystore.db.file}</span>
      <span class="content">-Djavax.net.ssl.trustStore=${truststore.db.file}</span>
      <span class="content">-Djavax.net.ssl.keyStorePasword=${ssl.password}</span>
      <span class="content">-Djavax.net.ssl.trustStorePassword=${ssl.password}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-client</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${appClient.jar}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/exec&gt;</span>
<span class="tag">&lt;/target&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="connecting-to-a-remote-ejb-module-through-a-firewall"><a class="anchor" href="#connecting-to-a-remote-ejb-module-through-a-firewall"></a>Connecting to a Remote EJB Module Through a Firewall</h4>
<div class="paragraph">
<p>To deploy and run an application client that connects to an EJB module
on a Eclipse GlassFish instance that is behind a firewall, you must set
ORB Virtual Address Agent Implementation (ORBVAA) options. Use the
<code>asadmin create-jvm-options</code> command as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin create-jvm-options -Dcom.sun.corba.ee.ORBVAAHost=public-IP-adress
asadmin create-jvm-options -Dcom.sun.corba.ee.ORBVAAPort=public-port
asadmin create-jvm-options
-Dcom.sun.corba.ee.ORBUserConfigurators.com.sun.corba.ee.impl.plugin.hwlb.VirtualAddressAgentImpl=x</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set the <code>ORBVAAHost</code> and <code>ORBVAAPort</code> options to the host and port of
the public address. The <code>ORBUserConfigurators</code> option tells the ORB to
create an instance of the <code>VirtualAddressAgentImpl</code> class and invoke the
<code>configure</code> method on the resulting object, which must implement the
com.sun.corba.ee.spi.orb.ORBConfigurator interface. The
<code>ORBUserConfigurators</code> value doesn&#8217;t matter. Together, these options
create an ORB that in turn creates <code>Object</code> references (the underlying
implementation of remote EJB references) containing the public address,
while the ORB listens on the private address specified for the IIOP port
in the Eclipse GlassFish configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="specifying-a-splash-screen"><a class="anchor" href="#specifying-a-splash-screen"></a>Specifying a Splash Screen</h4>
<div class="paragraph">
<p>Java SE 6 offers splash screen support, either through a Java
command-line option or a manifest entry in the application&#8217;s JAR file.
To take advantage of this Java SE feature in your application client,
you can do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the appclient JAR file so that its manifest contains a
<code>SplashScreen-Image</code> entry that specifies the path to the image in the
client. The <code>java</code> command displays the splash screen before starting
the ACC or your client, just as with any Java application.</p>
</li>
<li>
<p>Use the new <code>appclient &#8230;&#8203; -jar</code> launch format, using the <code>-splash</code>
command-line option at runtime or the <code>SplashScreen-Image</code> manifest
entry at development time. See <a href="#running-an-application-client-using-the-appclient-script">Running an Application Client
Using the <code>appclient</code> Script</a>.</p>
</li>
<li>
<p>In the environment that runs the <code>appclient</code> script, set the <code>VMOPTS</code>
environment variable to include the <code>-splash</code> option before invoking the
<code>appclient</code> script to launch the client.</p>
</li>
<li>
<p>Build an application client that uses the embeddable ACC feature and
specify the splash screen image using one of the following:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>-splash</code> option of the <code>java</code> command</p>
</li>
<li>
<p><code>SplashScreen-Image</code> in the manifest for your program (not the
manifest for the application client)</p>
<div class="paragraph">
<p>See <a href="#using-the-embeddable-acc">Using the Embeddable ACC</a>.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>During application (EAR file) deployment, the Eclipse GlassFish generates
façade JAR files, one for the application and one for each application
client in the application. During application client module deployment,
the Eclipse GlassFish generates a single facade JAR for the application
client. The <code>appclient</code> script supports splash screens inside the
application client JAR only if you launch an application client facade
or appclient client JAR. If you launch the facade for an application or
the undeployed application itself, the <code>appclient</code> script cannot take
advantage of the Java SE 6 splash screen feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-login-retries"><a class="anchor" href="#setting-login-retries"></a>Setting Login Retries</h4>
<div class="paragraph">
<p>You can set a JVM option using the <code>appclient</code> script that determines
the number of login retries allowed. This option is
`-Dorg.glassfish.appclient.acc.maxLoginRetries=`n where n is a positive
integer. The default number of retries is 3.</p>
</div>
<div class="paragraph">
<p>This retry loop happens when the ACC attempts to perform injection if
you annotated the client&#8217;s <code>main</code> class (for example, using
<code>@Resource</code>). If instead of annotations your client uses the
<code>InitialContext</code> explicitly to look up remote resources, the retry loop
does not apply. In this case, you could write logic to catch an
exception around the lookup and retry explicitly.</p>
</div>
<div class="paragraph">
<p>For details about the <code>appclient</code> script syntax, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-libraries-with-application-clients"><a class="anchor" href="#using-libraries-with-application-clients"></a>Using Libraries with Application Clients</h4>
<div class="paragraph">
<p>The Libraries field in the Administration Console&#8217;s deployment page and
the <code>--libraries</code> option of the <code>asadmin deploy</code> command do not apply to
application clients. Neither do the as-install<code>/lib</code>, domain-dir<code>/lib</code>,
and domain-dir`/lib/classes` directories comprising the Common Class
Loader. These apply only to applications and modules deployed to the
server. For more information, see <a href="#class-loaders">Class
Loaders</a>.</p>
</div>
<div class="paragraph">
<p>To use libraries with an application client, package the application
client in an application (EAR file). Then, either place the libraries in
the <code>/lib</code> directory of the EAR file or specify their location in the
application client JAR file&#8217;s manifest <code>Class-Path</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="developing-clients-without-the-acc"><a class="anchor" href="#developing-clients-without-the-acc"></a>Developing Clients Without the ACC</h3>
<div class="paragraph">
<p>This section describes the procedure to create, assemble, and deploy a
Java-based client that is not packaged using the Application Client
Container (ACC).</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#to-access-an-ejb-component-from-a-stand-alone-client">To access an EJB component from a stand-alone client</a></p>
</li>
<li>
<p><a href="#to-access-an-ejb-component-from-a-server-side-module">To access an EJB component from a server-side module</a></p>
</li>
<li>
<p><a href="#to-access-a-jms-resource-from-a-stand-alone-client">To access a JMS resource from a stand-alone client</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about using the ACC, see <a href="#developing-clients-using-the-acc">Developing Clients
Using the ACC</a>.</p>
</div>
<div class="sect3">
<h4 id="to-access-an-ejb-component-from-a-stand-alone-client"><a class="anchor" href="#to-access-an-ejb-component-from-a-stand-alone-client"></a>To access an EJB component from a stand-alone client</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In your client code, instantiate the <code>InitialContext</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">InitialContext</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is not necessary to explicitly instantiate a naming context that
points to the CosNaming service.</p>
</div>
</li>
<li>
<p>In the client code, look up the home object by specifying the JNDI
name of the home object.</p>
<div class="paragraph">
<p>Here is an EJB 2.x example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span> ref = ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">jndi-name</span><span class="delimiter">&quot;</span></span>);
BeanAHome = (BeanAHome)<span class="predefined-type">PortableRemoteObject</span>.narrow(ref,BeanAHome.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an EJB 3.x example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">BeanRemoteBusiness bean =(BeanRemoteBusiness) ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.BeanRemoteBusiness</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If load balancing is enabled as in Step <a href="#CIHJADHD">6</a> and the EJB
components being accessed are in a different cluster, the endpoint list
must be included in the lookup, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>corbaname:host1:port1,host2:port2,.../NameService#ejb/jndi-name</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about naming and lookups, see
<a href="#accessing-the-naming-context">Accessing the Naming Context</a>.</p>
</div>
</li>
<li>
<p>Deploy the EJB component to be accessed.</p>
<div class="paragraph">
<p>For more information on deployment, see "<a href="application-deployment-guide.html#about-deployment-tools">About
Deployment Tools</a>" in Eclipse GlassFish Application
Deployment Guide.</p>
</div>
</li>
<li>
<p>Copy the as-install<code>/lib/gf-client.jar</code> file to the client machine
and include it in the classpath on the client side.</p>
<div class="paragraph">
<p>The <code>gf-client.jar</code> file references Eclipse GlassFish JAR files in its
<code>MANIFEST.MF</code> file. If there is no Eclipse GlassFish installation on the
client machine, you must also copy the as-install<code>/modules</code> directory to
the client machine and maintain its directory structure relative to the
as-install<code>/lib/gf-client.jar</code> file. Or you can use the
<code>package-appclient</code> script; see <a href="#using-the-package-appclient-script">Using the
<code>package-appclient</code> Script</a>.</p>
</div>
</li>
<li>
<p>To access EJB components that are residing in a remote system, set
the following system properties for the Java Virtual Machine startup
options:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>-Dorg.omg.CORBA.ORBInitialHost=${ORBhost}
-Dorg.omg.CORBA.ORBInitialPort=${ORBport}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here ORBhost is the Eclipse GlassFish hostname and ORBport is the ORB
port number (default is <code>3700</code> for the default server instance, named
<code>server</code>).</p>
</div>
<div class="paragraph">
<p>You can use the <code>asadmin get</code> command to get the IIOP port numbers. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin get &quot;configs.config.server-config.iiop-service.iiop-listener.orb-listener-1.*&quot;</code></pre>
</div>
</div>
</li>
<li>
<p><a id="CIHJADHD"></a></p>
<div class="paragraph">
<p>To set up load balancing and remote EJB reference failover, define the
<code>endpoints</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>-Dcom.sun.appserv.iiop.endpoints=host1:port1,host2:port2,...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>endpoints</code> property specifies a comma-separated list of one or more
IIOP endpoints used for load balancing. An IIOP endpoint is in the form
host`:`port, where the host is an IPv4 address or host name, and the
port specifies the port number.</p>
</div>
<div class="paragraph">
<p>If the <code>endpoints</code> list is changed dynamically in the code, the new list
is used only if a new <code>InitialContext</code> is created.</p>
</div>
</li>
<li>
<p>Make sure the <code>etc/hosts</code> file on the client machine maps the
Eclipse GlassFish hostname and external IP address.</p>
</li>
<li>
<p>Run the stand-alone client.</p>
<div class="paragraph">
<p>As long as the client environment is set appropriately and the JVM is
compatible, you merely need to run the <code>main</code> class.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-access-an-ejb-component-from-a-server-side-module"><a class="anchor" href="#to-access-an-ejb-component-from-a-server-side-module"></a>To access an EJB component from a server-side module</h4>
<div class="paragraph">
<p>A server-side module can be a servlet, another EJB component, or another
type of module.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="CIHFIJDC"></a></p>
<div class="paragraph">
<p>In your module code, instantiate the <code>InitialContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">InitialContext</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is not necessary to explicitly instantiate a naming context that
points to the CosNaming service.</p>
</div>
<div class="paragraph">
<p>To set up load balancing and remote EJB reference failover, define the
<code>endpoints</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Hashtable</span> env = <span class="keyword">new</span> <span class="predefined-type">Hashtable</span>();
env.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.sun.appserv.iiop.endpoints</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">host1:port1,host2:port2,...</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">InitialContext</span> ctx = <span class="keyword">new</span> InitialConext(env);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>endpoints</code> property specifies a comma-separated list of one or more
IIOP endpoints used for load balancing. An IIOP endpoint is in the form
host`:`port, where the host is an IPv4 address or host name, and the
port specifies the port number.</p>
</div>
<div class="paragraph">
<p>You can use the <code>asadmin get</code> command to get the IIOP port numbers. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin get &quot;configs.config.server-config.iiop-service.iiop-listener.orb-listener-1.*&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>endpoints</code> list is changed dynamically in the code, the new list
is used only if a new <code>InitialContext</code> is created.</p>
</div>
</li>
<li>
<p>In the module code, look up the home object by specifying the JNDI
name of the home object.</p>
<div class="paragraph">
<p>Here is an EJB 2.x example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span> ref = ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">jndi-name</span><span class="delimiter">&quot;</span></span>);
BeanAHome = (BeanAHome)<span class="predefined-type">PortableRemoteObject</span>.narrow(ref,BeanAHome.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an EJB 3.x example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">BeanRemoteBusiness bean =(BeanRemoteBusiness) ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.BeanRemoteBusiness</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If load balancing is enabled as in Step <a href="#CIHFIJDC">1</a> and the EJB
components being accessed are in a different cluster, the endpoint list
must be included in the lookup, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>corbaname:host1:port1,host2:port2,.../NameService#ejb/jndi-name</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about naming and lookups, see
<a href="#accessing-the-naming-context">Accessing the Naming Context</a>.</p>
</div>
</li>
<li>
<p>Deploy the EJB component to be accessed.</p>
<div class="paragraph">
<p>For more information on deployment, see "<a href="application-deployment-guide.html#about-deployment-tools">About
Deployment Tools</a>" in Eclipse GlassFish Application
Deployment Guide.</p>
</div>
</li>
<li>
<p>To access EJB components that are residing in a remote system, set
the following system properties for the Java Virtual Machine startup
options:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>-Dorg.omg.CORBA.ORBInitialHost=${ORBhost}
-Dorg.omg.CORBA.ORBInitialPort=${ORBport}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here ORBhost is the Application Server hostname and ORBport is the ORB
port number (default is <code>3700</code> for the default server instance, named <code>server</code>).</p>
</div>
</li>
<li>
<p>Deploy the module.</p>
<div class="paragraph">
<p>For more information on deployment, see "<a href="application-deployment-guide.html#about-deployment-tools">About
Deployment Tools</a>" in Eclipse GlassFish Application
Deployment Guide.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-access-a-jms-resource-from-a-stand-alone-client"><a class="anchor" href="#to-access-a-jms-resource-from-a-stand-alone-client"></a>To access a JMS resource from a stand-alone client</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a JMS client.</p>
<div class="paragraph">
<p>For detailed instructions on developing a JMS client, see
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#jakarta-messaging-examples">
Java Message Service Examples</a> in The Jakarta EE Tutorial.</p>
</div>
</li>
<li>
<p>Configure a JMS resource on Eclipse GlassFish.</p>
<div class="paragraph">
<p>For information on configuring JMS resources, see
"<a href="administration-guide.html#administering-jms-connection-factories-and-destinations">
Administering JMS Connection Factories and Destinations</a>"
in Eclipse GlassFish Administration Guide.</p>
</div>
</li>
<li>
<p>Copy the following JAR files to the client machine and include them
in the classpath on the client side:</p>
<div class="ulist">
<ul>
<li>
<p><code>gf-client.jar</code> - available at as-install<code>/lib</code></p>
</li>
<li>
<p><code>imqjmsra.jar</code> - available at
as-install<code>/lib/install/aplications/jmsra</code></p>
<div class="paragraph">
<p>The <code>gf-client.jar</code> file references Eclipse GlassFish JAR files in its
<code>MANIFEST.MF</code> file. If there is no Eclipse GlassFish installation on the
client machine, you must also copy the as-install<code>/modules</code> directory to
the client machine and maintain its directory structure relative to the
as-install<code>/lib/gf-client.jar</code> file. Or you can use the
<code>package-appclient</code> script; see <a href="#using-the-package-appclient-script">Using the
<code>package-appclient</code> Script</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>To access EJB components that are residing in a remote system, set
the following system properties for the Java Virtual Machine startup
options:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>-Dorg.omg.CORBA.ORBInitialHost=${ORBhost}
-Dorg.omg.CORBA.ORBInitialPort=${ORBport}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here ORBhost is the Application Server hostname and ORBport is the ORB
port number (default is <code>3700</code> for the default server instance, named
<code>server</code>).</p>
</div>
<div class="paragraph">
<p>You can use the <code>asadmin get</code> command to get the IIOP port numbers. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin get &quot;configs.config.server-config.iiop-service.iiop-listener.orb-listener-1.*&quot;</code></pre>
</div>
</div>
</li>
<li>
<p>Run the stand-alone client.</p>
<div class="paragraph">
<p>As long as the client environment is set appropriately and the JVM is
compatible, you merely need to run the <code>main</code> class.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing-connectors"><a class="anchor" href="#developing-connectors"></a>16. Developing Connectors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Eclipse GlassFish support for the Jakarta EE
Connector Architecture, also known as
<a href="http://jcp.org/en/jsr/detail?id=322">JSR 322</a>
(<code><a href="http://jcp.org/en/jsr/detail?id=322" class="bare">http://jcp.org/en/jsr/detail?id=322</a></code>).</p>
</div>
<div class="paragraph">
<p>The Jakarta EE Connector Architecture provides a Java solution to the
problem of connectivity between multiple application servers and
existing enterprise information systems (EISs). By using the Jakarta EE
Connector architecture, EIS vendors no longer need to customize their
product for each application server. Application server vendors who
conform to the Jakarta EE Connector architecture do not need to write
custom code to add connectivity to a new EIS.</p>
</div>
<div class="paragraph">
<p>This chapter uses the terms connector and resource adapter
interchangeably. Both terms refer to a resource adapter module that is
developed in conformance with the Jakarta EE Connector Architecture
Specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you installed the Web Profile, connector modules that use only
outbound communication features and work-management that does not
involve inbound communication features are supported. Other connector
features are supported only in the full Eclipse GlassFish.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information about connectors, see
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#resource-adapters-and-contracts">
Resource Adapters and Contracts</a> in The Jakarta EE Tutorial.</p>
</div>
<div class="paragraph">
<p>For information about deploying a connector to the Eclipse GlassFish, see
the <a href="application-deployment-guide.html#GSDPG">
Eclipse GlassFish Application Deployment Guide</a>.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#connector-support-in-the-glassfish-server">Connector Support in the Eclipse GlassFish</a></p>
</li>
<li>
<p><a href="#advanced-connector-configuration-options">Advanced Connector Configuration Options</a></p>
</li>
<li>
<p><a href="#inbound-communication-support">Inbound Communication Support</a></p>
</li>
<li>
<p><a href="#outbound-communication-support">Outbound Communication Support</a></p>
</li>
<li>
<p><a href="#configuring-a-message-driven-bean-to-use-a-resource-adapter">Configuring a Message Driven Bean to Use a Resource Adapter</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="connector-support-in-the-glassfish-server"><a class="anchor" href="#connector-support-in-the-glassfish-server"></a>Connector Support in the Eclipse GlassFish</h3>
<div class="paragraph">
<p>The Eclipse GlassFish supports the development and deployment of resource
adapters that are compatible with the Connector 1.6 specification (and,
for backward compatibility, the Connector 1.0 and 1.5 specifications).</p>
</div>
<div class="paragraph">
<p>The Connector 1.0 specification defines the outbound connectivity system
contracts between the resource adapter and the Eclipse GlassFish. The
Connector 1.5 specification introduces major additions in defining
system level contracts between the Eclipse GlassFish and the resource
adapter with respect to inbound connectivity, life cycle management, and
thread management. The Connector 1.6 specification introduces further
additions in defining system level contracts between the Eclipse GlassFish and the resource adapter with respect to the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generic work context contract — A generic contract that enables a
resource adapter to control the execution context of a <code>Work</code> instance
that it has submitted to the Eclipse GlassFish for execution. The
<code>Generic</code> work contract provides the mechanism for a resource adapter to
augment the runtime context of a <code>Work</code> instance with additional
contextual information flown-in from the EIS. This contract enables a
resource adapter to control, in a more flexible manner, the contexts in
which the <code>Work</code> instances submitted by it are executed by the
application server&#8217;s <code>WorkManager</code>.</p>
</li>
<li>
<p>Security work context — A standard contract that enables a resource
adapter to establish security information while submitting a <code>Work</code>
instance for execution to a <code>WorkManager</code> and while delivering
messages-to-message endpoints residing in the Eclipse GlassFish. This
contract provides a mechanism to support the execution of a <code>Work</code>
instance in the context of an established identity. It also supports the
propagation of user information or Principal information from an EIS to
a <code>MessageEndpoint</code> during message inflow.</p>
</li>
<li>
<p>Transaction context — The transaction context contract between the
resource adapter and the application server leverages the Generic Work
Context mechanism by describing a standard <code>WorkContext</code>, the
<code>TransactionContext</code>. It represents the standard interface a resource
adapter can use to propagate transaction context information from the
EIS to the application server.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="connector-architecture-for-jms-and-jdbc"><a class="anchor" href="#connector-architecture-for-jms-and-jdbc"></a>Connector Architecture for JMS and JDBC</h4>
<div class="paragraph">
<p>In the Administration Console, connector, JMS, and JDBC resources are
handled differently, but they use the same underlying Connector
architecture. In the Eclipse GlassFish, all communication to an EIS,
whether to a message provider or an RDBMS, happens through the Connector
architecture. To provide JMS infrastructure to clients, the Eclipse GlassFish uses the Open Message Queue software. To provide JDBC
infrastructure to clients, the Eclipse GlassFish uses its own JDBC system
resource adapters. The Eclipse GlassFish automatically makes these system
resource adapters available to any client that requires them.</p>
</div>
<div class="paragraph">
<p>For more information about JMS in the Eclipse GlassFish, see
<a href="#using-the-java-message-service">Using the Java Message Service</a>. For more information
about JDBC in the Eclipse GlassFish, see <a href="#using-the-jdbc-api-for-database-access">Using the
JDBC API for Database Access</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="connector-configuration"><a class="anchor" href="#connector-configuration"></a>Connector Configuration</h4>
<div class="paragraph">
<p>The Eclipse GlassFish does not need to use <code>sun-ra.xml</code>, which previous
Eclipse GlassFish versions used, to store server-specific deployment
information inside a Resource Adapter Archive (RAR) file. (However, the
<code>sun-ra.xml</code> file is still supported for backward compatibility.)
Instead, the information is stored in the server configuration. As a
result, you can create multiple connector connection pools for a
connection definition in a functional resource adapter instance, and you
can create multiple user-accessible connector resources (that is,
registering a resource with a JNDI name) for a connector connection
pool. In addition, dynamic changes can be made to connector connection
pools and the connector resource properties without restarting the
Eclipse GlassFish.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-connector-configuration-options"><a class="anchor" href="#advanced-connector-configuration-options"></a>Advanced Connector Configuration Options</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#thread-associations">Thread Associations</a></p>
</li>
<li>
<p><a href="#security-maps">Security Maps</a></p>
</li>
<li>
<p><a href="#work-security-maps">Work Security Maps</a></p>
</li>
<li>
<p><a href="#overriding-configuration-properties">Overriding Configuration Properties</a></p>
</li>
<li>
<p><a href="#testing-a-connector-connection-pool">Testing a Connector Connection Pool</a></p>
</li>
<li>
<p><a href="#flushing-a-connector-connection-pool">Flushing a Connector Connection Pool</a></p>
</li>
<li>
<p><a href="#handling-invalid-connections">Handling Invalid Connections</a></p>
</li>
<li>
<p><a href="#setting-the-shutdown-timeout">Setting the Shutdown Timeout</a></p>
</li>
<li>
<p><a href="#specifying-the-class-loading-policy">Specifying the Class Loading Policy</a></p>
</li>
<li>
<p><a href="#using-last-agent-optimization-of-transactions">Using Last Agent Optimization of Transactions</a></p>
</li>
<li>
<p><a href="#disabling-pooling-for-a-connection">Disabling Pooling for a Connection</a></p>
</li>
<li>
<p><a href="#using-application-scoped-connectors">Using Application-Scoped Connectors</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="thread-associations"><a class="anchor" href="#thread-associations"></a>Thread Associations</h4>
<div class="paragraph">
<p>Connectors can submit work instances to the Eclipse GlassFish for
execution. By default, the Eclipse GlassFish services work requests for
all connectors from its default thread pool. However, you can associate
a specific user-created thread pool to service work requests from a
connector. A thread pool can service work requests from multiple
resource adapters. To create a thread pool:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, select Thread Pools under the relevant
configuration. For details, click the Help button in the Administration
Console.</p>
</li>
<li>
<p>Use the <code>asadmin create-threadpool</code> command. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To associate a connector with a thread pool:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, open the Applications component and
select Resource Adapter Configs. Specify the name of the thread pool in
the Thread Pool ID field. For details, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>Use the <code>--threadpoolid</code> option of the
<code>asadmin create-resource-adapter-config</code> command. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you create a resource adapter configuration for a connector module
that is already deployed, the connector module deployment is restarted
with the new configuration properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="security-maps"><a class="anchor" href="#security-maps"></a>Security Maps</h4>
<div class="paragraph">
<p>Create a security map for a connector connection pool to map an
application principal or a user group to a back end EIS principal. The
security map is usually used in situations where one or more EIS back
end principals are used to execute operations (on the EIS) initiated by
various principals or user groups in the application.</p>
</div>
<div class="paragraph">
<p>To create or update security maps for a connector connection pool:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, open the Resources component, select
Connectors, select Connector Connection Pools, and select the Security
Maps tab. For details, click the Help button in the Administration
Console.</p>
</li>
<li>
<p>Use the <code>asadmin create-connector-security-map</code> command. For details,
see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference
Manual</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a security map already exists for a connector connection pool, the
new security map is appended to the previous one. The connector security
map configuration supports the use of the wildcard asterisk (<code>*</code>) to
indicate all users or all user groups.</p>
</div>
<div class="paragraph">
<p>When an application principal initiates a request to an EIS, the
Eclipse GlassFish first checks for an exact match to a mapped back end
EIS principal using the security map defined for the connector
connection pool. If there is no exact match, the Eclipse GlassFish uses
the wild card character specification, if any, to determined the mapped
back end EIS principal.</p>
</div>
</div>
<div class="sect3">
<h4 id="work-security-maps"><a class="anchor" href="#work-security-maps"></a>Work Security Maps</h4>
<div class="paragraph">
<p>A work security map for a resource adapter maps an EIS principal or
group to a application principal or group. A work security map is useful
in situations where one or more application principals execute
operations initiated by principals or user groups in the EIS. A resource
adapter can have multiple work security maps. A work security map can
map either principals or groups, but not both.</p>
</div>
<div class="paragraph">
<p>To create a work security map, use the
<code>asadmin create-connector-work-security-map</code> command. For details, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>The work security map configuration supports the wildcard asterisk (<code>*</code>)
character to indicate all users or all user groups. When an EIS
principal sends a request to the Eclipse GlassFish, the Eclipse GlassFish
first checks for an exact match to a mapped application principal using
the work security map defined for the resource adapter. If there is no
exact match, the Eclipse GlassFish uses the wild card character
specification, if any, to determine the application principal.</p>
</div>
</div>
<div class="sect3">
<h4 id="overriding-configuration-properties"><a class="anchor" href="#overriding-configuration-properties"></a>Overriding Configuration Properties</h4>
<div class="paragraph">
<p>You can override the properties (<code>config-property</code> elements) specified
in the <code>ra.xml</code> file of a resource adapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, open the Resources component and select
Resource Adapter Configs. Create a new resource adapter configuration or
select an existing one to edit. Then enter property names and values in
the Additional Properties table. For details, click the Help button in
the Administration Console.</p>
</li>
<li>
<p>Use the <code>asadmin create-resource-adapter-config</code> command to create a
configuration for a resource adapter. Use this command&#8217;s <code>--property</code>
option to specify a name-value pair for a resource adapter property. For
details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify configuration properties either before or after resource
adapter deployment. If you specify properties after deploying the
resource adapter, the existing resource adapter is restarted with the
new properties.</p>
</div>
<div class="paragraph">
<p>You can also use token replacement for overriding resource adapter
configuration properties in individual server instances when the
resource adapter is deployed to a cluster. For example, for a property
called <code>inboundPort</code>, you can assign the value <code>${inboundPort}</code>. You can
then assign a different value to this property for each server instance.
Changes to system properties take effect upon server restart.</p>
</div>
</div>
<div class="sect3">
<h4 id="testing-a-connector-connection-pool"><a class="anchor" href="#testing-a-connector-connection-pool"></a>Testing a Connector Connection Pool</h4>
<div class="paragraph">
<p>You can test a connector connection pool for usability in one of these
ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, open the Resources component, open the
Connector component, select Connection Pools, and select the connection
pool you want to test. Then select the Ping button in the top right
corner of the page. For details, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>Use the <code>asadmin ping-connection-pool</code> command. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both these commands fail and display an error message unless they
successfully connect to the connection pool.</p>
</div>
<div class="paragraph">
<p>You can also specify that a connection pool is automatically tested when
created or reconfigured by setting the Ping attribute to <code>true</code> (the
default is <code>false</code>) in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter a Ping value in the Connector Connection Pools page in the
Administration Console. For more information, click the Help button in
the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--ping</code> option in the
<code>asadmin create-connector-connection-pool</code> command. For more
information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="flushing-a-connector-connection-pool"><a class="anchor" href="#flushing-a-connector-connection-pool"></a>Flushing a Connector Connection Pool</h4>
<div class="paragraph">
<p>Flushing a connector connection pool recreates all the connections in
the pool and brings the pool to the steady pool size without the need
for reconfiguring the pool. Connection pool reconfiguration can result
in application redeployment, which is a time-consuming operation.
Flushing destroys existing connections, and any existing transactions
are lost and must be retired.</p>
</div>
<div class="paragraph">
<p>You can flush a connector connection pool in one of these ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, open the Resources component, open the
Connector component, select Connection Pools, and select the connection
pool you want to flush. Then select the Flush button in the top right
corner of the page. For details, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>Use the <code>asadmin flush-connection-pool</code> command. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="handling-invalid-connections"><a class="anchor" href="#handling-invalid-connections"></a>Handling Invalid Connections</h4>
<div class="paragraph">
<p>If a resource adapter generates a <code>ConnectionErrorOccured</code> event, the
Eclipse GlassFish considers the connection invalid and removes the
connection from the connection pool. Typically, a resource adapter
generates a <code>ConnectionErrorOccured</code> event when it finds a
<code>ManagedConnection</code> object unusable. Reasons can be network failure with
the EIS, EIS failure, fatal problems with the resource adapter, and so
on.</p>
</div>
<div class="paragraph">
<p>If the <code>fail-all-connections</code> setting in the connection pool
configuration is set to <code>true</code>, and a single connection fails, all
connections are closed and recreated. If this setting is <code>false</code>,
individual connections are recreated only when they are used. The
default is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>The <code>is-connection-validation-required</code> setting specifies whether
connections have to be validated before being given to the application.
If a resource&#8217;s validation fails, it is destroyed, and a new resource is
created and returned. The default is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>The <code>prefer-validate-over-recreate</code> property specifies that validating
idle connections is preferable to closing them. This property has no
effect on non-idle connections. If set to <code>true</code>, idle connections are
validated during pool resizing, and only those found to be invalid are
destroyed and recreated. If <code>false</code>, all idle connections are destroyed
and recreated during pool resizing. The default is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>You can set the <code>fail-all-connections</code>,
<code>is-connection-validation-required</code>, and <code>prefer-validate-over-recreate</code>
configuration settings during creation of a connector connection pool.
Or, you can use the <code>asadmin set</code> command to dynamically reconfigure a
setting. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server.resources.connector-connection-pool.CCP1.fail-all-connections=&quot;true&quot;
asadmin set server.resources.connector-connection-pool.CCP1.is-connection-validation-required=&quot;true&quot;
asadmin set server.resources.connector-connection-pool.CCP1.property.prefer-validate-over-recreate=&quot;true&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>The interface ValidatingManagedConnectionFactory exposes the method
<code>getInvalidConnections</code> to allow retrieval of the invalid connections.
The Eclipse GlassFish checks if the resource adapter implements this
interface, and if it does, invalid connections are removed when the
connection pool is resized.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-the-shutdown-timeout"><a class="anchor" href="#setting-the-shutdown-timeout"></a>Setting the Shutdown Timeout</h4>
<div class="paragraph">
<p>According to the Connector specification, while an application server
shuts down, all resource adapters should be stopped. A resource adapter
might hang during shutdown, since shutdown is typically a resource
intensive operation. To avoid such a situation, you can set a timeout
that aborts resource adapter shutdown if exceeded. The default timeout
is 30 seconds per resource adapter module. To configure this timeout:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, select Connector Service under the
relevant configuration and edit the shutdown Timeout field. For details,
click the Help button in the Administration Console.</p>
</li>
<li>
<p>Use the following <code>asadmin set</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server.connector-service.shutdown-timeout-in-seconds=&quot;num-secs&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish deactivates all message-driven bean deployments
before stopping a resource adapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="specifying-the-class-loading-policy"><a class="anchor" href="#specifying-the-class-loading-policy"></a>Specifying the Class Loading Policy</h4>
<div class="paragraph">
<p>Use the <code>class-loading-policy</code> setting to determine which resource
adapters accessible to applications. Allowed values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>derived</code> — Applications access resource adapters based on references
in their deployment descriptors. These references can be <code>resource-ref</code>,
<code>resource-env-ref</code>, <code>resource-adapter-mid</code>, or equivalent annotations.</p>
</li>
<li>
<p><code>global</code> — All stand-alone resource adapters are available to all
applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure this setting, use the <code>asadmin set</code> command. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server.connector-service.class-loading-policy=&quot;global&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-last-agent-optimization-of-transactions"><a class="anchor" href="#using-last-agent-optimization-of-transactions"></a>Using Last Agent Optimization of Transactions</h4>
<div class="paragraph">
<p>Transactions that involve multiple resources or multiple participant
processes are distributed or global transactions. A global transaction
can involve one non-XA resource if last agent optimization is enabled.
Otherwise, all resources must be XA. For more information about
transactions in the Eclipse GlassFish, see
<a href="#using-the-transaction-service">Using the Transaction Service</a>.</p>
</div>
<div class="paragraph">
<p>The Connector specification requires that if a resource adapter supports
<code>XATransaction</code>, the <code>ManagedConnection</code> created from that resource
adapter must support both distributed and local transactions. Therefore,
even if a resource adapter supports <code>XATransaction</code>, you can configure
its connector connection pools as non-XA or without transaction support
for better performance. A non-XA resource adapter becomes the last agent
in the transactions in which it participates.</p>
</div>
<div class="paragraph">
<p>The value of the connection pool configuration property
<code>transaction-support</code> defaults to the value of the <code>transaction-support</code>
property in the <code>ra.xml</code> file. The connection pool configuration
property can override the <code>ra.xml</code> file property if the transaction
level in the connection pool configuration property is lower. If the
value in the connection pool configuration property is higher, it is
ignored.</p>
</div>
</div>
<div class="sect3">
<h4 id="disabling-pooling-for-a-connection"><a class="anchor" href="#disabling-pooling-for-a-connection"></a>Disabling Pooling for a Connection</h4>
<div class="paragraph">
<p>To disable connection pooling, set the Pooling attribute to false. The
default is true. You can enable or disable connection pooling in one of
the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter a Pooling value in the Connector Connection Pools page in the
Administration Console. For more information, click the Help button in
the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--pooling</code> option in the
<code>asadmin create-connector-connection-pool</code> command. For more
information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using-application-scoped-connectors"><a class="anchor" href="#using-application-scoped-connectors"></a>Using Application-Scoped Connectors</h4>
<div class="paragraph">
<p>You can define an application-scoped connector or other resource for an
enterprise application, web module, EJB module, connector module, or
application client module by supplying a <code>glassfish-resources.xml</code>
deployment descriptor file. For details, see
"<a href="application-deployment-guide.html#application-scoped-resources">Application-Scoped Resources</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inbound-communication-support"><a class="anchor" href="#inbound-communication-support"></a>Inbound Communication Support</h3>
<div class="paragraph">
<p>The Connector specification defines the transaction and message inflow
system contracts for achieving inbound connectivity from an EIS. The
message inflow contract also serves as a standard message provider
pluggability contract, thereby allowing various message providers to
seamlessly plug in their products with any application server that
supports the message inflow contract. In the inbound communication
model, the EIS initiates all communication to an application. An
application can be composed of enterprise beans (session, entity, or
message-driven beans), which reside in an EJB container.</p>
</div>
<div class="paragraph">
<p>Incoming messages are received through a message endpoint, which is a
message-driven bean. This message-driven bean asynchronously consumes
messages from a message provider. An application can also synchronously
send and receive messages directly using messaging style APIs.</p>
</div>
<div class="paragraph">
<p>A resource adapter supporting inbound communication provides an instance
of an <code>ActivationSpec</code> JavaBean class for each supported message
listener type. Each class contains a set of configurable properties that
specify endpoint activation configuration information during
message-driven bean deployment. The required <code>config-property</code> element
in the <code>ra.xml</code> file provides a list of configuration property names
required for each activation specification. An endpoint activation fails
if the required property values are not specified. Values for the
properties that are overridden in the message-driven bean&#8217;s deployment
descriptor are applied to the <code>ActivationSpec</code> JavaBean when the
message-driven bean is deployed.</p>
</div>
<div class="paragraph">
<p>Administered objects can also be specified for a resource adapter, and
these JavaBeans are specific to a messaging style or message provider.
For example, some messaging styles may need applications to use special
administered objects (such as Queue and Topic objects in JMS).
Applications use these objects to send and synchronously receive
messages using connection objects using messaging style APIs. For more
information about administered objects, see <a href="#using-the-java-message-service">Using the
Java Message Service</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="outbound-communication-support"><a class="anchor" href="#outbound-communication-support"></a>Outbound Communication Support</h3>
<div class="paragraph">
<p>The Connector specification defines the system contracts for achieving
outbound connectivity from an EIS. A resource adapter supporting
outbound communication provides an instance of a
<code>ManagedConnectionFactory</code> JavaBean class. A <code>ManagedConnectionFactory</code>
JavaBean represents outbound connectivity information to an EIS instance
from an application.</p>
</div>
<div class="paragraph">
<p>The 1.6 Connector specification introduces a mechanism through which the
transaction level of a <code>ManagedConnectionFactory</code> can be detected at
runtime. During the configuration of a <code>ManagedConnectionFactory</code> in the
Connector Connection Pools page in the Administration Console, the
Administration Console can instantiate the <code>ManagedConnectionFactory</code>
and show the level of transaction support. The three levels are <code>no-tx</code>,
<code>local-tx</code>, <code>xa-tx</code>. If a <code>ManagedConnectionFactory</code> returns <code>local-tx</code>
as the level it can support, it is assumed that <code>xa-tx</code> is not
supported, and the Administration Console shows only <code>no-tx</code> and
<code>local-tx</code> as the available support levels.</p>
</div>
<div class="paragraph">
<p>For more information, click the Help button in the Administration
Console.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-message-driven-bean-to-use-a-resource-adapter"><a class="anchor" href="#configuring-a-message-driven-bean-to-use-a-resource-adapter"></a>Configuring a Message Driven Bean to Use a Resource Adapter</h3>
<div class="paragraph">
<p>The Connectors specification&#8217;s message inflow contract provides a
generic mechanism to plug in a wide-range of message providers,
including JMS, into a Java-EE-compatible application server. Message
providers use a resource adapter and dispatch messages to message
endpoints, which are implemented as message-driven beans.</p>
</div>
<div class="paragraph">
<p>The message-driven bean developer provides activation configuration
information in the message-driven bean&#8217;s <code>ejb-jar.xml</code> file.
Configuration information includes messaging-style-specific
configuration details, and possibly message-provider-specific details as
well. The message-driven bean deployer uses this configuration
information to set up the activation specification JavaBean. The
activation configuration properties specified in <code>ejb-jar.xml</code> override
configuration properties in the activation specification definition in
the <code>ra.xml</code> file.</p>
</div>
<div class="paragraph">
<p>According to the EJB specification, the messaging-style-specific
descriptor elements contained within the activation configuration
element are not specified because they are specific to a messaging
provider. In the following sample message-driven bean <code>ejb-jar.xml</code>, a
message-driven bean has the following activation configuration property
names: <code>destinationType</code>, <code>SubscriptionDurability</code>, and
<code>MessageSelector</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!--  A sample MDB that listens to a JMS Topic --&gt;</span>
<span class="comment">&lt;!-- message-driven bean deployment descriptor --&gt;</span>
...
 <span class="tag">&lt;activation-config&gt;</span>
   <span class="tag">&lt;activation-config-property&gt;</span>
     <span class="tag">&lt;activation-config-property-name&gt;</span>
       destinationType
     <span class="tag">&lt;/activation-config-property-name&gt;</span>
     <span class="tag">&lt;activation-config-property-value&gt;</span>
       jakarta.jms.Topic
     <span class="tag">&lt;/activation-config-property-value&gt;</span>
  <span class="tag">&lt;/activation-config-property&gt;</span>
  <span class="tag">&lt;activation-config-property&gt;</span>
     <span class="tag">&lt;activation-config-property-name&gt;</span>
       SubscriptionDurability
     <span class="tag">&lt;/activation-config-property-name&gt;</span>
     <span class="tag">&lt;activation-config-property-value&gt;</span>
       Durable
     <span class="tag">&lt;/activation-config-property-value&gt;</span>
  <span class="tag">&lt;/activation-config-property&gt;</span>
  <span class="tag">&lt;activation-config-property&gt;</span>
     <span class="tag">&lt;activation-config-property-name&gt;</span>
       MessageSelector
     <span class="tag">&lt;/activation-config-property-name&gt;</span>
     <span class="tag">&lt;activation-config-property-value&gt;</span>
       JMSType = 'car' AND color = 'blue'
     <span class="tag">&lt;/activation-config-property-value&gt;</span>
  <span class="tag">&lt;/activation-config-property&gt;</span>
 ...
 <span class="tag">&lt;/activation-config&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the message-driven bean is deployed, the value for the
<code>resource-adapter-mid</code> element in the <code>glassfish-ejb-jar.xml</code> file is
set to the resource adapter module name that delivers messages to the
message endpoint (to the message-driven bean). In the following example,
the <code>jmsra</code> JMS resource adapter, which is the bundled resource adapter
for the Message Queue message provider, is specified as the resource
adapter module identifier for the <code>SampleMDB</code> bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-ejb-jar&gt;</span>
<span class="tag">&lt;enterprise-beans&gt;</span>
    <span class="tag">&lt;unique-id&gt;</span>1<span class="tag">&lt;/unique-id&gt;</span>
    <span class="tag">&lt;ejb&gt;</span>
       <span class="tag">&lt;ejb-name&gt;</span>SampleMDB<span class="tag">&lt;/ejb-name&gt;</span>
       <span class="tag">&lt;jndi-name&gt;</span>SampleQueue<span class="tag">&lt;/jndi-name&gt;</span>
    <span class="comment">&lt;!-- JNDI name of the destination from which messages would be
         delivered from MDB needs to listen to --&gt;</span>
    ...
    <span class="tag">&lt;mdb-resource-adapter&gt;</span>
       <span class="tag">&lt;resource-adapter-mid&gt;</span>jmsra<span class="tag">&lt;/resource-adapter-mid&gt;</span>
       <span class="comment">&lt;!-- Resource Adapter Module Id that would deliver messages to
            this message endpoint --&gt;</span>
       <span class="tag">&lt;/mdb-resource-adapter&gt;</span>
    ...
 <span class="tag">&lt;/ejb&gt;</span>
 ...
<span class="tag">&lt;/enterprise-beans&gt;</span>
...
<span class="tag">&lt;/glassfish-ejb-jar&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the message-driven bean is deployed, the Eclipse GlassFish uses the
<code>resourceadapter-mid</code> setting to associate the resource adapter with a
message endpoint through the message inflow contract. This message
inflow contract with the Eclipse GlassFish gives the resource adapter a
handle to the <code>MessageEndpointFactory</code> and the <code>ActivationSpec</code>
JavaBean, and the adapter uses this handle to deliver messages to the
message endpoint instances (which are created by the
<code>MessageEndpointFactory</code>).</p>
</div>
<div class="paragraph">
<p>When a message-driven bean first created for use on the Eclipse GlassFish
7 is deployed, the Connector runtime transparently transforms the
previous deployment style to the current connector-based deployment
style. If the deployer specifies neither a <code>resource-adapter-mid</code>
element nor the Message Queue resource adapter&#8217;s activation
configuration properties, the Connector runtime maps the message-driven
bean to the <code>jmsra</code> system resource adapter and converts the
JMS-specific configuration to the Message Queue resource adapter&#8217;s
activation configuration properties.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing-lifecycle-listeners"><a class="anchor" href="#developing-lifecycle-listeners"></a>17. Developing Lifecycle Listeners</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lifecycle listener modules provide a means of running short or long
duration Java-based tasks within the Eclipse GlassFish
environment, such as instantiation of singletons or RMI servers. These
modules are automatically initiated at server startup and are notified
at various phases of the server life cycle.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Lifecycle listener modules are deprecated. Support for them is included
for backward compatibility. Implementing the org.glassfish.api.Startup
interface instead is recommended.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All lifecycle module classes and interfaces are in the
<code>as-install/modules/glassfish-api.jar</code> file.</p>
</div>
<div class="paragraph">
<p>For Javadoc tool pages relevant to lifecycle modules, see the
<code>com.sun.appserv.server</code> package.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#server-life-cycle-events">Server Life Cycle Events</a></p>
</li>
<li>
<p><a href="#the-lifecyclelistener-interface">The LifecycleListener Interface</a></p>
</li>
<li>
<p><a href="#the-lifecycleevent-class">The <code>LifecycleEvent</code> Class</a></p>
</li>
<li>
<p><a href="#the-server-lifecycle-event-context">The Server Lifecycle Event Context</a></p>
</li>
<li>
<p><a href="#deploying-a-lifecycle-module">Deploying a Lifecycle Module</a></p>
</li>
<li>
<p><a href="#considerations-for-lifecycle-modules">Considerations for Lifecycle Modules</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="server-life-cycle-events"><a class="anchor" href="#server-life-cycle-events"></a>Server Life Cycle Events</h3>
<div class="paragraph">
<p>A lifecycle module listens for and performs its tasks in response to the
following events in the server life cycle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>After the <code>INIT_EVENT</code>, the server reads the configuration,
initializes built-in subsystems (such as security and logging services),
and creates the containers.</p>
</li>
<li>
<p>After the <code>STARTUP_EVENT</code>, the server loads and initializes deployed
applications.</p>
</li>
<li>
<p>After the <code>READY_EVENT</code>, the server is ready to service requests.</p>
</li>
<li>
<p>After the <code>SHUTDOWN_EVENT</code>, the server destroys loaded applications
and stops.</p>
</li>
<li>
<p>After the <code>TERMINATION_EVENT</code>, the server closes the containers, the
built-in subsystems, and the server runtime environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These events are defined in the <code>LifecycleEvent</code> class.</p>
</div>
<div class="paragraph">
<p>The lifecycle modules that listen for these events implement the
LifecycleListener interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-lifecyclelistener-interface"><a class="anchor" href="#the-lifecyclelistener-interface"></a>The LifecycleListener Interface</h3>
<div class="paragraph">
<p>To create a lifecycle module is to configure a customized class that
implements the com.sun.appserv.server.LifecycleListener interface. You
can create and simultaneously execute multiple lifecycle modules.</p>
</div>
<div class="paragraph">
<p>The LifecycleListener interface defines this method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> handleEvent(com.sun.appserv.server.LifecycleEvent event)
<span class="directive">throws</span> ServerLifecycleException</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method responds to a lifecycle event and throws a
<code>com.sun.appserv.server.ServerLifecycleException</code> if an error occurs.</p>
</div>
<div class="paragraph">
<p>A sample implementation of the LifecycleListener interface is the
<code>LifecycleListenerImpl.java</code> file, which you can use for testing
lifecycle events.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-lifecycleevent-class"><a class="anchor" href="#the-lifecycleevent-class"></a>The <code>LifecycleEvent</code> Class</h3>
<div class="paragraph">
<p>The <code>com.sun.appserv.server.LifecycleEvent</code> class defines a server life
cycle event. The following methods are associated with the event:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>public java.lang.Object.getData()</code></p>
<div class="paragraph">
<p>This method returns an instance of <code>java.util.Properties</code> that contains
the properties defined for the lifecycle module.</p>
</div>
</li>
<li>
<p><code>public int getEventType()</code></p>
<div class="paragraph">
<p>This method returns the type of the last event, which is <code>INIT_EVENT</code>,
<code>STARTUP_EVENT</code>, <code>READY_EVENT</code>, <code>SHUTDOWN_EVENT</code>, or
<code>TERMINATION_EVENT</code>.</p>
</div>
</li>
<li>
<p><code>public com.sun.appserv.server.LifecycleEventContext.getLifecycleEventContext()</code></p>
<div class="paragraph">
<p>This method returns the lifecycle event context, described next.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>LifecycleEvent</code> instance is passed to the
<code>LifecycleListener.handleEvent</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-server-lifecycle-event-context"><a class="anchor" href="#the-server-lifecycle-event-context"></a>The Server Lifecycle Event Context</h3>
<div class="paragraph">
<p>The com.sun.appserv.server.LifecycleEventContext interface exposes
runtime information about the server. The lifecycle event context is
created when the <code>LifecycleEvent</code> class is instantiated at server
initialization. The LifecycleEventContext interface defines these
methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>public java.lang.String[].getCmdLineArgs()</code></p>
<div class="paragraph">
<p>This method returns the server startup command-line arguments.</p>
</div>
</li>
<li>
<p><code>public java.lang.String.getInstallRoot()</code></p>
<div class="paragraph">
<p>This method returns the server installation root directory.</p>
</div>
</li>
<li>
<p><code>public java.lang.String.getInstanceName()</code></p>
<div class="paragraph">
<p>This method returns the server instance name.</p>
</div>
</li>
<li>
<p><code>public javax.naming.InitialContext.getInitialContext()</code></p>
<div class="paragraph">
<p>This method returns the initial JNDI naming context. The naming
environment for lifecycle modules is installed after the
<code>STARTUP_EVENT</code>. A lifecycle module can look up any resource by its
<code>jndi-name</code> attribute after the <code>READY_EVENT</code>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a lifecycle module needs to look up resources, it can do so after the
<code>READY_EVENT</code>. It can use the <code>getInitialContext</code> method to get the
initial context to which all the resources are bound.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploying-a-lifecycle-module"><a class="anchor" href="#deploying-a-lifecycle-module"></a>Deploying a Lifecycle Module</h3>
<div class="paragraph">
<p>For instructions on how to deploy a lifecycle module, see the
<a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment
Guide</a>, or see the <code>asadmin create-lifecycle-module</code> command in the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>You do not need to specify a classpath for the lifecycle module if you
place it in the domain-dir<code>/lib</code> or domain-dir`/lib/classes` directory
for the Domain Administration Server. Do not place it in the lib
directory for a particular instance, or it will be deleted when that
instance synchronizes with the Domain Administration Server.</p>
</div>
</div>
<div class="sect2">
<h3 id="considerations-for-lifecycle-modules"><a class="anchor" href="#considerations-for-lifecycle-modules"></a>Considerations for Lifecycle Modules</h3>
<div class="paragraph">
<p>The resources allocated at initialization or startup should be freed at
shutdown or termination. The lifecycle module classes are called
synchronously from the main server thread, therefore it is important to
ensure that these classes don&#8217;t block the server. Lifecycle modules can
create threads if appropriate, but these threads must be stopped in the
shutdown and termination phases.</p>
</div>
<div class="paragraph">
<p>The LifeCycleModule class loader is the parent class loader for
lifecycle modules. Each lifecycle module&#8217;s classpath is used to
construct its class loader. All the support classes needed by a
lifecycle module must be available to the LifeCycleModule class loader
or its parent, the Connector class loader.</p>
</div>
<div class="paragraph">
<p>You must ensure that the <code>server.policy</code> file is appropriately set up,
or a lifecycle module trying to perform a <code>System.exec()</code> might cause a
security access violation. For details, see
<a href="#GSDVG00121">The <code>server.policy</code> File</a>.</p>
</div>
<div class="paragraph">
<p>The configured properties for a lifecycle module are passed as
properties after the <code>INIT_EVENT</code>. The JNDI naming context is not
available before the <code>STARTUP_EVENT</code>. If a lifecycle module requires the
naming context, it can get this after the <code>STARTUP_EVENT</code>,
<code>READY_EVENT</code>, or <code>SHUTDOWN_EVENT</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing-osgi-enabled-java-ee-applications"><a class="anchor" href="#developing-osgi-enabled-java-ee-applications"></a>18. Developing OSGi-enabled Jakarta EE Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the features and interfaces that Eclipse GlassFish
provides to develop OSGi-enabled enterprise applications. This chapter
includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-of-osgi-application-and-glassfish-server">Overview of OSGi Application and Eclipse GlassFish</a></p>
</li>
<li>
<p><a href="#developing-osgi-application-bundles-for-glassfish-server">Developing OSGi Application Bundles for Eclipse GlassFish</a></p>
</li>
<li>
<p><a href="#deploying-osgi-bundles-in-glassfish-server">Deploying OSGi Bundles in Eclipse GlassFish</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="overview-of-osgi-application-and-glassfish-server"><a class="anchor" href="#overview-of-osgi-application-and-glassfish-server"></a>Overview of OSGi Application and Eclipse GlassFish</h3>
<div class="paragraph">
<p>Eclipse GlassFish is fully-compliant with Jakarta EE 10, so it provides the
latest Jakarta EE APIs and frameworks. It is built using OSGi technology,
and includes as its OSGi module management subsystem the
<a href="http://felix.apache.org">Apache Felix OSGi framework</a>
(<code><a href="http://felix.apache.org" class="bare">http://felix.apache.org</a></code>), which is a fully-compliant implementation
of the OSGi Service Platform R4 Version 4.3 specification. Eclipse GlassFish
supports deployment of OSGi-based applications using this
framework. OSGi applications can make use of core as well as enterprise
OSGi features. Eclipse GlassFish makes available many of its Jakarta EE
platform services, such as the transaction service, HTTP service, JDBC
Service and JMS, as OSGi services. It also enables use of Jakarta EE
programming model in OSGi applications, so enterprise Java application
developers can continue to leverage their existing skills in OSGi-based
applications. See <a href="#benefits-of-using-osgi-in-enterprise-java-applications">Benefits of Using OSGi in Enterprise Java
Applications</a> for more information.</p>
</div>
<div class="paragraph">
<p>OSGi applications are deployed as one or more OSGi bundles, and the
Eclipse GlassFish deployment and administration infrastructure enables
you to deploy and manage your OSGi bundles. This chapter classifies OSGi
bundles into two categories based on the features they use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plain OSGi Application Bundles - bundles that do not contain any Jakarta EE
components. See <a href="#developing-plain-osgi-bundles">Developing Plain OSGi Bundles</a>.</p>
</li>
<li>
<p>Hybrid Application Bundles - bundles that are an OSGi bundle as wells
as a Jakarta EE module. At runtime, such modules have both an OSGi bundle
context and a Jakarta EE context. Eclipse GlassFish supports the following
hybrid application bundles:</p>
<div class="ulist">
<ul>
<li>
<p>Web Application Bundles (or WABs) , see <a href="#developing-web-application-bundles">Developing Web
Application Bundles</a>.</p>
</li>
<li>
<p>EJB Application Bundles, see <a href="#developing-ejb-application-bundles">Developing EJB Application
Bundles</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="benefits-of-using-osgi-in-enterprise-java-applications"><a class="anchor" href="#benefits-of-using-osgi-in-enterprise-java-applications"></a>Benefits of Using OSGi in Enterprise Java Applications</h4>
<div class="paragraph">
<p>Enterprise applications typically need transactional, secured access to
data stores, messaging systems and other such enterprise information
systems, and have to cater to a wide variety of clients such as web
browsers and desktop applications, and so on. Jakarta EE makes development
of such applications easier with a rich set of APIs and frameworks. It
also provides a scalable, reliable and easy to administer runtime to
host such applications.</p>
</div>
<div class="paragraph">
<p>The OSGi platform complements these features with modularity. It enables
applications to be separated into smaller, reusable modules with a well
defined and robust dependency specification. A module explicitly
specifies its capabilities and requirements. This explicit dependency
specification encourages developers to visualize dependencies among
their modules and help them make their modules highly cohesive and less
coupled. The OSGi module system is dynamic: it allows modules to be
added and removed at runtime. OSGi has very good support for versioning:
it supports package versioning as well module versioning. In fact, it
allows multiple versions of the same package to coexist in the same
runtime, thus allowing greater flexibility to deployers. The service
layer of the OSGi platform encourages a more service-oriented approach
to build a system. The service-oriented approach and dynamic module
system used together allow a system to be more agile during development
as well as in production. It makes them better suited to run in an
Platform-as-a-Service (PaaS) environment.</p>
</div>
<div class="paragraph">
<p>With Eclipse GlassFish, you do not have to chose one of the two
platforms. A hybrid approach like OSGi enabling your Jakarta EE
applications allows new capabilities to applications hitherto
unavailable to applications built using just one of the two platforms.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="developing-osgi-application-bundles-for-glassfish-server"><a class="anchor" href="#developing-osgi-application-bundles-for-glassfish-server"></a>Developing OSGi Application Bundles for Eclipse GlassFish</h3>
<div class="paragraph">
<p>Eclipse GlassFish enables interaction between OSGi components and Jakarta EE
components. OSGi services managed by the OSGi framework can invoke Jakarta EE
components managed by the Jakarta EE container and vice versa.
For example, developers can declaratively export EJBs as OSGi services
without having to write any OSGi code. This allows any plain OSGi
component, which is running without the Jakarta EE context, to discover the
EJB and invoke it. Similarly, Jakarta EE components can locate OSGi
services provided by plain OSGi bundles and use them as well.
Eclipse GlassFish extends the Jakarta EE Context and Dependency Injection (CDI)
framework to make it easier for Jakarta EE components to consume dynamic
OSGi services in a type-safe manner.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#developing-plain-osgi-bundles">Developing Plain OSGi Bundles</a></p>
</li>
<li>
<p><a href="#developing-web-application-bundles">Developing Web Application Bundles</a></p>
</li>
<li>
<p><a href="#developing-ejb-application-bundles">Developing EJB Application Bundles</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="developing-plain-osgi-bundles"><a class="anchor" href="#developing-plain-osgi-bundles"></a>Developing Plain OSGi Bundles</h4>
<div class="paragraph">
<p>Jakarta EE components (like an EJB or Servlet) can look up Jakarta EE platform
services using JNDI names in the associated Jakarta EE naming context. Such
code can rely on the Jakarta EE container to inject the required services
as well. Unfortunately, neither of them works when the code runs outside
a Jakarta EE context. An example of such code is the <code>BundleActivator</code> of
an OSGi bundle. For such code to access Jakarta EE platform services,
Eclipse GlassFish makes key services and resources of the underlying Jakarta EE
platform available as OSGi services. Thus, an OSGi bundle deployed in
Eclipse GlassFish can access these services using OSGi Service look-up
APIs or by using a white board pattern. The following Jakarta EE services
are available as OSGi services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#http-service">HTTP Service</a></p>
</li>
<li>
<p><a href="#transaction-service">Transaction Service</a></p>
</li>
<li>
<p><a href="#jdbc-data-source-service">JDBC Data Source Service</a></p>
</li>
<li>
<p><a href="#jms-resource-service">JMS Resource Service</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="http-service"><a class="anchor" href="#http-service"></a>HTTP Service</h5>
<div class="paragraph">
<p>The Eclipse GlassFish web container is made available as a service for
OSGi users who do not use OSGi Web Application Bundles (WABs). This
service is made available using the standard OSGi/HTTP service
specification, which is a light API that predates the concept of a web
application as we know it today. This simple API allows users to
register servlets and static resources dynamically and draw a boundary
around them in the form of a <code>HttpContext</code>. This simple API can be used
to build feature-rich web application, such as the Felix Web Console for
example.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish web container has one or more virtual servers. A
virtual server has one or more web application deployed in it. Each web
application has a distinct context path. Each virtual server has a set
of HTTP listeners. Each HTTP listener listens on a particular port. When
multiple virtual servers are present, one of them is treated as the
default virtual server. Every virtual server comes configured with a
default web application. The default web application is used to serve
static content from the <code>docroot</code> of Eclipse GlassFish. This default web
application uses <code>/</code> as the context path. A web application contains
static and dynamic resources. Each virtual server is mapped to an
<code>org.osgi.services.http.HttpService</code> instance. When there are multiple
virtual servers present, there will be multiple occurrences of
<code>HttpService</code> registered in the service registry. In order to
distinguish one service from another, each service is registered with a
service property named <code>VirtualServer</code>, whose value is the name of the
virtual server. The service corresponding to default virtual server has
the highest ranking, so when looking up a service of type <code>HttpService</code>
without any additional criteria returns the <code>HttpService</code> corresponding
to the default virtual server. In a typical Eclipse GlassFish
installation, the default virtual server is configured to listen on port
8080 for the HTTP protocol and port 8181 for the HTTPS protocol.</p>
</div>
<div class="paragraph">
<p>The context path <code>/</code> is reserved for the default web application. Every
resource and servlet registered using the <code>registerResource()</code> and
<code>registerServlet()</code> methods of <code>HttpService</code> are made available under a
special context path named <code>/osgi</code> in the virtual server. The <code>/osgi</code>
context path can be changed to some other value by setting an
appropriate value in the OSGi configuration property or in a system
property called <code>org.glassfish.osgihttp.ContextPath</code>.</p>
</div>
<div class="paragraph">
<p>For example, HelloWorldServlet will be available at
<code><a href="http://localhost:8080/osgi/helloworld" class="bare">http://localhost:8080/osgi/helloworld</a></code> when the following code is
executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpService httpService = getHttpService(); <span class="comment">// Obtain HttpService</span>
httpService.registerServlet(httpService.registerServlet(<span class="string"><span class="delimiter">&quot;</span><span class="content">/helloworld</span><span class="delimiter">&quot;</span></span>,
<span class="keyword">new</span> HelloWorldServlet(), <span class="predefined-constant">null</span>, ctx);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="transaction-service"><a class="anchor" href="#transaction-service"></a>Transaction Service</h5>
<div class="paragraph">
<p>The Java Transaction API (JTA) defines three interfaces to interact with
the transaction management system: <code>UserTransaction</code>,
<code>TransactionManager</code>, and <code>TransactionSynchronizationRegistry</code>. They all
belong to the javax.transaction package. <code>TransactionManager</code> and
<code>TransactionSynchronizationRegistry</code> are intended for system level code,
such as a persistence provider. Whereas, <code>UserTransaction</code> is the entity
that you should use to control transactions. All the objects of the
underlying JTA layer are made available in the OSGi service registry
using the following service interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javax.transaction.UserTransaction</code></p>
</li>
<li>
<p><code>javax.transaction.TransactionManager</code></p>
</li>
<li>
<p><code>javax.transaction.TransactionSynchronisationRegistry</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is no additional service property associated with them. Although
<code>UserTransaction</code> appears to be a singleton, in reality any call to it
gets rerouted to the actual transaction associated with the calling
thread. Code that runs in the context of a Jakarta EE component typically
gets a handle on <code>UserTransaction</code> by doing a JNDI lookup in the
component naming context or by using injection, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">(UserTransaction)(<span class="keyword">new</span> <span class="predefined-type">InitialContext</span>().lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/UserTransaction</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span> UserTransaction utx;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When certain code (such as an OSGi Bundle Activator), which does not
have a Jakarta EE component context, wants to get hold of
<code>UserTransaction</code>, or any of the other JTA artifacts, then they can look
it up in the service registry. Here is an example of such code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">BundleContext context;
ServiceReference txRef =
    context.getServiceReference(UserTransaction.class.getName());
UserTransaction utx = (UserTransaction);
context.getService(txRef);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jdbc-data-source-service"><a class="anchor" href="#jdbc-data-source-service"></a>JDBC Data Source Service</h5>
<div class="paragraph">
<p>Any JDBC data source created in Eclipse GlassFish is automatically made
available as an OSGi Service; therefore, OSGi bundles can track
availability of JDBC data sources using the <code>ServiceTracking</code> facility
of the OSGi platform. The life of the OSGi service matches that of the
underlying data source created in Eclipse GlassFish. For instructions on
administering JDBC resources in Eclipse GlassFish, see the
<a href="administration-guide.html#GSADG">Eclipse GlassFish Administration Guide</a>.</p>
</div>
<div class="paragraph">
<p>Eclipse GlassFish registers each JDBC data source as an OSGi service with
<code>objectClass = "javax.sql.DataSource"</code> and a service property called
<code>jndi-name</code>, which is set to the JNDI name of the data source. Here is a
code sample that looks up a data source service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@Inject</span>
  <span class="annotation">@OSGiService</span>(<span class="predefined-constant">true</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">(jndi-name=jdbc/MyDS)</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">DataSource</span> ds;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jms-resource-service"><a class="anchor" href="#jms-resource-service"></a>JMS Resource Service</h5>
<div class="paragraph">
<p>Like JDBC data sources, JMS administered objects, such as destinations
and connection factories, are also automatically made available as OSGi
services. Their service mappings are as follows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12%;">
<col style="width: 39%;">
<col style="width: 12%;">
<col style="width: 37%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JMS Object</th>
<th class="tableblock halign-left valign-top">Service Interface</th>
<th class="tableblock halign-left valign-top">Service Properties</th>
<th class="tableblock halign-left valign-top">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JMS Queue destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.jms.Queue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jndi-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jndi-name</code> is set to the JNDI name of the queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JMS Topic destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.jms.Topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jndi-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jndi-name</code> is set to the JNDI name of the topic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JMS connection factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.jms.QueueConnectionFactory</code><br>
or<br>
<code>jakarta.jms.TopicConnectionFactory</code><br>
or<br>
<code>jakarta.jms.ConnectionFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jndi-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jndi-name</code> is set to the JNDI name of the topic.<br>
The actual service interface depends on which type of connection factory
was created.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="developing-web-application-bundles"><a class="anchor" href="#developing-web-application-bundles"></a>Developing Web Application Bundles</h4>
<div class="paragraph">
<p>When a web application is packaged and deployed as an OSGi bundle, it is
called a Web Application Bundle (WAB). WAB support is based on the OSGi
Web Application specification , which is part of the OSGi Service
Platform, Enterprise Specification, Release 4, Version 4.3. A WAB is
packaged as an OSGi bundle, so all the OSGi packaging rules apply to WAB
packaging. When a WAB is not packaged like a WAR, the OSGi Web Container
of Eclipse GlassFish maps the WAB to the hierarchical structure of web
application using the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The root of the WAB corresponds to the <code>docroot</code> of the web
application.</p>
</li>
<li>
<p>Every JAR in the Bundle-ClassPath of the WAB is treated like a JAR in
<code>WEB-INF/lib/.</code></p>
</li>
<li>
<p>Every directory except "." in Bundle-ClassPath of the WAB is treated
like <code>WEB-INF/classes/.</code></p>
</li>
<li>
<p>Bundle-ClassPath entry of type "." is treated as if the entire WAB is
a JAR in <code>WEB-INF/lib/.</code></p>
</li>
<li>
<p>Bundle-ClassPath includes the Bundle-ClassPath entries of any attached
fragment bundles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The simplest way to avoid knowing these mapping rules is to avoid the
problem in the first place. Moreover, there are many packaging tools and
development time tools that understand WAR structure. Therefore, we
strongly recommend that you package the WAB exactly like a WAR, with
only additional OSGi metadata.</p>
</div>
<div class="sect4">
<h5 id="required-wab-metadata"><a class="anchor" href="#required-wab-metadata"></a>Required WAB Metadata</h5>
<div class="paragraph">
<p>In addition to the standard OSGi metadata, the main attributes of
<code>META-INF/MANIFEST.MF</code> of the WAB must have an additional attribute
called <code>Web-ContextPath</code>. The <code>Web-ContextPath</code> attribute specifies the
value of the context path of the web application. Since the root of a
WAB is mapped to the <code>docroot</code> of the web application, it should not be
used in the <code>Bundle-ClassPath</code>. Moreover, <code>WEB-INF/classes/</code> should be
specified ahead of <code>WEB-INF/lib/</code> in the <code>Bundle-ClassPath</code> in order to
be compliant with the search order used for traditional WAR files.</p>
</div>
<div class="paragraph">
<p>Assuming the WAB is structured as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  foo.war/
       index.html
       foo.jsp
       WEB-INF/classes/
                      foo/BarServlet.class
       WEB-INF/lib/lib1.jar
       WEB-INF/lib/lib2.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the OSGi metadata for the WAB as specified in
<code>META-INF/MANIFEST.MF</code> of the WAB would appear as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  MANIFEST.MF:Manifest-Version: 1.0
  Bundle-ManifestVersion: 2
  Bundle-SymbolicName: com.acme.foo
  Bundle-Version: 1.0
  Bundle-Name: Foo Web Application Bundle Version 1.0
  Import-Package: javax.servlet; javax.servlet.http, version=[3.0, 4.0, 5.0)
  Bundle-ClassPath: WEB-INF/classes, WEB-INF/lib/lib1.jar, WEB-INF/lib/lib2.jar
  Web-ContextPath: /foo</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="how-wabs-consume-osgi-services"><a class="anchor" href="#how-wabs-consume-osgi-services"></a>How WABs Consume OSGi Services</h5>
<div class="paragraph">
<p>Since a WAB has a valid <code>Bundle-Context</code>, it can consume OSGi services.
Although you are free to use any OSGi API to locate OSGi services,
Eclipse GlassFish makes it easy for WAB users to use OSGi services by
virtue of extending the Context and Dependency Injection (CDI)
framework. Here&#8217;s an example of the injection of an OSGi Service into a
Servlet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@WebServlet</span>
  <span class="directive">public</span> <span class="type">class</span> <span class="class">MyServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="annotation">@Inject</span> <span class="annotation">@OSGiService</span>(dynamic=<span class="predefined-constant">true</span>)
    FooService fooService;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about this feature, refer to <a href="#osgi-cdi-extension-for-wabs">OSGi CDI
Extension for WABs</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="osgi-cdi-extension-for-wabs"><a class="anchor" href="#osgi-cdi-extension-for-wabs"></a>OSGi CDI Extension for WABs</h5>
<div class="paragraph">
<p>Eclipse GlassFish includes a CDI extension that enables web applications,
such as servlets, that are part of WABs to express a type-safe
dependency on an OSGi service using CDI APIs. An OSGi service can be
provided by any OSGi bundle without any knowledge of Jakarta EE/CDI, and
they are allowed to be injected transparently in a type-safe manner into
a web application.</p>
</div>
<div class="paragraph">
<p>A custom CDI Qualifier, <code>@org.glassfish.osgicdi.OSGiService</code>, is used by
the component to represent dependency on an OSGi service. The qualifier
has additional metadata to customize the service discovery and injection
behavior. The following <code>@OsgiService</code> attributes are currently
available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>serviceCriteria</code> — An LDAP filter query used for service selection in
the OSGi service registry.</p>
</li>
<li>
<p><code>waitTimeout</code> — Waits the specified duration for a service that
matches the criteria specified to appear in the OSGi service registry.</p>
</li>
<li>
<p><code>dynamic</code> — Dynamically obtain a service reference (true/false).</p>
<div class="paragraph">
<p>Since OSGi services are dynamic, they may not match the life cycle of
the application component that has injected a reference to the service.
Through this attribute, you could indicate that a service reference can
be obtained dynamically or not. For stateless or idempotent services, a
dynamic reference to a service implementation would be useful. The
container then injects a proxy to the service and dynamically switches
to an available implementation when the current service reference is
invalid.</p>
</div>
</li>
</ul>
</div>
<div id="gkvbk" class="paragraph">
<p>Example 13-1 Example of a WAB Using CDI</p>
</div>
<div class="paragraph">
<p>In this example, Bundle B0 defines a service contract called
<code>com.acme.Foo</code> and exports the <code>com.acme</code> package for use by other
bundles. Bundle B1 in turn provides a service implementation, FooImpl,
of the <code>com.acme.Foo</code> interface. It then registers the service FooImpl
service with the OSGi service registry with <code>com.acme.Foo</code> as the
service interface.</p>
</div>
<div class="paragraph">
<p>Bundle B2 is a hybrid application bundle that imports the <code>com.acme</code>
package. It has a component called BarServlet that expresses a
dependency to <code>com.acme.Foo</code> by adding a field/setter method and
qualifies that injection point with <code>@OsgiService</code>. For instance,
BarServlet could look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@Servlet</span>
  <span class="directive">public</span> <span class="type">void</span> BarServlet <span class="directive">extends</span> HttpServlet{
      <span class="annotation">@Inject</span> <span class="annotation">@OSGiService</span>(dynamic=<span class="predefined-constant">true</span>)
      <span class="directive">private</span> com.acme.Foo f;
  }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="developing-ejb-application-bundles"><a class="anchor" href="#developing-ejb-application-bundles"></a>Developing EJB Application Bundles</h4>
<div class="paragraph">
<p>Another type of hybrid application bundle is the EJB Application Bundle.
When an EJB Jar is packaged with additional OSGi metadata and deployed
as an OSGi bundle it is called an EJB Application Bundle. Eclipse GlassFishsupports only packaging the OSGi bundle as a simple JAR file with
required OSGi metadata, just as you would package an <code>ejb-jar</code> file.</p>
</div>
<div class="sect4">
<h5 id="required-ejb-metadata"><a class="anchor" href="#required-ejb-metadata"></a>Required EJB Metadata</h5>
<div class="paragraph">
<p>An EJB Application Bundle must have a manifest metadata called
Export-EJB in order to be considered as an EJB Bundle. For syntax of
Export-EJB header, please refer to the Publishing EJB as OSGi Service
section. Here&#8217;s an example of an EJB Application Bundle with its
metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  myEjb.jar/
           com/acme/Foo
           com/acme/impl/FooEJB
           META-INF/MANIFEST.MF</code></pre>
</div>
</div>
<div class="paragraph">
<p>MANIFEST.MF:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  Manifest-Version: 1.0
  Bundle-ManifestVersion: 2
  Bundle-SymbolicName: com.acme.foo EJB bundle
  Bundle-Version: 1.0.0.BETA
  Bundle-Name: com.acme.foo EJB bundle version 1.0.0.BETA
  Export-EJB: ALL
  Export-Package: com.acme; version=1.0
  Import-Package: javax.ejb; version=[3.0, 4.0), com.acme; version=[1.0, 1.1)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="how-ejb-bundles-consume-osgi-services"><a class="anchor" href="#how-ejb-bundles-consume-osgi-services"></a>How EJB Bundles Consume OSGi Services</h5>
<div class="paragraph">
<p>Since an EJB has a valid Bundle-Context, it can consume OSGi services.
Although you are free to use any OSGi API to locate OSGi services,
Eclipse GlassFish makes it easy to use OSGi services by virtue of
extending the Context and Dependency Injection (CDI) framework. Here&#8217;s
an example of injection of an OSGi Service into a servlet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@Stateless</span>
  <span class="directive">public</span> <span class="type">class</span> <span class="class">MyEJB</span> {
    <span class="annotation">@Inject</span> <span class="annotation">@OSGiService</span>(dynamic=<span class="predefined-constant">true</span>)
    Foo foo;
    ...
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about this feature, refer to <a href="#using-the-osgi-cdi-extension-with-ejb-bundles">Using the OSGi
CDI Extension With EJB Bundles</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-the-osgi-cdi-extension-with-ejb-bundles"><a class="anchor" href="#using-the-osgi-cdi-extension-with-ejb-bundles"></a>Using the OSGi CDI Extension With EJB Bundles</h5>
<div class="paragraph">
<p>Eclipse GlassFish includes a CDI extension that enables EJB application
bundles to express a type-safe dependency on an OSGi Service using CDI
APIs. An OSGi service can be provided by any OSGi bundle without any
knowledge of Jakarta EE/CDI, and they are allowed to be injected
transparently in a type-safe manner into an EJB bundle.</p>
</div>
<div class="paragraph">
<p>A custom CDI Qualifier, <code>@org.glassfish.osgicdi.OSGiService</code>, is used by
the component to represent dependency on an OSGi service. The qualifier
has additional metadata to customize the service discovery and injection
behavior. The following <code>@OsgiService</code> attributes are currently
available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dynamic</code> — Dynamically obtain a service reference (true/false).</p>
</li>
<li>
<p><code>waitTimeout</code> — Waits for specified duration for a service to appear
in the OSGi service registry.</p>
</li>
<li>
<p><code>serviceCriteria</code> — An LDAP filter query used for service selection.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying-osgi-bundles-in-glassfish-server"><a class="anchor" href="#deploying-osgi-bundles-in-glassfish-server"></a>Deploying OSGi Bundles in Eclipse GlassFish</h3>
<div class="paragraph">
<p>For instruction on deploying OSGi bundle, see
"<a href="application-deployment-guide.html#osgi-bundle-deployment-guidelines">
OSGi Bundle Deployment Guidelines</a>"
in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="part-iii"><a class="anchor" href="#part-iii"></a>Part III</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="using-services-and-apis"><a class="anchor" href="#using-services-and-apis"></a>19. Using Services and APIs</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="using-the-jdbc-api-for-database-access"><a class="anchor" href="#using-the-jdbc-api-for-database-access"></a>20. Using the JDBC API for Database Access</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to use the Java Database Connectivity (JDBC)
API for database access with the Eclipse GlassFish. This chapter
also provides high level JDBC implementation instructions for servlets
and EJB components using the Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The JDBC specifications are available at
<code><a href="https://www.oracle.com/java/technologies/javase/javase-tech-database.html" class="bare">https://www.oracle.com/java/technologies/javase/javase-tech-database.html</a></code>.</p>
</div>
<div class="paragraph">
<p>A useful JDBC tutorial is located at
<code><a href="https://docs.oracle.com/javase/tutorial/jdbc/index.html" class="bare">https://docs.oracle.com/javase/tutorial/jdbc/index.html</a></code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Eclipse GlassFish does not support connection pooling or transactions
for an application&#8217;s database access if it does not use standard Jakarta EE
<code>DataSource</code> objects.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#statements">Statements</a></p>
</li>
<li>
<p><a href="#connections">Connections</a></p>
</li>
<li>
<p><a href="#connection-wrapping">Connection Wrapping</a></p>
</li>
<li>
<p><a href="#allowing-non-component-callers">Allowing Non-Component Callers</a></p>
</li>
<li>
<p><a href="#using-application-scoped-jdbc-resources">Using Application-Scoped JDBC Resources</a></p>
</li>
<li>
<p><a href="#restrictions-and-optimizations">Restrictions and Optimizations</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="statements"><a class="anchor" href="#statements"></a>Statements</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-an-initialization-statement">Using an Initialization Statement</a></p>
</li>
<li>
<p><a href="#setting-a-statement-timeout">Setting a Statement Timeout</a></p>
</li>
<li>
<p><a href="#statement-leak-detection-and-leaked-statement-reclamation">Statement Leak Detection and Leaked Statement Reclamation</a></p>
</li>
<li>
<p><a href="#statement-caching">Statement Caching</a></p>
</li>
<li>
<p><a href="#statement-tracing">Statement Tracing</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="using-an-initialization-statement"><a class="anchor" href="#using-an-initialization-statement"></a>Using an Initialization Statement</h4>
<div class="paragraph">
<p>You can specify a statement that executes each time a physical
connection to the database is created (not reused) from a JDBC
connection pool. This is useful for setting request or session specific
properties and is suited for homogeneous requests in a single
application. Set the Init SQL attribute of the JDBC connection pool to
the SQL string to be executed in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter an Init SQL value in the Edit Connection Pool Advanced
Attributes page in the Administration Console. For more information,
click the Help button in the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--initsql</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>init-sql</code> option in the <code>asadmin set</code> command. For
example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.DerbyPool.init-sql=&quot;sql-string&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="setting-a-statement-timeout"><a class="anchor" href="#setting-a-statement-timeout"></a>Setting a Statement Timeout</h4>
<div class="paragraph">
<p>An abnormally long running JDBC query executed by an application may
leave it in a hanging state unless a timeout is explicitly set on the
statement. Setting a statement timeout guarantees that all queries
automatically time out if not completed within the specified period.
When statements are created, the <code>queryTimeout</code> is set according to the
statement timeout setting. This works only when the underlying JDBC
driver supports <code>queryTimeout</code> for <code>Statement</code>, <code>PreparedStatement</code>,
<code>CallableStatement</code>, and <code>ResultSet</code>.</p>
</div>
<div class="paragraph">
<p>You can specify a statement timeout in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter a Statement Timeout value in the Edit Connection Pool Advanced
Attributes page in the Administration Console. For more information,
click the Help button in the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--statementtimeout</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="statement-leak-detection-and-leaked-statement-reclamation"><a class="anchor" href="#statement-leak-detection-and-leaked-statement-reclamation"></a>Statement Leak Detection and Leaked Statement Reclamation</h4>
<div class="paragraph">
<p>If statements are not closed by an application after use, it is possible
for the application to run out of cursors. Enabling statement leak
detection causes statements to be considered as leaked if they are not
closed within a specified period. Additionally, leaked statements can
reclaimed automatically.</p>
</div>
<div class="paragraph">
<p>To enable statement leak detection, set Statement Leak Timeout In
Seconds for the JDBC connection pool to a positive, nonzero value in one
of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the <code>--statementleaktimeout</code> option in the
<code>create-jdbc-connection-pool</code> subcommand. For more information, see
<a href="reference-manual.html#create-jdbc-connection-pool"><code>create-jdbc-connection-pool</code>(1)</a>.</p>
</li>
<li>
<p>Specify the <code>statement-leak-timeout-in-seconds</code> option in the <code>set</code>
subcommand. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set resources.jdbc-connection-pool.pool-name.statement-leak-timeout-in-seconds=300</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When selecting a value for Statement Leak Timeout In Seconds, make sure
that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is less than the Connection Leak Timeout; otherwise, the connection
could be closed before the statement leak is recognized.</p>
</li>
<li>
<p>It is greater than the Statement Timeout; otherwise, a long running
query could be mistaken as a statement leak.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After enabling statement leak detection, enable leaked statement
reclamation by setting Reclaim Leaked Statements for the JDBC connection
pool to a <code>true</code> value in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the <code>--statementleakreclaim=true</code> option in the
<code>create-jdbc-connection-pool</code> subcommand. For more information, see
<a href="reference-manual.html#create-jdbc-connection-pool"><code>create-jdbc-connection-pool</code>(1)</a>.</p>
</li>
<li>
<p>Specify the <code>statement-leak-reclaim</code> option in the <code>set</code> subcommand.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set resources.jdbc-connection-pool.pool-name.statement-leak-reclaim=true</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="statement-caching"><a class="anchor" href="#statement-caching"></a>Statement Caching</h4>
<div class="paragraph">
<p>Statement caching stores statements, prepared statements, and callable
statements that are executed repeatedly by applications in a cache,
thereby improving performance. Instead of the statement being prepared
each time, the cache is searched for a match. The overhead of parsing
and creating new statements each time is eliminated.</p>
</div>
<div class="paragraph">
<p>Statement caching is usually a feature of the JDBC driver. The Eclipse GlassFish provides caching for drivers that do not support caching. To
enable this feature, set the Statement Cache Size for the JDBC
connection pool in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter a Statement Cache Size value in the Edit Connection Pool
Advanced Attributes page in the Administration Console. For more
information, click the Help button in the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--statementcachesize</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>statement-cache-size</code> option in the <code>asadmin set</code>
command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.DerbyPool.statement-cache-size=10</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, this attribute is set to zero and the statement caching is
turned off. To enable statement caching, you can set any positive
nonzero value. The built-in cache eviction strategy is LRU-based (Least
Recently Used). When a connection pool is flushed, the connections in
the statement cache are recreated.</p>
</div>
</div>
<div class="sect3">
<h4 id="statement-tracing"><a class="anchor" href="#statement-tracing"></a>Statement Tracing</h4>
<div class="paragraph">
<p>You can trace the SQL statements executed by applications that use a
JDBC connection pool. Set the SQL Trace Listeners attribute to a
comma-separated list of trace listener implementation classes in one of
the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter an SQL Trace Listeners value in the Edit Connection Pool
Advanced Attributes page in the Administration Console. For more
information, click the Help button in the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--sqltracelisteners</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>sql-trace-listeners</code> option in the <code>asadmin set</code> command.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.DerbyPool.sql-trace-listeners=listeners</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish provides a public interface,
org.glassfish.api.jdbc.SQLTraceListener , that implements a means of
recording <code>SQLTraceRecord</code> objects. To make custom implementations of
this interface available to the Eclipse GlassFish, place the
implementation classes in as-install<code>/lib</code>.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish provides an SQL tracing logger to log the SQL
operations in the form of <code>SQLTraceRecord</code> objects in the <code>server.log</code>
file. The module name under which the SQL operation is logged is
<code>jakarta.enterprise.resource.sqltrace</code>. SQL traces are logged as FINE
messages along with the module name to enable easy filtering of the SQL
logs. A sample SQL trace record looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[#|2009-11-27T15:46:52.202+0530|FINE|glassfish 6.0|jakarta.enterprise.resource.sqltrace.com.sun.gjc.util
|_ThreadID=29;_ThreadName=Thread-1;ClassName=com.sun.gjc.util.SQLTraceLogger;MethodName=sqlTrace;
|ThreadID=77 | ThreadName=p: thread-pool-1; w: 6 | TimeStamp=1259317012202
| ClassName=com.sun.gjc.spi.jdbc40.PreparedStatementWrapper40 | MethodName=executeUpdate
| arg[0]=insert into table1(colName) values(100) | arg[1]=columnNames | |#]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This trace shows that an <code>executeUpdate(String sql, String columnNames)</code>
operation is being done.</p>
</div>
<div class="paragraph">
<p>When SQL statement tracing is enabled and JDBC connection pool
monitoring is enabled, Eclipse GlassFish maintains a tracing cache of
recent queries and their frequency of use. The following JDBC connection
pool properties can be configured to control this cache and the
monitoring statistics available from it:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>time-to-keep-queries-in-minutes</code></dt>
<dd>
<p>Specifies how long in minutes to keep a query in the tracing cache,
tracking its frequency of use. The default value is 5 minutes.</p>
</dd>
<dt class="hdlist1"><code>number-of-top-queries-to-report</code></dt>
<dd>
<p>Specifies how many of the most used queries, in frequency order, are
listed the monitoring report. The default value is 10 queries.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Set these parameters in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add them as properties in the Edit JDBC Connection Pool Properties
page in the Administration Console. For more information, click the Help
button in the Administration Console.</p>
</li>
<li>
<p>Specify them using the <code>--property</code> option in the
<code>create-jdbc-connection-pool</code> subcommand. For more information, see
<a href="reference-manual.html#create-jdbc-connection-pool"><code>create-jdbc-connection-pool</code>(1)</a>.</p>
</li>
<li>
<p>Set them using the <code>set</code> subcommand. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set resources.jdbc-connection-pool.pool-name.property.time-to-keep-queries-in-minutes=10</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connections"><a class="anchor" href="#connections"></a>Connections</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#transparent-pool-reconfiguration">Transparent Pool Reconfiguration</a></p>
</li>
<li>
<p><a href="#disabling-pooling">Disabling Pooling</a></p>
</li>
<li>
<p><a href="#associating-connections-with-threads">Associating Connections with Threads</a></p>
</li>
<li>
<p><a href="#custom-connection-validation">Custom Connection Validation</a></p>
</li>
<li>
<p><a href="#sharing-connections">Sharing Connections</a></p>
</li>
<li>
<p><a href="#marking-bad-connections">Marking Bad Connections</a></p>
</li>
<li>
<p><a href="#handling-invalid-connections">Handling Invalid Connections</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="transparent-pool-reconfiguration"><a class="anchor" href="#transparent-pool-reconfiguration"></a>Transparent Pool Reconfiguration</h4>
<div class="paragraph">
<p>When the properties or attributes of a JDBC connection pool are changed,
the connection pool is destroyed and re-created. Normally, applications
using the connection pool must be redeployed as a consequence. This
restriction can be avoided by enabling transparent JDBC connection pool
reconfiguration. When this feature is enabled, applications do not need
to be redeployed. Instead, requests for a new connections are blocked
until the reconfiguration operation completes. Connection requests from
any in-flight transactions are served using the old pool configuration
so as to complete the transaction. Then, connections are created using
the pool&#8217;s new configuration, and any blocked connection requests are
served with connections from the re-created pool..</p>
</div>
<div class="paragraph">
<p>To enable transparent JDBC connection pool reconfiguration, set the
<code>dynamic-reconfiguration-wait-timeout-in-seconds</code> property of the JDBC
connection pool to a positive, nonzero value in one of the following
ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add it as a property in the Edit JDBC Connection Pool Properties page
in the Administration Console. For more information, click the Help
button in the Administration Console.</p>
</li>
<li>
<p>Specify it using the <code>--property</code> option in the
<code>create-jdbc-connection-pool</code> subcommand. For more information, see
<a href="reference-manual.html#create-jdbc-connection-pool"><code>create-jdbc-connection-pool</code>(1)</a>.</p>
</li>
<li>
<p>Set it using the <code>set</code> subcommand. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set resources.jdbc-connection-pool.pool-name.property.dynamic-reconfiguration-wait-timeout-in-seconds=15</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This property specifies the time in seconds to wait for in-use
connections to close and in-flight transactions to complete. Any
connections in use or transaction in flight past this time must be
retried.</p>
</div>
</div>
<div class="sect3">
<h4 id="disabling-pooling"><a class="anchor" href="#disabling-pooling"></a>Disabling Pooling</h4>
<div class="paragraph">
<p>To disable connection pooling, set the Pooling attribute to false. The
default is true. You can enable or disable connection pooling in one of
the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter a Pooling value in the Edit Connection Pool Advanced Attributes
page in the Administration Console. For more information, click the Help
button in the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--pooling</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>pooling</code> option in the <code>asadmin set</code> command. For
example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.DerbyPool.pooling=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>pooling</code> option and the system property
<code>com.sun.enterprise.connectors.SwitchoffACCConnectionPooling</code>, which
turns off connection pooling in the Application Client Container, do not
affect each other.</p>
</div>
<div class="paragraph">
<p>An exception is thrown if <code>associate-with-thread</code> is set to <code>true</code> and
pooling is disabled. An exception is thrown if you attempt to flush a
connection pool when pooling is disabled. A warning is logged if the
following attributes are used, because they are useful only in a pooled
environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>connection-validation</code></p>
</li>
<li>
<p><code>validate-atmost-once-period</code></p>
</li>
<li>
<p><code>match-connections</code></p>
</li>
<li>
<p><code>max-connection-usage-count</code></p>
</li>
<li>
<p><code>idle-timeout</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="associating-connections-with-threads"><a class="anchor" href="#associating-connections-with-threads"></a>Associating Connections with Threads</h4>
<div class="paragraph">
<p>To associate connections with a thread, set the Associate With Thread
attribute to <code>true</code>. The default is <code>false</code>. A <code>true</code> setting allows
connections to be saved as <code>ThreadLocal</code> in the calling thread.
Connections get reclaimed only when the calling thread dies or when the
calling thread is not in use and the pool has run out of connections. If
the setting is <code>false</code>, the thread must obtain a connection from the
pool each time the thread requires a connection.</p>
</div>
<div class="paragraph">
<p>The Associate With Thread attribute associates connections with a thread
such that when the same thread is in need of connections, it can reuse
the connections already associated with that thread. In this case, the
overhead of getting connections from the pool is avoided. However, when
this value is set to <code>true</code>, you should verify that the value of the Max
Pool Size attribute is comparable to the Max Thread Pool Size attribute
of the thread pool. If the Max Thread Pool Size value is much higher
than the Max Pool Size value, a lot of time is spent associating
connections with a new thread after dissociating them from an older one.
Use this attribute in cases where the thread pool should reuse
connections to avoid this overhead.</p>
</div>
<div class="paragraph">
<p>You can set the Associate With Thread attribute in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter an Associate With Thread value in the Edit Connection Pool
Advanced Attributes page in the Administration Console. For more
information, click the Help button in the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--associatewiththread</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>associate-with-thread</code> option in the <code>asadmin set</code>
command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.DerbyPool.associate-with-thread=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="custom-connection-validation"><a class="anchor" href="#custom-connection-validation"></a>Custom Connection Validation</h4>
<div class="paragraph">
<p>You can specify a custom implementation for Connection Validation that
is faster or optimized for a specific database. Set the Validation
Method attribute to the value <code>custom-validation</code>. (Other validation
methods available are <code>table</code> (the default), <code>auto-commit</code>, and
<code>meta-data</code>.) The Eclipse GlassFish provides a public interface,
org.glassfish.api.jdbc.ConnectionValidation, which you can implement to
plug in your implementation. A new attribute, Validation Classname,
specifies the fully qualified name of the class that implements the
ConnectionValidation interface. The Validation Classname attribute is
required if Connection Validation is enabled and Validation Method is
set to Custom Validation.</p>
</div>
<div class="paragraph">
<p>To enable this feature, set Connection Validation, Validation Method,
and Validation Classname for the JDBC connection pool in one of the
following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter Connection Validation, Validation Method, and Validation
Classname values in the Edit Connection Pool Advanced Attributes page in
the Administration Console. You can select from among validation class
names for common databases in the Validation Classname field. For more
information, click the Help button in the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--isconnectionvalidatereq</code>, <code>--validationmethod</code>, and
<code>--validationclassname</code> options in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>is-connection-validation-required</code>,
<code>connection-validation-method</code>, and <code>validation-classname</code> options in
the <code>asadmin set</code> command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.MyPool.is-connection-validation-required=true
asadmin set domain1.resources.jdbc-connection-pool.MyPool.connection-validation-method=custom-validation
asadmin set domain1.resources.jdbc-connection-pool.MyPool.validation-classname=impl-class</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, optimized validation mechanisms are provided for DB2, Apache
Derby, MSSQL, MySQL, Oracle, PostgreSQL and Sybase databases.
Additionally, for JDBC 4.0 compliant database drivers, a validation
mechanism is provided that uses the <code>Connection.isValid(0)</code>
implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="sharing-connections"><a class="anchor" href="#sharing-connections"></a>Sharing Connections</h4>
<div class="paragraph">
<p>When multiple connections acquired by an application use the same JDBC
resource, the connection pool provides connection sharing within the
same transaction scope. For example, suppose Bean A starts a transaction
and obtains a connection, then calls a method in Bean B. If Bean B
acquires a connection to the same JDBC resource with the same sign-on
information, and if Bean A completes the transaction, the connection can
be shared.</p>
</div>
<div class="paragraph">
<p>Connections obtained through a resource are shared only if the resource
reference declared by the Jakarta EE component allows it to be shareable.
This is specified in a component&#8217;s deployment descriptor by setting the
<code>res-sharing-scope</code> element to <code>Shareable</code> for the particular resource
reference. To turn off connection sharing, set <code>res-sharing-scope</code> to
<code>Unshareable</code>.</p>
</div>
<div class="paragraph">
<p>For general information about connections and JDBC URLs, see
"<a href="administration-guide.html#administering-database-connectivity">Administering Database Connectivity</a>" in Eclipse GlassFish Administration Guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="marking-bad-connections"><a class="anchor" href="#marking-bad-connections"></a>Marking Bad Connections</h4>
<div class="paragraph">
<p>The <code>DataSource</code> implementation in the Eclipse GlassFish provides a
<code>markConnectionAsBad</code> method. A marked bad connection is removed from
its connection pool when it is closed. The method signature is as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> markConnectionAsBad(java.sql.Connection con)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">com.sun.appserv.jdbc.DataSource ds=
   (com.sun.appserv.jdbc.DataSource)context.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Connection</span> con = ds.getConnection();
<span class="predefined-type">Statement</span> stmt = <span class="predefined-constant">null</span>;
<span class="keyword">try</span>{
   stmt = con.createStatement();
   stmt.executeUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">Update</span><span class="delimiter">&quot;</span></span>);
}
<span class="keyword">catch</span> (BadConnectionException e){
   ds.markConnectionAsBad(con) <span class="comment">//marking it as bad for removal</span>
}
<span class="keyword">finally</span>{
   stmt.close();
   con.close(); <span class="comment">//Connection will be destroyed during close.</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="handling-invalid-connections-2"><a class="anchor" href="#handling-invalid-connections-2"></a>Handling Invalid Connections</h4>
<div class="paragraph">
<p>If a <code>ConnectionErrorOccured</code> event occurs, the Eclipse GlassFish
considers the connection invalid and removes the connection from the
connection pool. Typically, a JDBC driver generates a
<code>ConnectionErrorOccured</code> event when it finds a <code>ManagedConnection</code>
object unusable. Reasons can be database failure, network failure with
the database, fatal problems with the connection pool, and so on.</p>
</div>
<div class="paragraph">
<p>If the <code>fail-all-connections</code> setting in the connection pool
configuration is set to <code>true</code>, and a single connection fails, all
connections are closed and recreated. If this setting is <code>false</code>,
individual connections are recreated only when they are used. The
default is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>The <code>is-connection-validation-required</code> setting specifies whether
connections have to be validated before being given to the application.
If a resource&#8217;s validation fails, it is destroyed, and a new resource is
created and returned. The default is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>The <code>prefer-validate-over-recreate</code> property specifies that validating
idle connections is preferable to closing them. This property has no
effect on non-idle connections. If set to <code>true</code>, idle connections are
validated during pool resizing, and only those found to be invalid are
destroyed and recreated. If <code>false</code>, all idle connections are destroyed
and recreated during pool resizing. The default is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>You can set the <code>fail-all-connections</code>,
<code>is-connection-validation-required</code>, and <code>prefer-validate-over-recreate</code>
configuration settings during creation of a JDBC connection pool. Or,
you can use the <code>asadmin set</code> command to dynamically reconfigure a
setting. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set server.resources.jdbc-connection-pool.JCPool1.fail-all-connections=&quot;true&quot;
asadmin set server.resources.jdbc-connection-pool.JCPool1.is-connection-validation-required=&quot;true&quot;
asadmin set server.resources.jdbc-connection-pool.JCPool1.property.prefer-validate-over-recreate=&quot;true&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish
Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>The interface ValidatingManagedConnectionFactory exposes the method
<code>getInvalidConnections</code> to allow retrieval of the invalid connections.
The Eclipse GlassFish checks if the JDBC driver implements this
interface, and if it does, invalid connections are removed when the
connection pool is resized.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connection-wrapping"><a class="anchor" href="#connection-wrapping"></a>Connection Wrapping</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#wrapping-connections">Wrapping Connections</a></p>
</li>
<li>
<p><a href="#obtaining-a-physical-connection-from-a-wrapped-connection">Obtaining a Physical Connection From a Wrapped Connection</a></p>
</li>
<li>
<p><a href="#using-the-connection-unwrap-method">Using the <code>Connection.unwrap()</code> Method</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="wrapping-connections"><a class="anchor" href="#wrapping-connections"></a>Wrapping Connections</h4>
<div class="paragraph">
<p>If the Wrap JDBC Objects option is <code>true</code> (the default), wrapped JDBC
objects are returned for <code>Statement</code>, <code>PreparedStatement</code>,
<code>CallableStatement</code>, <code>ResultSet</code>, and <code>DatabaseMetaData</code>.</p>
</div>
<div class="paragraph">
<p>This option ensures that <code>Statement.getConnection()</code> is the same as
<code>DataSource.getConnection()</code>. Therefore, this option should be <code>true</code>
when both <code>Statement.getConnection()</code> and <code>DataSource.getConnection()</code>
are done.</p>
</div>
<div class="paragraph">
<p>You can specify the Wrap JDBC Objects option in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check or uncheck the Wrap JDBC Objects box on the Edit Connection Pool
Advanced Attributes page in the Administration Console. For more
information, click the Help button in the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--wrapjdbcobjects</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="obtaining-a-physical-connection-from-a-wrapped-connection"><a class="anchor" href="#obtaining-a-physical-connection-from-a-wrapped-connection"></a>Obtaining a Physical Connection From a Wrapped Connection</h4>
<div class="paragraph">
<p>The <code>DataSource</code> implementation in the Eclipse GlassFish provides a
<code>getConnection</code> method that retrieves the JDBC driver&#8217;s <code>SQLConnection</code>
from the Eclipse GlassFish&#8217;s <code>Connection</code> wrapper. The method signature
is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> java.sql.Connection getConnection(java.sql.Connection con)
<span class="directive">throws</span> java.sql.SQLException</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">InitialContext</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
com.sun.appserv.jdbc.DataSource ds = (com.sun.appserv.jdbc.DataSource)
   ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyBase</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Connection</span> con = ds.getConnection();
<span class="predefined-type">Connection</span> drivercon = ds.getConnection(con); <span class="comment">//get physical connection from wrapper</span>
<span class="comment">// Do db operations.</span>
<span class="comment">// Do not close driver connection.</span>
con.close(); <span class="comment">// return wrapped connection to pool.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="GSDVG00509"></a><a id="using-the-connection.unwrap-method"></a></p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-connection-unwrap-method"><a class="anchor" href="#using-the-connection-unwrap-method"></a>Using the <code>Connection.unwrap()</code> Method</h4>
<div class="paragraph">
<p>Using the <code>Connection.unwrap()</code> method on a vendor-provided interface
returns an object or a wrapper object implementing the vendor-provided
interface, which the application can make use of to do vendor-specific
database operations. Use the <code>Connection.isWrapperFor()</code> method on a
vendor-provided interface to check whether the connection can provide an
implementation of the vendor-provided interface. Check the JDBC driver
vendor&#8217;s documentation for information on these interfaces.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="allowing-non-component-callers"><a class="anchor" href="#allowing-non-component-callers"></a>Allowing Non-Component Callers</h3>
<div class="paragraph">
<p>You can allow non-Java-EE components, such as servlet filters, lifecycle
modules, and third party persistence managers, to use this JDBC
connection pool. The returned connection is automatically enlisted with
the transaction context obtained from the transaction manager. Standard
Jakarta EE components can also use such pools. Connections obtained by
non-component callers are not automatically closed at the end of a
transaction by the container. They must be explicitly closed by the
caller.</p>
</div>
<div class="paragraph">
<p>You can enable non-component callers in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check the Allow Non Component Callers box on the Edit Connection Pool
Advanced Attributes page in the Administration Console. The default is
<code>false</code>. For more information, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>Specify the <code>--allownoncomponentcallers</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>allow-non-component-callers</code> option in the <code>asadmin set</code>
command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.DerbyPool.allow-non-component-callers=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
<li>
<p>Create a JDBC resource with a <code>__pm</code> suffix.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accessing a <code>DataSource</code> using the <code>Synchronization.beforeCompletion()</code>
method requires setting Allow Non Component Callers to <code>true</code>. For more
information about the Transaction Synchronization Registry, see
<a href="#the-transaction-manager-the-transaction-synchronization-registry-and-usertransaction">The Transaction Manager, the
Transaction Synchronization Registry, and <code>UserTransaction</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-application-scoped-jdbc-resources"><a class="anchor" href="#using-application-scoped-jdbc-resources"></a>Using Application-Scoped JDBC Resources</h3>
<div class="paragraph">
<p>You can define an application-scoped database or other resource for an
enterprise application, web module, EJB module, connector module, or
application client module by supplying a <code>glassfish-resources.xml</code>
deployment descriptor file. For details, see
"<a href="application-deployment-guide.html#application-scoped-resources">Application-Scoped Resources</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="restrictions-and-optimizations-2"><a class="anchor" href="#restrictions-and-optimizations-2"></a>Restrictions and Optimizations</h3>
<div class="paragraph">
<p>This section discusses restrictions and performance optimizations that
affect using the JDBC API.</p>
</div>
<div class="sect3">
<h4 id="disabling-stored-procedure-creation-on-sybase"><a class="anchor" href="#disabling-stored-procedure-creation-on-sybase"></a>Disabling Stored Procedure Creation on Sybase</h4>
<div class="paragraph">
<p>By default, DataDirect and Oracle JDBC drivers for Sybase databases
create a stored procedure for each parameterized <code>PreparedStatement</code>. On
the Eclipse GlassFish, exceptions are thrown when primary key identity
generation is attempted. To disable the creation of these stored
procedures, set the property <code>PrepareMethod=direct</code> for the JDBC
connection pool.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-transaction-service"><a class="anchor" href="#using-the-transaction-service"></a>21. Using the Transaction Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Jakarta EE platform provides several abstractions that simplify
development of dependable transaction processing for applications. This
chapter discusses Jakarta EE transactions and transaction support in the
Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#handling-transactions-with-databases">Handling Transactions with Databases</a></p>
</li>
<li>
<p><a href="#handling-transactions-with-enterprise-beans">Handling Transactions with Enterprise Beans</a></p>
</li>
<li>
<p><a href="#handling-transactions-with-the-java-message-service">Handling Transactions with the Java Message Service</a></p>
</li>
<li>
<p><a href="#the-transaction-manager-the-transaction-synchronization-registry-and-usertransaction">The Transaction Manager, the Transaction Synchronization
Registry, and <code>UserTransaction</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about the Java Transaction API (JTA), see "<a href="administration-guide.html#administering-transactions">Administering Transactions</a>" in Eclipse GlassFish Administration
Guide and the following site:
<code><a href="https://jakarta.ee/specifications/transactions/" class="bare">https://jakarta.ee/specifications/transactions/</a></code>.</p>
</div>
<div class="paragraph">
<p>You might also want to read
"<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#transactions">Transactions</a>"
in The Jakarta EE Tutorial.</p>
</div>
<div class="sect2">
<h3 id="handling-transactions-with-databases"><a class="anchor" href="#handling-transactions-with-databases"></a>Handling Transactions with Databases</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-jdbc-transaction-isolation-levels">Using JDBC Transaction Isolation Levels</a></p>
</li>
<li>
<p><a href="#using-non-transactional-connections">Using Non-Transactional Connections</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="using-jdbc-transaction-isolation-levels"><a class="anchor" href="#using-jdbc-transaction-isolation-levels"></a>Using JDBC Transaction Isolation Levels</h4>
<div class="paragraph">
<p>Not all database vendors support all transaction isolation levels
available in the JDBC API. The Eclipse GlassFish permits specifying any
isolation level your database supports. The following table defines
transaction isolation levels.</p>
</div>
<div id="fvyoi" class="paragraph">
<p>Table 15-1 Transaction Isolation Levels</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 27%;">
<col style="width: 28%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Transaction Isolation Level</th>
<th class="tableblock halign-left valign-top"><code>getTransactionIsolation</code> Return Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>read-uncommitted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dirty reads, non-repeatable reads, and phantom
reads can occur.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>read-committed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dirty reads are prevented; non-repeatable reads
and phantom reads can occur.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repeatable-read</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dirty reads and non-repeatable reads are
prevented; phantom reads can occur.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>serializable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dirty reads, non-repeatable reads and phantom
reads are prevented.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By default, the transaction isolation level is undefined (empty), and
the JDBC driver&#8217;s default isolation level is used. You can specify the
transaction isolation level in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the value from the Transaction Isolation drop-down list on the
New JDBC Connection Pool or Edit Connection Pool page in the
Administration Console. For more information, click the Help button in
the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--isolationlevel</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>transaction-isolation-level</code> option in the <code>asadmin set</code>
command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.DerbyPool.transaction-isolation-level=serializable</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that you cannot call <code>setTransactionIsolation</code> during a
transaction.</p>
</div>
<div class="paragraph">
<p>You can set the default transaction isolation level for a JDBC
connection pool. For details, see "<a href="administration-guide.html#to-create-a-jdbc-connection-pool">To Create a JDBC
Connection Pool</a>" in Eclipse GlassFish Administration
Guide.</p>
</div>
<div class="paragraph">
<p>To verify that a level is supported by your database management system,
test your database programmatically using the
<code>supportsTransactionIsolationLevel</code> method in
<code>java.sql.DatabaseMetaData</code>, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">InitialContext</span> ctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
<span class="predefined-type">DataSource</span> ds = (<span class="predefined-type">DataSource</span>)
ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyBase</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Connection</span> con = ds.getConnection();
<span class="predefined-type">DatabaseMetaData</span> dbmd = con.getMetaData();
<span class="keyword">if</span> (dbmd.supportsTransactionIsolationLevel(TRANSACTION_SERIALIZABLE)
{ <span class="predefined-type">Connection</span>.setTransactionIsolation(TRANSACTION_SERIALIZABLE); }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about these isolation levels and what they mean,
see the JDBC API specification.</p>
</div>
<div class="paragraph">
<p>Setting or resetting the transaction isolation level for every
<code>getConnection</code> call can degrade performance. So by default the
isolation level is not guaranteed.</p>
</div>
<div class="paragraph">
<p>Applications that change the transaction isolation level on a pooled
connection programmatically risk polluting the JDBC connection pool,
which can lead to errors. If an application changes the isolation level,
enabling the <code>is-isolation-level-guaranteed</code> setting in the pool can
minimize such errors.</p>
</div>
<div class="paragraph">
<p>You can guarantee the transaction isolation level in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check the Isolation Level Guaranteed box on the New JDBC Connection
Pool or Edit Connection Pool page in the Administration Console. For
more information, click the Help button in the Administration Console.</p>
</li>
<li>
<p>Specify the <code>--isisolationguaranteed</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>is-isolation-level-guaranteed</code> option in the
<code>asadmin set</code> command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.DerbyPool.is-isolation-level-guaranteed=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using-non-transactional-connections"><a class="anchor" href="#using-non-transactional-connections"></a>Using Non-Transactional Connections</h4>
<div class="paragraph">
<p>You can specify a non-transactional database connection in any of these
ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check the Non-Transactional Connections box on the New JDBC Connection
Pool or Edit Connection Pool page in the Administration Console. The
default is unchecked. For more information, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>Specify the <code>--nontransactionalconnections</code> option in the
<code>asadmin create-jdbc-connection-pool</code> command. For more information, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
<li>
<p>Specify the <code>non-transactional-connections</code> option in the
<code>asadmin set</code> command. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin set domain1.resources.jdbc-connection-pool.DerbyPool.non-transactional-connections=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
</li>
<li>
<p>Use the <code>DataSource</code> implementation in the Eclipse GlassFish, which
provides a <code>getNonTxConnection</code> method. This method retrieves a JDBC
connection that is not in the scope of any transaction. There are two
variants.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> java.sql.Connection getNonTxConnection() <span class="directive">throws</span> java.sql.SQLException

<span class="directive">public</span> java.sql.Connection getNonTxConnection(<span class="predefined-type">String</span> user, <span class="predefined-type">String</span> password)
   <span class="directive">throws</span> java.sql.SQLException</code></pre>
</div>
</div>
</li>
<li>
<p>Create a resource with the JNDI name ending in <code>__nontx</code>. This forces
all connections looked up using this resource to be non transactional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Typically, a connection is enlisted in the context of the transaction in
which a <code>getConnection</code> call is invoked. However, a non-transactional
connection is not enlisted in a transaction context even if a
transaction is in progress.</p>
</div>
<div class="paragraph">
<p>The main advantage of using non-transactional connections is that the
overhead incurred in enlisting and delisting connections in transaction
contexts is avoided. However, use such connections carefully. For
example, if a non-transactional connection is used to query the database
while a transaction is in progress that modifies the database, the query
retrieves the unmodified data in the database. This is because the
in-progress transaction hasn&#8217;t committed. For another example, if a
non-transactional connection modifies the database and a transaction
that is running simultaneously rolls back, the changes made by the
non-transactional connection are not rolled back.</p>
</div>
<div class="paragraph">
<p>Here is a typical use case for a non-transactional connection: a
component that is updating a database in a transaction context spanning
over several iterations of a loop can refresh cached data by using a
non-transactional connection to read data before the transaction
commits.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handling-transactions-with-enterprise-beans"><a class="anchor" href="#handling-transactions-with-enterprise-beans"></a>Handling Transactions with Enterprise Beans</h3>
<div class="paragraph">
<p>This section describes the transaction support built into the Enterprise
JavaBeans programming model for the Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>As a developer, you can write an application that updates data in
multiple databases distributed across multiple sites. The site might use
EJB servers from different vendors.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#flat-transactions">Flat Transactions</a></p>
</li>
<li>
<p><a href="#global-and-local-transactions">Global and Local Transactions</a></p>
</li>
<li>
<p><a href="#commit-options">Commit Options</a></p>
</li>
<li>
<p><a href="#bean-level-container-managed-transaction-timeouts">Bean-Level Container-Managed Transaction Timeouts</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="flat-transactions"><a class="anchor" href="#flat-transactions"></a>Flat Transactions</h4>
<div class="paragraph">
<p>The Enterprise JavaBeans Specification, v3.0 requires support for flat
(as opposed to nested) transactions. In a flat transaction, each
transaction is decoupled from and independent of other transactions in
the system. Another transaction cannot start in the same thread until
the current transaction ends.</p>
</div>
<div class="paragraph">
<p>Flat transactions are the most prevalent model and are supported by most
commercial database systems. Although nested transactions offer a finer
granularity of control over transactions, they are supported by far
fewer commercial database systems.</p>
</div>
</div>
<div class="sect3">
<h4 id="global-and-local-transactions"><a class="anchor" href="#global-and-local-transactions"></a>Global and Local Transactions</h4>
<div class="paragraph">
<p>Both local and global transactions are demarcated using the
javax.transaction.UserTransaction interface, which the client must use.
Local transactions bypass the XA commit protocol and are faster. For
more information, see <a href="#the-transaction-manager-the-transaction-synchronization-registry-and-usertransaction">The Transaction Manager, the
Transaction Synchronization Registry, and <code>UserTransaction</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="commit-options"><a class="anchor" href="#commit-options"></a>Commit Options</h4>
<div class="paragraph">
<p>The EJB protocol is designed to give the container the flexibility to
select the disposition of the instance state at the time a transaction
is committed. This allows the container to best manage caching an entity
object&#8217;s state and associating an entity object identity with the EJB
instances.</p>
</div>
<div class="paragraph">
<p>There are three commit-time options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Option A - The container caches a ready instance between transactions.
The container ensures that the instance has exclusive access to the
state of the object in persistent storage.</p>
<div class="paragraph">
<p>In this case, the container does not have to synchronize the instance&#8217;s
state from the persistent storage at the beginning of the next
transaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Commit option A is not supported for this Eclipse GlassFish release.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Option B - The container caches a ready instance between transactions,
but the container does not ensure that the instance has exclusive access
to the state of the object in persistent storage. This is the default.</p>
<div class="paragraph">
<p>In this case, the container must synchronize the instance&#8217;s state by
invoking <code>ejbLoad</code> from persistent storage at the beginning of the next
transaction.</p>
</div>
</li>
<li>
<p>Option C - The container does not cache a ready instance between
transactions, but instead returns the instance to the pool of available
instances after a transaction has completed.</p>
<div class="paragraph">
<p>The life cycle for every business method invocation under commit option
C looks like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ejbActivate   ejbLoad   business method   ejbStore   ejbPassivate</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there is more than one transactional client concurrently accessing
the same entity, the first client gets the ready instance and subsequent
concurrent clients get new instances from the pool.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>glassfish-ejb-jar.xml</code> deployment descriptor has an element,
<code>commit-option</code>, that specifies the commit option to be used. Based on
the specified commit option, the appropriate handler is instantiated.</p>
</div>
</div>
<div class="sect3">
<h4 id="bean-level-container-managed-transaction-timeouts"><a class="anchor" href="#bean-level-container-managed-transaction-timeouts"></a>Bean-Level Container-Managed Transaction Timeouts</h4>
<div class="paragraph">
<p>The transaction timeout for the domain is specified using the
Transaction Timeout setting of the Transaction Service. A transaction
started by the container must commit (or rollback) within this time,
regardless of whether the transaction is suspended (and resumed), or the
transaction is marked for rollback. The default value, <code>0</code>, specifies
that the server waits indefinitely for a transaction to complete.</p>
</div>
<div class="paragraph">
<p>To override this timeout for an individual bean, use the optional
<code>cmt-timeout-in-seconds</code> element in <code>glassfish-ejb-jar.xml</code>. The default
value, <code>0</code>, specifies that the Transaction Service timeout is used. The
value of <code>cmt-timeout-in-seconds</code> is used for all methods in the bean
that start a new container-managed transaction. This value is not used
if the bean joins a client transaction.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handling-transactions-with-the-java-message-service"><a class="anchor" href="#handling-transactions-with-the-java-message-service"></a>Handling Transactions with the Java Message Service</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#transactions-and-non-persistent-messages">Transactions and Non-Persistent Messages</a></p>
</li>
<li>
<p><a href="#using-the-configurabletransactionsupport-interface">Using the ConfigurableTransactionSupport Interface</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="transactions-and-non-persistent-messages"><a class="anchor" href="#transactions-and-non-persistent-messages"></a>Transactions and Non-Persistent Messages</h4>
<div class="paragraph">
<p>During transaction recovery, non-persistent messages might be lost. If
the broker fails between the transaction manager&#8217;s prepare and commit
operations, any non-persistent message in the transaction is lost and
cannot be delivered. A message that is not saved to a persistent store
is not available for transaction recovery.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-configurabletransactionsupport-interface"><a class="anchor" href="#using-the-configurabletransactionsupport-interface"></a>Using the ConfigurableTransactionSupport Interface</h4>
<div class="paragraph">
<p>The Jakarta EE Connector 1.6 specification allows a resource adapter to use
the <code>transaction-support</code> attribute to specify the level of transaction
support that the resource adapter handles. However, the resource adapter
vendor does not have a mechanism to figure out the current transactional
context in which a <code>ManagedConnectionFactory</code> is used.</p>
</div>
<div class="paragraph">
<p>If a <code>ManagedConnectionFactory</code> implements an optional interface called
com.sun.appserv.connectors.spi.ConfigurableTransactionSupport , the
Eclipse GlassFish notifies the <code>ManagedConnectionFactory</code> of the
<code>transaction-support</code> configured for the connector connection pool when
the <code>ManagedConnectionFactory</code> instance is created for the pool.
Connections obtained from the pool can then be used with a transaction
level at or lower than the configured value. For example, a connection
obtained from a pool that is set to <code>XA_TRANSACTION</code> could be used as a
LOCAL resource in a last-agent-optimized transaction or in a
non-transactional context.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-transaction-manager-the-transaction-synchronization-registry-and-usertransaction"><a class="anchor" href="#the-transaction-manager-the-transaction-synchronization-registry-and-usertransaction"></a>The Transaction Manager, the Transaction Synchronization Registry, and <code>UserTransaction</code></h3>
<div class="paragraph">
<p>To access a <code>UserTransaction</code> instance, you can either look it up using
the <code>java:comp/``UserTransaction</code> JNDI name or inject it using the
<code>@Resource</code> annotation.</p>
</div>
<div class="paragraph">
<p>Accessing a <code>DataSource</code> using the <code>Synchronization.beforeCompletion()</code>
method requires setting Allow Non Component Callers to <code>true</code>. The
default is <code>false</code>. For more information about non-component callers,
see <a href="#allowing-non-component-callers">Allowing Non-Component Callers</a>.</p>
</div>
<div class="paragraph">
<p>If possible, you should use the
javax.transaction.TransactionSynchronizationRegistry interface instead
of javax.transaction.TransactionManager , for portability. You can look
up the implementation of this interface by using the JNDI name
<code>java:comp/``TransactionSynchronizationRegistry</code>. For details, see the
<a href="https://jakarta.ee/specifications/transactions/2.0/apidocs/jakarta/transaction/transactionsynchronizationregistry"><code>TransactionSynchronizationRegistryInterface</code></a>
API documentation and
<a href="http://www.jcp.org/en/jsr/detail?id=907">Java Specification Request (JSR) 907</a></p>
</div>
<div class="paragraph">
<p>If accessing the javax.transaction.TransactionManager implementation is
absolutely necessary, you can look up the Eclipse GlassFish
implementation of this interface using the JNDI name
java:appserver/TransactionManager . This lookup should not be used by
the application code.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-java-naming-and-directory-interface"><a class="anchor" href="#using-the-java-naming-and-directory-interface"></a>22. Using the Java Naming and Directory Interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A naming service maintains a set of bindings, which relate names to
objects. The Jakarta EE naming service is based on the Java Naming and
Directory Interface (JNDI) API. The JNDI API allows application
components and clients to look up distributed resources, services, and
EJB components. For general information about the JNDI API, see
<code><a href="https://docs.oracle.com/javase/tutorial/jndi/overview/index.html" class="bare">https://docs.oracle.com/javase/tutorial/jndi/overview/index.html</a></code>. You can also
see the JNDI tutorial at <code><a href="https://docs.oracle.com/javase/jndi/tutorial/" class="bare">https://docs.oracle.com/javase/jndi/tutorial/</a></code>.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#accessing-the-naming-context">Accessing the Naming Context</a></p>
</li>
<li>
<p><a href="#configuring-resources">Configuring Resources</a></p>
</li>
<li>
<p><a href="#GSDVG00194">Using a Custom <code>jndi.properties</code> File</a></p>
</li>
<li>
<p><a href="#mapping-references">Mapping References</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Web Profile of the Eclipse GlassFish supports the EJB 3.1 Lite
specification, which allows enterprise beans within web applications,
among other features. The full Eclipse GlassFish supports the entire EJB
3.1 specification. For details, see
<a href="http://jcp.org/en/jsr/detail?id=318">JSR 318</a>
(<code><a href="http://jcp.org/en/jsr/detail?id=318" class="bare">http://jcp.org/en/jsr/detail?id=318</a></code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="accessing-the-naming-context"><a class="anchor" href="#accessing-the-naming-context"></a>Accessing the Naming Context</h3>
<div class="paragraph">
<p>The Eclipse GlassFish provides a naming environment, or context,
which is compliant with standard Jakarta EE requirements. A <code>Context</code>
object provides the methods for binding names to objects, unbinding
names from objects, renaming objects, and listing the bindings. The
<code>InitialContext</code> is the handle to the Jakarta EE naming service that
application components and clients use for lookups.</p>
</div>
<div class="paragraph">
<p>The JNDI API also provides subcontext functionality. Much like a
directory in a file system, a subcontext is a context within a context.
This hierarchical structure permits better organization of information.
For naming services that support subcontexts, the <code>Context</code> class also
provides methods for creating and destroying subcontexts.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#portable-global-jndi-names">Portable Global JNDI Names</a></p>
</li>
<li>
<p><a href="#glassfish-server-v2-vendor-specific-global-jndi-names">Eclipse GlassFish V2 Vendor-Specific Global JNDI Names</a></p>
</li>
<li>
<p><a href="#disabling-glassfish-server-v2-jndi-names">Disabling Eclipse GlassFish V2 JNDI Names</a></p>
</li>
<li>
<p><a href="#accessing-ejb-components-using-the-cosnaming-naming-context">Accessing EJB Components Using the <code>CosNaming</code> Naming
Context</a></p>
</li>
<li>
<p><a href="#accessing-ejb-components-in-a-remote-glassfish-server">Accessing EJB Components in a Remote Eclipse GlassFish</a></p>
</li>
<li>
<p><a href="#naming-environment-for-lifecycle-modules">Naming Environment for Lifecycle Modules</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each resource within a server instance must have a unique name. However,
two resources in different server instances or different domains can
have the same name.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="portable-global-jndi-names"><a class="anchor" href="#portable-global-jndi-names"></a>Portable Global JNDI Names</h4>
<div class="paragraph">
<p>If an EJB component is a kind of session bean and it is deployed to any
implementation supporting the EJB 3.1specification (for example,
Eclipse GlassFish 7), it automatically has one or more portable JNDI
names defined based on the syntax in the specification. Note that this
is true of existing EJB 3.0 and 2.x applications that are deployed to an
implementation supporting EJB 3.1. No code changes are required to the
bean class itself in order to have the portable global JNDI name
automatically assigned when deployed to an EJB 3.1 container.</p>
</div>
<div class="paragraph">
<p>For more information, see the Jakarta EE Platform Specification, section
EE.5.2.2, "Application Component Environment Namespaces"
(<code><a href="http://jcp.org/en/jsr/detail?id=366" class="bare">http://jcp.org/en/jsr/detail?id=366</a></code>),
and the EJB 3.1 Specification, section 4.4, "Global JNDI Access"
(<code><a href="http://jcp.org/en/jsr/detail?id=318" class="bare">http://jcp.org/en/jsr/detail?id=318</a></code>).</p>
</div>
<div class="paragraph">
<p>If the <code>disable-nonportable-jndi-names</code> property is set to false (the
default), a Eclipse GlassFish V2-specific JNDI name is assigned in
addition to a portable global JNDI name. For more information, see
<a href="#glassfish-server-v2-vendor-specific-global-jndi-names">Eclipse GlassFish V2 Vendor-Specific Global JNDI Names</a> and
<a href="#disabling-glassfish-server-v2-jndi-names">Disabling Eclipse GlassFish V2 JNDI Names</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="glassfish-server-v2-vendor-specific-global-jndi-names"><a class="anchor" href="#glassfish-server-v2-vendor-specific-global-jndi-names"></a>Eclipse GlassFish V2 Vendor-Specific Global JNDI Names</h4>
<div class="paragraph">
<p>Eclipse GlassFish v2 vendor-specific global JNDI names are assigned
according to the following precedence rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A global JNDI name assigned in the <code>glassfish-ejb-jar.xml</code>,
<code>glassfish-web.xml</code>, or <code>glassfish-application-client.xml</code> deployment
descriptor file has the highest precedence. See <a href="#mapping-references">Mapping
References</a>.</p>
</li>
<li>
<p>A global JNDI name assigned in a <code>mapped-name</code> element in the
<code>ejb-jar.xml</code>, <code>web.xml</code>, or <code>application-client.xml</code> deployment
descriptor file has the second highest precedence. The following
elements have <code>mapped-name</code> subelements: <code>resource-ref</code>,
<code>resource-env-ref</code>, <code>ejb-ref</code>, <code>message-destination</code>,
<code>message-destination-ref</code>, <code>session</code>, <code>message-driven</code>, and <code>entity</code>.</p>
</li>
<li>
<p>A global JNDI name assigned in a <code>mappedName</code> attribute of an
annotation has the third highest precedence. The following annotations
have <code>mappedName</code> attributes: <code>@jakarta.annotation.Resource</code>,
<code>@javax.ejb.EJB</code>, <code>@javax.ejb.Stateless</code>, <code>@javax.ejb.Singleton</code>,
<code>@javax.ejb.Stateful</code>, and <code>@javax.ejb.MessageDriven</code>.</p>
</li>
<li>
<p>In most cases, a default global JNDI name is assigned (and recorded
in the server log) if no name is assigned in deployment descriptors or
annotations.</p>
<div class="ulist">
<ul>
<li>
<p>For a session or entity bean, a Eclipse GlassFish V2-specific JNDI name
is assigned as follows:</p>
<div class="ulist">
<ul>
<li>
<p>For an EJB 2.x dependency or a session or entity bean with a remote
interface, the default is the fully qualified name of the home
interface.</p>
</li>
<li>
<p>For an EJB 3.0 dependency or a session bean with a remote interface,
the default is the fully qualified name of the remote business
interface.</p>
</li>
<li>
<p>If both EJB 2.x and EJB 3.0 remote interfaces are specified, or if
more than one 3.0 remote interface is specified, there is no Eclipse GlassFish V2-specific default. For an entity bean, a global JNDI name must
be assigned.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For all other component dependencies that must be mapped to global
JNDI names, the default is the name of the dependency relative to
<code>java:comp/env</code>. For example, in the
<code>@Resource(name="jdbc/Foo") DataSource ds;</code> annotation, the global JNDI
name is <code>jdbc/Foo</code>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="disabling-glassfish-server-v2-jndi-names"><a class="anchor" href="#disabling-glassfish-server-v2-jndi-names"></a>Disabling Eclipse GlassFish V2 JNDI Names</h4>
<div class="paragraph">
<p>The EJB 3.1 specification supported by Eclipse GlassFish 7 defines
portable EJB JNDI names for session beans. Because of this, there is
less need to continue to use older vendor-specific JNDI names.</p>
</div>
<div class="paragraph">
<p>By default, Eclipse GlassFish V2-specific JNDI names are applied
automatically by Eclipse GlassFish 7 for backward compatibility.
However, this can lead to some ease-of-use issues. For example,
deploying two different applications containing a remote EJB component
that exposes the same remote interface causes a conflict between the
default JNDI names.</p>
</div>
<div class="paragraph">
<p>The default handling of V2-specific JNDI names in Eclipse GlassFish 7
can be managed by using the <code>asadmin</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin&gt; set server.ejb-container.property.disable-nonportable-jndi-names=&quot;true&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>disable-nonportable-jndi-names</code> property is a boolean flag that can
take the following values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>false</code></dt>
<dd>
<p>Enables the automatic use of Eclipse GlassFish V2-specific JNDI names
in addition to portable global JNDI names. This is the default
setting.</p>
</dd>
<dt class="hdlist1"><code>true</code></dt>
<dd>
<p>Disables the automatic use of V2-specific JNDI names. In all cases,
only portable global JNDI names are used.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that this setting applies to all session beans deployed to the
server.</p>
</div>
</div>
<div class="sect3">
<h4 id="accessing-ejb-components-using-the-cosnaming-naming-context"><a class="anchor" href="#accessing-ejb-components-using-the-cosnaming-naming-context"></a>Accessing EJB Components Using the <code>CosNaming</code> Naming Context</h4>
<div class="paragraph">
<p>The preferred way of accessing the naming service, even in code that
runs outside of a Jakarta EE container, is to use the no-argument
<code>InitialContext</code> constructor. However, if EJB client code explicitly
instantiates an <code>InitialContext</code> that points to the <code>CosNaming</code> naming
service, it is necessary to set the <code>java.naming.factory.initial</code>
property to <code>org.glassfish.jndi.cosnaming.CNCtxFactory</code> in the client JVM
software when accessing EJB components. You can set this property using
the <code>asadmin create-jvm-options</code> command, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>asadmin&gt; create-jvm-options -Djava.naming.factory.initial=org.glassfish.jndi.cosnaming.CNCtxFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details about <code>asadmin create-jvm-options</code>, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</div>
<div class="paragraph">
<p>Or you can set this property in the code, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> properties = <span class="predefined-constant">null</span>;
      <span class="keyword">try</span> {
            properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
            properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">java.naming.factory.initial</span><span class="delimiter">&quot;</span></span>,
                  <span class="string"><span class="delimiter">&quot;</span><span class="content">org.glassfish.jndi.cosnaming.CNCtxFactory</span><span class="delimiter">&quot;</span></span>);
            ...
          }
      ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>java.naming.factory.initial</code> property applies to only one instance.
The property is not cluster-aware.</p>
</div>
</div>
<div class="sect3">
<h4 id="accessing-ejb-components-in-a-remote-glassfish-server"><a class="anchor" href="#accessing-ejb-components-in-a-remote-glassfish-server"></a>Accessing EJB Components in a Remote Eclipse GlassFish</h4>
<div class="paragraph">
<p>The recommended approach for looking up an EJB component in a remote
Eclipse GlassFish from a client that is a servlet or EJB component is to
use the Interoperable Naming Service syntax. Host and port information
is prepended to any global JNDI names and is automatically resolved
during the lookup. The syntax for an interoperable global name is as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>corbaname:iiop:host:port#a/b/name</code></pre>
</div>
</div>
<div class="paragraph">
<p>This makes the programming model for accessing EJB components in another
Eclipse GlassFish exactly the same as accessing them in the same server.
The deployer can change the way the EJB components are physically
distributed without having to change the code.</p>
</div>
<div class="paragraph">
<p>For Jakarta EE components, the code still performs a <code>java:comp/env</code> lookup
on an EJB reference. The only difference is that the deployer maps the
<code>ejb-ref</code> element to an interoperable name in a Eclipse GlassFish
deployment descriptor file instead of to a simple global JNDI name.</p>
</div>
<div class="paragraph">
<p>For example, suppose a servlet looks up an EJB reference using
<code>java:comp/env/ejb/Foo</code>, and the target EJB component has a global JNDI
name of <code>a/b/Foo</code>.</p>
</div>
<div class="paragraph">
<p>The <code>ejb-ref</code> element in <code>glassfish-web.xml</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ejb-ref&gt;</span>
   <span class="tag">&lt;ejb-ref-name&gt;</span>ejb/Foo<span class="tag">&lt;/ejb-ref-name&gt;</span>
   <span class="tag">&lt;jndi-name&gt;</span>corbaname:iiop:host:port#a/b/Foo<span class="tag">&lt;/jndi-name&gt;</span>
<span class="tag">&lt;/ejb-ref&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Context</span> ic = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
<span class="predefined-type">Object</span> o = ic.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/ejb/Foo</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a client that doesn&#8217;t run within a Jakarta EE container, the code just
uses the interoperable global name instead of the simple global JNDI
name. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Context</span> ic = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
<span class="predefined-type">Object</span> o = ic.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">corbaname:iiop:host:port#a/b/Foo</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Objects stored in the interoperable naming context and
component-specific (<code>java:comp/env</code>) naming contexts are transient. On
each server startup or application reloading, all relevant objects are
re-bound to the namespace.</p>
</div>
</div>
<div class="sect3">
<h4 id="naming-environment-for-lifecycle-modules"><a class="anchor" href="#naming-environment-for-lifecycle-modules"></a>Naming Environment for Lifecycle Modules</h4>
<div class="paragraph">
<p>Lifecycle listener modules provide a means of running short or long
duration tasks based on Java technology within the Eclipse GlassFish
environment, such as instantiation of singletons or RMI servers. These
modules are automatically initiated at server startup and are notified
at various phases of the server life cycle. For details about lifecycle
modules, see <a href="#developing-lifecycle-listeners">Developing Lifecycle
Listeners</a>.</p>
</div>
<div class="paragraph">
<p>The configured properties for a lifecycle module are passed as
properties during server initialization (the <code>INIT_EVENT</code>). The initial
JNDI naming context is not available until server initialization is
complete. A lifecycle module can get the <code>InitialContext</code> for lookups
using the method <code>LifecycleEventContext.getInitialContext()</code> during, and
only during, the <code>STARTUP_EVENT</code>, <code>READY_EVENT</code>, or <code>SHUTDOWN_EVENT</code>
server life cycle events.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-resources"><a class="anchor" href="#configuring-resources"></a>Configuring Resources</h3>
<div class="paragraph">
<p>The Eclipse GlassFish exposes special resources in the naming
environment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#external-jndi-resources">External JNDI Resources</a></p>
</li>
<li>
<p><a href="#custom-resources">Custom Resources</a></p>
</li>
<li>
<p><a href="#built-in-factories-for-custom-resources">Built-in Factories for Custom Resources</a></p>
</li>
<li>
<p><a href="#using-application-scoped-resources">Using Application-Scoped Resources</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="external-jndi-resources"><a class="anchor" href="#external-jndi-resources"></a>External JNDI Resources</h4>
<div class="paragraph">
<p>An external JNDI resource defines custom JNDI contexts and implements
the javax.naming.spi.InitialContextFactory interface. There is no
specific JNDI parent context for external JNDI resources, except for the
standard <code>java:comp/env/</code>.</p>
</div>
<div class="paragraph">
<p>Create an external JNDI resource in one of these ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To create an external JNDI resource using the Administration Console,
open the Resources component, open the JNDI component, and select
External Resources. For details, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>To create an external JNDI resource, use the
<code>asadmin create-jndi-resource</code> command. For details, see the
<a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="custom-resources"><a class="anchor" href="#custom-resources"></a>Custom Resources</h4>
<div class="paragraph">
<p>A custom resource specifies a custom server-wide resource object factory
that implements the javax.naming.spi.ObjectFactory interface. There is
no specific JNDI parent context for external JNDI resources, except for
the standard <code>java:comp/env/</code>.</p>
</div>
<div class="paragraph">
<p>Create a custom resource in one of these ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To create a custom resource using the Administration Console, open the
Resources component, open the JNDI component, and select Custom
Resources. For details, click the Help button in the Administration
Console.</p>
</li>
<li>
<p>To create a custom resource, use the <code>asadmin create-custom-resource</code>
command. For details, see the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="built-in-factories-for-custom-resources"><a class="anchor" href="#built-in-factories-for-custom-resources"></a>Built-in Factories for Custom Resources</h4>
<div class="paragraph">
<p>The Eclipse GlassFish provides built-in factories for the following types
of custom resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#javabeanfactory">JavaBeanFactory</a></p>
</li>
<li>
<p><a href="#propertiesfactory">PropertiesFactory</a></p>
</li>
<li>
<p><a href="#primitivesandstringfactory">PrimitivesAndStringFactory</a></p>
</li>
<li>
<p><a href="#urlfactory">URLFactory</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Template <code>glassfish-resources.xml</code> files for these built-in factories
and a <code>README</code> file are available at
as-install<code>/lib/install/templates/resources/custom/</code>. For more
information about the <code>glassfish-resources.xml</code> file, see the
<a href="application-deployment-guide.html#GSDPG">Eclipse GlassFish Application Deployment
Guide</a>.</p>
</div>
<div class="sect4">
<h5 id="javabeanfactory"><a class="anchor" href="#javabeanfactory"></a>JavaBeanFactory</h5>
<div class="paragraph">
<p>To create a custom resource that provides instances of a JavaBean class,
follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the custom resource&#8217;s factory class to
<code>org.glassfish.resources.custom.factory.JavaBeanFactory</code>.</p>
</li>
<li>
<p>Create a property in the custom resource for each setter method in
the JavaBean class.</p>
<div class="paragraph">
<p>For example, if the JavaBean class has a method named <code>setAccount</code>,
specify a property named <code>account</code> and give it a value.</p>
</div>
</li>
<li>
<p>Make sure the JavaBean class is accessible to the Eclipse GlassFish.</p>
<div class="paragraph">
<p>For example, you can place the JavaBean class in the as-install<code>/lib</code>
directory.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="propertiesfactory"><a class="anchor" href="#propertiesfactory"></a>PropertiesFactory</h5>
<div class="paragraph">
<p>To create a custom resource that provides properties to applications,
set the custom resource&#8217;s factory class to
<code>org.glassfish.resources.custom.factory.PropertiesFactory</code>, then specify
one or both of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a property in the custom resource named
<code>org.glassfish.resources.custom.factory.PropertiesFactory.fileName</code> and
specify as its value the path to a properties file or an XML file.</p>
<div class="paragraph">
<p>The path can be absolute or relative to as-install. The file must be
accessible to the Eclipse GlassFish.</p>
</div>
<div class="paragraph">
<p>If an XML file is specified, it must match the document type definition
(DTD) specified in the API definition of
<a href="http://download.oracle.com/javase/8/docs/api/java/util/Properties.html">java.util.Properties</a>
(<code><a href="http://docs.oracle.com/javase/8/docs/api/java/util/Properties.html" class="bare">http://docs.oracle.com/javase/8/docs/api/java/util/Properties.html</a></code>).</p>
</div>
</li>
<li>
<p>Create the desired properties directly as properties of the custom
resource.</p>
<div class="paragraph">
<p>If both the <code>fileName</code> property and other properties are specified, the
resulting property set is the union. If the same property is defined in
the file and directly in the custom resource, the value of the latter
takes precedence.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="primitivesandstringfactory"><a class="anchor" href="#primitivesandstringfactory"></a>PrimitivesAndStringFactory</h5>
<div class="paragraph">
<p>To create a custom resource that provides Java primitives to
applications, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the custom resource&#8217;s factory class to
<code>org.glassfish.resources.custom.factory.PrimitivesAndStringFactory</code>.</p>
</li>
<li>
<p>Set the custom resource&#8217;s resource type to one of the following or
its fully qualified wrapper class name equivalent:</p>
<div class="ulist">
<ul>
<li>
<p><code>int</code></p>
</li>
<li>
<p><code>long</code></p>
</li>
<li>
<p><code>double</code></p>
</li>
<li>
<p><code>float</code></p>
</li>
<li>
<p><code>char</code></p>
</li>
<li>
<p><code>short</code></p>
</li>
<li>
<p><code>byte</code></p>
</li>
<li>
<p><code>boolean</code></p>
</li>
<li>
<p><code>String</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Create a property in the custom resource named <code>value</code> and give it
the value needed by the application.</p>
<div class="paragraph">
<p>For example, If the application requires a <code>double</code> of value <code>22.1</code>,
create a property with the name <code>value</code> and the value <code>22.1</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="urlfactory"><a class="anchor" href="#urlfactory"></a>URLFactory</h5>
<div class="paragraph">
<p>To create a custom resource that provides URL instances to applications,
follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the custom resource&#8217;s factory class to
<code>org.glassfish.resources.custom.factory.URLObjectFactory</code>.</p>
</li>
<li>
<p>Choose which of the following constructors to use:</p>
<div class="ulist">
<ul>
<li>
<p><code>URL(protocol, host, port, file)</code></p>
</li>
<li>
<p><code>URL(protocol, host, file)</code></p>
</li>
<li>
<p><code>URL(spec)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Define properties according to the chosen constructor.</p>
<div class="paragraph">
<p>For example, for the first constructor, define properties named
<code>protocol</code>, <code>host</code>, <code>port</code>, and <code>file</code>. Example values might be <code>http</code>,
<code>localhost</code>, <code>8085</code>, and <code>index.html</code>, respectively.</p>
</div>
<div class="paragraph">
<p>For the third constructor, define a property named <code>spec</code> and assign it
the value of the entire URL.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-application-scoped-resources"><a class="anchor" href="#using-application-scoped-resources"></a>Using Application-Scoped Resources</h4>
<div class="paragraph">
<p>You can define an application-scoped JNDI or other resource for an
enterprise application, web module, EJB module, connector module, or
application client module by supplying a <code>glassfish-resources.xml</code>
deployment descriptor file. For details, see
"<a href="application-deployment-guide.html#application-scoped-resources">Application-Scoped Resources</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p><a id="GSDVG00194"></a><a id="using-a-custom-jndi.properties-file"></a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-a-custom-jndi-properties-file"><a class="anchor" href="#using-a-custom-jndi-properties-file"></a>Using a Custom <code>jndi.properties</code> File</h3>
<div class="paragraph">
<p>To use a custom <code>jndi.properties</code> file, JAR it and place it in the
domain-dir<code>/lib</code> directory. This adds the custom <code>jndi.properties</code> file
to the Common class loader. For more information about class loading,
see <a href="#class-loaders">Class Loaders</a>.</p>
</div>
<div class="paragraph">
<p>For each property found in more than one <code>jndi.properties</code> file, the
Jakarta EE naming service either uses the first value found or concatenates
all of the values, whichever makes sense.</p>
</div>
</div>
<div class="sect2">
<h3 id="mapping-references"><a class="anchor" href="#mapping-references"></a>Mapping References</h3>
<div class="paragraph">
<p>The following XML elements in the Eclipse GlassFish deployment
descriptors map resource references in application client, EJB, and web
application components to JNDI names configured in Eclipse GlassFish:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resource-env-ref</code> - Maps the <code>@Resource</code> or <code>@Resources</code> annotation
(or the <code>resource-env-ref</code> element in the corresponding Jakarta EE XML
file) to the absolute JNDI name configured in Eclipse GlassFish.</p>
</li>
<li>
<p><code>resource-ref</code> - Maps the <code>@Resource</code> or <code>@Resources</code> annotation (or
the <code>resource-ref</code> element in the corresponding Jakarta EE XML file) to the
absolute JNDI name configured in Eclipse GlassFish.</p>
</li>
<li>
<p><code>ejb-ref</code> - Maps the <code>@EJB</code> annotation (or the <code>ejb-ref</code> element in
the corresponding Jakarta EE XML file) to the absolute JNDI name configured
in Eclipse GlassFish.</p>
<div class="paragraph">
<p>JNDI names for EJB components must be unique. For example, appending the
application name and the module name to the EJB name is one way to
guarantee unique names. In this case, <code>mycompany.pkging.pkgingEJB.MyEJB</code>
would be the JNDI name for an EJB in the module <code>pkgingEJB.jar</code>, which
is packaged in the <code>pkging.ear</code> application.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These elements are part of the <code>glassfish-web.xml</code>,
<code>glassfish-application-client.xml</code>, <code>glassfish-ejb-jar.xml</code>, and
<code>glassfish-application.xml</code> deployment descriptor files. For more
information about how these elements behave in each of the deployment
descriptor files, see "<a href="application-deployment-guide.html#c-elements-of-the-glassfish-server-deployment-descriptors">Elements of the Eclipse GlassFish
Deployment Descriptors</a>" in Eclipse GlassFish
Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>The rest of this section uses an example of a JDBC resource lookup to
describe how to reference resource factories. The same principle is
applicable to all resources (such as JMS destinations, Jakarta Mail
sessions, and so on).</p>
</div>
<div class="paragraph">
<p>The <code>@Resource</code> annotation in the application code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/helloDbDs</span><span class="delimiter">&quot;</span></span>) javax.sql.DataSource ds;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This references a resource with the JNDI name of <code>java:jdbc/helloDbDs</code>.
If this is the JNDI name of the JDBC resource configured in the
Eclipse GlassFish, the annotation alone is enough to reference the
resource.</p>
</div>
<div class="paragraph">
<p>However, you can use a Eclipse GlassFish specific deployment descriptor
to override the annotation. For example, the <code>resource-ref</code> element in
the <code>glassfish-web.xml</code> file maps the <code>res-ref-name</code> (the name specified
in the annotation) to the JNDI name of another JDBC resource configured
in Eclipse GlassFish.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource-ref&gt;</span>
   <span class="tag">&lt;res-ref-name&gt;</span>jdbc/helloDbDs<span class="tag">&lt;/res-ref-name&gt;</span>
   <span class="tag">&lt;jndi-name&gt;</span>jdbc/helloDbDataSource<span class="tag">&lt;/jndi-name&gt;</span>
<span class="tag">&lt;/resource-ref&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-java-message-service"><a class="anchor" href="#using-the-java-message-service"></a>23. Using the Java Message Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to use the Java Message Service (JMS) API.
The Eclipse GlassFish has a fully integrated JMS provider: the
Open Message Queue software.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>JMS resources are supported only in the full Eclipse GlassFish, not in
the Web Profile.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For information about the JMS, see
<a href="https://eclipse-ee4j.github.io/jakartaee-tutorial/#messaging">Messaging</a>
in The Jakarta EE Tutorial.</p>
</div>
<div class="paragraph">
<p>For detailed information about JMS concepts and JMS support in the
Eclipse GlassFish, see "<a href="administration-guide.html#administering-the-java-message-service-jms">Administering the Java Message
Service (JMS)</a>" in Eclipse GlassFish Administration
Guide.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-application-scoped-jms-resources">Using Application-Scoped JMS Resources</a></p>
</li>
<li>
<p><a href="#load-balanced-message-inflow">Load-Balanced Message Inflow</a></p>
</li>
<li>
<p><a href="#authentication-with-connectionfactory">Authentication With <code>ConnectionFactory</code></a></p>
</li>
<li>
<p><a href="#delivering-soap-messages-using-the-jms-api">Delivering SOAP Messages Using the JMS API</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="using-application-scoped-jms-resources"><a class="anchor" href="#using-application-scoped-jms-resources"></a>Using Application-Scoped JMS Resources</h3>
<div class="paragraph">
<p>You can define an application-scoped JMS or other resource for an
enterprise application, web module, EJB module, connector module, or
application client module by supplying a <code>glassfish-resources.xml</code>
deployment descriptor file. For details, see
"<a href="application-deployment-guide.html#application-scoped-resources">Application-Scoped Resources</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="load-balanced-message-inflow"><a class="anchor" href="#load-balanced-message-inflow"></a>Load-Balanced Message Inflow</h3>
<div class="paragraph">
<p>You can configure <code>ActivationSpec</code> properties of the <code>jmsra</code> resource
adapter in the <code>glassfish-ejb-jar.xml</code> file for a message-driven bean
using <code>activation-config-property</code> elements. Whenever a message-driven
bean (<code>EndPointFactory</code>) is deployed, the connector runtime engine finds
these properties and configures them accordingly in the resource
adapter. See "<a href="application-deployment-guide.html#activation-config-property">activation-config-property</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
<div class="paragraph">
<p>The Eclipse GlassFish transparently enables messages to be delivered in
random fashion to message-driven beans having same <code>ClientID</code>. The
<code>ClientID</code> is required for durable subscribers.</p>
</div>
<div class="paragraph">
<p>For nondurable subscribers in which the <code>ClientID</code> is not configured,
all instances of a specific message-driven bean that subscribe to same
topic are considered equal. When a message-driven bean is deployed to
multiple instances of the Eclipse GlassFish, only one of the
message-driven beans receives the message. If multiple distinct
message-driven beans subscribe to same topic, one instance of each
message-driven bean receives a copy of the message.</p>
</div>
<div class="paragraph">
<p>To support multiple consumers using the same queue, set the
<code>maxNumActiveConsumers</code> property of the physical destination to a large
value. If this property is set, the Oracle Message Queue software allows
multiple message-driven beans to consume messages from same queue. The
message is delivered randomly to the message-driven beans. If
<code>maxNumActiveConsumers</code> is set to <code>-1</code>, there is no limit to the number
of consumers.</p>
</div>
<div class="paragraph">
<p>To ensure that local delivery is preferred, set <code>addresslist-behavior</code>
to <code>priority</code>. This setting specifies that the first broker in the
<code>AddressList</code> is selected first. This first broker is the local
colocated Message Queue instance. If this broker is unavailable,
connection attempts are made to brokers in the order in which they are
listed in the <code>AddressList</code>. This setting is the default for Eclipse GlassFish instances that belong to a cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="authentication-with-connectionfactory"><a class="anchor" href="#authentication-with-connectionfactory"></a>Authentication With <code>ConnectionFactory</code></h3>
<div class="paragraph">
<p>If your web, EJB, or client module has <code>res-auth</code> set to <code>Container</code>,
but you use the <code>ConnectionFactory.createConnection("user","password")</code>
method to get a connection, the Eclipse GlassFish searches the container
for authentication information before using the supplied user and
password. Version 7 of the Eclipse GlassFish threw an exception in this
situation.</p>
</div>
</div>
<div class="sect2">
<h3 id="delivering-soap-messages-using-the-jms-api"><a class="anchor" href="#delivering-soap-messages-using-the-jms-api"></a>Delivering SOAP Messages Using the JMS API</h3>
<div class="paragraph">
<p>Web service clients use the Simple Object Access Protocol (SOAP) to
communicate with web services. SOAP uses a combination of XML-based data
structuring and Hyper Text Transfer Protocol (HTTP) to define a
standardized way of invoking methods in objects distributed in diverse
operating environments across the Internet.</p>
</div>
<div class="paragraph">
<p>For more information about SOAP, see the Apache SOAP web site at
<code><a href="http://xml.apache.org/soap/index.html" class="bare">http://xml.apache.org/soap/index.html</a></code>.</p>
</div>
<div class="paragraph">
<p>You can take advantage of the JMS provider&#8217;s reliable messaging when
delivering SOAP messages. You can convert a SOAP message into a JMS
message, send the JMS message, then convert the JMS message back into a
SOAP message.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#to-send-soap-messages-using-the-jms-api">To Send SOAP Messages Using the JMS API</a></p>
</li>
<li>
<p><a href="#to-receive-soap-messages-using-the-jms-api">To Receive SOAP Messages Using the JMS API</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="to-send-soap-messages-using-the-jms-api"><a class="anchor" href="#to-send-soap-messages-using-the-jms-api"></a>To Send SOAP Messages Using the JMS API</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the <code>MessageTransformer</code> library.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.sun.messaging.xml.MessageTransformer</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the utility whose methods you use to convert SOAP messages to
JMS messages and the reverse. You can then send a JMS message containing
a SOAP payload as if it were a normal JMS message.</p>
</div>
</li>
<li>
<p>Initialize the <code>TopicConnectionFactory</code>, <code>TopicConnection</code>,
<code>TopicSession</code>, and publisher.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tcf = <span class="keyword">new</span> TopicConnectionFactory();
tc = tcf.createTopicConnection();
session = tc.createTopicSession(<span class="predefined-constant">false</span>,Session.AUTO_ACKNOWLEDGE);
topic = session.createTopic(topicName);
publisher = session.createPublisher(topic);</code></pre>
</div>
</div>
</li>
<li>
<p>Construct a SOAP message using the SOAP with Attachments API for
Java (SAAJ).</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/*construct a default soap MessageFactory */</span>
MessageFactory mf = MessageFactory.newInstance();
* Create a SOAP message object.*/
SOAPMessage soapMessage = mf.createMessage();
<span class="comment">/** Get SOAP part.*/</span>
SOAPPart soapPart = soapMessage.getSOAPPart();
<span class="comment">/* Get SOAP envelope. */</span>
SOAPEnvelope soapEnvelope = soapPart.getEnvelope();
<span class="comment">/* Get SOAP body.*/</span>
SOAPBody soapBody = soapEnvelope.getBody();
<span class="comment">/* Create a name object. with name space */</span>
<span class="comment">/* http://www.sun.com/imq. */</span>
<span class="predefined-type">Name</span> name = soapEnvelope.createName(<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloWorld</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hw</span><span class="delimiter">&quot;</span></span>,
 <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.sun.com/imq</span><span class="delimiter">&quot;</span></span>);
* Add child element with the above name. */
SOAPElement element = soapBody.addChildElement(name)
<span class="comment">/* Add another child element.*/</span>
element.addTextNode( <span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome to GlassFish Web Services.</span><span class="delimiter">&quot;</span></span> );
<span class="comment">/* Create an atachment with activation API.*/</span>
<span class="predefined-type">URL</span> url = <span class="keyword">new</span> <span class="predefined-type">URL</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/webservices/</span><span class="delimiter">&quot;</span></span>);
DataHandler dh = <span class="keyword">new</span> DataHandler (url);
AttachmentPart ap = soapMessage.createAttachmentPart(dh);
<span class="comment">/*set content type/ID. */</span>
ap.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>);
ap.setContentId(<span class="string"><span class="delimiter">&quot;</span><span class="content">cid-001</span><span class="delimiter">&quot;</span></span>);
<span class="comment">/** add the attachment to the SOAP message.*/</span>
soapMessage.addAttachmentPart(ap);
soapMessage.saveChanges();</code></pre>
</div>
</div>
</li>
<li>
<p>Convert the SOAP message to a JMS message by calling the
<code>MessageTransformer.SOAPMessageintoJMSMessage()</code> method.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Message m = MessageTransformer.SOAPMessageIntoJMSMessage (soapMessage, session );</code></pre>
</div>
</div>
</li>
<li>
<p>Publish the JMS message.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">publisher.publish(m);</code></pre>
</div>
</div>
</li>
<li>
<p>Close the JMS connection.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tc.close();</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-receive-soap-messages-using-the-jms-api"><a class="anchor" href="#to-receive-soap-messages-using-the-jms-api"></a>To Receive SOAP Messages Using the JMS API</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the <code>MessageTransformer</code> library.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.sun.messaging.xml.MessageTransformer</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the utility whose methods you use to convert SOAP messages to
JMS messages and the reverse. The JMS message containing the SOAP
payload is received as if it were a normal JMS message.</p>
</div>
</li>
<li>
<p>Initialize the <code>TopicConnectionFactory</code>, <code>TopicConnection</code>,
<code>TopicSession</code>, <code>TopicSubscriber</code>, and Topic.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">messageFactory = MessageFactory.newInstance();
tcf = <span class="keyword">new</span> com.sun.messaging.TopicConnectionFactory();
tc = tcf.createTopicConnection();
session = tc.createTopicSession(<span class="predefined-constant">false</span>, Session.AUTO_ACKNOWLEDGE);
topic = session.createTopic(topicName);
subscriber = session.createSubscriber(topic);
subscriber.setMessageListener(<span class="local-variable">this</span>);
tc.start();</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>OnMessage</code> method to receive the message. Use the
<code>SOAPMessageFromJMSMessage</code> method to convert the JMS message to a SOAP
message.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> onMessage (Message message) {
SOAPMessage soapMessage = MessageTransformer.SOAPMessageFromJMSMessage(message, messageFactory );
}</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the content of the SOAP message.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-jakarta-mail-api"><a class="anchor" href="#using-the-jakarta-mail-api"></a>24. Using the Jakarta Mail API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to use the Jakarta Mail API, which provides a set
of abstract classes defining objects that comprise a mail system.</p>
</div>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#introducing-jakarta-mail">Introducing Jakarta Mail</a></p>
</li>
<li>
<p><a href="#creating-a-jakarta-mail-session">Creating a Jakarta Mail Session</a></p>
</li>
<li>
<p><a href="#jakarta-mail-session-properties">Jakarta Mail Session Properties</a></p>
</li>
<li>
<p><a href="#looking-up-a-jakarta-mail-session">Looking Up a Jakarta Mail Session</a></p>
</li>
<li>
<p><a href="#sending-and-reading-messages-using-jakarta-mail">Sending and Reading Messages Using Jakarta Mail</a></p>
</li>
<li>
<p><a href="#using-application-scoped-jakarta-mail-resources">Using Application-Scoped Jakarta Mail Resources</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Jakarta Mail resources are supported only in the full Eclipse GlassFish, not in the Web Profile.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="introducing-jakarta-mail"><a class="anchor" href="#introducing-jakarta-mail"></a>Introducing Jakarta Mail</h3>
<div class="paragraph">
<p>The Jakarta Mail API defines classes such as <code>Message</code>, <code>Store</code>, and
<code>Transport</code>. The API can be extended and can be subclassed to provide
new protocols and to add functionality when necessary. In addition, the
API provides concrete subclasses of the abstract classes. These
subclasses, including <code>MimeMessage</code> and <code>MimeBodyPart</code>, implement widely
used Internet mail protocols and conform to the RFC822 and RFC2045
specifications. The Jakarta Mail API includes support for the IMAP4, POP3,
and SMTP protocols.</p>
</div>
<div class="paragraph">
<p>The Jakarta Mail architectural components are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The abstract layer declares classes, interfaces, and abstract methods
intended to support mail handling functions that all mail systems
support.</p>
</li>
<li>
<p>The internet implementation layer implements part of the abstract
layer using the RFC822 and MIME internet standards.</p>
</li>
<li>
<p>Jakarta Mail uses the JavaBeans Activation Framework (JAF) to encapsulate
message data and to handle commands intended to interact with that data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see
"<a href="administration-guide.html#administering-the-jakarta-mail-service">Administering the Jakarta Mail Service</a>"
in Eclipse GlassFish Administration Guide
and the Jakarta Mail specification at
<code><a href="https://jakarta.ee/specifications/mail" class="bare">https://jakarta.ee/specifications/mail</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-jakarta-mail-session"><a class="anchor" href="#creating-a-jakarta-mail-session"></a>Creating a Jakarta Mail Session</h3>
<div class="paragraph">
<p>You can create a Jakarta Mail session in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Administration Console, open the Resources component and select
Jakarta Mail Sessions. For details, click the Help button in the
Administration Console.</p>
</li>
<li>
<p>Use the <code>asadmin create-mail-resource</code> command. For details, see
the <a href="reference-manual.html#GSRFM">Eclipse GlassFish Reference Manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-mail-session-properties"><a class="anchor" href="#jakarta-mail-session-properties"></a>Jakarta Mail Session Properties</h3>
<div class="paragraph">
<p>You can set properties for a Jakarta Mail <code>Session</code> object. Every property
name must start with a <code>mail-</code> prefix. The Eclipse GlassFish changes the
dash (<code>-</code>) character to a period (<code>.</code>) in the name of the property and
saves the property to the <code>MailConfiguration</code> and Jakarta Mail <code>Session</code>
objects. If the name of the property doesn&#8217;t start with <code>mail-</code>, the
property is ignored.</p>
</div>
<div class="paragraph">
<p>For example, if you want to define the property <code>mail.from</code> in a
Jakarta Mail <code>Session</code> object, first define the property as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name - <code>mail-from</code></p>
</li>
<li>
<p>Value - <code>john.doe@sun.com</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="looking-up-a-jakarta-mail-session"><a class="anchor" href="#looking-up-a-jakarta-mail-session"></a>Looking Up a Jakarta Mail Session</h3>
<div class="paragraph">
<p>The standard Java Naming and Directory Interface (JNDI) subcontext for
Jakarta Mail sessions is <code>java:comp/env/mail</code>.</p>
</div>
<div class="paragraph">
<p>Registering Jakarta Mail sessions in the <code>mail</code> naming subcontext of a JNDI
namespace, or in one of its child subcontexts, is standard. The JNDI
namespace is hierarchical, like a file system&#8217;s directory structure, so
it is easy to find and nest references. A Jakarta Mail session is bound to a
logical JNDI name. The name identifies a subcontext, <code>mail</code>, of the root
context, and a logical name. To change the Jakarta Mail session, you can
change its entry in the JNDI namespace without having to modify the
application.</p>
</div>
<div class="paragraph">
<p>The resource lookup in the application code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">InitialContext</span> ic = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
<span class="predefined-type">String</span> snName = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/mail/MyMailSession</span><span class="delimiter">&quot;</span></span>;
Session session = (Session)ic.lookup(snName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the JNDI API, see <a href="#using-the-java-naming-and-directory-interface">Using
the Java Naming and Directory Interface</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sending-and-reading-messages-using-jakarta-mail"><a class="anchor" href="#sending-and-reading-messages-using-jakarta-mail"></a>Sending and Reading Messages Using Jakarta Mail</h3>
<div class="paragraph">
<p>The following topics are addressed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#to-send-a-message-using-jakarta-mail">To Send a Message Using Jakarta Mail</a></p>
</li>
<li>
<p><a href="#to-read-a-message-using-jakarta-mail">To Read a Message Using Jakarta Mail</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="to-send-a-message-using-jakarta-mail"><a class="anchor" href="#to-send-a-message-using-jakarta-mail"></a>To Send a Message Using Jakarta Mail</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the packages that you need.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.util</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.activation</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.mail</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.mail.internet</span>.*;
<span class="keyword">import</span> <span class="include">javax.naming</span>.*;</code></pre>
</div>
</div>
</li>
<li>
<p>Look up the Jakarta Mail session.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">InitialContext</span> ic = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
<span class="predefined-type">String</span> snName = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/mail/MyMailSession</span><span class="delimiter">&quot;</span></span>;
Session session = (Session)ic.lookup(snName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="#looking-up-a-jakarta-mail-session">Looking Up a Jakarta Mail Session</a>.</p>
</div>
</li>
<li>
<p>Override the Jakarta Mail session properties if necessary.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> props = session.getProperties();
props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">user2@mailserver.com</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>MimeMessage</code>.</p>
<div class="paragraph">
<p>The msgRecipient, msgSubject, and msgTxt variables in the following
example contain input from the user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Message msg = <span class="keyword">new</span> MimeMessage(session);
msg.setSubject(msgSubject);
msg.setSentDate(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
msg.setFrom();
msg.setRecipients(Message.RecipientType.TO,
   InternetAddress.parse(msgRecipient, <span class="predefined-constant">false</span>));
msg.setText(msgTxt);</code></pre>
</div>
</div>
</li>
<li>
<p>Send the message.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Transport.send(msg);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-read-a-message-using-jakarta-mail"><a class="anchor" href="#to-read-a-message-using-jakarta-mail"></a>To Read a Message Using Jakarta Mail</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the packages that you need.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.util</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.activation</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.mail</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.mail.internet</span>.*;
<span class="keyword">import</span> <span class="include">javax.naming</span>.*;</code></pre>
</div>
</div>
</li>
<li>
<p>Look up the Jakarta Mail session.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">InitialContext</span> ic = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
<span class="predefined-type">String</span> snName = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/mail/MyMailSession</span><span class="delimiter">&quot;</span></span>;
Session session = (jakarta.mail.Session)ic.lookup(snName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="#looking-up-a-jakarta-mail-session">Looking Up a Jakarta Mail Session</a>.</p>
</div>
</li>
<li>
<p>Override the Jakarta Mail session properties if necessary.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> props = session.getProperties();
props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.from</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">user2@mailserver.com</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
<li>
<p>Get a <code>Store</code> object from the <code>Session</code>, then connect to the mail
server using the Store object&#8217;s <code>connect</code> method.</p>
<div class="paragraph">
<p>You must supply a mail server name, a mail user name, and a password.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Store store = session.getStore();
store.connect(<span class="string"><span class="delimiter">&quot;</span><span class="content">MailServer</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">MailUser</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
<li>
<p>Get the INBOX folder.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Folder folder = store.getFolder(<span class="string"><span class="delimiter">&quot;</span><span class="content">INBOX</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
<li>
<p>It is efficient to read the <code>Message</code> objects (which represent
messages on the server) into an array.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Message<span class="type">[]</span> messages = folder.getMessages();</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-application-scoped-jakarta-mail-resources"><a class="anchor" href="#using-application-scoped-jakarta-mail-resources"></a>Using Application-Scoped Jakarta Mail Resources</h3>
<div class="paragraph">
<p>You can define an application-scoped Jakarta Mail or other resource for an
enterprise application, web module, EJB module, connector module, or
application client module by supplying a <code>glassfish-resources.xml</code>
deployment descriptor file. For details, see
"<a href="application-deployment-guide.html#application-scoped-resources">Application-Scoped Resources</a>" in Eclipse GlassFish Application Deployment Guide.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-06 22:57:12 UTC
</div>
</div>
</body>
</html>